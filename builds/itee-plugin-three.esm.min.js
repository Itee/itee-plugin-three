import{DefaultLogger as e,TBinaryReader as t,Endianness as i,FileFormat as s,Keys as n,Mouse as o,TDataBaseManager as r,ResponseType as a}from"itee-client";import{DefaultLoadingManager as h,Box3 as l,FileLoader as c,Group as d,BufferGeometry as p,BufferAttribute as u,PointsMaterial as m,Points as _,TextureLoader as f,Mesh as g,PlaneGeometry as v,MeshBasicMaterial as b,DoubleSide as w,MathUtils as y,Vector3 as x,Shape as E,ColladaLoader as M,FBXLoader as P,ObjectLoader as A,OBJLoader as T,ShapeBufferGeometry as S,MeshPhongMaterial as D,STLLoader as O,MTLLoader as k,EventDispatcher as C,Object3D as I,Camera as z,Vector2 as F,Spherical as L,Quaternion as B,MOUSE as j,LineSegments as R,EdgesGeometry as G,BoxBufferGeometry as U,LineBasicMaterial as H,Plane as N,CylinderBufferGeometry as X,Float32BufferAttribute as Y,OctahedronBufferGeometry as Z,SphereBufferGeometry as V,TorusBufferGeometry as W,Line as $,ConeBufferGeometry as q,PlaneBufferGeometry as J,Raycaster as K,Euler as Q,Scene as ee,SplineCurve as te,QuadraticBezierCurve3 as ie,QuadraticBezierCurve as se,Path as ne,LineCurve3 as oe,LineCurve as re,EllipseCurve as ae,CurvePath as he,Curve as le,CubicBezierCurve3 as ce,CubicBezierCurve as de,CatmullRomCurve3 as pe,ArcCurve as ue,WireframeGeometry as me,SphereGeometry as _e,TubeGeometry as fe,TorusKnotGeometry as ge,TorusGeometry as ve,TextGeometry as be,TetrahedronGeometry as we,ShapeGeometry as ye,RingGeometry as xe,PolyhedronGeometry as Ee,ParametricGeometry as Me,OctahedronGeometry as Pe,LatheGeometry as Ae,IcosahedronGeometry as Te,Geometry as Se,ExtrudeGeometry as De,DodecahedronGeometry as Oe,ConeGeometry as ke,CylinderGeometry as Ce,CircleGeometry as Ie,BoxGeometry as ze,Face3 as Fe,InstancedBufferGeometry as Le,TubeBufferGeometry as Be,TorusKnotBufferGeometry as je,TextBufferGeometry as Re,TetrahedronBufferGeometry as Ge,RingBufferGeometry as Ue,PolyhedronBufferGeometry as He,ParametricBufferGeometry as Ne,LatheBufferGeometry as Xe,IcosahedronBufferGeometry as Ye,ExtrudeBufferGeometry as Ze,DodecahedronBufferGeometry as Ve,CircleBufferGeometry as We,ImageLoader as $e,MeshLambertMaterial as qe,Color as Je,LinearFilter as Ke,Sprite as Qe,LineLoop as et,LOD as tt,SkinnedMesh as it,HemisphereLight as st,SpotLight as nt,RectAreaLight as ot,PointLight as rt,DirectionalLight as at,AmbientLight as ht,OrthographicCamera as lt,PerspectiveCamera as ct,Fog as dt,FogExp2 as pt,VertexColors as ut}from"three-full";import{degreesToRadians as mt,toEnum as _t}from"itee-utils";import{isObject as ft,isFunction as gt,isArray as vt,isString as bt,isNull as wt,isUndefined as yt,isNotBoolean as xt,isEmptyArray as Et,isNotDefined as Mt,isDefined as Pt,isNotArray as At,isNotString as Tt,isEmptyString as St,isBlankString as Dt,isNotEmptyString as Ot,isNotEmptyArray as kt}from"itee-validators";
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @file A loader for ASC cloud point files.
 *
 * @example
 *    var loader = new ASCLoader();
 *    loader.load('/path/to/file.asc', function (geometry) {
 *
 *		scene.add( new Mesh( geometry ) );
 *
 *	} );
 *
 * If the ASC file need to be offset,
 * it can be set before loading file.
 *
 * loader.setOffset( {
 *	x: 1.0,
 *  y: 52.0,
 *  z: -5.0
 * } );
 *
 */class Ct{constructor(t=h,i=e){this.manager=t,this.logger=i,this._boundingBox=new l,this._points=[],this._numberOfPoints=0,this._coloredPoints=!1,this._autoOffset=!1,this._offset={x:0,y:0,z:0},this._positions=null,this._bufferIndex=0,this._positionsC=null,this._bufferIndexC=0,this.wrongPoints=0}load(e,t,i,s,n){const o=new c(this.manager);o.setResponseType("blob"),o.load(e,function(e){const o=new d;this._parse(e,o,t,i,s,n),t(o)}.bind(this),i,s)}setOffset(e){this._offset=e,this._autoOffset=!1}_parse(e,t,i,s,n,o){const r=this,a=o||100,h=new FileReader;let l=0;function c(){if(l>=e.size)return;const t=e.slice(l,l+134217728,"text/plain");h.readAsText(t)}h.onabort=e=>{this.logger.log("abortEvent:"),this.logger.log(e)},h.onerror=e=>{this.logger.log("errorEvent:"),this.logger.log(e),n&&n(e)},h.onloadstart=e=>{this.logger.log("loadStartEvent:"),this.logger.log(e)},h.onprogress=e=>{this.logger.log("progressEvent:"),this.logger.log(e),s&&s(e)},h.onload=e=>{this.logger.log("loadEvent:"),this.logger.log(e);const t=e.target.result.split("\n"),i=t.length;l-=t[i-1].length;const s=Math.round(100/a);for(let e=0;e<i-1;e++)e%s==0&&r._parseLine(t[e])},h.onloadend=i=>{this.logger.log("loadEndEvent"),this.logger.log(i),(this._points.length>1e6||l+134217728>=e.size)&&(this._offsetPoints(),this._createSubCloudPoint(t)),l+=134217728,c()},c()}_parseLine(e){const t=e.split(/\s/g).filter(Boolean),i=t.length;3===i?this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2])}):4===i?(this._pointsHaveIntensity=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3])})):6===i?(this._pointsHaveColor=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),r:parseFloat(t[3]),g:parseFloat(t[4]),b:parseFloat(t[5])})):7===i?(this._pointsHaveIntensity=!0,this._pointsHaveColor=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),r:parseFloat(t[4]),g:parseFloat(t[5]),b:parseFloat(t[6])})):9===i?(this._pointsHaveColor=!0,this._pointsHaveNormals=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),r:parseFloat(t[3]),g:parseFloat(t[4]),b:parseFloat(t[5]),nx:parseFloat(t[6]),ny:parseFloat(t[7]),nz:parseFloat(t[8])})):10===i?(this._pointsHaveIntensity=!0,this._pointsHaveColor=!0,this._pointsHaveNormals=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),r:parseFloat(t[4]),g:parseFloat(t[5]),b:parseFloat(t[6]),nx:parseFloat(t[7]),ny:parseFloat(t[8]),nz:parseFloat(t[9])})):this.logger.error(`Invalid data line: ${e}`)}_parseLines(e){const t=e[0].split(/\s/g).filter(Boolean).length;3===t?this._parseLinesAsXYZ(e):4===t?this._parseLinesAsXYZI(e):6===t?this._parseLinesAsXYZRGB(e):7===t?this._parseLinesAsXYZIRGB(e):9===t?this._parseLinesAsXYZRGBnXnYnZ(e):10===t?this._parseLinesAsXYZIRGBnXnYnZ(e):this.logger.error(`Invalid data line: ${e}`)}_parseLinesAsXYZ(e){let t=[];for(let i=0,s=e.length;i<s;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2])})}_parseLinesAsXYZI(e){this._pointsHaveIntensity=!0;let t=[];for(let i=0,s=e.length;i<s;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3])})}_parseLinesAsXYZRGB(e){this._pointsHaveColor=!0;let t=[];for(let i=0,s=e.length;i<s;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),r:parseFloat(t[3]),g:parseFloat(t[4]),b:parseFloat(t[5])})}_parseLinesAsXYZnXnYnZ(e){let t=[];for(let i=0,s=e.length;i<s;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),nx:parseFloat(t[7]),ny:parseFloat(t[8]),nz:parseFloat(t[9])})}_parseLinesAsXYZIRGB(e){this._pointsHaveIntensity=!0,this._pointsHaveColor=!0;let t=[];for(let i=0,s=e.length;i<s;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),r:parseFloat(t[4]),g:parseFloat(t[5]),b:parseFloat(t[6])})}_parseLinesAsXYZInXnYnZ(e){let t=[];for(let i=0,s=e.length;i<s;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),nx:parseFloat(t[7]),ny:parseFloat(t[8]),nz:parseFloat(t[9])})}_parseLinesAsXYZRGBnXnYnZ(e){this._pointsHaveColor=!0,this._pointsHaveNormals=!0;let t=[];for(let i=0,s=e.length;i<s;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),r:parseFloat(t[3]),g:parseFloat(t[4]),b:parseFloat(t[5]),nx:parseFloat(t[6]),ny:parseFloat(t[7]),nz:parseFloat(t[8])})}_parseLinesAsXYZIRGBnXnYnZ(e){this._pointsHaveIntensity=!0,this._pointsHaveColor=!0,this._pointsHaveNormals=!0;let t=[];for(let i=0,s=e.length;i<s;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),r:parseFloat(t[4]),g:parseFloat(t[5]),b:parseFloat(t[6]),nx:parseFloat(t[7]),ny:parseFloat(t[8]),nz:parseFloat(t[9])})}_parseLineB(e){const t=e.split(/\s/g).filter(Boolean),i=t.length,s=this._bufferIndex;3===i&&(this._positions[s]=parseFloat(t[0]),this._positions[s+1]=parseFloat(t[1]),this._positions[s+2]=parseFloat(t[2]),this._bufferIndex+=3)}_parseLineC(e){const t=e.split(/\s/g).filter(Boolean),i=t.length,s=this._bufferIndexC;3===i&&(this._positionsC[s]=Number.parseFloat(t[0]),this._positionsC[s+1]=Number.parseFloat(t[1]),this._positionsC[s+2]=Number.parseFloat(t[2]),this._bufferIndexC+=3)}_offsetPoints(){this._autoOffset&&(this._boundingBox.setFromPoints(this._points),this.setOffset(this._boundingBox.getCenter()));const e=this._offset.x,t=this._offset.y,i=this._offset.z;let s=null;for(let n=0,o=this._points.length;n<o;++n)s=this._points[n],s.x-=e,s.y-=t,s.z-=i}_createCloudPoint(e){const t=this._points.length,i=Math.ceil(t/1e6);let s=null,n=0,o=null;for(let t=0;t<i;++t){s=this._points.splice(0,1e6),n=s.length;const t=new p,i=new Float32Array(3*n),r=new Float32Array(3*n);let a=0,h=null;for(let e=0;e<n;++e)h=s[e],i[a]=h.x,i[a+1]=h.y,i[a+2]=h.z,this._pointsHaveColor?(r[a]=h.r/255,r[a+1]=h.g/255,r[a+2]=h.b/255):(r[a]=.1,r[a+1]=.2,r[a+2]=.5),a+=3;t.setAttribute("position",new u(i,3)),t.setAttribute("color",new u(r,3));const l=new m({size:.01,vertexColors:!0});o=new _(t,l),e.children.push(o)}}_createSubCloudPoint(e){const t=this._points.length,i=new p,s=new Float32Array(3*t),n=new Float32Array(3*t);let o=0,r=null;for(let e=0;e<t;++e)r=this._points[e],s[o]=r.x,s[o+1]=r.y,s[o+2]=r.z,this._pointsHaveColor?(n[o]=r.r/255,n[o+1]=r.g/255,n[o+2]=r.b/255):(n[o]=.1,n[o+1]=.2,n[o+2]=.5),o+=3;i.setAttribute("position",new u(s,3)),i.setAttribute("color",new u(n,3));const a=new m({size:.005,vertexColors:!0}),h=new _(i,a);h.rotation.x-=Math.PI/2,e.children.push(h),this._points=[]}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * From:
 * https://www.clicketyclick.dk/databases/xbase/format/db2_dbf.html#DBII_DBF_STRUCT
 * http://web.archive.org/web/20150323061445/http://ulisse.elettra.trieste.it/services/doc/dbase/DBFstruct.htm
 * http://www.dbase.com/Knowledgebase/INT/db7_file_fmt.htm
 *
 * @class Todo...
 * @classdesc Todo...
 * @example Todo...
 *
 */const It=Object.freeze({FoxPro:48,FoxPro_Autoincrement:49,dBASE_II:2,FoxPro_Var:50,dBASE_III_plus:3,dBASE_III_plus_memo:131,dBASE_IV_SQL_table:67,dBASE_IV_SQL_system:99,dBASE_IV_memo:139,dBASE_IV_memo_SQL_table:203,FoxBase:251,dBase_v_7:4,FoxPro_2_x:245,HiPerSix_memo:229}),zt=Object.freeze({Binary:"B",Character:"C",Date:"D",Numeric:"N",Logical:"L",Memo:"M",Timestamp:"@",Long:"I",Autoincrement:"+",Float:"F",Double:"O",OLE:"G"});function Ft(i=h,s=e){this.manager=i,this.logger=s,this.reader=new t}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @class Todo...
 * @classdesc Todo...
 * @example Todo...
 *
 */
function Lt(t=h,i=e){this.manager=t,this.logger=i,this.textureLoader=new f,this.imagesShotData=[]}Object.assign(Ft,{Terminator:13,DeletedRecord:26,YearOffset:1900}),Object.assign(Ft.prototype,{load(e,t,i,s){const n=this,o=new c(n.manager);o.setResponseType("arraybuffer"),o.load(e,e=>{t(n.parse(e))},i,s)},parse(e){this.reader.setEndianess(i.Big).setBuffer(e);const t=this.reader.getInt8();if(!this._isValidVersion(t))return this.logger.error(`DBFLoader: Invalid version number: ${t}`),null;const s=this._parseHeader(t);return{header:s,datas:this._parseDatas(t,s)}},_isValidVersion:e=>Object.values(It).includes(e),_parseHeader(e){let t={};switch(e){case It.FoxPro:case It.FoxPro_Autoincrement:case It.FoxPro_Var:case It.dBASE_II:t=this._parseHeaderV2();break;case It.dBASE_III_plus:case It.dBASE_III_plus_memo:t=this._parseHeaderV2_5();break;case It.dBASE_IV_memo:case It.dBASE_IV_memo_SQL_table:case It.dBASE_IV_SQL_system:case It.dBASE_IV_SQL_table:t=this._parseHeaderV3();break;case It.dBase_v_7:case It.FoxPro_2_x:case It.HiPerSix_memo:t=this._parseHeaderV4();break;default:throw new RangeError(`Invalid version parameter: ${e}`)}return this.reader.getUint8()!==Ft.Terminator&&this.logger.error("DBFLoader: Invalid terminator after field descriptors !!!"),t},_parseHeaderV2(){const e=this.reader.getInt16(),t=this.reader.getInt8()+Ft.YearOffset,i=this.reader.getInt8(),s=this.reader.getInt8(),n=this.reader.getInt16();let o=[],r=void 0,a=void 0,h=void 0,l=void 0,c=void 0;for(let t=0;t<e;t++)r=this.reader.getString(11),a=this.reader.getChar(),h=this.reader.getUint8(),l=this.reader.getInt16(),c=this.reader.getInt8(),o.push({name:r,type:a,length:h,memoryAddress:l,decimalCount:c});return{numberOfRecords:e,year:t,month:i,day:s,lengthOfEachRecords:n,fields:o}},_parseHeaderV2_5(){const e=this.reader.getInt8()+Ft.YearOffset,t=this.reader.getInt8(),s=this.reader.getInt8();this.reader.setEndianess(i.Little);const n=this.reader.getInt32(),o=this.reader.getInt16(),r=this.reader.getInt16();this.reader.setEndianess(i.Big),this.reader.skipOffsetOf(20);let a=[],h=void 0,l=void 0,c=void 0,d=void 0,p=void 0,u=void 0,m=void 0;for(let e=0;e<n;e++)h=this.reader.getString(11),l=this.reader.getChar(),d=this.reader.getInt32(),c=this.reader.getUint8(),p=this.reader.getUint8(),this.reader.skipOffsetOf(2),u=this.reader.getInt8(),this.reader.skipOffsetOf(2),m=this.reader.getInt8(),this.reader.skipOffsetOf(1),a.push({name:h,type:l,length:c,memoryAddress:d,decimalCount:p,workAreaId:u,MDXFlag:m});return{year:e,month:t,day:s,numberOfRecords:n,numberOfByteInHeader:o,numberOfByteInRecord:r,fields:a}},_parseHeaderV3(){const e=this.reader.getInt8()+Ft.YearOffset,t=this.reader.getInt8(),s=this.reader.getInt8();this.reader.setEndianess(i.Little);const n=this.reader.getInt32(),o=this.reader.getInt16(),r=this.reader.getInt16();this.reader.setEndianess(i.Big),this.reader.skipOffsetOf(2);const a=this.reader.getInt8(),h=this.reader.getInt8();this.reader.skipOffsetOf(12);const l=this.reader.getInt8(),c=this.reader.getInt8();this.reader.skipOffsetOf(2);let d=[],p=void 0,u=void 0,m=void 0,_=void 0,f=void 0,g=void 0;for(;this.reader.getOffset()<o-1;)p=this.reader.getString(11),u=this.reader.getChar(),this.reader.skipOffsetOf(4),m=this.reader.getUint8(),_=this.reader.getUint8(),this.reader.skipOffsetOf(2),f=this.reader.getInt8(),this.reader.skipOffsetOf(10),g=this.reader.getInt8(),d.push({name:p,type:u,length:m,decimalCount:_,workAreaId:f,MDXFieldFlag:g});return{year:e,month:t,day:s,numberOfRecords:n,numberOfByteInHeader:o,numberOfByteInRecord:r,incompleteTransactionFlag:a,encryptionFlag:h,MDXFlag:l,languageDriverId:c,fields:d}},_parseHeaderV4(){const e=this.reader.getInt8()+Ft.YearOffset,t=this.reader.getInt8(),s=this.reader.getInt8();this.reader.setEndianess(i.Little);const n=this.reader.getInt32(),o=this.reader.getInt16(),r=this.reader.getInt16();this.reader.setEndianess(i.Big),this.reader.skipOffsetOf(2);const a=this.reader.getInt8(),h=this.reader.getInt8();this.reader.skipOffsetOf(12);const l=this.reader.getInt8(),c=this.reader.getInt8();this.reader.skipOffsetOf(2);const d=this.reader.getString(32);this.reader.skipOffsetOf(4);let p=[],u=void 0,m=void 0,_=void 0,f=void 0,g=void 0,v=void 0;for(let e=0;e<n;e++)u=this.reader.getString(32),m=this.reader.getChar(),_=this.reader.getUint8(),f=this.reader.getUint8(),this.reader.skipOffsetOf(2),g=this.reader.getInt8(),this.reader.skipOffsetOf(2),v=this.reader.getInt32(),this.reader.skipOffsetOf(4),p.push({name:u,type:m,length:_,decimalCount:f,MDXFieldFlag:g,nextAutoincrementValue:v});return{year:e,month:t,day:s,numberOfRecords:n,numberOfByteInHeader:o,numberOfByteInRecord:r,incompleteTransactionFlag:a,encryptionFlag:h,MDXFlag:l,languageDriverId:c,languageDriverName:d,fields:p}},_parseDatas(e,t){const i=t.numberOfRecords,s=t.fields;let n=[],o=null,r=null;for(let e=0;e<i;e++){o={},o.deleted=this.reader.getUint8()===Ft.DeletedRecord;for(let e=0,t=s.length;e<t;e++)switch(r=s[e],r.type){case zt.Binary:{const e=this.reader.getString(r.length);o[r.name]=parseInt(e)}break;case zt.Numeric:{const e=this.reader.getString(r.length);o[r.name]=parseInt(e)}break;case zt.Character:case zt.Date:o[r.name]=this.reader.getString(r.length);break;case zt.Logical:{const e=this.reader.getChar().toLowerCase();o[r.name]="t"===e||"y"===e||"f"!==e&&"n"!==e&&null}break;case zt.Memo:o[r.name]=this.reader.getString(r.length);break;case zt.Timestamp:break;case zt.Long:case zt.Autoincrement:o[r.name]=this.reader.getInt32();break;case zt.Float:{const e=this.reader.getString(r.length);o[r.name]=parseInt(e)}break;case zt.Double:o[r.name]=this.reader.getFloat64();break;case zt.OLE:o[r.name]=this.reader.getString(r.length);break;default:throw new RangeError(`Invalid data type parameter: ${r.type}`)}n.push(o)}return n},_parseFieldProperties(){const e=this.reader.getInt16(),t=this.reader.getInt16(),i=this.reader.getInt16(),s=this.reader.getInt16(),n=this.reader.getInt16(),o=this.reader.getInt16(),r=this.reader.getInt16(),a=this.reader.getInt16();let h=[];for(let t=0;t<e;t++)h.push(this._getStandardProperties());let l=[];for(let e=0;e<i;e++)l.push(this._getCustomProperties());let c=[];for(let e=0;e<n;e++)c.push(this._getReferentialIntegrityProperties());return{numberOfStandardProperties:e,startOfStandardPropertiesDescriptor:t,numberOfCustomProperties:i,startOfCustomPropertiesDescriptor:s,numberOfReferentialIntegrityProperties:n,startOfReferentialIntegrityDescriptor:o,startOfData:r,sizeOfPropertiesStructure:a,standardProperties:h,customProperties:l,referentialIntegrityProperties:c}},_getStandardProperties(){const e=this.reader.getInt16(),t=this.reader.getInt16(),i=this.reader.getInt8(),s=this.reader.getInt8(),n=this.reader.getInt8();return this.reader.skipOffsetOf(4),{generationalNumber:e,tableFieldOffset:t,propertyDescribed:i,type:s,isConstraint:n,offsetFromStart:this.reader.getInt16(),widthOfDatabaseField:this.reader.getInt16()}},_getCustomProperties(){const e=this.reader.getInt16(),t=this.reader.getInt16(),i=this.reader.getInt8();return this.reader.skipOffsetOf(1),{generationalNumber:e,tableFieldOffset:t,type:i,offsetFromStartOfName:this.reader.getInt16(),lengthOfName:this.reader.getInt16(),offsetFromStartOfData:this.reader.getInt16(),lengthOfData:this.reader.getInt16()}},_getReferentialIntegrityProperties(){return{databaseState:this.reader.getInt8(),sequentialNumberRule:this.reader.getInt16(),offsetOfTheRIRuleName:this.reader.getInt16(),sizeOfTheRIRuleName:this.reader.getInt16(),offsetOfNameOfForeignTable:this.reader.getInt16(),sizeOfNameOfForeignTable:this.reader.getInt16(),stateBehaviour:this.reader.getInt8(),numberOfFieldsInLinkingKey:this.reader.getInt16(),offsetOfLocalTableTagName:this.reader.getInt16(),sizeOfTheLocalTableTagName:this.reader.getInt16(),offsetOfForeignTableTagName:this.reader.getInt16(),sizeOfTheForeignTableTagName:this.reader.getInt16()}}}),Object.assign(Lt.prototype,{constructor:Lt,load:function(e,t,i,s){const n=e.replace(/[^/]*$/,""),o=new c(this.manager);o.setResponseType("text/plain"),o.load(e,e=>{t(this._parse(e,n))},i,s)},_parse(e,t){let i=null;if(window.DOMParser){i=(new DOMParser).parseFromString(e,"text/xml")}else i=new window.ActiveXObject("Microsoft.XMLDOM"),i.async=!1,i.loadXML(e);const s=i.getElementsByTagName("SHOT");let n=null,o=null,r=null,a=null;for(let e=0,t=s.length;e<t;++e)n=s[e],o=n.children[0],r=o.children[0],a=o.children[1],this.imagesShotData.push({imageName:n.attributes.n.value,position:{x:parseFloat(r.attributes.x.value),y:parseFloat(r.attributes.y.value),z:parseFloat(r.attributes.z.value)},rotation:{x:parseFloat(a.attributes.x.value),y:parseFloat(a.attributes.y.value),z:parseFloat(a.attributes.z.value)}});return this._createImagesPacks(t)},_createImagesPacks(e){for(var t=this.imagesShotData,i=new d,s=void 0,n=void 0,o=0,r=t.length;o<r;++o)s=t[o],(n=new g(new v(.06528,.04896,1,1),new b({color:16777215,side:w}))).name=s.imageName,n.position.x=s.position.x-600200,n.position.y=s.position.y-131400,n.position.z=s.position.z-60-.34,n.rotation.x=y.degToRad(s.rotation.x),n.rotation.y=y.degToRad(s.rotation.z),n.rotation.z=-y.degToRad(s.rotation.y),n.userData={filePath:e},i.add(n);return i.rotateX(-Math.PI/2),i}});
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * This class allow to split any geometries type during runtime.
 * Keeping normals and Uvs. It is really usefull to see inside mesh like building.
 *
 * Constructor parameter:
 *
 * size - the size of the square view
 *
 * @class Todo...
 * @classdesc Todo...
 * @example Todo...
 *
 */
const Bt=Object.freeze({NullShape:0,Point:1,Polyline:3,Polygon:5,MultiPoint:8,PointZ:11,PolyLineZ:13,PolygonZ:15,MultiPointZ:18,PointM:21,PolylineM:23,PolygonM:25,MultiPointM:28,MultiPatch:31});function jt(e,t){let i=t[0],s=t[1],n=-1;for(let o=0,r=e.length,a=r-1;o<r;a=o++){const r=e[o],h=r[0],l=r[1],c=e[a],d=c[0],p=c[1];Rt(r,c,t)?n=0:l>s!=p>s&&i<(d-h)*(s-l)/(p-l)+h&&(n=-n)}return n}function Rt(e,t,i){var s=i[0]-e[0],n=i[1]-e[1];if(0===s&&0===n)return!0;var o=t[0]-e[0],r=t[1]-e[1];if(0===o&&0===r)return!1;var a=(s*o+n*r)/(o*o+r*r);return!(a<0||a>1)&&(0===a||1===a||a*o===s&&a*r===n)}function Gt(i=h,s=e){this.manager=i,this.logger=s,this.globalOffset=new x,this.worldAxis={from:"zUp",to:"zForward"},this._reader=new t}function Ut(e){return e.substring(e.lastIndexOf("/")+1)}function Ht(e){return e.slice(2+(e.lastIndexOf(".")-1>>>0))}function Nt(e){const t=
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @class UniversalLoader
 * @classdesc The TUniversalLoader allow to automatically select correct THREE loader for given files. (based on https://github.com/jeromeetienne/threex.universalloader)
 * @example Todo...
 *
 */
function(e){return e.substring(0,e.lastIndexOf("/"))}(e);return e.indexOf("blob")>-1?t:e}function Xt(t=h,i=e){this.manager=t,this.logger=i}Object.assign(Gt,{FileCode:9994,MinFileLength:100,MinVersion:1e3}),Object.assign(Gt.prototype,{load(e,t,i,s){const n=this,o=new c(n.manager);o.setResponseType("arraybuffer"),o.load(e,e=>{t(n.parse(e))},i,s)},parse(e){this._reader.setEndianess(i.Big).setBuffer(e);const t=this._parseHeader();if(t.fileCode!==Gt.FileCode)return this.logger.error("SHPLoader: Invalide Shape file code !"),null;if(t.fileLength<Gt.MinFileLength)return this.logger.error("SHPLoader: Shape file have an incorrect length !"),null;if(!Object.values(Bt).includes(t.shapeType))return this.logger.error("SHPLoader: Shape file have an incorrect shape type !"),null;t.version<Gt.MinVersion&&this.logger.warn("SHPLoader: Version of shape file below than 1000 could be incorrectly parsed !");const s=this._parseDatas(t);return this._convertToObjects(s)},_parseHeader(){const e=this._reader.getInt32();this._reader.skipOffsetOf(20);const t=this._reader.getInt32();this._reader.setEndianess(i.Little);const s=this._reader.getInt32(),n=this._reader.getInt32(),o=this._reader.getInt32(),r=this._reader.getInt32();return{fileCode:e,fileLength:t,version:s,shapeType:n,boundingBox:{xMin:o,xMax:this._reader.getInt32(),yMin:r,yMax:this._reader.getInt32(),zMin:this._reader.getInt32(),zMax:this._reader.getInt32(),mMin:this._reader.getInt32(),mMax:this._reader.getInt32()}}},_parseDatas(e){this._reader.skipOffsetTo(100);let t=[],s=void 0,n=void 0,o=void 0;for(;!this._reader.isEndOfFile();)switch(s=this._parseRecordHeader(),n=this._reader.getOffset()+2*s.contentLength,this._reader.setEndianess(i.Little),e.shapeType){case Bt.NullShape:this._reader.skipOffsetTo(n);break;case Bt.Point:case Bt.PointZ:case Bt.PointM:for(;this._reader.getOffset()<n;)o=this._parsePoint(),o&&t.push(o);break;case Bt.Polyline:case Bt.PolyLineZ:case Bt.PolylineM:for(;this._reader.getOffset()<n;)o=this._parsePolyLine(),o&&t.push(o);break;case Bt.Polygon:case Bt.PolygonZ:case Bt.PolygonM:for(;this._reader.getOffset()<n;)o=this._parsePolyLine(),o&&t.push(o);break;case Bt.MultiPoint:case Bt.MultiPointZ:case Bt.MultiPointM:for(;this._reader.getOffset()<n;)o=this._parseMultiPoint(),o&&t.push(o);break;case Bt.MultiPatch:for(;this._reader.getOffset()<n;)o=this._parseMultiPatch(),o&&t.push(o);break;default:this.logger.error(`SHPLoader: Invalid switch parameter: ${e.shapeType}`)}return t},_parseRecordHeader(){return this._reader.setEndianess(i.Big),{recordNumber:this._reader.getInt32(),contentLength:this._reader.getInt32()}},_parsePoint(){const e=this._reader.getInt32();return e===Bt.NullShape?null:{shapeType:e,x:this._reader.getFloat64(),y:this._reader.getFloat64()}},_parsePolyLine(){const e=this._reader.getInt32();if(e===Bt.NullShape)return null;const t={xMin:this._reader.getFloat64(),yMin:this._reader.getFloat64(),xMax:this._reader.getFloat64(),yMax:this._reader.getFloat64()},i=this._reader.getInt32(),s=this._reader.getInt32(),n=new Array(i);for(let e=0;e<i;e++)n[e]=this._reader.getInt32();const o=new Array(s);for(let e=0;e<s;e++)o[e]={x:this._reader.getFloat64(),y:this._reader.getFloat64()};return{shapeType:e,boundingBox:t,numberOfParts:i,numberOfPoints:s,parts:n,points:o}},_parsePolygon(){const e=this._reader.getInt32();if(e===Bt.NullShape)return null;const t={xMin:this._reader.getFloat64(),yMin:this._reader.getFloat64(),xMax:this._reader.getFloat64(),yMax:this._reader.getFloat64()},i=this._reader.getInt32(),s=this._reader.getInt32();let n=new Array(i);for(let e=0;e<i;e++)n[e]=this._reader.getInt32();let o=new Array(s);for(let e=0;e<s;e++)o[e]={x:this._reader.getFloat64(),y:this._reader.getFloat64()};const r=[],a=[];return n.forEach((e,t)=>{const i=o.slice(e,n[t+1]);!function(e){if((t=e.length)<4)return!1;for(var t,i=0,s=e[t-1][1]*e[0][0]-e[t-1][0]*e[0][1];++i<t;)s+=e[i-1][1]*e[i][0]-e[i-1][0]*e[i][1];return s>=0}(i)?a.push(i):r.push(i)}),a.forEach(e=>{r.some(t=>{if(function(e,t){let i=0,s=t.length;do{if(jt(e,t[i])>0)return!0}while(++i<s);return!1}(t[0],e))return t.push(e),!0})||r.push([e])}),{shapeType:e,boundingBox:t,numberOfParts:i,numberOfPoints:s,parts:n,polygons:r}},_parseMultiPoint(){const e=this._reader.getInt32();if(e===Bt.NullShape)return null;const t={xMin:this._reader.getFloat64(),xMax:this._reader.getFloat64(),yMin:this._reader.getFloat64(),yMax:this._reader.getFloat64()},i=this._reader.getInt32(),s=new Array(i);for(let e=0;e<i;e++)s.push([this._reader.getFloat64(),this._reader.getFloat64()]);return{shapeType:e,boundingBox:t,numberOfPoints:i,points:s}},_parseMultiPatch(){const e=this._reader.getInt32();return e===Bt.NullShape?null:{shapeType:e}},_convertToObjects(e){let t=[];for(let t=0,n=e.length;t<n;t++){let n=e[t];n.shapeType!==Bt.Polygon&&n.shapeType!==Bt.PolygonZ&&n.shapeType!==Bt.PolygonM||(n.points&&Array.isArray(n.points[0])?i(n.points):s(n.points))}function i(e){for(let t=0,n=e.length;t<n;t++){let n=e[t];n?Array.isArray(n[0])?i(n):s(n):this.logger.log("no array, oups !")}}function s(e){t.push(new E(e))}return t}}),Object.assign(Xt.prototype,{load(e,t,i,s){if(e)if(e instanceof FileList){const n=e.length;this.logger.log(`numberOfFiles: ${n}`);const o=[];let r="",a=null;for(let t=0;t<n;++t)a=e[t],r=`${URL.createObjectURL(a)}/${a.name}`,o.push({url:r});this.load(o,t,i,s)}else if(e instanceof File){const n=`${URL.createObjectURL(e)}/${e.name}`;this.loadSingleFile({url:n},t,i,s)}else if(ft(e))this.loadSingleFile(e,t,i,s);else if(gt(e))this.load(e(),t,i,s);else if(vt(e))if(2===e.length&&ft(e[0])&&ft(e[1]))this.loadAssociatedFiles(e,t,i,s);else for(let n=0,o=e.length;n<o;n++)this.load(e[n],t,i,s);else bt(e)?this.loadSingleFile({url:e},t,i,s):this.logger.error("TUniversalLoader: Invalid files parameter !!!");else this.logger.error("Unable to load null or undefined files !")},loadSingleFile(e,t,i,n){const o=e.url,r=Ht(Ut(o));switch(e.url=Nt(o),r){case s.Asc.value:this._loadAsc(e,t,i,n);break;case s.Dae.value:this._loadDae(e,t,i,n);break;case s.Dbf.value:this._loadDbf(e,t,i,n);break;case s.Fbx.value:this._loadFbx(e,t,i,n);break;case s.Json.value:this._loadJson(e,t,i,n);break;case s.Obj.value:this._loadObj(e,t,i,n);break;case s.Shp.value:this._loadShp(e,t,i,n);break;case s.Stl.value:this._loadStl(e,t,i,n);break;default:throw new RangeError(`Invalid file extension: ${r}. Supported formats are: ${s.toString()}`)}},loadAssociatedFiles(e,t,i,n){const o=e[0],r=o.url,a=Ht(Ut(r));o.url=Nt(r);const h=e[1],l=h.url,c=Ht(Ut(l));h.url=Nt(l),a===s.Mtl.value&&c===s.Obj.value?this._loadObjMtlCouple(h,o,t,i,n):a===s.Obj.value&&c===s.Mtl.value?this._loadObjMtlCouple(o,h,t,i,n):a===s.Shp.value&&c===s.Dbf.value?this._loadShpDbfCouple(o,h,t,i,n):a===s.Dbf.value&&c===s.Shp.value?this._loadShpDbfCouple(h,o,t,i,n):(this.loadSingleFile(e[0],t,i,n),this.loadSingleFile(e[1],t,i,n))},_loadAsc(e,t,i,s){new Ct(this.manager).load(e.url,t,i,s)},_loadDae(e,t,i,s){new M(this.manager).load(e.url,e=>{t(e.scene)},i,s)},_loadDbf(e,t,i,s){new Ft(this.manager).load(e.url,t,i,s)},_loadFbx(e,t,i,s){new P(this.manager).load(e.url,i=>{const s=e.position;s&&i.position.set(s.x,s.y,s.z),t(i)},i,s)},_loadJson(e,t,i,s){new A(this.manager).load(e.url,t,i,s)},_loadObj(e,t,i,s){new T(this.manager).load(e.url,t,i,s)},_loadShp(e,t,i,s){new Gt(this.manager).load(e.url,e=>{const i=new d;for(let t=0,s=e.length;t<s;t++)i.add(new g(new S(e[t]),new D({color:16777215*Math.random(),side:w})));i.rotateX(mt(-90)),t(i)},i,s)},_loadStl(e,t,i,s){new O(this.manager).load(e.url,i=>{const s=new D,n=new g(i,s),o=e.position;o&&n.position.set(o.x,o.y,o.z),t(n)},i,s)},_loadObjMtlCouple(e,t,i,s,n){const o=new k(this.manager),r=new T(this.manager),a=t.texturePath;a&&o.setTexturePath(a),o.load(t.url,t=>{t.preload();for(let e=0,i=t.materials.length;e<i;e++){const i=t.materials[e];i.opacity=1,t.materials[e]=i}r.setMaterials(t),r.load(e.url,i,s,n)},s,n)},_loadShpDbfCouple(e,t,i,s,n){let o=void 0,r=void 0;function a(){if(!o||!r)return;const e=new d;e.name="Locaux";let t=void 0;for(let i=0,s=o.length;i<s;i++){t=new g(new S(o[i]),new D({color:11596470,side:w}));const s=r.datas[i].CODE;t.name=s,t.userData.Code=s,e.add(t)}i(e)}new Gt(this.manager).load(e.url,e=>{o=e,a()},s,n),new Ft(this.manager).load(t.url,e=>{r=e,a()},s,n)}});
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @file Todo
 *
 * @example Todo
 *
 */
const Yt=new x(0,0,-1),Zt=new x(0,0,1),Vt=new x(0,1,0),Wt=new x(0,-1,0),$t=new x(1,0,0),qt=new x(-1,0,0),Jt=_t({None:0,Rotating:1,Panning:2,Rolling:3,Zooming:4,Moving:5}),Kt=_t({FirstPerson:1,Orbit:2,Fly:3,Path:4});class Qt extends C{constructor(t={}){const i={logger:e,camera:null,target:new I,mode:Kt.Orbit,domElement:window,...t};super(),this._handlers={onMouseEnter:this._onMouseEnter.bind(this),onMouseLeave:this._onMouseLeave.bind(this),onMouseDown:this._onMouseDown.bind(this),onMouseMove:this._onMouseMove.bind(this),onMouseWheel:this._onMouseWheel.bind(this),onMouseUp:this._onMouseUp.bind(this),onDblClick:this._onDblClick.bind(this),onTouchStart:this._onTouchStart.bind(this),onTouchEnd:this._onTouchEnd.bind(this),onTouchCancel:this._onTouchCancel.bind(this),onTouchLeave:this._onTouchLeave.bind(this),onTouchMove:this._onTouchMove.bind(this),onKeyDown:this._onKeyDown.bind(this),onKeyUp:this._onKeyUp.bind(this)},this.logger=i.logger,this.camera=i.camera,this.target=i.target,this.mode=i.mode,this.domElement=i.domElement,this.enabled=!0,this._paths=[],this._trackPath=!1,this._cameraJump=.1,this._currentPathPosition=null,this._currentPathOffset=0,this._currentPathIndex=0,this._currentPath=null,this._maxJump=1,this._lockedTarget=!0,this.previousTouches=[],this.canMove=!0,this.moveSpeed=1,this.canFront=!0,this.frontMinimum=-1/0,this.frontMaximum=-1/0,this.frontMinSpeed=0,this.frontSpeed=1,this.frontMaxSpeed=1/0,this.frontAcceleration=1,this.canBack=!0,this.backMinimum=-1/0,this.backMaximum=-1/0,this.backMinSpeed=0,this.backSpeed=1,this.backMaxSpeed=1/0,this.backAcceleration=1,this.canUp=!0,this.upMinimum=-1/0,this.upMaximum=-1/0,this.upMinSpeed=0,this.upSpeed=1,this.upMaxSpeed=1/0,this.upAcceleration=1,this.canDown=!0,this.downMinimum=-1/0,this.downMaximum=-1/0,this.downMinSpeed=0,this.downSpeed=1,this.downMaxSpeed=1/0,this.downAcceleration=1,this.canLeft=!0,this.leftMinimum=-1/0,this.leftMaximum=-1/0,this.leftMinSpeed=0,this.leftSpeed=1,this.leftMaxSpeed=1/0,this.leftAcceleration=1,this.canRight=!0,this.rightMinimum=-1/0,this.rightMaximum=-1/0,this.rightMinSpeed=0,this.rightSpeed=1,this.rightMaxSpeed=1/0,this.rightAcceleration=1,this.canRotate=!0,this.minPolarAngle=.001,this.maxPolarAngle=Math.PI-.001,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.rotateMinSpeed=0,this.rotateSpeed=1,this.rotateMaxSpeed=1/0,this.rotateAcceleration=1,this.canPan=!0,this.panMinimum=-1/0,this.panMaximum=-1/0,this.panMinSpeed=0,this.panSpeed=.001,this.panMaxSpeed=1/0,this.panAcceleration=1,this.canRoll=!0,this.rollMinimum=-1/0,this.rollMaximum=-1/0,this.rollMinSpeed=0,this.rollSpeed=.1,this.rollMaxSpeed=1/0,this.rollAcceleration=1,this.canZoom=!0,this.zoomMinimum=0,this.zoomMaximum=1/0,this.zoomMinSpeed=0,this.zoomSpeed=.001,this.zoomMaxSpeed=1/0,this.zoomAcceleration=1,this.canLookAt=!0,this.actionsMap={front:[n.Z.value,n.UP_ARROW.value],back:[n.S.value,n.DOWN_ARROW.value],up:[n.A.value,n.PAGE_UP.value],down:[n.E.value,n.PAGE_DOWN.value],left:[n.Q.value,n.LEFT_ARROW.value],right:[n.D.value,n.RIGHT_ARROW.value],rotate:[o.LEFT.value],pan:[o.MIDDLE.value],roll:{left:[n.R.value],right:[n.T.value]},zoom:[o.WHEEL.value],lookAtFront:[n.NUMPAD_2.value],lookAtFrontLeft:[n.NUMPAD_3.value],lookAtFrontRight:[n.NUMPAD_1.value],lookAtBack:[n.NUMPAD_8.value],lookAtBackLeft:[n.NUMPAD_9.value],lookAtBackRight:[n.NUMPAD_7.value],lookAtUp:[n.NUMPAD_5.value],lookAtDown:[n.NUMPAD_0.value],lookAtLeft:[n.NUMPAD_6.value],lookAtRight:[n.NUMPAD_4.value]},this._state=Jt.None}get camera(){return this._camera}set camera(e){if(wt(e))throw new Error("Camera cannot be null ! Expect an instance of Camera");if(yt(e))throw new Error("Camera cannot be undefined ! Expect an instance of Camera");if(!(e instanceof z))throw new Error(`Camera cannot be an instance of ${e.constructor.name}. Expect an instance of Camera.`);this._camera=e}get target(){return this._target}set target(e){if(wt(e))throw new Error("Target cannot be null ! Expect an instance of Object3D.");if(yt(e))throw new Error("Target cannot be undefined ! Expect an instance of Object3D.");if(!(e instanceof I))throw new Error(`Target cannot be an instance of ${e.constructor.name}. Expect an instance of Object3D.`);this._target=e}get mode(){return this._mode}set mode(e){if(wt(e))throw new Error("Mode cannot be null ! Expect a value from CameraControlMode enum.");if(yt(e))throw new Error("Mode cannot be undefined ! Expect a value from CameraControlMode enum.");this._mode=e,this._trackPath&&this._initPathDisplacement()}get paths(){return this._paths}set paths(e){this._paths=e}get trackPath(){return this._trackPath}set trackPath(e){if(xt(e))throw new Error(`Track path cannot be an instance of ${e.constructor.name}. Expect a boolean.`);this._trackPath=e,this._trackPath&&this._initPathDisplacement()}get domElement(){return this._domElement}set domElement(e){if(wt(e))throw new Error("DomElement cannot be null ! Expect an instance of HTMLDocument.");if(yt(e))throw new Error("DomElement cannot be undefined ! Expect an instance of HTMLDocument.");if(!(e instanceof Window||e instanceof HTMLDocument||e instanceof HTMLDivElement||e instanceof HTMLCanvasElement))throw new Error(`DomElement cannot be an instance of ${e.constructor.name}. Expect an instance of Window, HTMLDocument or HTMLDivElement.`);this._domElement&&(this._domElement.removeEventListener("mouseenter",this._handlers.onMouseEnter,!1),this._domElement.removeEventListener("mouseleave",this._handlers.onMouseLeave,!1),this.dispose()),this._domElement=e,this._domElement.addEventListener("mouseenter",this._handlers.onMouseEnter,!1),this._domElement.addEventListener("mouseleave",this._handlers.onMouseLeave,!1),this.impose()}setCamera(e){return this.camera=e,this}setTarget(e){return this.target=e,this}setMode(e){return this.mode=e,this}setPaths(e){return this.paths=e,this}addPath(e){return this._paths.push(e),this}setTrackPath(e){return this.trackPath=e,this}setDomElement(e){return this.domElement=e,this}impose(){this._domElement.addEventListener("keydown",this._handlers.onKeyDown,!1),this._domElement.addEventListener("keyup",this._handlers.onKeyUp,!1),this._domElement.addEventListener("dblclick",this._handlers.onDblClick,!1),this._domElement.addEventListener("mousedown",this._handlers.onMouseDown,!1),this._domElement.addEventListener("mousemove",this._handlers.onMouseMove,!1),this._domElement.addEventListener("mouseup",this._handlers.onMouseUp,!1),this._domElement.addEventListener("wheel",this._handlers.onMouseWheel,{capture:!0,once:!1,passive:!1}),this._domElement.addEventListener("touchcancel",this._handlers.onTouchCancel,!1),this._domElement.addEventListener("touchend",this._handlers.onTouchEnd,!1),this._domElement.addEventListener("touchleave",this._handlers.onTouchLeave,!1),this._domElement.addEventListener("touchmove",this._handlers.onTouchMove,{capture:!0,once:!1,passive:!1}),this._domElement.addEventListener("touchstart",this._handlers.onTouchStart,{capture:!0,once:!1,passive:!1}),this.dispatchEvent({type:"impose"})}dispose(){this._domElement.removeEventListener("keydown",this._handlers.onKeyDown,!1),this._domElement.removeEventListener("keyup",this._handlers.onKeyUp,!1),this._domElement.removeEventListener("dblclick",this._handlers.onDblClick,!1),this._domElement.removeEventListener("mousedown",this._handlers.onMouseDown,!1),this._domElement.removeEventListener("mousemove",this._handlers.onMouseMove,!1),this._domElement.removeEventListener("mouseup",this._handlers.onMouseUp,!1),this._domElement.removeEventListener("wheel",this._handlers.onMouseWheel,{capture:!0,once:!1,passive:!1}),this._domElement.removeEventListener("touchcancel",this._handlers.onTouchCancel,!1),this._domElement.removeEventListener("touchend",this._handlers.onTouchEnd,!1),this._domElement.removeEventListener("touchleave",this._handlers.onTouchLeave,!1),this._domElement.removeEventListener("touchmove",this._handlers.onTouchMove,{capture:!0,once:!1,passive:!1}),this._domElement.removeEventListener("touchstart",this._handlers.onTouchStart,{capture:!0,once:!1,passive:!1}),this.dispatchEvent({type:"dispose"})}update(){}setCameraPosition(e){return this._camera.position.copy(e),this._camera.lookAt(this._target.position),this}setTargetPosition(e){return this._target.position.copy(e),this._camera.lookAt(this._target.position),this}_consumeEvent(e){e.cancelable&&e.stopImmediatePropagation()}_onKeyDown(e){if(!this.enabled)return;e.preventDefault();const t=this.actionsMap,i=e.keyCode;t.front.includes(i)?(this._front(),this._consumeEvent(e)):t.back.includes(i)?(this._back(),this._consumeEvent(e)):t.up.includes(i)?(this._up(),this._consumeEvent(e)):t.down.includes(i)?(this._down(),this._consumeEvent(e)):t.left.includes(i)?(this._left(),this._consumeEvent(e)):t.right.includes(i)?(this._right(),this._consumeEvent(e)):t.rotate.includes(i)?this._rotate(1):t.pan.includes(i)?(this._pan(1),this._consumeEvent(e)):t.roll.left.includes(i)?(this._roll(1),this._consumeEvent(e)):t.roll.right.includes(i)?(this._roll(-1),this._consumeEvent(e)):t.zoom.includes(i)?(this._zoom(1),this._consumeEvent(e)):t.lookAtFront.includes(i)?(this._lookAt(Yt),this._consumeEvent(e)):t.lookAtFrontLeft.includes(i)?(this._lookAt(new x(-1,0,-1).normalize()),this._consumeEvent(e)):t.lookAtFrontRight.includes(i)?(this._lookAt(new x(1,0,-1).normalize()),this._consumeEvent(e)):t.lookAtBack.includes(i)?(this._lookAt(Zt),this._consumeEvent(e)):t.lookAtBackLeft.includes(i)?(this._lookAt(new x(-1,0,1).normalize()),this._consumeEvent(e)):t.lookAtBackRight.includes(i)?(this._lookAt(new x(1,0,1).normalize()),this._consumeEvent(e)):t.lookAtUp.includes(i)?(this._lookAt(Vt),this._consumeEvent(e)):t.lookAtDown.includes(i)?(this._lookAt(Wt),this._consumeEvent(e)):t.lookAtLeft.includes(i)?(this._lookAt(qt),this._consumeEvent(e)):t.lookAtRight.includes(i)&&(this._lookAt($t),this._consumeEvent(e))}_onKeyUp(e){this.enabled&&e.preventDefault()}_onTouchStart(e){this.enabled&&(e.preventDefault(),this.previousTouches=e.touches)}_onTouchEnd(e){this.enabled&&(e.preventDefault(),this.previousTouches=[],this._state=Jt.None)}_onTouchCancel(e){this.enabled&&(e.preventDefault(),this.previousTouches=[],this._state=Jt.None)}_onTouchLeave(e){this.enabled&&(e.preventDefault(),this.previousTouches=[],this._state=Jt.None)}_onTouchMove(e){if(!this.enabled)return;e.preventDefault();const t=this.previousTouches,i=e.changedTouches,s=t.length,n=i.length;if(2===s&&2===n){const s=new F(t[0].clientX,t[0].clientY),n=new F(t[1].clientX,t[1].clientY),o=s.distanceTo(n),r=(new F).addVectors(s,n).divideScalar(2),a=(new F).subVectors(s,n).normalize(),h=new F(i[0].clientX,i[0].clientY),l=new F(i[1].clientX,i[1].clientY),c=h.distanceTo(l),d=(new F).addVectors(h,l).divideScalar(2),p=(new F).subVectors(s,n).normalize(),u=(new F).subVectors(d,r),m=c-o,_=p.dot(a);this._pan(u),this._zoom(m),this._roll(_),this._consumeEvent(e)}else if(1===s&&1===n){const s=new F(i[0].clientX-t[0].clientX,i[0].clientY-t[0].clientY).divideScalar(10);this._rotate(s),this._consumeEvent(e)}else this.logger.warn("Ignoring inconsistent touches event.");this.previousTouches=i}_onMouseEnter(e){this.enabled&&(e.preventDefault(),this.impose(),e.target.constructor!==HTMLDocument&&this._domElement.focus())}_onMouseLeave(e){this.enabled&&(e.preventDefault(),e.target.constructor!==HTMLDocument&&this._domElement.blur(),this.dispose(),this._state=Jt.None)}_onMouseDown(e){if(!this.enabled)return;e.preventDefault();const t=this.actionsMap,i=e.button;t.front.includes(i)?(this._state=Jt.Moving,this._front(),this._consumeEvent(e)):t.back.includes(i)?(this._state=Jt.Moving,this._back(),this._consumeEvent(e)):t.up.includes(i)?(this._state=Jt.Moving,this._up(),this._consumeEvent(e)):t.down.includes(i)?(this._state=Jt.Moving,this._down(),this._consumeEvent(e)):t.left.includes(i)?(this._state=Jt.Moving,this._left(),this._consumeEvent(e)):t.right.includes(i)?(this._state=Jt.Moving,this._right(),this._consumeEvent(e)):t.rotate.includes(i)?(this._state=Jt.Rotating,this._consumeEvent(e)):t.pan.includes(i)?(this._state=Jt.Panning,this._consumeEvent(e)):t.roll.left.includes(i)?(this._state=Jt.Rolling,this._consumeEvent(e)):t.roll.right.includes(i)?(this._state=Jt.Rolling,this._consumeEvent(e)):t.zoom.includes(i)?(this._state=Jt.Zooming,this._consumeEvent(e)):this._state=Jt.None}_onMouseMove(e){if(!this.enabled||this._state===Jt.None)return;e.preventDefault();const t=this._state,i={x:e.movementX||e.mozMovementX||e.webkitMovementX||0,y:e.movementY||e.mozMovementY||e.webkitMovementY||0};switch(t){case Jt.Moving:break;case Jt.Rotating:this._rotate(i),this._consumeEvent(e);break;case Jt.Panning:this._pan(i),this._consumeEvent(e);break;case Jt.Rolling:this._roll(i),this._consumeEvent(e);break;case Jt.Zooming:this._zoom(i),this._consumeEvent(e);break;default:throw new RangeError(`Unknown state: ${t}`)}}_onMouseWheel(e){if(!this.enabled)return;e.preventDefault();const t=e.wheelDelta||e.deltaY;this._zoom(t),this._consumeEvent(e)}_onMouseUp(e){this.enabled&&(e.preventDefault(),this._state=Jt.None,this._consumeEvent(e))}_onDblClick(e){this.enabled&&(e.preventDefault(),this.logger.warn("CameraControls: Double click events is not implemented yet, sorry for the disagreement."))}_front(){if(this.canMove&&this.canFront){if(this._camera.isPerspectiveCamera){const e=Yt.clone().applyQuaternion(this._camera.quaternion),t=this._trackPath?this._getPathDisplacement(e):e.multiplyScalar(this.frontSpeed);this._camera.position.add(t),this._target.position.add(t)}else if(this._camera.isOrthographicCamera){const e=Yt.clone().applyQuaternion(this._camera.quaternion),t=this._trackPath?this._getPathDisplacement(e):e.multiplyScalar(this.frontSpeed);this._camera.position.add(t),this._target.position.add(t);const i=this.frontSpeed*this.zoomSpeed;this._camera.zoom+=i,this._camera.updateProjectionMatrix()}else console.error(`Unmanaged displacement for camera of type ${this._camera.type}`);this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_back(){if(this.canMove&&this.canBack){if(this._camera.isPerspectiveCamera){const e=Zt.clone().applyQuaternion(this._camera.quaternion),t=this._trackPath?this._getPathDisplacement(e):e.multiplyScalar(this.backSpeed);this._camera.position.add(t),this._target.position.add(t)}else if(this._camera.isOrthographicCamera){const e=Zt.clone().applyQuaternion(this._camera.quaternion),t=this._trackPath?this._getPathDisplacement(e):e.multiplyScalar(this.backSpeed);this._camera.position.add(t),this._target.position.add(t);const i=this.backSpeed*this.zoomSpeed;this._camera.zoom-i<=0?this._camera.zoom=.01:this._camera.zoom-=i,this._camera.updateProjectionMatrix()}else console.error(`Unmanaged displacement for camera of type ${this._camera.type}`);this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_up(){if(this.canMove&&this.canUp){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const e=Vt.clone().applyQuaternion(this._camera.quaternion).multiplyScalar(this.upSpeed);this._camera.position.add(e),this._target.position.add(e)}else console.error(`Unmanaged displacement for camera of type ${this._camera.type}`);this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_down(){if(this.canMove&&this.canDown){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const e=Wt.clone().applyQuaternion(this._camera.quaternion).multiplyScalar(this.downSpeed);this._camera.position.add(e),this._target.position.add(e)}else console.error(`Unmanaged displacement for camera of type ${this._camera.type}`);this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_left(){if(this.canMove&&this.canLeft){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const e=qt.clone().applyQuaternion(this._camera.quaternion).multiplyScalar(this.leftSpeed);this._camera.position.add(e),this._target.position.add(e)}else console.error(`Unmanaged displacement for camera of type ${this._camera.type}`);this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_right(){if(this.canMove&&this.canRight){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const e=$t.clone().applyQuaternion(this._camera.quaternion).multiplyScalar(this.rightSpeed);this._camera.position.add(e),this._target.position.add(e)}this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_rotate(e){if(this.canRotate){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const t=this._camera.position,i=this._target.position,s=t.distanceTo(i),n=(new x).subVectors(t,i).normalize(),o=this.rotateSpeed;switch(this._mode){case Kt.FirstPerson:{const s=e.x,n=e.y,r=new x(-s,n,0).applyQuaternion(this._camera.quaternion).multiplyScalar(o).add(i),a=(new x).subVectors(r,t).normalize(),h=Vt.clone().dot(a),l=$t.clone().dot(a),c=.97;if(h<-c||h>c||l<-2||l>2)return;const d=a.multiplyScalar(1).add(t);this.setTargetPosition(d)}break;case Kt.Orbit:{const t=(new L).setFromVector3(n),r=t.theta+mt(-e.x)*o,a=t.phi+mt(-e.y)*o;t.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,r)),t.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,a));const h=(new x).setFromSpherical(t).multiplyScalar(s).add(i);this.setCameraPosition(h)}break;default:throw new RangeError(`Unamanaged rotation for camera mode ${this._mode}`)}}this.dispatchEvent({type:"rotate"}),this.dispatchEvent({type:"change"})}}_pan(e){if(this.canPan){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const t=this._camera.position,i=this._target.position,s=t.distanceTo(i),n=new x(-e.x,e.y,0).applyQuaternion(this._camera.quaternion).multiplyScalar(this.panSpeed*s);this._camera.position.add(n),this._target.position.add(n)}this.dispatchEvent({type:"pan"}),this.dispatchEvent({type:"change"})}}_roll(e){if(this.canRoll){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const t=this._camera.position,i=this._target.position,s=(new x).subVectors(t,i).normalize(),n=e*this.rollSpeed;this._camera.up.applyAxisAngle(s,n),this._camera.lookAt(i)}this.dispatchEvent({type:"roll"}),this.dispatchEvent({type:"change"})}}_zoom(e){if(this.canZoom){if(this._camera.isPerspectiveCamera)switch(this._mode){case Kt.FirstPerson:e>0?this._camera.fov--:this._camera.fov++,this._camera.updateProjectionMatrix();break;case Kt.Orbit:{const t=this._camera.position,i=this._target.position,s=t.distanceTo(i),n=Yt.clone().applyQuaternion(this._camera.quaternion).multiplyScalar(e*this.zoomSpeed*s);let o=t.clone().add(n);const r=(new x).subVectors(o,t).normalize(),a=(new x).subVectors(t,i).normalize(),h=(new x).subVectors(o,i).normalize(),l=r.dot(a),c=r.dot(h),d=o.distanceToSquared(i);l<0&&(d<this.zoomMinimum*this.zoomMinimum||c>0)&&(o=a.clone().multiplyScalar(this.zoomMinimum).add(i)),this._camera.position.copy(o)}break;default:throw new RangeError(`Invalid camera control mode parameter: ${this._mode}`)}else if(this._camera.isOrthographicCamera){const t=this._camera.position,i=this._target.position,s=t.distanceTo(i),n=e*this.zoomSpeed*s;this._camera.zoom+n<=0?this._camera.zoom=.01:this._camera.zoom+=n,this._camera.updateProjectionMatrix()}this.dispatchEvent({type:"zoom"}),this.dispatchEvent({type:"change"})}}_lookAt(e){if(this.canLookAt){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const t=e.clone(),i=this._camera.position,s=this._target.position,n=i.distanceTo(s);switch(this.mode){case Kt.FirstPerson:{t.y=-t.y;const e=t.multiplyScalar(n).add(i);this.setTargetPosition(e)}break;case Kt.Orbit:{const e=t.multiplyScalar(n).add(s);this.setCameraPosition(e)}break;default:throw new RangeError(`Invalid camera control mode parameter: ${this._mode}`)}}this.dispatchEvent({type:"lookAt"}),this.dispatchEvent({type:"change"})}}_initPathDisplacement(){if(Et(this._paths))this.logger.warn("Try to init path displacement without any paths");else switch(Mt(this._currentPath)&&(this._currentPathIndex=0,this._currentPathOffset=0,this._currentPath=this._paths[0]),this._currentPathPosition=this._currentPath.getPointAt(this._currentPathOffset),this._mode){case Kt.FirstPerson:if(this._lockedTarget){const e=(new x).subVectors(this._currentPathPosition,this.camera.position);this._camera.position.add(e),this._target.position.add(e)}else this.setCameraPosition(this._currentPathPosition);break;case Kt.Orbit:if(this._lockedTarget){const e=(new x).subVectors(this._currentPathPosition,this.target.position);this._camera.position.add(e),this._target.position.add(e)}else this.setTargetPosition(this._currentPathPosition);break;default:throw new RangeError(`Invalid camera control _mode parameter: ${this._mode}`)}}_getPathDisplacement(e){let t=null;const i=this._currentPathPosition,s=this._currentPathOffset+this._cameraJump,n=s<1?s:1,o=this._currentPath.getPointAt(n),r=(new x).subVectors(o,i),a=r.clone().normalize(),h=e.dot(a),l=this._currentPathOffset-this._cameraJump,c=l>0?l:0,d=this._currentPath.getPointAt(c),p=(new x).subVectors(d,i),u=p.clone().normalize(),m=e.dot(u);if(0===h&&m<0){const i=this._getDirectionsMap();let s=void 0,n=void 0,o=-1,r=void 0;i.forEach(t=>{const i=t.index,a=t.startDisplacement;if(a){const t=a.clone().normalize(),h=e.dot(t);h>o&&(s=i,n=a,o=h,r=!0)}const h=t.endDisplacement;if(h){const t=h.clone().normalize(),a=e.dot(t);a>o&&(s=i,n=h,o=a,r=!1)}}),void 0!==s?(this._currentPathIndex=s,this._currentPath=this._paths[this._currentPathIndex],this._currentPathOffset=r?this._cameraJump:1-this._cameraJump,this._currentPathPosition=this._currentPath.getPointAt(this._currentPathOffset),t=n):(this.logger.warn("Reach path end."),t=new x)}else if(h>0&&m<=0)t=r,this._currentPathOffset=n,this._currentPathPosition=o;else if(h<=0&&m>0)t=p,this._currentPathOffset=c,this._currentPathPosition=d;else if(h<0&&0===m){const i=this._getDirectionsMap();let s=void 0,n=void 0,o=-1,r=void 0;i.forEach(t=>{const i=t.index,a=t.startDisplacement;if(a){const t=a.clone().normalize(),h=e.dot(t);h>o&&(s=i,n=a,o=h,r=!0)}const h=t.endDisplacement;if(h){const t=h.clone().normalize(),a=e.dot(t);a>o&&(s=i,n=h,o=a,r=!1)}}),void 0!==s?(this._currentPathIndex=s,this._currentPath=this._paths[this._currentPathIndex],this._currentPathOffset=r?this._cameraJump:1-this._cameraJump,this._currentPathPosition=this._currentPath.getPointAt(this._currentPathOffset),t=n):(this.logger.warn("Reach path start."),t=new x)}else h<0&&m<0||h>0&&m>0?h>m?(t=r,this._currentPathOffset=n,this._currentPathPosition=o):(t=p,this._currentPathOffset=c,this._currentPathPosition=d):(this.logger.warn("Unable to find correct next path position."),t=new x);return t}_getDirectionsMap(){const e=this._currentPathPosition,t=this._currentPathIndex,i=this._cameraJump,s=this._maxJump;return this._paths.reduce((n,o,r)=>{if(r===t)return n;const a=o.getPointAt(0);let h=void 0;e.distanceToSquared(a)<s&&(h=(new x).subVectors(o.getPointAt(i),a));const l=o.getPointAt(1);let c=void 0;return e.distanceToSquared(l)<s&&(c=(new x).subVectors(o.getPointAt(1-i),l)),(h||c)&&n.push({index:r,startDisplacement:h,endDisplacement:c}),n},[])}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @file Todo
 *
 * @example Todo
 *
 */const ei=Math.PI/2,ti=-1,ii=0,si=new x(1,0,0),ni=new x(0,1,0);function oi(t={}){const i={camera:null,target:new I,mode:Kt.Orbit,domElement:document,...t},s=this;let o=ti;this.camera=i.camera,this.cameraJump=0,this.paths=[],this.pathsMap=new Map,this.currentPath=void 0,this.currentPathIndex=-1,this.currentPathPosition=0,this.domElement=i.domElement,this.forwardControl=this.domElement.children[0].children[0].children[0],this.backwardControl=this.domElement.children[0].children[1].children[0],this.timeoutId=void 0,this.enabled=!1,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=.0025,this.enablePan=!0,this.keyPanSpeed=7,this.verticalOffset=1.5,this.keysCodes={forwardKeys:[n.Z,n.UP_ARROW],backwardKeys:[n.S,n.BOTTOM_ARROW]};let r={x:new B,y:new B};function a(){if(s.currentPathPosition+=s.cameraJump,s.currentPathPosition>1){e.log("reachEnd");var t=s.pathsMap.get(s.currentPathIndex).indexOfNextPath;s.pathsMap.get(t).indexOfNextPath===s.currentPathIndex?s.currentPathPosition=1:s.currentPathPosition=0,s.currentPathIndex=t,s.currentPath=s.paths[t]}s.update(),s.dispatchEvent({type:"move"})}function h(){if(s.currentPathPosition-=s.cameraJump,s.currentPathPosition<0){e.log("reachStart");var t=s.pathsMap.get(s.currentPathIndex).indexOfPreviousPath;s.pathsMap.get(t).indexOfPreviousPath===s.currentPathIndex?s.currentPathPosition=0:s.currentPathPosition=1,s.currentPathIndex=t,s.currentPath=s.paths[t]}s.update(),s.dispatchEvent({type:"move"})}function l(t){if(!1!==s.enabled){var i=s.currentPath.getPointAt(s.currentPathPosition),n=void 0;n=s.currentPathPosition+s.cameraJump>1?s.currentPath.getPointAt(s.currentPathPosition-s.cameraJump).sub(i).normalize().negate():s.currentPath.getPointAt(s.currentPathPosition+s.cameraJump).sub(i).normalize();var o=s.camera.getWorldDirection().normalize().dot(n);o>0&&s.keysCodes.forwardKeys.includes(t.keyCode)?(t.preventDefault(),a()):o<0&&s.keysCodes.forwardKeys.includes(t.keyCode)?(t.preventDefault(),h()):o>0&&s.keysCodes.backwardKeys.includes(t.keyCode)?(t.preventDefault(),h()):o<0&&s.keysCodes.backwardKeys.includes(t.keyCode)?(t.preventDefault(),a()):e.warn(`The key event is not implemented for key code: ${t.keyCode}`)}}function c(e){!1!==s.enabled&&(s.keysCodes.forwardKeys.includes(e.keyCode)||s.keysCodes.backwardKeys.includes(e.keyCode))&&(e&&e.preventDefault(),s.dispatchEvent({type:"moveEnd"}))}function d(e){!1!==s.enabled&&(e.preventDefault(),!0===s.enableRotate&&e.button===s.mouseButtons.ORBIT?o=ii:!0===s.enableZoom&&e.button===s.mouseButtons.ZOOM||!0===s.enablePan&&(e.button,s.mouseButtons.PAN))}function p(e){!1!==s.enabled&&(e.preventDefault(),o===ii&&function(e){var t=e.movementX||e.mozMovementX||e.webkitMovementX||0,i=e.movementY||e.mozMovementY||e.webkitMovementY||0,n=s.orientation;n.y+=t*s.rotateSpeed,n.x+=i*s.rotateSpeed,n.x=Math.max(-ei,Math.min(ei,n.x)),s.update(),s.dispatchEvent({type:"rotate"})}(e))}function u(e){!1!==s.enabled&&(e&&e.preventDefault(),o=ti,s.dispatchEvent({type:"rotateEnd"}))}this.mouseButtons={ORBIT:j.LEFT,ZOOM:j.MIDDLE,PAN:j.RIGHT},this.orientation={x:0,y:0},this.update=function(){if(!1!==this.enabled){var e=this.currentPath.getPointAt(this.currentPathPosition);this.camera.position.x=e.x,this.camera.position.y=e.y+this.verticalOffset,this.camera.position.z=e.z,r.x.setFromAxisAngle(si,this.orientation.x),r.y.setFromAxisAngle(ni,this.orientation.y),this.camera.quaternion.copy(r.y).multiply(r.x)}},this.dispose=function(){this.domElement.removeEventListener("mousedown",d,!1),this.domElement.removeEventListener("mousemove",p,!1),this.domElement.removeEventListener("mouseup",u,!1),window.removeEventListener("keydown",l,!1),window.removeEventListener("keyup",c,!1)},this.domElement.addEventListener("mousedown",d,!1),this.domElement.addEventListener("mousemove",p,!1),this.domElement.addEventListener("mouseup",u,!1),window.addEventListener("keydown",l,!1),window.addEventListener("keyup",c,!1),this.forwardControl.addEventListener("click",(function(e){clearTimeout(s.timeoutId),e.keyCode=n.UP_ARROW,l(e),s.timeoutId=setTimeout(c.bind(s),750)}),!1),this.backwardControl.addEventListener("click",(function(e){clearTimeout(s.timeoutId),e.keyCode=n.BOTTOM_ARROW,l(e),s.timeoutId=setTimeout(c.bind(s),750)}),!1)}Object.assign(oi.prototype,C.prototype,{get camera(){return this._camera},set camera(e){if(wt(e))throw new Error("Camera cannot be null ! Expect an instance of Camera");if(yt(e))throw new Error("Camera cannot be undefined ! Expect an instance of Camera");if(!(e instanceof z))throw new Error(`Camera cannot be an instance of ${e.constructor.name}. Expect an instance of Camera.`);this._camera=e},setCamera(e){return this.camera=e,this},setPath(e){this.currentPath=e,this.cameraJump=1/e.getLength()},setPaths(e,t){this.paths=e,this.currentPathIndex=0;for(var i=this.paths[this.currentPathIndex],s=this.paths.length,n=void 0,o=void 0,r=void 0,a=void 0,h=void 0,l=void 0,c=0;c<s;c++){o=(n=this.paths[c]).getPointAt(0),r=n.getPointAt(1),t&&n.name===t&&(i=n,this.currentPathIndex=c);for(var d=1/0,p=1/0,u=void 0,m=void 0,_=0;_<s;_++)c!==_&&(h=(a=this.paths[_]).getPointAt(0),l=a.getPointAt(1),o.distanceTo(h)<d&&(d=o.distanceTo(h),u=_),o.distanceTo(l)<d&&(d=o.distanceTo(l),u=_),r.distanceTo(h)<p&&(p=r.distanceTo(h),m=_),r.distanceTo(l)<p&&(p=r.distanceTo(l),m=_));this.pathsMap.set(c,{indexOfPreviousPath:u,indexOfNextPath:m})}this.setPath(i)},setMouseQuat(e){this.orientation.y=2*Math.asin(e.y),this.orientation.x=0},getCurrentPathPosition(){return this.currentPath.getPointAt(this.currentPathPosition)},getNextPathPosition(){return this.currentPathPosition+this.cameraJump>1?this.currentPath.getPointAt(this.currentPathPosition-this.cameraJump).negate():this.currentPath.getPointAt(this.currentPathPosition+this.cameraJump)},getDistanceFromStart(){return this.currentPathPosition*this.currentPath.getLength()},lookAtPath(){var e=this.getNextPathPosition();e.y=this.camera.position.y,this.camera.lookAt(e),this.setMouseQuat(this.camera.quaternion)},goTo(e){for(var t=void 0,i=void 0,s=void 0,n=void 0,o=void 0,r=void 0,a=void 0,h=1/0,l=0,c=this.paths.length;l<c;l++){i=this.paths[l],t=Math.floor(i.getLength()),s=i.getSpacedPoints(t);for(var d=0;d<t;d++)(a=e.distanceTo(s[d]))<h&&(h=a,r=l,o=i,n=d)}this.setPath(o),this.currentPathIndex=r,this.currentPathPosition=this.cameraJump*n,this.lookAtPath(),this.update(),this.dispatchEvent({type:"moveEnd"}),this.dispatchEvent({type:"rotateEnd"})}});
/**
 * @author [Ahmed DCHAR]{@link https://github.com/Dragoneel}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @file Todo
 *
 * @example Todo
 *
 */
class ri extends p{constructor(e=new x(0,0,0),t=new x(1,0,0)){super(),this.type="LineGeometry",this.setAttribute("position",new Y([e.x,e.y,e.z,t.x,t.y,t.z],3))}}class ai extends R{constructor(){super(),this.margin=.01,this.geometry=new G(new U(2,2,2)),this.material=new H({color:16777215}),this.matrixAutoUpdate=!1,this.normalPlanes={normalRightSide:new x(-1,0,0),normalLeftSide:new x(1,0,0),normalFrontSide:new x(0,-1,0),normalBackSide:new x(0,1,0),normalTopSide:new x(0,0,-1),normalBottomSide:new x(0,0,1)},this.planes={rightSidePlane:new N(this.normalPlanes.normalRightSide.clone(),0),leftSidePlane:new N(this.normalPlanes.normalLeftSide.clone(),0),frontSidePlane:new N(this.normalPlanes.normalFrontSide.clone(),0),backSidePlane:new N(this.normalPlanes.normalBackSide.clone(),0),topSidePlane:new N(this.normalPlanes.normalTopSide.clone(),0),bottomSidePlane:new N(this.normalPlanes.normalBottomSide.clone(),0)},this._boundingBox=new l}getBoundingSphere(){return this.geometry.computeBoundingSphere(),this.geometry.boundingSphere.applyMatrix4(this.matrixWorld),this.geometry.boundingSphere}setColor(e){this.material.color.set(e)}applyClippingTo(e,t){if(Mt(t))return;let i=[];for(let e in this.planes)i.push(this.planes[e]);t.traverse(t=>{if(Mt(t))return;if(Mt(t.geometry))return;if(Mt(t.material))return;const s=vt(t.material)?t.material:[t.material];for(let t=0,n=s.length;t<n;t++){let n=s[t];n.clippingPlanes||(n.clippingPlanes=[]),n.clippingPlanes=e?i:[]}})}updateSize(e){this.scale.set(e.x,e.y,e.z)}update(){this._boundingBox.setFromObject(this);const e=this.margin,t=this._boundingBox.min,i=this._boundingBox.max;this.planes.rightSidePlane.constant=i.x+e,this.planes.leftSidePlane.constant=-t.x+e,this.planes.frontSidePlane.constant=i.y+e,this.planes.backSidePlane.constant=-t.y+e,this.planes.topSidePlane.constant=i.z+e,this.planes.bottomSidePlane.constant=-t.z+e}}class hi extends b{constructor(e){super(e),this.isHighlightableMaterial=!0,this.depthTest=!1,this.depthWrite=!1,this.fog=!1,this.side=w,this.transparent=!0,this.oldColor=this.color.clone()}highlight(e){if(e){const e=.35,t=this.color.r,i=this.color.g,s=this.color.b,n=Math.min(Math.max(0,t+t*e),1),o=Math.min(Math.max(0,i+i*e),1),r=Math.min(Math.max(0,s+s*e),1);this.color.setRGB(n,o,r)}else this.color.copy(this.oldColor)}}class li extends H{constructor(e){super(e),this.isHighlightableMaterial=!0,this.depthTest=!1,this.depthWrite=!1,this.fog=!1,this.transparent=!0,this.linewidth=1,this.oldColor=this.color.clone()}highlight(e){if(e){const e=.35,t=this.color.r,i=this.color.g,s=this.color.b,n=Math.min(Math.max(0,t+t*e),1),o=Math.min(Math.max(0,i+i*e),1),r=Math.min(Math.max(0,s+s*e),1);this.color.setRGB(n,o,r)}else this.color.copy(this.oldColor)}}class ci extends g{constructor(e={}){const t={geometry:new p,material:new b({visible:!1,depthTest:!1,depthWrite:!1,fog:!1,side:w}),...e};super(t.geometry,t.material),this.isHitbox=!0,this.type="Hitbox",this.matrixAutoUpdate=!1}}class di extends ci{constructor(e={}){const t=new X(.2,0,1,4,1,!1);t.translate(0,.5,0),super({geometry:t,...e}),this.isCylindricaHitbox=!0,this.type="CylindricaHitbox"}}class pi extends ci{constructor(e={}){const t=new p;t.setAttribute("position",new Y([0,0,0,1.1,0,0,1.1,1.1,0,0,1.1,0],3)),t.setIndex([0,1,2,2,3,0]),super({geometry:t,...e}),this.isPlanarHitbox=!0,this.type="PlanarHitbox"}}class ui extends ci{constructor(e={}){const t=new Y([0,0,0,.85,0,0,1.1,1.1,0,0,.85,0],3),i=new p;i.setAttribute("position",t),i.setIndex([0,1,2,2,3,0]),super({geometry:i,...e}),this.isPlanarHitbox=!0,this.type="PlanarHitbox"}}class mi extends ci{constructor(e={}){super({geometry:new Z(1.2,0),...e}),this.isOctahedricalHitbox=!0,this.type="OctahedricalHitbox"}}class _i extends ci{constructor(e={}){super({geometry:new V(1,8,6,0,2*Math.PI,0,Math.PI),...e}),this.isSphericalHitbox=!0,this.type="SphericalHitbox"}}class fi extends ci{constructor(e={}){super({geometry:new W(1,.12,4,12,Math.PI),...e}),this.isTorusHitbox=!0,this.type="TorusHitbox"}}class gi extends I{constructor(e={}){const t={color:16777215,hitbox:null,...e};super(),this.isHandle=!0,this.type="Handle",this.matrixAutoUpdate=!1,this.color=t.color,this.hitbox=t.hitbox,this.baseQuaternion=new B}get color(){return this.line.material.color.clone()}set color(e){if(wt(e))throw new Error("Color cannot be null ! Expect an instance of Color.");if(yt(e))throw new Error("Color cannot be undefined ! Expect an instance of Color.");this.traverse(t=>{let i=t.material;i&&i.color.setHex(e)})}get hitbox(){return this._hitbox}set hitbox(e){this._hitbox=e,this.add(e)}setColor(e){return this.color=e,this}setHitbox(e){return this.hitbox=e,this}setScale(e,t,i){return this.scale.set(e,t,i),this}setPosition(e,t,i){return this.position.set(e,t,i),this}highlight(e){for(let t=0,i=this.children.length;t<i;t++){const i=this.children[t];if(i.isHitbox)continue;const s=i.material;!yt(s)&&s.isHighlightableMaterial&&s.highlight(e)}}raycast(e,t){const i=e.intersectObject(this._hitbox,!1);i.length>0&&t.push({distance:i[0].distance,object:this})}setRotationFromAxisAndAngle(e,t){return this.quaternion.setFromAxisAngle(e,t),this.baseQuaternion.copy(this.quaternion),this}update(e){}}class vi extends gi{constructor(e={}){const t={color:16777215,hitbox:new di,direction:new x(0,1,0),...e};super(t),this.isTranslateHandle=!0,this.type="TranslateHandle";const i=new ri(new x(0,0,0),new x(0,.8,0)),s=new li({color:t.color}),n=new $(i,s);n.matrixAutoUpdate=!1,this.add(n);const o=new q(.05,.2,12,1,!1);o.translate(0,.9,0);const r=new hi({color:t.color}),a=new g(o,r);a.matrixAutoUpdate=!1,this.add(a),this.direction=t.direction}get direction(){return this._direction}set direction(e){if(wt(e))throw new Error("Direction cannot be null ! Expect an instance of Color.");if(yt(e))throw new Error("Direction cannot be undefined ! Expect an instance of Color.");if(!(e instanceof x))throw new Error(`Direction cannot be an instance of ${e.constructor.name}. Expect an instance of Vector3.`);if(this._direction=e,e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{const t=new x(e.z,0,-e.x).normalize(),i=Math.acos(e.y);this.quaternion.setFromAxisAngle(t,i)}}update(e){super.update(e),this._direction.dot(e)>=0&&this.flipDirection(),this.updateMatrix(),this.hitbox.updateMatrix()}setDirection(e){return this.direction=e,this}flipDirection(){this.direction=this._direction.negate()}}class bi extends gi{constructor(e={}){const t={color:16777215,hitbox:new di,direction:new x(0,1,0),...e};super(t),this.isScaleHandle=!0,this.type="ScaleHandle";const i=new ri(new x(0,0,0),new x(0,.88,0)),s=new li({color:t.color}),n=new $(i,s);n.matrixAutoUpdate=!1,this.add(n);const o=new U(.12,.12,.12);o.translate(0,.94,0);const r=new hi({color:t.color}),a=new g(o,r);a.matrixAutoUpdate=!1,this.add(a),this.direction=t.direction}get direction(){return this._direction}set direction(e){if(wt(e))throw new Error("Direction cannot be null ! Expect an instance of Color.");if(yt(e))throw new Error("Direction cannot be undefined ! Expect an instance of Color.");if(!(e instanceof x))throw new Error(`Direction cannot be an instance of ${e.constructor.name}. Expect an instance of Vector3.`);if(this._direction=e,e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{const t=new x(e.z,0,-e.x).normalize(),i=Math.acos(e.y);this.quaternion.setFromAxisAngle(t,i)}}update(e){super.update(e),this._direction.dot(e)>=0&&this.flipDirection(),this.updateMatrix(),this.hitbox.updateMatrix()}setDirection(e){return this.direction=e,this}flipDirection(){this.direction=this._direction.negate()}}class wi extends gi{constructor(e={}){super({...e}),this.isRotateHandle=!0,this.type="RotateHandle"}update(e){super.update(e),this.updateMatrix(),this.hitbox.updateMatrix()}}class yi extends gi{constructor(e={}){const t={color:16777215,hitbox:new pi,direction:new x(0,1,0),...e};super(t),this.isPlaneHandle=!0,this.type="PlaneHandle";const i=new p;i.setAttribute("position",new Y([.75,1,0,1,1,0,1,.75,0],3));const s=new li({color:t.color}),n=new $(i,s);n.matrixAutoUpdate=!1,this.add(n);const o=new p;o.setAttribute("position",new Y([.1,.1,0,1,.1,0,1,1,0,.1,1,0],3)),o.setIndex([0,1,2,2,3,0]);const r=new hi({color:t.color,transparent:!0,opacity:.35}),a=new g(o,r);a.matrixAutoUpdate=!1,this.add(a),this.xAxis=new x(1,0,0),this.yAxis=new x(0,1,0),this.zAxis=new x(0,0,1),this.xDirection=new x(t.direction.x,0,0),this.yDirection=new x(0,t.direction.y,0),this.zDirection=new x(0,0,t.direction.z),this.direction=t.direction}get direction(){return this._direction}set direction(e){if(wt(e))throw new Error("Direction cannot be null ! Expect an instance of Color.");if(yt(e))throw new Error("Direction cannot be undefined ! Expect an instance of Color.");if(!(e instanceof x))throw new Error(`Direction cannot be an instance of ${e.constructor.name}. Expect an instance of Vector3.`);this._direction=e}update(e){super.update(e);const t=new x(this._direction.x,0,0),i=new x(0,this._direction.y,0),s=new x(0,0,this._direction.z),n=t.dot(e),o=i.dot(e),r=s.dot(e);this.quaternion.copy(this.baseQuaternion),n>0&&o>0&&0===r?(this.rotateOnAxis(this.zAxis,mt(180)),this.xDirection.setX(-1),this.yDirection.setY(-1),this.zDirection.setZ(0)):n>0&&o<0&&0===r?(this.rotateOnAxis(this.zAxis,mt(90)),this.xDirection.setX(-1),this.yDirection.setY(1),this.zDirection.setZ(0)):n<0&&o>0&&0===r?(this.rotateOnAxis(this.zAxis,mt(270)),this.xDirection.setX(1),this.yDirection.setY(-1),this.zDirection.setZ(0)):n<0&&o<0&&0===r?(this.rotateOnAxis(this.zAxis,mt(0)),this.xDirection.setX(1),this.yDirection.setY(1),this.zDirection.setZ(0)):n>0&&0===o&&r>0?(this.rotateOnAxis(this.zAxis,mt(180)),this.xDirection.setX(-1),this.yDirection.setY(0),this.zDirection.setZ(-1)):n>0&&0===o&&r<0?(this.rotateOnAxis(this.zAxis,mt(90)),this.xDirection.setX(-1),this.yDirection.setY(0),this.zDirection.setZ(1)):n<0&&0===o&&r>0?(this.rotateOnAxis(this.zAxis,mt(270)),this.xDirection.setX(1),this.yDirection.setY(0),this.zDirection.setZ(-1)):n<0&&0===o&&r<0?(this.rotateOnAxis(this.zAxis,mt(0)),this.xDirection.setX(1),this.yDirection.setY(0),this.zDirection.setZ(1)):0===n&&o>0&&r>0?(this.rotateOnAxis(this.zAxis,mt(180)),this.xDirection.setX(0),this.yDirection.setY(-1),this.zDirection.setZ(-1)):0===n&&o>0&&r<0?(this.rotateOnAxis(this.zAxis,mt(270)),this.xDirection.setX(0),this.yDirection.setY(-1),this.zDirection.setZ(1)):0===n&&o<0&&r>0?(this.rotateOnAxis(this.zAxis,mt(90)),this.xDirection.setX(0),this.yDirection.setY(1),this.zDirection.setZ(-1)):0===n&&o<0&&r<0&&(this.rotateOnAxis(this.zAxis,mt(0)),this.xDirection.setX(0),this.yDirection.setY(1),this.zDirection.setZ(1)),this.updateMatrix(),this.hitbox.updateMatrix()}setDirection(e){return this.direction=e,this}flipXDirection(){this.xDirection.setX(-this.xDirection.x)}flipYDirection(){this.yDirection.setY(-this.yDirection.y)}flipZDirection(){this.zDirection.setZ(-this.zDirection.z)}}class xi extends gi{constructor(e={}){const t={color:16777215,hitbox:new ui,direction:new x(1,1,0),...e};super(t),this.isPlaneHandle=!0,this.type="PlaneHandle";const i=new p;i.setAttribute("position",new Y([.1,.75,0,1,1,0,.75,.1,0],3));const s=new li({color:t.color}),n=new $(i,s);n.matrixAutoUpdate=!1,this.add(n);const o=new p;o.setAttribute("position",new Y([.1,.1,0,.75,.1,0,1,1,0,.1,.75,0],3)),o.setIndex([0,1,2,2,3,0]);const r=new hi({color:t.color,transparent:!0,opacity:.35}),a=new g(o,r);a.matrixAutoUpdate=!1,this.add(a),this.direction=t.direction,this.xDirection=new x(t.direction.x,0,0),this.yDirection=new x(0,t.direction.y,0),this.zDirection=new x(0,0,t.direction.z),this.xAxis=new x(1,0,0),this.yAxis=new x(0,1,0),this.zAxis=new x(0,0,1)}get direction(){return this._direction}set direction(e){if(wt(e))throw new Error("Direction cannot be null ! Expect an instance of Color.");if(yt(e))throw new Error("Direction cannot be undefined ! Expect an instance of Color.");if(!(e instanceof x))throw new Error(`Direction cannot be an instance of ${e.constructor.name}. Expect an instance of Vector3.`);this._direction=e}update(e){super.update(e);const t=this.xDirection.dot(e),i=this.yDirection.dot(e),s=this.zDirection.dot(e);this.quaternion.copy(this.baseQuaternion),t>0&&i>0&&0===s?this.rotateOnAxis(this.zAxis,mt(180)):t>0&&i<0&&0===s?this.rotateOnAxis(this.zAxis,mt(90)):t<0&&i>0&&0===s?this.rotateOnAxis(this.zAxis,mt(270)):t<0&&i<0&&0===s?this.rotateOnAxis(this.zAxis,mt(0)):t>0&&0===i&&s>0?this.rotateOnAxis(this.zAxis,mt(180)):t>0&&0===i&&s<0?this.rotateOnAxis(this.zAxis,mt(90)):t<0&&0===i&&s>0?this.rotateOnAxis(this.zAxis,mt(270)):t<0&&0===i&&s<0?this.rotateOnAxis(this.zAxis,mt(0)):0===t&&i>0&&s>0?this.rotateOnAxis(this.zAxis,mt(180)):0===t&&i>0&&s<0?this.rotateOnAxis(this.zAxis,mt(270)):0===t&&i<0&&s>0?this.rotateOnAxis(this.zAxis,mt(90)):0===t&&i<0&&s<0&&this.rotateOnAxis(this.zAxis,mt(0)),this.updateMatrix(),this.hitbox.updateMatrix()}setDirection(e){return this.direction=e,this}flipXAxis(){const e=this._direction.clone();e.x=-e.x,this.direction=e}flipYAxis(){const e=this._direction.clone();e.y=-e.y,this.direction=e}flipZAxis(){const e=this._direction.clone();e.z=-e.z,this.direction=e}}class Ei extends gi{constructor(e={}){const t={color:16777215,hitbox:new mi,...e};super(t),this.isOmnidirectionalHandle=!0,this.type="OmnidirectionalHandle";const i=new Z(.1,0),s=new hi({color:t.color,transparent:!0,opacity:.55}),n=new g(i,s);n.matrixAutoUpdate=!1,this.add(n);const o=new G(i),r=new li({color:t.color,linewidth:4}),a=new R(o,r);a.matrixAutoUpdate=!1,this.add(a)}update(e){super.update(e),this.updateMatrix(),this.hitbox.updateMatrix()}}class Mi extends I{constructor(){super(),this.isGizmo=!0,this.type="AbstractGizmo",this.matrixAutoUpdate=!1}init(){this.handles=new I,this.handles.matrixAutoUpdate=!1,this.add(this.handles);const e=new J(50,50,2,2),t=new b({side:w,visible:!1});this.intersectPlane=new g(e,t),this.intersectPlane.matrixAutoUpdate=!1,this.intersectPlane.visible=!0,this.add(this.intersectPlane);((e,t)=>{for(let i in e){const s=e[i];if(At(s))s.name=i,s.renderOrder=1/0,t.add(s);else for(let n=s.length;n--;){const s=e[i][n][0],o=e[i][n][1],r=e[i][n][2],a=e[i][n][3],h=e[i][n][4];s.name=i,s.tag=h,s.renderOrder=1/0,o&&s.position.set(o[0],o[1],o[2]),r&&s.rotation.set(r[0],r[1],r[2]),a&&s.scale.set(a[0],a[1],a[2]),s.updateMatrix();const l=s.geometry.clone();l.applyMatrix4(s.matrix),s.geometry=l,s.position.set(0,0,0),s.rotation.set(0,0,0),s.scale.set(1,1,1),t.add(s)}}})(this.handleGizmos,this.handles)}highlight(e){for(let e in this.handleGizmos)this.handleGizmos[e].highlight(!1);const t=this.handleGizmos[e];t&&t.highlight(!0)}update(e,t){this.traverse(e=>{e.isHandle&&e.update(t)}),this.updateIntersectPlane(e)}updateIntersectPlane(e){this.intersectPlane.lookAt(e),this.intersectPlane.updateMatrix()}}class Pi extends Mi{constructor(){super(),this.isTranslateGizmo=!0,this.type="TranslateGizmo",this.handleGizmos={X:new vi({color:11141120,direction:new x(1,0,0)}),Y:new vi({color:43520,direction:new x(0,1,0)}),Z:new vi({color:170,direction:new x(0,0,1)}),XY:new xi({color:11184640,direction:new x(1,1,0)}).setScale(.33,.33,1),YZ:new xi({color:43690,direction:new x(0,1,1)}).setScale(.33,.33,1).setRotationFromAxisAndAngle(new x(0,1,0),mt(-90)),XZ:new xi({color:11141290,direction:new x(1,0,1)}).setScale(.33,.33,1).setRotationFromAxisAndAngle(new x(1,0,0),mt(90)),XYZ:new Ei({color:11184810}).setScale(.15,.15,.15)},this.init()}}class Ai extends Mi{constructor(){super(),this.isRotateGizmo=!0,this.type="RotateGizmo";const e=(e,t,i)=>{const s=new p;let n=[];i=i||1;for(let s=0;s<=64*i;++s)"x"===t&&n.push(0,Math.cos(s/32*Math.PI)*e,Math.sin(s/32*Math.PI)*e),"y"===t&&n.push(Math.cos(s/32*Math.PI)*e,0,Math.sin(s/32*Math.PI)*e),"z"===t&&n.push(Math.sin(s/32*Math.PI)*e,Math.cos(s/32*Math.PI)*e,0);return s.setAttribute("position",new Y(n,3)),s};this.handleGizmos={X:[[new $(new e(1,"x",.5),new li({color:16711680}))],[new g(new Z(.04,0),new hi({color:16711680})),[0,0,.99],null,[3,1,1]]],Y:[[new $(new e(1,"y",.5),new li({color:65280}))],[new g(new Z(.04,0),new hi({color:65280})),[0,0,.99],null,[3,1,1]]],Z:[[new $(new e(1,"z",.5),new li({color:255}))],[new g(new Z(.04,0),new hi({color:255})),[.99,0,0],null,[1,3,1]]],E:[[new $(new e(1.25,"z",1),new li({color:13421568}))]],XYZ:[[new $(new e(1,"z",1),new li({color:7895160}))]]},this.pickerGizmos={X:[[new fi,[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new fi,[0,0,0],[Math.PI/2,0,0]]],Z:[[new fi,[0,0,0],[0,0,-Math.PI/2]]],E:[[new fi({radius:1.25,tube:.12,radialSegments:2,tubularSegments:24})]],XYZ:[[new fi]]},this.init()}}class Ti extends Mi{constructor(){super(),this.isScaleGizmo=!0,this.type="ScaleGizmo",this.handleGizmos={XYZ:new Ei({color:11184810}).setScale(.15,.15,.15),XY:new yi({color:11184640,direction:new x(1,1,0)}).setScale(.33,.33,1),YZ:new yi({color:43690,direction:new x(0,1,1)}).setScale(.33,.33,1).setRotationFromAxisAndAngle(new x(0,1,0),mt(-90)),XZ:new yi({color:11141290,direction:new x(1,0,1)}).setScale(.33,.33,1).setRotationFromAxisAndAngle(new x(1,0,0),mt(90)),X:new bi({color:11141120,direction:new x(1,0,0)}),Y:new bi({color:43520,direction:new x(0,1,0)}),Z:new bi({color:170,direction:new x(0,0,1)})},this.init()}}const Si=_t({None:"None",Translate:"Translate",Rotate:"Rotate",Scale:"Scale"});class Di extends I{constructor(e={}){const t={camera:null,domElement:window,mode:Si.None,objectsToClip:new I,...e};super(),this._handlers={onMouseEnter:this._onMouseEnter.bind(this),onMouseLeave:this._onMouseLeave.bind(this),onMouseDown:this._onMouseDown.bind(this),onMouseMove:this._onMouseMove.bind(this),onMouseWheel:this._onMouseWheel.bind(this),onMouseUp:this._onMouseUp.bind(this),onDblClick:this._onDblClick.bind(this),onTouchStart:this._onTouchStart.bind(this),onTouchEnd:this._onTouchEnd.bind(this),onTouchCancel:this._onTouchCancel.bind(this),onTouchLeave:this._onTouchLeave.bind(this),onTouchMove:this._onTouchMove.bind(this),onKeyDown:this._onKeyDown.bind(this),onKeyUp:this._onKeyUp.bind(this)},this._events={impose:{type:"impose"},dispose:{type:"dispose"},change:{type:"change"},translate:{type:"translate"},rotate:{type:"rotate"},scale:{type:"scale"},mouseEnter:{type:"mouseEnter"},mouseLeave:{type:"mouseLeave"},mouseDown:{type:"mouseDown"},mouseUp:{type:"mouseUp"}},this._objectsToClipBoundingBox=new l,this._objectsToClipSize=new x,this._objectsToClipCenter=new x,this._clippingBox=new ai,this.add(this._clippingBox),this.camera=t.camera,this.domElement=t.domElement,this.mode=t.mode,this.objectsToClip=t.objectsToClip,this.translationSnap=.1,this.scaleSnap=.1,this.rotationSnap=.1,this.matrixAutoUpdate=!1,this.enabled=!1,this.size=1,this._dragging=!1,this._firstPoint=new x,this._secondPoint=new x,this._mouseDisplacement=new x,this._offset=new x,this._raycaster=new K,this._pointerVector=new F,this._directionToMouse=new x,this._cameraPosition=new x,this._cameraDirection=new x,this._worldPosition=new x,this._worldRotation=new Q,this._gizmos={Translate:new Pi,Scale:new Ti};for(let e in this._gizmos)this.add(this._gizmos[e]);this._currentGizmo=null,this._currentHandle=null,this.actionsMap={setMode:{translate:[n.T.value],rotate:[n.R.value],scale:[n.S.value]},translate:{front:[n.Z.value,n.UP_ARROW.value],back:[n.S.value,n.DOWN_ARROW.value],up:[n.A.value,n.PAGE_UP.value],down:[n.E.value,n.PAGE_DOWN.value],left:[n.Q.value,n.LEFT_ARROW.value],right:[n.D.value,n.RIGHT_ARROW.value]},scale:{widthPlus:[n.LEFT_ARROW.value],widthMinus:[n.RIGHT_ARROW.value],heightPlus:[n.PAGE_UP.value],heightMinus:[n.PAGE_DOWN.value],depthPlus:[n.UP_ARROW.value],depthMinus:[n.DOWN_ARROW.value]},rotate:{xAxis:[n.X.value],yAxis:[n.Y.value],zAxis:[n.Z.value]}}}get objectsToClip(){return this._objectsToClip}set objectsToClip(e){if(wt(e))throw new Error("Objects to clip cannot be null ! Expect an instance of Object3D");if(yt(e))throw new Error("Objects to clip cannot be undefined ! Expect an instance of Object3D");if(!(e instanceof I))throw new Error(`Objects to clip cannot be an instance of ${e.constructor.name}. Expect an instance of Object3D.`);this._objectsToClip=e,this.updateClipping()}get camera(){return this._camera}set camera(e){if(wt(e))throw new Error("Camera cannot be null ! Expect an instance of Camera");if(yt(e))throw new Error("Camera cannot be undefined ! Expect an instance of Camera");if(!(e instanceof z))throw new Error(`Camera cannot be an instance of ${e.constructor.name}. Expect an instance of Camera.`);this._camera=e}get domElement(){return this._domElement}set domElement(e){if(wt(e))throw new Error("DomElement cannot be null ! Expect an instance of Window, HTMLDocument, HTMLDivElement or HTMLCanvasElement.");if(yt(e))throw new Error("DomElement cannot be undefined ! Expect an instance of Window, HTMLDocument, HTMLDivElement or HTMLCanvasElement.");if(!(e instanceof Window||e instanceof HTMLDocument||e instanceof HTMLDivElement||e instanceof HTMLCanvasElement))throw new Error(`Target cannot be an instance of ${e.constructor.name}. Expect an instance of Window, HTMLDocument, HTMLDivElement or HTMLCanvasElement.`);this._domElement&&(this._domElement.removeEventListener("mouseenter",this._handlers.onMouseEnter,!1),this._domElement.removeEventListener("mouseleave",this._handlers.onMouseLeave,!1),this.dispose()),this._domElement=e,this._domElement.addEventListener("mouseenter",this._handlers.onMouseEnter,!1),this._domElement.addEventListener("mouseleave",this._handlers.onMouseLeave,!1),this.impose()}get mode(){return this._mode}set mode(e){if(wt(e))throw new Error("Mode cannot be null ! Expect a value from ClippingModes enum.");if(yt(e))throw new Error("Mode cannot be undefined ! Expect a value from ClippingModes enum.");this._mode=e;for(let e in this._gizmos)this._gizmos[e].visible=!1;this._mode===Si.None?this._currentGizmo=null:(this._currentGizmo=this._gizmos[this._mode],this._currentGizmo.visible=!0),this.updateGizmo()}setCamera(e){return this.camera=e,this}setDomElement(e){return this.domElement=e,this}setMode(e){return this.mode=e,this}setObjectsToClip(e){return this.objectsToClip=e,this}impose(){this._domElement.addEventListener("keydown",this._handlers.onKeyDown,!1),this._domElement.addEventListener("keyup",this._handlers.onKeyUp,!1),this._domElement.addEventListener("dblclick",this._handlers.onDblClick,!1),this._domElement.addEventListener("mousedown",this._handlers.onMouseDown,!1),this._domElement.addEventListener("mousemove",this._handlers.onMouseMove,!1),this._domElement.addEventListener("mouseup",this._handlers.onMouseUp,!1),this._domElement.addEventListener("wheel",this._handlers.onMouseWheel,{capture:!0,once:!1,passive:!1}),this._domElement.addEventListener("touchcancel",this._handlers.onTouchCancel,!1),this._domElement.addEventListener("touchend",this._handlers.onTouchEnd,!1),this._domElement.addEventListener("touchleave",this._handlers.onTouchLeave,!1),this._domElement.addEventListener("touchmove",this._handlers.onTouchMove,{capture:!0,once:!1,passive:!1}),this._domElement.addEventListener("touchstart",this._handlers.onTouchStart,{capture:!0,once:!1,passive:!1}),this.dispatchEvent(this._events.impose)}dispose(){this._domElement.removeEventListener("keydown",this._handlers.onKeyDown,!1),this._domElement.removeEventListener("keyup",this._handlers.onKeyUp,!1),this._domElement.removeEventListener("dblclick",this._handlers.onDblClick,!1),this._domElement.removeEventListener("mousedown",this._handlers.onMouseDown,!1),this._domElement.removeEventListener("mousemove",this._handlers.onMouseMove,!1),this._domElement.removeEventListener("mouseup",this._handlers.onMouseUp,!1),this._domElement.removeEventListener("wheel",this._handlers.onMouseWheel,{capture:!0,once:!1,passive:!1}),this._domElement.removeEventListener("touchcancel",this._handlers.onTouchCancel,!1),this._domElement.removeEventListener("touchend",this._handlers.onTouchEnd,!1),this._domElement.removeEventListener("touchleave",this._handlers.onTouchLeave,!1),this._domElement.removeEventListener("touchmove",this._handlers.onTouchMove,{capture:!0,once:!1,passive:!1}),this._domElement.removeEventListener("touchstart",this._handlers.onTouchStart,{capture:!0,once:!1,passive:!1}),this.dispatchEvent(this._events.dispose)}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}enable(){this.visible=!0,this.enabled=!0,Pt(this._objectsToClip)&&(this._objectsToClipBoundingBox.setFromObject(this._objectsToClip),this._objectsToClipBoundingBox.getSize(this._objectsToClipSize),this._objectsToClipSize.divideScalar(2),this.scale.set(this._objectsToClipSize.x,this._objectsToClipSize.y,this._objectsToClipSize.z),this._objectsToClipBoundingBox.getCenter(this._objectsToClipCenter),this.position.set(this._objectsToClipCenter.x,this._objectsToClipCenter.y,this._objectsToClipCenter.z),this.updateMatrix(),this.updateMatrixWorld()),this.updateClipping(),this.updateGizmo()}disable(){this.visible=!1,this.enabled=!1,this.updateClipping()}updateClipping(){Mt(this._objectsToClip)||(this._clippingBox.update(),this._clippingBox.applyClippingTo(this.enabled,this._objectsToClip))}updateGizmo(){this.enabled&&this._mode!==Si.None&&(Mt(this._currentGizmo)||(this._camera.getWorldPosition(this._cameraPosition),this._camera.getWorldDirection(this._cameraDirection),this._currentGizmo.update(this._cameraPosition,this._cameraDirection)))}_consumeEvent(e){e.cancelable&&e.stopImmediatePropagation()}_onKeyDown(e){if(!this.enabled)return;e.preventDefault();const t=this.actionsMap,i=e.keyCode;if(e.ctrlKey)switch(this._mode){case Si.Translate:t.translate.front.includes(i)?(this._translateZ(this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.translate.back.includes(i)?(this._translateZ(-this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.translate.right.includes(i)?(this._translateX(this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.translate.left.includes(i)?(this._translateX(-this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.translate.up.includes(i)?(this._translateY(this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.translate.down.includes(i)&&(this._translateY(-this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change));break;case Si.Rotate:break;case Si.Scale:t.scale.depthPlus.includes(i)?(this._scaleZ(this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.scale.depthMinus.includes(i)?(this._scaleZ(-this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.scale.widthPlus.includes(i)?(this._scaleX(this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.scale.widthMinus.includes(i)?(this._scaleX(-this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.scale.heightPlus.includes(i)?(this._scaleY(this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.scale.heightMinus.includes(i)&&(this._scaleY(-this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change))}else t.setMode.translate.includes(i)?(this.setMode(Si.Translate),this.updateClipping(),this._consumeEvent(e)):t.setMode.rotate.includes(i)?(this.setMode(Si.Rotate),this.updateClipping(),this._consumeEvent(e)):t.setMode.scale.includes(i)&&(this.setMode(Si.Scale),this.updateClipping(),this._consumeEvent(e))}_onKeyUp(e){this.enabled&&!e.defaultPrevented&&e.preventDefault()}_onDblClick(e){this.enabled&&this._mode!==Si.None&&e.preventDefault()}_onMouseDown(e){if(!this.enabled)return;if(this._mode===Si.None)return;if(e.button!==o.LEFT.value)return;if(Mt(this._currentHandle))return;e.preventDefault(),this._dragging=!0;const t=this.intersectObjects(e,[this._currentGizmo.intersectPlane]);t&&(this._firstPoint=t.point),this._consumeEvent(e),this.dispatchEvent(this._events.mouseDown)}_onMouseEnter(e){this.enabled&&this._mode!==Si.None&&(e.preventDefault(),this.impose(),e.target.constructor!==HTMLDocument&&this._domElement.focus())}_onMouseLeave(e){this.enabled&&this._mode!==Si.None&&(e.preventDefault(),this._dragging=!1,e.target.constructor!==HTMLDocument&&this._domElement.blur(),this.dispose())}_onMouseMove(e){if(this.enabled&&this._mode!==Si.None)if(e.preventDefault(),!1===this._dragging){const t=this.intersectObjects(e,this._currentGizmo.handles.children);if(t){const i=t.object;this._currentHandle&&i!==this._currentHandle&&(this._currentHandle.highlight(!1),this.dispatchEvent(this._events.mouseLeave)),this._currentHandle=i,this._currentHandle.highlight(!0),this.dispatchEvent(this._events.mouseEnter),this._consumeEvent(e)}else Pt(this._currentHandle)&&(this._currentHandle.highlight(!1),this._currentHandle=null,this.dispatchEvent(this._events.mouseLeave))}else{const t=this._currentHandle,i=t.name,s=this.intersectObjects(e,[this._currentGizmo.intersectPlane]);switch(s&&(this._secondPoint=s.point),this._mouseDisplacement.subVectors(this._secondPoint,this._firstPoint),this._firstPoint.copy(this._secondPoint),this._mode){case Si.Translate:"X"===i?this._offset.set(1,0,0):"Y"===i?this._offset.set(0,1,0):"Z"===i?this._offset.set(0,0,1):"XY"===i?this._offset.set(1,1,0):"YZ"===i?this._offset.set(0,1,1):"XZ"===i?this._offset.set(1,0,1):"XYZ"===i&&this._offset.set(1,1,1),this._offset.multiply(this._mouseDisplacement),this._translate(this._offset);break;case Si.Rotate:break;case Si.Scale:if(t.isScaleHandle)this._offset.copy(this._currentHandle.direction).multiply(this._mouseDisplacement);else if(t.isPlaneHandle){const e=this._currentHandle.xDirection.dot(this._mouseDisplacement);e>0?this._offset.setX(Math.abs(this._mouseDisplacement.x)):e<0?this._offset.setX(-Math.abs(this._mouseDisplacement.x)):this._offset.setX(0);const t=this._currentHandle.yDirection.dot(this._mouseDisplacement);t>0?this._offset.setY(Math.abs(this._mouseDisplacement.y)):t<0?this._offset.setY(-Math.abs(this._mouseDisplacement.y)):this._offset.setY(0);const i=this._currentHandle.zDirection.dot(this._mouseDisplacement);i>0?this._offset.setZ(Math.abs(this._mouseDisplacement.z)):i<0?this._offset.setZ(-Math.abs(this._mouseDisplacement.z)):this._offset.setZ(0)}else if(t.isOmnidirectionalHandle){this.getWorldPosition(this._worldPosition),this._directionToMouse.subVectors(this._firstPoint,this._worldPosition);const e=this._directionToMouse.dot(this._mouseDisplacement)>0?this._mouseDisplacement.length():-this._mouseDisplacement.length();this._offset.set(e,e,e)}this._scale(this._offset);break;default:throw new RangeError(`Invalid switch parameter: ${this._mode}`)}this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)}}_onMouseUp(e){if(!this.enabled)return;if(this._mode===Si.None)return;if(e.button!==o.LEFT.value)return;e.preventDefault(),this._dragging=!1,this.dispatchEvent(this._events.mouseUp);const t=this.intersectObjects(e,this._currentGizmo.handles.children);t?(this._currentHandle=t.object,this._currentHandle.highlight(!0),this._consumeEvent(e),this.dispatchEvent(this._events.mouseEnter)):Pt(this._currentHandle)&&(this._currentHandle.highlight(!1),this._currentHandle=null,this.dispatchEvent(this._events.mouseLeave)),this.updateGizmo()}_onMouseWheel(e){this.enabled&&e.preventDefault()}_onTouchCancel(e){this.enabled&&e.preventDefault()}_onTouchEnd(e){this.enabled&&e.preventDefault()}_onTouchLeave(e){this.enabled&&e.preventDefault()}_onTouchMove(e){this.enabled&&e.preventDefault()}_onTouchStart(e){this.enabled&&e.preventDefault()}getActiveHandle(e){}intersectObjects(e,t){const i=this._domElement.getBoundingClientRect(),s=(e.clientX-i.left)/i.width*2-1,n=-(e.clientY-i.top)/i.height*2+1;this._pointerVector.set(s,n),this._raycaster.setFromCamera(this._pointerVector,this._camera);const o=this._raycaster.intersectObjects(t,!1);return o[0]?o[0]:null}_translate(e){this.position.add(e),this.updateMatrix()}_translateX(e){this.position.setX(this.position.x+e),this.updateMatrix()}_translateY(e){this.position.setY(this.position.y+e),this.updateMatrix()}_translateZ(e){this.position.setZ(this.position.z+e),this.updateMatrix()}_translateXY(e,t){this.position.setX(this.position.x+e),this.position.setY(this.position.y+t),this.updateMatrix()}_translateXZ(e,t){this.position.setX(this.position.x+e),this.position.setZ(this.position.z+t),this.updateMatrix()}_translateYZ(e,t){this.position.setY(this.position.y+e),this.position.setZ(this.position.z+t),this.updateMatrix()}_translateXYZ(e,t,i){this.position.set(this.position.x+e,this.position.y+t,this.position.z+i),this.updateMatrix()}_rotateX(e){}_rotateY(e){}_rotateZ(e){}_rotateXY(e){}_rotateXZ(e){}_rotateYZ(e){}_rotateXYZ(e){}_scale(e){this.scale.add(e),this.updateMatrix()}_scaleX(e){this.scale.setX(this.scale.x+e),this.updateMatrix()}_scaleY(e){this.scale.setY(this.scale.y+e),this.updateMatrix()}_scaleZ(e){this.scale.setZ(this.scale.z+e),this.updateMatrix()}_scaleXY(e,t){this.scale.setX(this.scale.x+e),this.scale.setY(this.scale.y+t),this.updateMatrix()}_scaleXZ(e,t){this.scale.setX(this.scale.x+e),this.scale.setZ(this.scale.z+t),this.updateMatrix()}_scaleYZ(e,t){this.scale.setY(this.scale.y+e),this.scale.setZ(this.scale.z+t),this.updateMatrix()}_scaleXYZ(e,t,i){this.scale.set(this.scale.x+e,this.scale.y+t,this.scale.z+i),this.updateMatrix()}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @file Todo
 *
 * @example Todo
 *
 */function Oi(){r.call(this),this.basePath="/buffergeometries"}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @file Todo
 *
 * @example Todo
 *
 */
function ki(){r.call(this),this.basePath="/curves"}Oi.prototype=Object.assign(Object.create(r.prototype),{constructor:Oi,convert(e){let t=null;switch(e.type){case"Scene":t=new ee;break;default:t=new I}return t}}),Object.defineProperties(Oi.prototype,{_onJson:{value:function(e,t,i,s){const n=ft(e)?[e]:e,o={};let r=void 0;for(let e=0,t=n.length,a=void 0;e<t;e++)a=n[e],r=this.convert(a,s),r&&(o[a._id]=r),i(e/t);t(o)}}}),ki.prototype=Object.assign(Object.create(r.prototype),{constructor:ki,convert(e){if(!e)throw new Error("CurvesManager: Unable to convert null or undefined data !");const t=e.type;let i=void 0;switch(t){case"ArcCurve":i=new ue;break;case"CatmullRomCurve3":i=new pe;break;case"CubicBezierCurve":i=new de;break;case"CubicBezierCurve3":i=new ce;break;case"Curve":i=new le;break;case"CurvePath":i=new he;break;case"EllipseCurve":i=new ae;break;case"LineCurve":i=new re;break;case"LineCurve3":i=new oe;break;case"Path":i=new ne;break;case"QuadraticBezierCurve":i=new se;break;case"QuadraticBezierCurve3":i=new ie;break;case"SplineCurve":i=new te;break;case"Shape":i=new E;break;default:throw new Error(`TCurvesManager: Unknown curve of type: ${t}`)}return i.fromJSON(e),i}}),Object.defineProperties(ki.prototype,{_onJson:{value:function(e,t,i,s){const n=ft(e)?[e]:e,o={};for(let e=0,t=n.length,r=void 0;e<t;e++){r=n[e];try{o[r._id]=this.convert(r)}catch(e){s(e)}i(e/t)}t(o)}}});
/**
 * @author [Ahmed DCHAR]{@link https://github.com/Dragoneel}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @class ClassName
 * @classdesc Todo...
 * @example Todo...
 *
 */
class Ci extends r{constructor(t={}){super({basePath:"/",responseType:a.Json,bunchSize:500,requestAggregationTime:200,requestsConcurrency:6,logger:e,...t})}_onJson(e,t,i,s){const n=ft(e)?[e]:e,o={};for(let e=0,t=n.length,r=void 0;e<t;e++){r=n[e];try{o[r.id]=this.convert(r)}catch(e){s(e)}i(new ProgressEvent("FilairesManager",{lengthComputable:!0,loaded:e+1,total:t}))}t(o)}convert(e){if(!e)throw new Error("FilairesManager: Unable to convert null or undefined data !");const t=e.type;let i=null;if(Mt(t))throw new Error("TFilaireManager.convert() : data type must be defined !!!");switch(t){case"NaissanceVoute":i=this._parseFilaire(e,8868096);break;case"Radier":i=this._parseFilaire(e,35247);break;case"Intrados":i=this._parseFilaire(e,12648628);break;case"Br":case"Bp":case"Src":i=this._parsePoint(e,65280);break;default:throw new Error(`TFilaireManager: Unknown object of type: ${t}`)}return i}_parseFilaire(e,t){const i=JSON.parse(e.geojson).coordinates.reduce((e,t)=>e.concat(t),[]);if(Mt(i))throw new Error(`TFilaireManager._parseFilaire() : ${e.type} geometry doesn't contains coordinates !!!`);const s=new H({color:t}),n=new p;n.setAttribute("position",new Y(i,3));let o=new $(n,s);return Mt(e.type)?o.name="".concat(e.id):o.name="".concat(e.type,"_").concat(e.numero_bloc,"_").concat(e.id),o}_parsePoint(e,t){const i=JSON.parse(e.geojson).coordinates.reduce((e,t)=>e.concat(t),[]);if(Mt(i))throw new Error("FilairesManager._parsePoint() : ".concat(e.type," geometry doesn't contains coordinates !!!"));let s=new V(parseFloat(e.attribut),50,50,0,2*Math.PI,0,2*Math.PI);s.computeVertexNormals();let n=new D({color:t}),o=new g(s,n);return o.position.set(i[0],i[1],i[2]),Mt(e.type)?o.name="".concat(e.id):o.name="".concat(e.type,"_").concat(e.numero_bloc,"_").concat(e.id),o}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @class GeometriesManager
 * @classdesc Todo...
 * @example Todo...
 *
 * @requires {@link TDataBaseManager}
 * @requires '../../../node_modules/three/src/core/Geometry'
 * @requires { BufferGeometry } from 'three'
 * @requires '../../../node_modules/three/src/core/BufferAttribute'
 *
 */const Ii=0,zi=1,Fi=2,Li=3,Bi=4,ji=5,Ri=6,Gi=7,Ui=8;class Hi extends r{constructor(e={}){const t={basePath:"/geometries",projectionSystem:"zBack",globalScale:1,computeNormals:!0,computeBoundingBox:!0,computeBoundingSphere:!0,...e};super(t),this.projectionSystem=t.projectionSystem,this.globalScale=t.globalScale,this.computeNormals=t.computeNormals,this.computeBoundingBox=t.computeBoundingBox,this.computeBoundingSphere=t.computeBoundingSphere}get computeBoundingBox(){return this._computeBoundingBox}set computeBoundingBox(e){if(wt(e))throw new TypeError("Compute bounding box cannot be null ! Expect a boolean.");if(yt(e))throw new TypeError("Compute bounding box cannot be undefined ! Expect a boolean.");if(xt(e))throw new TypeError(`Compute bounding box cannot be an instance of ${e.constructor.name} ! Expect a boolean.`);this._computeBoundingBox=e}get computeBoundingSphere(){return this._computeBoundingSphere}set computeBoundingSphere(e){if(wt(e))throw new TypeError("Compute bounding sphere cannot be null ! Expect a boolean.");if(yt(e))throw new TypeError("Compute bounding sphere cannot be undefined ! Expect a boolean.");if(xt(e))throw new TypeError(`Compute bounding sphere cannot be an instance of ${e.constructor.name} ! Expect a boolean.`);this._computeBoundingSphere=e}get computeNormals(){return this._computeNormals}set computeNormals(e){if(wt(e))throw new TypeError("Compute normals cannot be null ! Expect a boolean.");if(yt(e))throw new TypeError("Compute normals cannot be undefined ! Expect a boolean.");if(xt(e))throw new TypeError(`Compute normals cannot be an instance of ${e.constructor.name} ! Expect a boolean.`);this._computeNormals=e}get projectionSystem(){return this._projectionSystem}set projectionSystem(e){if(wt(e))throw new TypeError("Projection system cannot be null ! Expect a positive number.");if(yt(e))throw new TypeError("Projection system cannot be undefined ! Expect a positive number.");this._projectionSystem=e}get globalScale(){return this._globalScale}set globalScale(e){if(wt(e))throw new TypeError("Global scale cannot be null ! Expect a positive number.");if(yt(e))throw new TypeError("Global scale cannot be undefined ! Expect a positive number.");this._globalScale=e}setComputeBoundingBox(e){return this.computeBoundingBox=e,this}setComputeBoundingShpere(e){return this.computeBoundingSphere=e,this}setComputeNormals(e){return this.computeNormals=e,this}setProjectionSystem(e){return this.projectionSystem=e,this}setGlobalScale(e){return this.globalScale=e,this}_onJson(e,t,i,s){const n=ft(e)?[e]:e,o={};for(let e=0,t=n.length,r=void 0;e<t;e++){r=n[e];try{o[r._id]=this.convert(r)}catch(e){s(e)}i(new ProgressEvent("GeometriesManager",{lengthComputable:!0,loaded:e+1,total:t}))}t(o)}convert(e){if(!e)throw new Error("GeometriesManager: Unable to convert null or undefined data !");const t=e.type;if(!t)throw new Error("GeometriesManager: Unable to convert untyped data !");let i=null;if(e.isBufferGeometry||t.includes("BufferGeometry"))i=this._convertJsonToBufferGeometry(e),this._computeNormals&&i.computeVertexNormals();else{if(!e.isGeometry&&!t.includes("Geometry"))throw new Error(`TGeometriesManager: Unable to retrieve geometry of type ${t} !`);i=this._convertJsonToGeometry(e),this._computeNormals&&i.computeFaceNormals()}return this.computeBoundingBox&&(i.boundingBox=null,i.computeBoundingBox()),this.computeBoundingSphere&&(i.boundingSphere=null,i.computeBoundingSphere()),i}_convertJsonToGeometry(e){const t=e.types;let i=null;switch(t){case"BoxGeometry":i=new ze;break;case"CircleGeometry":i=new Ie;break;case"CylinderGeometry":i=new Ce;break;case"ConeGeometry":i=new ke;break;case"EdgesGeometry":i=new G;break;case"DodecahedronGeometry":i=new Oe;break;case"ExtrudeGeometry":i=new De;break;case"Geometry":i=new Se;break;case"IcosahedronGeometry":i=new Te;break;case"LatheGeometry":i=new Ae;break;case"OctahedronGeometry":i=new Pe;break;case"ParametricGeometry":i=new Me;break;case"PlaneGeometry":i=new v;break;case"PolyhedronGeometry":i=new Ee;break;case"RingGeometry":i=new xe;break;case"ShapeGeometry":i=new ye;break;case"TetrahedronGeometry":i=new we;break;case"TextGeometry":i=new be;break;case"TorusGeometry":i=new ve;break;case"TorusKnotGeometry":i=new ge;break;case"TubeGeometry":i=new fe;break;case"SphereGeometry":i=new _e;break;case"WireframeGeometry":i=new me;break;default:throw new Error(`TGeometriesManager: Unknown geometry of type: ${t}`)}i.uuid=e.uuid,i.name=e.name,i.type=e.type;for(var s=[],n=void 0,o=0,r=e.vertices.length;o<r;++o)n=e.vertices[o],s.push(new x(n.x,n.y,n.z));i.vertices=s;for(var a=[],h=void 0,l=0,c=e.faces.length;l<c;l++)h=e.faces[l],a.push(new Fe(h.a,h.b,h.c,h.normal,h.color,h.materialIndex));i.faces=a,i.morphTargets=[],i.morphNormals=[],i.skinWeights=[],i.skinIndices=[],i.lineDistances=[],i.elementsNeedUpdate=!0,i.verticesNeedUpdate=!0,i.uvsNeedUpdate=!0,i.normalsNeedUpdate=!0,i.colorsNeedUpdate=!0,i.lineDistancesNeedUpdate=!0,i.groupsNeedUpdate=!0}_convertJsonToBufferGeometry(e){const t=e.type;let i=null;switch(t){case"BoxBufferGeometry":i=new U;break;case"BufferGeometry":i=new p;break;case"CircleBufferGeometry":i=new We;break;case"CylinderBufferGeometry":i=new X;break;case"ConeBufferGeometry":i=new q;break;case"DodecahedronBufferGeometry":i=new Ve;break;case"ExtrudeBufferGeometry":i=new Ze;break;case"IcosahedronBufferGeometry":i=new Ye;break;case"LatheBufferGeometry":i=new Xe;break;case"OctahedronBufferGeometry":i=new Z;break;case"ParametricBufferGeometry":i=new Ne;break;case"PlaneBufferGeometry":i=new J;break;case"PolyhedronBufferGeometry":i=new He;break;case"RingBufferGeometry":i=new Ue;break;case"ShapeBufferGeometry":i=new p;break;case"TetrahedronBufferGeometry":i=new Ge;break;case"TextBufferGeometry":i=new Re;break;case"TorusBufferGeometry":i=new W;break;case"TorusKnotBufferGeometry":i=new je;break;case"TubeBufferGeometry":i=new Be;break;case"SphereBufferGeometry":i=new V;break;case"InstancedBufferGeometry":i=new Le;break;default:throw new Error(`TGeometriesManager: Unknown buffer geometry of type: ${t}`)}i._id=e._id,i.uuid=e.uuid,i.name=e.name;const s=e.index;if(s&&s.array&&s.array.length>0){const e=this.__convertBase64ToArrayBuffer(s.array),t=this.__convertArrayBufferToTypedArray(e);i.index=new u(t,s.itemSize,s.normalized)}const n=e.attributes;if(n){let e={};const t=n.position;if(t){const i=this.__convertBase64ToArrayBuffer(t.array),s=this.__convertArrayBufferToTypedArray(i),n=this.globalScale,o=new Float32Array(s);if("zBack"===this._projectionSystem){let e=null,t=null,i=null;for(let s=0,r=o.length;s<r;s+=3)e=o[s]/n,t=o[s+2]/n,i=-o[s+1]/n,o[s]=e,o[s+1]=t,o[s+2]=i}else for(let e=0,t=o.length;e<t;e++)o[e]/=n;e.position=new u(o,t.itemSize,t.normalized)}const s=n.normal;if(s){const t=this.__convertBase64ToArrayBuffer(s.array),i=this.__convertArrayBufferToTypedArray(t);e.normal=new u(i,s.itemSize,s.normalized)}const o=n.uv;if(o){const t=this.__convertBase64ToArrayBuffer(o.array),i=this.__convertArrayBufferToTypedArray(t);e.uv=new u(i,o.itemSize,o.normalized)}i.attributes=e}return Pt(e.groups)&&(i.groups=e.groups),Pt(e.boundingBox)&&(i.boundingBox=e.boundingBox),Pt(e.boundingSphere)&&(i.boundingSphere=e.boundingSphere),"ShapeBufferGeometry"===t&&(i.shapes=e.shapes.map(e=>(new E).fromJSON(e)),i.curveSegments=e.curveSegments),i}__convertArrayBufferToTypedArray(e){const t=new DataView(e),i=e.byteLength-1,s=t.getUint8(0);let n=null;switch(s){case Ii:n=new Int8Array(i/1);for(let e=0,s=1;s<i;e++,s+=1)n[e]=t.getInt8(s);break;case zi:n=new Uint8Array(i/1);for(let e=0,s=1;s<i;e++,s+=1)n[e]=t.getUint8(s);break;case Fi:n=new Uint8ClampedArray(i/1);for(let e=0,s=1;s<i;e++,s+=1)n[e]=t.getUint8(s);break;case Li:n=new Int16Array(i/2);for(let e=0,s=1;s<i;e++,s+=2)n[e]=t.getInt16(s);break;case Bi:n=new Uint16Array(i/2);for(let e=0,s=1;s<i;e++,s+=2)n[e]=t.getUint16(s);break;case ji:n=new Int32Array(i/4);for(let e=0,s=1;s<i;e++,s+=4)n[e]=t.getInt32(s);break;case Ri:n=new Uint32Array(i/4);for(let e=0,s=1;s<i;e++,s+=4)n[e]=t.getUint32(s);break;case Gi:n=new Float32Array(i/4);for(let e=0,s=1;s<i;e++,s+=4)n[e]=t.getFloat32(s);break;case Ui:n=new Float64Array(i/8);for(let e=0,s=1;s<i;e++,s+=8)n[e]=t.getFloat64(s);break;default:throw new RangeError(`Invalid switch parameter: ${s}`)}return n}__convertBase64ToArrayBuffer(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=new Uint8Array(256);for(let e=0;e<t.length;e++)i[t.charCodeAt(e)]=e;const s=e.length;let n=.75*s;"="===e[s-1]&&(n--,"="===e[s-2]&&n--);let o=new ArrayBuffer(n),r=new Uint8Array(o),a=void 0,h=void 0,l=void 0,c=void 0;for(let t=0,n=0;t<s;t+=4)a=i[e.charCodeAt(t)],h=i[e.charCodeAt(t+1)],l=i[e.charCodeAt(t+2)],c=i[e.charCodeAt(t+3)],r[n++]=a<<2|h>>4,r[n++]=(15&h)<<4|l>>2,r[n++]=(3&l)<<6|63&c;return o}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @file Todo
 *
 * @example Todo
 *
 */function Ni(){r.call(this),this.basePath="/textures"}Ni.prototype=Object.assign(Object.create(r.prototype),{constructor:Ni,convert(e){if(!e)throw new Error("TexturesManager: Unable to convert null or undefined data !");const t=e.type;throw new Error(`TTexturesManager: Unknown texture of type: ${t}`)}}),Object.defineProperties(Ni.prototype,{_onJson:{value:function(e,t,i,s){const n=ft(e)?[e]:e,o={};for(let e=0,t=n.length,r=void 0;e<t;e++){r=n[e];try{o[r._id]=this.convert(r)}catch(e){s(e)}i(e/t)}t(o)}}});
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @class TScenesManager
 * @classdesc Todo...
 * @example Todo...
 * @requires TDataBaseManager
 *
 */
const Xi=(new $e).load("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH4gkKDRoGpGNegQAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAAMSURBVAjXY/j//z8ABf4C/tzMWecAAAAASUVORK5CYII=");class Yi extends r{constructor(e={}){const t={basePath:"/materials",texturesPath:"/textures",texturesProvider:new f,generateMipmap:!1,autoFillTextures:!0,...e};super(t),this.texturesPath=t.texturesPath,this.texturesProvider=t.texturesProvider,this.generateMipmap=t.generateMipmap,this.autoFillTextures=t.autoFillTextures}get texturesPath(){return this._texturesPath}set texturesPath(e){if(wt(e))throw new TypeError("Textures path cannot be null ! Expect a non empty string.");if(yt(e))throw new TypeError("Textures path cannot be undefined ! Expect a non empty string.");if(Tt(e))throw new TypeError(`Textures path cannot be an instance of ${e.constructor.name} ! Expect a non empty string.`);if(St(e))throw new TypeError("Textures path cannot be empty ! Expect a non empty string.");if(Dt(e))throw new TypeError("Textures path cannot contain only whitespace ! Expect a non empty string.");this._texturesPath=e}get texturesProvider(){return this._texturesProvider}set texturesProvider(e){if(wt(e))throw new TypeError("Textures provider cannot be null ! Expect an instance of TextureLoader.");if(yt(e))throw new TypeError("Textures provider cannot be undefined ! Expect an instance of TextureLoader.");if(!(e instanceof Ni||e instanceof f))throw new TypeError(`Textures provider cannot be an instance of ${e.constructor.name} ! Expect an instance of TTexturesManager.`);this._texturesProvider=e}get generateMipmap(){return this._generateMipmap}set generateMipmap(e){if(wt(e))throw new TypeError("Generate mipmap cannot be null ! Expect a boolean.");if(yt(e))throw new TypeError("Generate mipmap cannot be undefined ! Expect a boolean.");if(xt(e))throw new TypeError(`Generate mipmap cannot be an instance of ${e.constructor.name} ! Expect a boolean.`);this._generateMipmap=e}get autoFillTextures(){return this._autoFillTextures}set autoFillTextures(e){if(wt(e))throw new TypeError("Global scale cannot be null ! Expect a boolean.");if(yt(e))throw new TypeError("Global scale cannot be undefined ! Expect a positive number.");if(xt(e))throw new TypeError("Global scale cannot be null ! Expect a boolean.");this._autoFillTextures=e}setTexturesPath(e){return this.texturesPath=e,this}setTexturesProvider(e){return this.texturesProvider=e,this}setGenerateMipmap(e){return this.generateMipmap=e,this}setAutoFillTextures(e){return this.autoFillTextures=e,this}_onJson(e,t,i,s){const n=ft(e)?[e]:e,o={};for(let e=0,t=n.length,r=void 0;e<t;e++){r=n[e];try{o[r._id]=this.convert(r)}catch(e){s(e)}i(new ProgressEvent("MaterialsManager",{lengthComputable:!0,loaded:e+1,total:t}))}this._autoFillTextures?this.fillTextures(o,t,i,s):t(o)}convert(e){if(!e)throw new Error("MaterialsManager: Unable to convert null or undefined data !");const t=e.type;let i=null;switch(t){case"MeshPhongMaterial":{i=new D,this._fillBaseMaterialData(i,e);const t=e.color;Pt(t)&&(i.color=this._setColor(t));const s=e.specular;Pt(s)&&(i.specular=this._setColor(s));const n=e.shininess;Pt(n)&&(i.shininess=n);const o=e.map;Pt(o)&&(i.map=o);const r=e.lightMap;Pt(r)&&(i.lightMap=r);const a=e.lightMapIntensity;Pt(a)&&(i.lightMapIntensity=a);const h=e.aoMap;Pt(h)&&(i.aoMap=h);const l=e.aoMapIntensity;Pt(l)&&(i.aoMapIntensity=l);const c=e.emissive;Pt(c)&&(i.emissive=this._setColor(c));const d=e.emissiveIntensity;Pt(d)&&(i.emissiveIntensity=d);const p=e.emissiveMap;Pt(p)&&(i.emissiveMap=p);const u=e.bumpMap;Pt(u)&&(i.bumpMap=u);const m=e.bumpScale;Pt(m)&&(i.bumpScale=m);const _=e.normalMap;Pt(_)&&(i.normalMap=_);const f=e.normalScale;Pt(f)&&(i.normalScale=this._setVector2(f));const g=e.displacementMap;Pt(g)&&(i.displacementMap=g);const v=e.displacementScale;Pt(v)&&(i.displacementScale=v);const b=e.displacementBias;Pt(b)&&(i.displacementBias=b);const w=e.specularMap;Pt(w)&&(i.specularMap=w);const y=e.alphaMap;Pt(y)&&(i.alphaMap=y);const x=e.envMap;Pt(x)&&(i.envMap=x);const E=e.combine;Pt(E)&&(i.combine=E);const M=e.reflectivity;Pt(M)&&(i.reflectivity=M);const P=e.refractionRatio;Pt(P)&&(i.refractionRatio=P);const A=e.wireframe;Pt(A)&&(i.wireframe=A);const T=e.wireframeLinewidth;Pt(T)&&(i.wireframeLinewidth=T);const S=e.wireframeLinecap;Pt(S)&&(i.wireframeLinecap=S);const O=e.wireframeLinejoin;Pt(O)&&(i.wireframeLinejoin=O);const k=e.skinning;Pt(k)&&(i.skinning=k);const C=e.morphTargets;Pt(C)&&(i.morphTargets=C);const I=e.morphNormals;Pt(I)&&(i.morphNormals=I)}break;case"MeshLambertMaterial":{i=new qe,this._fillBaseMaterialData(i,e);const t=e.color;Pt(t)&&(i.color=this._setColor(t));const s=e.map;Pt(s)&&(i.map=s);const n=e.lightMap;Pt(n)&&(i.lightMap=n);const o=e.lightMapIntensity;Pt(o)&&(i.lightMapIntensity=o);const r=e.aoMap;Pt(r)&&(i.aoMap=r);const a=e.aoMapIntensity;Pt(a)&&(i.aoMapIntensity=a);const h=e.emissive;Pt(h)&&(i.emissive=this._setColor(h));const l=e.emissiveIntensity;Pt(l)&&(i.emissiveIntensity=l);const c=e.emissiveMap;Pt(c)&&(i.emissiveMap=c);const d=e.specularMap;Pt(d)&&(i.specularMap=d);const p=e.alphaMap;Pt(p)&&(i.alphaMap=p);const u=e.envMap;Pt(u)&&(i.envMap=u);const m=e.combine;Pt(m)&&(i.combine=m);const _=e.reflectivity;Pt(_)&&(i.reflectivity=_);const f=e.refractionRatio;Pt(f)&&(i.refractionRatio=f);const g=e.wireframe;Pt(g)&&(i.wireframe=g);const v=e.wireframeLinewidth;Pt(v)&&(i.wireframeLinewidth=v);const b=e.wireframeLinecap;Pt(b)&&(i.wireframeLinecap=b);const w=e.wireframeLinejoin;Pt(w)&&(i.wireframeLinejoin=w);const y=e.skinning;Pt(y)&&(i.skinning=y);const x=e.morphTargets;Pt(x)&&(i.morphTargets=x);const E=e.morphNormals;Pt(E)&&(i.morphNormals=E)}break;case"LineBasicMaterial":{i=new H,this._fillBaseMaterialData(i,e);const t=e.color;Pt(t)&&(i.color=this._setColor(t))}break;case"PointsMaterial":{i=new m,this._fillBaseMaterialData(i,e);const t=e.color;Pt(t)&&(i.color=this._setColor(t));const s=e.map;Pt(s)&&(i.map=s);const n=e.morphTargets;Pt(n)&&(i.morphTargets=n);const o=e.size;Pt(o)&&(i.size=o);const r=e.sizeAttenuation;Pt(r)&&(i.sizeAttenuation=r)}break;default:throw new Error(`TMaterialsManager: Unmanaged material of type: ${t}`)}return i}_fillBaseMaterialData(e,t){const i=t._id;Pt(i)&&bt(i)&&(e._id=i);const s=t.uuid;Pt(s)&&bt(s)&&(e.uuid=s);const n=t.name;Pt(n)&&bt(n)&&(e.name=n);const o=t.fog;Pt(o)&&(e.fog=o);const r=t.lights;Pt(r)&&(e.lights=r);const a=t.blending;Pt(a)&&(e.blending=a);const h=t.side;Pt(h)&&(e.side=h);const l=t.flatShading;Pt(l)&&(e.flatShading=l);const c=t.vertexColors;Pt(c)&&(e.vertexColors=c);const d=t.opacity;Pt(d)&&(e.opacity=d);const p=t.transparent;Pt(p)&&(e.transparent=p);const u=t.blendSrc;Pt(u)&&(e.blendSrc=u);const m=t.blendDst;Pt(m)&&(e.blendDst=m);const _=t.blendEquation;Pt(_)&&(e.blendEquation=_);const f=t.blendSrcAlpha;Pt(f)&&(e.blendSrcAlpha=f);const g=t.blendDstAlpha;Pt(g)&&(e.blendDstAlpha=g);const v=t.blendEquationAlpha;Pt(v)&&(e.blendEquationAlpha=v);const b=t.depthFunc;Pt(b)&&(e.depthFunc=b);const w=t.depthTest;Pt(w)&&(e.depthTest=w);const y=t.depthWrite;Pt(y)&&(e.depthWrite=y);const x=t.clippingPlanes;Pt(x)&&(e.clippingPlanes=x);const E=t.clipIntersection;Pt(E)&&(e.clipIntersection=E);const M=t.clipShadows;Pt(M)&&(e.clipShadows=M);const P=t.colorWrite;Pt(P)&&(e.colorWrite=P);const A=t.precision;Pt(A)&&(e.precision=A);const T=t.polygonOffset;Pt(T)&&(e.polygonOffset=T);const S=t.polygonOffsetFactor;Pt(S)&&(e.polygonOffsetFactor=S);const D=t.polygonOffsetUnits;Pt(D)&&(e.polygonOffsetUnits=D);const O=t.dithering;Pt(O)&&(e.dithering=O);const k=t.alphaTest;Pt(k)&&(e.alphaTest=k);const C=t.premultipliedAlpha;Pt(C)&&(e.premultipliedAlpha=C);const I=t.overdraw;Pt(I)&&(e.overdraw=I);const z=t.visible;Pt(z)&&(e.visible=z);const F=t.userData;Pt(F)&&(e.userData=F);const L=t.needsUpdate;Pt(L)&&(e.needsUpdate=L)}_setVector2(e){const t=e.x,i=e.y;if(Mt(t)||Mt(i))throw new Error("MaterialsManager: Unable to convert null or undefined vector 2 !");return new F(t,i)}_setColor(e){const t=e.r,i=e.g,s=e.b;if(Mt(t)||Mt(i)||Mt(s))throw new Error("MaterialsManager: Unable to convert null or undefined color !");return new Je(t,i,s)}fillTextures(e,t){const i=this._retrieveTexturesOf(e);for(let t in e){const s=e[t],n=i[t];for(let e in n)s[e]=n[e]}t(e)}_retrieveTexturesOf(e){const t=["map","lightMap","aoMap","emissiveMap","bumpMap","normalMap","displacementMap","specularMap","alphaMap","envMap"],i={},s={};for(let n in e){const o=e[n];let r={};for(let e=0,i=t.length;e<i;e++){let i=t[e];const n=o[i];if(Pt(n)&&bt(n)&&Ot(n)){const e=`${this._texturesPath}/${n}`,t=s[e];if(Pt(t))r[i]=t;else{const t=this._texturesProvider.load(e,()=>{},()=>{},()=>{t.image||(t.image=Xi,t.needsUpdate=!0)});t.name=n,this._generateMipmap||(t.generateMipmaps=!1,t.magFilter=Ke,t.minFilter=Ke),s[e]=t,r[i]=t}}}i[n]=r}return i}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @class ClassName
 * @classdesc Todo...
 * @example Todo...
 *
 */class Zi extends r{constructor(e={}){const t={basePath:"/objects",geometriesProvider:new Hi,materialsProvider:new Yi,projectionSystem:"zBack",globalScale:1,autoFillObjects3D:!0,...e};super(t),this.geometriesProvider=t.geometriesProvider,this.materialsProvider=t.materialsProvider,this.projectionSystem=t.projectionSystem,this.globalScale=t.globalScale,this.autoFillObjects3D=t.autoFillObjects3D}get geometriesProvider(){return this._geometriesProvider}set geometriesProvider(e){if(wt(e))throw new TypeError("Geometries provider cannot be null ! Expect an instance of GeometriesManager.");if(yt(e))throw new TypeError("Geometries provider cannot be undefined ! Expect an instance of GeometriesManager.");if(!(e instanceof Hi))throw new TypeError(`Geometries provider cannot be an instance of ${e.constructor.name} ! Expect an instance of TGeometriesManager.`);this._geometriesProvider=e}get materialsProvider(){return this._materialsProvider}set materialsProvider(e){if(wt(e))throw new TypeError("Materials provider cannot be null ! Expect an instance of MaterialsManager.");if(yt(e))throw new TypeError("Materials provider cannot be undefined ! Expect an instance of MaterialsManager.");if(!(e instanceof Yi))throw new TypeError(`Materials provider cannot be an instance of ${e.constructor.name} ! Expect an instance of TMaterialsManager.`);this._materialsProvider=e}get projectionSystem(){return this._projectionSystem}set projectionSystem(e){if(wt(e))throw new TypeError("Projection system cannot be null ! Expect a positive number.");if(yt(e))throw new TypeError("Projection system cannot be undefined ! Expect a positive number.");this._projectionSystem=e}get globalScale(){return this._globalScale}set globalScale(e){if(wt(e))throw new TypeError("Global scale cannot be null ! Expect a positive number.");if(yt(e))throw new TypeError("Global scale cannot be undefined ! Expect a positive number.");this._globalScale=e}get autoFillObjects3D(){return this._autoFillObjects3D}set autoFillObjects3D(e){if(wt(e))throw new TypeError("Global scale cannot be null ! Expect a boolean.");if(yt(e))throw new TypeError("Global scale cannot be undefined ! Expect a positive number.");if(xt(e))throw new TypeError("Global scale cannot be null ! Expect a boolean.");this._autoFillObjects3D=e}setGeometriesProvider(e){return this.geometriesProvider=e,this}setMaterialsProvider(e){return this.materialsProvider=e,this}setProjectionSystem(e){return this.projectionSystem=e,this}setGlobalScale(e){return this.globalScale=e,this}setAutoFillObjects3D(e){return this.autoFillObjects3D=e,this}_onJson(e,t,i,s){const n={};for(let t=0,o=e.length,r=void 0;t<o;t++){r=e[t];try{n[r._id]=this.convert(r)}catch(e){s(e)}i(new ProgressEvent("ObjectsManager",{lengthComputable:!0,loaded:t+1,total:o}))}this._autoFillObjects3D?this.fillObjects3D(n,t,i,s):t(n)}_onArrayBuffer(e,t,i,s){}_onBlob(e,t,i,s){}_onText(e,t,i,s){}convert(e){if(!e)throw new Error("ObjectsManager: Unable to convert null or undefined data !");const t=e.type;let i=null;switch(t){case"Object3D":i=new I,this._fillBaseObjectsData(i,e);break;case"Scene":i=new ee,this._fillBaseObjectsData(i,e),Pt(e.background)&&Number.isInteger(e.background)&&(i.background=new Je(e.background)),Pt(e.fog)&&("Fog"===e.fog.type?i.fog=new dt(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(i.fog=new pt(e.fog.color,e.fog.density))),i.overrideMaterial=e.overrideMaterial,i.autoUpdate=e.autoUpdate;break;case"PerspectiveCamera":i=new ct,this._fillBaseObjectsData(i,e),i.fov=e.fov,i.aspect=e.aspect,i.near=e.near,i.far=e.far,Pt(e.focus)&&(i.focus=e.focus),Pt(e.zoom)&&(i.zoom=e.zoom),Pt(e.filmGauge)&&(i.filmGauge=e.filmGauge),Pt(e.filmOffset)&&(i.filmOffset=e.filmOffset),Pt(e.view)&&(i.view=Object.assign({},e.view));break;case"OrthographicCamera":i=new lt(e.left,e.right,e.top,e.bottom,e.near,e.far),this._fillBaseObjectsData(i,e);break;case"AmbientLight":i=new ht(e.color,e.intensity),this._fillBaseObjectsData(i,e);break;case"DirectionalLight":i=new at(e.color,e.intensity),this._fillBaseObjectsData(i,e);break;case"PointLight":i=new rt(e.color,e.intensity,e.distance,e.decay),this._fillBaseObjectsData(i,e);break;case"RectAreaLight":i=new ot(e.color,e.intensity,e.width,e.height),this._fillBaseObjectsData(i,e);break;case"SpotLight":i=new nt(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),this._fillBaseObjectsData(i,e);break;case"HemisphereLight":i=new st(e.color,e.groundColor,e.intensity),this._fillBaseObjectsData(i,e);break;case"SkinnedMesh":i=new it,this._fillBaseObjectsData(i,e),i.geometry=e.geometry,i.material=e.material,i.drawMode=e.drawMode,i.bindMode=e.bindMode,i.bindMatrix=e.bindMatrix,i.bindMatrixInverse=e.bindMatrixInverse;break;case"Mesh":i=new g,this._fillBaseObjectsData(i,e),i.geometry=e.geometry,i.material=e.material,i.drawMode=e.drawMode;break;case"LOD":i=new tt,this._fillBaseObjectsData(i,e),i.levels=e.levels;break;case"Line":i=new $,this._fillBaseObjectsData(i,e),i.geometry=e.geometry,i.material=e.material,i.drawMode=e.drawMode;break;case"LineLoop":i=new et,this._fillBaseObjectsData(i,e),i.geometry=e.geometry,i.material=e.material,i.drawMode=e.drawMode;break;case"LineSegments":i=new R,this._fillBaseObjectsData(i,e),i.geometry=e.geometry,i.material=e.material,i.drawMode=e.drawMode;break;case"Points":i=new _,this._fillBaseObjectsData(i,e),i.geometry=e.geometry,i.material=e.material,i.drawMode=e.drawMode;break;case"Sprite":i=new Qe,this._fillBaseObjectsData(i,e),i.material=e.material;break;case"Group":i=new d,this._fillBaseObjectsData(i,e);break;default:throw new Error(`TObjectsManager: Unknown object of type: ${t}`)}return i}_fillBaseObjectsData(e,t){e._id=t._id,Pt(t.uuid)&&(e.uuid=t.uuid),Pt(t.name)&&(e.name=t.name),Pt(t.parent)&&(e.parent=t.parent),kt(t.children)&&(e.children=t.children),Pt(t.up)&&(e.up.x=t.up.x,e.up.y=t.up.y,e.up.z=t.up.z),Pt(t.position)&&("zBack"===this._projectionSystem?(e.position.x=t.position.x/this._globalScale,e.position.y=t.position.z/this._globalScale,e.position.z=-t.position.y/this._globalScale):(e.position.x=t.position.x/this._globalScale,e.position.y=t.position.y/this._globalScale,e.position.z=t.position.z/this._globalScale)),Pt(t.rotation)&&("zBack"===this._projectionSystem?(e.rotation.x=t.rotation.x,e.rotation.y=t.rotation.z,e.rotation.z=-t.rotation.y,e.rotation.order=t.rotation.order):(e.rotation.x=t.rotation.x,e.rotation.y=t.rotation.y,e.rotation.z=t.rotation.z,e.rotation.order=t.rotation.order)),Pt(t.quaternion)&&("zBack"===this._projectionSystem?(e.quaternion.x=t.quaternion.x,e.quaternion.y=t.quaternion.z,e.quaternion.z=-t.quaternion.y,e.quaternion.w=t.quaternion.w):(e.quaternion.x=t.quaternion.x,e.quaternion.y=t.quaternion.y,e.quaternion.z=t.quaternion.z,e.quaternion.w=t.quaternion.w)),Pt(t.scale)&&(0!==t.scale.x&&0!==t.scale.y&&0!==t.scale.z?(e.scale.x=t.scale.x,e.scale.y=t.scale.y,e.scale.z=t.scale.z):console.warn("Try to assign null scale !")),Pt(t.modelViewMatrix)&&kt(t.modelViewMatrix)&&e.modelViewMatrix.fromArray(t.modelViewMatrix),Pt(t.normalMatrix)&&kt(t.normalMatrix)&&e.normalMatrix.fromArray(t.normalMatrix),Pt(t.matrix)&&kt(t.matrix)&&e.matrix.fromArray(t.matrix),Pt(t.matrixWorld)&&kt(t.matrixWorld)&&e.matrixWorld.fromArray(t.matrixWorld),Pt(t.matrixAutoUpdate)&&(e.matrixAutoUpdate=t.matrixAutoUpdate),Pt(t.matrixWorldNeedsUpdate)&&(e.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate),Pt(t.layers)&&(e.layers.mask=t.layers),Pt(t.visible)&&(e.visible=t.visible),Pt(t.castShadow)&&(e.castShadow=t.castShadow),Pt(t.receiveShadow)&&(e.receiveShadow=t.receiveShadow),Pt(t.frustumCulled)&&(e.frustumCulled=t.frustumCulled),Pt(t.renderOrder)&&(e.renderOrder=t.renderOrder),Pt(t.userData)&&(e.userData=t.userData)}fillObjects3D(e,t,i,s){const n=this,o=[];for(let t in e){const i=e[t];(i.geometry||i.material)&&o.push(e[t])}if(0===o.length)return void t(e);let r=void 0;this._retrieveGeometriesOf(o,e=>{r=e,h()},i,s);let a=void 0;function h(){if(r&&a){for(let t in e){const i=e[t];n.applyGeometry(i,r),n.applyMaterials(i,a)}t(e)}}this._retrieveMaterialsOf(o,e=>{a=e,h()},i,s)}_retrieveGeometriesOf(e,t,i,s){const n=e.map(e=>e.geometry).filter((e,t,i)=>e&&i.indexOf(e)===t);0!==n.length?this._geometriesProvider.read(n,null,t,i,s):t({})}_retrieveMaterialsOf(e,t,i,s){const n=e.map(e=>e.material),o=[].concat.apply([],n).filter((e,t,i)=>e&&i.indexOf(e)===t);0!==o.length?this._materialsProvider.read(o,null,t,i,s):t({})}applyGeometry(e,t){const i=e.geometry;if(!i)return;const s=t[i];s?e.geometry=s:console.error("Unable to retrieve geometry !!!")}applyMaterials(e,t){const i=e.material;if(i)if(Array.isArray(i))if(1===i.length){const s=t[i[0]];if(!s)return console.error("Unable to retrieve material !!!"),null;e.material=s.clone()}else{e.material=[];for(let s=0,n=i.length;s<n;s++){const n=t[i[s]];if(!n)return console.error("Unable to retrieve material !!!"),null;e.material.push(n.clone())}}else if("string"==typeof i){const s=t[i];if(!s)return void console.error("Unable to retrieve material !!!");e.material=s.clone()}else console.error("Invalid material ids, expected string or array of string")}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @class OrbitControlsHelper
 * @classdesc Todo...
 * @example Todo...
 *
 */class Vi extends R{constructor(e={}){const t={radius:2,radials:16,circles:2,divisions:64,innerColor:new Je(4473924),outerColor:new Je(8947848),...e};super(Vi._createInternalGeometry(t.radius,t.radials,t.circles,t.divisions,t.innerColor,t.outerColor),Vi._createInternalMaterial()),this.matrixAutoUpdate=!1,this._intervalId=void 0}static _createInternalGeometry(e,t,i,s,n,o){const r=[],a=[];let h,l,c,d,u,m,_;for(d=0;d<=t;d++)c=d/t*(2*Math.PI),h=Math.sin(c)*e,l=Math.cos(c)*e,r.push(0,0,0),r.push(h,0,l),_=1&d?n:o,a.push(_.r,_.g,_.b),a.push(_.r,_.g,_.b);for(d=0;d<=i;d++){for(_=1&d?n:o,m=e-e/i*d,u=0;u<s;u++)c=u/s*(2*Math.PI),h=Math.sin(c)*m,l=Math.cos(c)*m,r.push(h,0,l),a.push(_.r,_.g,_.b),c=(u+1)/s*(2*Math.PI),h=Math.sin(c)*m,l=Math.cos(c)*m,r.push(h,0,l),a.push(_.r,_.g,_.b);r.push(-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1),a.push(0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1)}const f=new Y(r,3);f.name="TOrbitControlsHelperPositionBufferAttribute";const g=new Y(a,3);g.name="TOrbitControlsHelperColorBufferAttribute";const v=new p;return v.setAttribute("position",f),v.setAttribute("color",g),v.name="TOrbitControlsHelperGeometry",v}static _createInternalMaterial(){const e=new H({vertexColors:ut});return e.transparent=!0,e.opacity=0,e.name="TOrbitControlsHelperMaterial",e}startOpacityAnimation(){void 0!==this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this.material.opacity=1}endOpacityAnimation(){this._intervalId=setInterval(function(){this.material.opacity<=0?(this.material.opacity=0,clearInterval(this._intervalId),this._intervalId=void 0):this.material.opacity-=.1}.bind(this),100)}}export{Ct as ASCLoader,Mi as AbstractGizmo,gi as AbstractHandle,ci as AbstractHitbox,Oi as BufferGeometriesManager,Kt as CameraControlMode,Qt as CameraControls,oi as CameraPathController,ai as ClippingBox,Di as ClippingControls,Si as ClippingModes,ki as CurvesManager,di as CylindricaHitbox,Ft as DBFLoader,Ci as FilairesManager,Hi as GeometriesManager,li as HighlightableLineMaterial,hi as HighlightableMaterial,xi as LozengeHandle,ui as LozengeHitbox,Yi as MaterialsManager,Zi as ObjectsManager,Ei as OctahedricalHandle,mi as OctahedricalHitbox,Vi as OrbitControlsHelper,pi as PlanarHitbox,yi as PlaneHandle,Lt as RZMLLoader,Ai as RotateGizmo,wi as RotateHandle,Gt as SHPLoader,Ti as ScaleGizmo,bi as ScaleHandle,Bt as ShapeType,_i as SphericalHitbox,Ni as TexturesManager,fi as TorusHitbox,Pi as TranslateGizmo,vi as TranslateHandle,Xt as UniversalLoader};
