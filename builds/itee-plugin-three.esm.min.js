import{DefaultLogger as e,TBinaryReader as t,Endianness as i,Byte as s,Keys as r,Mouse as n,TDataBaseManager as a}from"itee-client";import{DefaultLoadingManager as o,Box3 as h,FileLoader as l,Group as c,BufferGeometry as d,BufferAttribute as p,PointsMaterial as u,Points as _,Vector3 as m,Shape as g,EventDispatcher as f,Object3D as b,Vector2 as w,Spherical as y,PlaneBufferGeometry as v,MeshBasicMaterial as x,DoubleSide as E,Mesh as P,Quaternion as M,CylinderBufferGeometry as F,LineBasicMaterial as A,Float32BufferAttribute as S,Line as D,ConeBufferGeometry as T,OctahedronBufferGeometry as O,EdgesGeometry as U,LineSegments as I,ArrowHelper as C,BoxBufferGeometry as k,Plane as B,Raycaster as z,Euler as R,SplineCurve as L,QuadraticBezierCurve3 as G,QuadraticBezierCurve as H,Path as N,LineCurve3 as j,LineCurve as Y,EllipseCurve as X,CurvePath as Z,Curve as V,CubicBezierCurve3 as W,CubicBezierCurve as $,CatmullRomCurve3 as q,ArcCurve as K,WireframeGeometry as Q,SphereGeometry as J,TubeGeometry as ee,TorusKnotGeometry as te,TorusGeometry as ie,TextGeometry as se,TetrahedronGeometry as re,ShapeGeometry as ne,RingGeometry as ae,PolyhedronGeometry as oe,PlaneGeometry as he,ParametricGeometry as le,OctahedronGeometry as ce,LatheGeometry as de,IcosahedronGeometry as pe,Geometry as ue,ExtrudeGeometry as _e,DodecahedronGeometry as me,ConeGeometry as ge,CylinderGeometry as fe,CircleGeometry as be,BoxGeometry as we,Face3 as ye,InstancedBufferGeometry as ve,SphereBufferGeometry as xe,TubeBufferGeometry as Ee,TorusKnotBufferGeometry as Pe,TorusBufferGeometry as Me,TextBufferGeometry as Fe,TetrahedronBufferGeometry as Ae,RingBufferGeometry as Se,PolyhedronBufferGeometry as De,ParametricBufferGeometry as Te,LatheBufferGeometry as Oe,IcosahedronBufferGeometry as Ue,ExtrudeBufferGeometry as Ie,DodecahedronBufferGeometry as Ce,CircleBufferGeometry as ke,ImageLoader as Be,TextureLoader as ze,MeshLambertMaterial as Re,MeshPhongMaterial as Le,Color as Ge,LinearFilter as He,Sprite as Ne,LineLoop as je,LOD as Ye,SkinnedMesh as Xe,HemisphereLight as Ze,SpotLight as Ve,RectAreaLight as We,PointLight as $e,DirectionalLight as qe,AmbientLight as Ke,OrthographicCamera as Qe,PerspectiveCamera as Je,Scene as et,Fog as tt,FogExp2 as it,VertexColors as st}from"three-full";import{toEnum as rt,ringClockwise as nt,ringContainsSome as at,degreesToRadians as ot}from"itee-utils";import{isNull as ht,isUndefined as lt,isNotBoolean as ct,isEmptyArray as dt,isNotDefined as pt,isNotArray as ut,isArray as _t,isDefined as mt,isObject as gt,isNotString as ft,isEmptyString as bt,isBlankString as wt,isString as yt,isNotEmptyString as vt,isNotEmptyArray as xt}from"itee-validators";
/**
 * @module Loader/ASCLoader
 * @desc A loader for ASC cloud point files.
 *
 * @requires {@link https://github.com/Itee/itee-client itee-client}
 * @requires {@link https://github.com/Itee/three-full three-full}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 * @example
 *
 * import { ASCLoader } from 'itee-plugin-three'
 *
 * const loader = new ASCLoader();
 *
 * // If the ASC file need to be offseted, it can be set before loading file.
 * loader.setOffset( {
 *      x: 1.0,
 *      y: 52.0,
 *      z: -5.0
 * } );
 *
 * // Then load the file and get the threejs Point Geometry
 * loader.load('/path/to/file.asc', function (geometry) {
 *
 *      scene.add( new Mesh( geometry ) );
 *
 * } );
 *
 */class Et{constructor(t=o,i=e){this.manager=t,this.logger=i,this._boundingBox=new h,this._points=[],this._numberOfPoints=0,this._coloredPoints=!1,this._autoOffset=!1,this._offset={x:0,y:0,z:0},this._positions=null,this._bufferIndex=0,this._positionsC=null,this._bufferIndexC=0,this.wrongPoints=0}load(e,t,i,s,r){const n=new l(this.manager);n.setResponseType("blob"),n.load(e,function(e){const n=new c;this._parse(e,n,t,i,s,r),t(n)}.bind(this),i,s)}setOffset(e){this._offset=e,this._autoOffset=!1}_parse(e,t,i,s,r,n){const a=this,o=n||100,h=new FileReader,l=134217728;let c=0;function d(){if(c>=e.size)return;const t=e.slice(c,c+l,"text/plain");h.readAsText(t)}h.onabort=e=>{this.logger.log("abortEvent:"),this.logger.log(e)},h.onerror=e=>{this.logger.log("errorEvent:"),this.logger.log(e),r&&r(e)},h.onloadstart=e=>{this.logger.log("loadStartEvent:"),this.logger.log(e)},h.onprogress=e=>{this.logger.log("progressEvent:"),this.logger.log(e),s&&s(e)},h.onload=e=>{this.logger.log("loadEvent:"),this.logger.log(e);const t=e.target.result.split("\n"),i=t.length;c-=t[i-1].length;const s=Math.round(100/o);for(let e=0;e<i-1;e++)e%s==0&&a._parseLine(t[e])},h.onloadend=i=>{this.logger.log("loadEndEvent"),this.logger.log(i),(this._points.length>1e6||c+l>=e.size)&&(this._offsetPoints(),this._createSubCloudPoint(t)),c+=l,d()},d()}_parseLine(e){const t=e.split(/\s/g).filter(Boolean),i=t.length;3===i?this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2])}):4===i?(this._pointsHaveIntensity=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3])})):6===i?(this._pointsHaveColor=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),r:parseFloat(t[3]),g:parseFloat(t[4]),b:parseFloat(t[5])})):7===i?(this._pointsHaveIntensity=!0,this._pointsHaveColor=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),r:parseFloat(t[4]),g:parseFloat(t[5]),b:parseFloat(t[6])})):9===i?(this._pointsHaveColor=!0,this._pointsHaveNormals=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),r:parseFloat(t[3]),g:parseFloat(t[4]),b:parseFloat(t[5]),nx:parseFloat(t[6]),ny:parseFloat(t[7]),nz:parseFloat(t[8])})):10===i?(this._pointsHaveIntensity=!0,this._pointsHaveColor=!0,this._pointsHaveNormals=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),r:parseFloat(t[4]),g:parseFloat(t[5]),b:parseFloat(t[6]),nx:parseFloat(t[7]),ny:parseFloat(t[8]),nz:parseFloat(t[9])})):this.logger.error(`Invalid data line: ${e}`)}_parseLines(e){const t=e[0].split(/\s/g).filter(Boolean).length;3===t?this._parseLinesAsXYZ(e):4===t?this._parseLinesAsXYZI(e):6===t?this._parseLinesAsXYZRGB(e):7===t?this._parseLinesAsXYZIRGB(e):9===t?this._parseLinesAsXYZRGBnXnYnZ(e):10===t?this._parseLinesAsXYZIRGBnXnYnZ(e):this.logger.error(`Invalid data line: ${e}`)}_parseLinesAsXYZ(e){let t=[];for(let i=0,s=e.length;i<s;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2])})}_parseLinesAsXYZI(e){this._pointsHaveIntensity=!0;let t=[];for(let i=0,s=e.length;i<s;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3])})}_parseLinesAsXYZRGB(e){this._pointsHaveColor=!0;let t=[];for(let i=0,s=e.length;i<s;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),r:parseFloat(t[3]),g:parseFloat(t[4]),b:parseFloat(t[5])})}_parseLinesAsXYZnXnYnZ(e){let t=[];for(let i=0,s=e.length;i<s;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),nx:parseFloat(t[7]),ny:parseFloat(t[8]),nz:parseFloat(t[9])})}_parseLinesAsXYZIRGB(e){this._pointsHaveIntensity=!0,this._pointsHaveColor=!0;let t=[];for(let i=0,s=e.length;i<s;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),r:parseFloat(t[4]),g:parseFloat(t[5]),b:parseFloat(t[6])})}_parseLinesAsXYZInXnYnZ(e){let t=[];for(let i=0,s=e.length;i<s;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),nx:parseFloat(t[7]),ny:parseFloat(t[8]),nz:parseFloat(t[9])})}_parseLinesAsXYZRGBnXnYnZ(e){this._pointsHaveColor=!0,this._pointsHaveNormals=!0;let t=[];for(let i=0,s=e.length;i<s;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),r:parseFloat(t[3]),g:parseFloat(t[4]),b:parseFloat(t[5]),nx:parseFloat(t[6]),ny:parseFloat(t[7]),nz:parseFloat(t[8])})}_parseLinesAsXYZIRGBnXnYnZ(e){this._pointsHaveIntensity=!0,this._pointsHaveColor=!0,this._pointsHaveNormals=!0;let t=[];for(let i=0,s=e.length;i<s;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),r:parseFloat(t[4]),g:parseFloat(t[5]),b:parseFloat(t[6]),nx:parseFloat(t[7]),ny:parseFloat(t[8]),nz:parseFloat(t[9])})}_parseLineB(e){const t=e.split(/\s/g).filter(Boolean),i=t.length,s=this._bufferIndex;3===i&&(this._positions[s]=parseFloat(t[0]),this._positions[s+1]=parseFloat(t[1]),this._positions[s+2]=parseFloat(t[2]),this._bufferIndex+=3)}_parseLineC(e){const t=e.split(/\s/g).filter(Boolean),i=t.length,s=this._bufferIndexC;3===i&&(this._positionsC[s]=Number.parseFloat(t[0]),this._positionsC[s+1]=Number.parseFloat(t[1]),this._positionsC[s+2]=Number.parseFloat(t[2]),this._bufferIndexC+=3)}_offsetPoints(){this._autoOffset&&(this._boundingBox.setFromPoints(this._points),this.setOffset(this._boundingBox.getCenter()));const e=this._offset.x,t=this._offset.y,i=this._offset.z;let s=null;for(let r=0,n=this._points.length;r<n;++r)s=this._points[r],s.x-=e,s.y-=t,s.z-=i}_createCloudPoint(e){const t=1e6,i=this._points.length,s=Math.ceil(i/t);let r=null,n=0,a=null;for(let i=0;i<s;++i){r=this._points.splice(0,t),n=r.length;const i=new d,s=new Float32Array(3*n),o=new Float32Array(3*n);let h=0,l=null;for(let e=0;e<n;++e)l=r[e],s[h]=l.x,s[h+1]=l.y,s[h+2]=l.z,this._pointsHaveColor?(o[h]=l.r/255,o[h+1]=l.g/255,o[h+2]=l.b/255):(o[h]=.1,o[h+1]=.2,o[h+2]=.5),h+=3;i.setAttribute("position",new p(s,3)),i.setAttribute("color",new p(o,3));const c=new u({size:.01,vertexColors:!0});a=new _(i,c),e.children.push(a)}}_createSubCloudPoint(e){const t=this._points.length,i=new d,s=new Float32Array(3*t),r=new Float32Array(3*t);let n=0,a=null;for(let e=0;e<t;++e)a=this._points[e],s[n]=a.x,s[n+1]=a.y,s[n+2]=a.z,this._pointsHaveColor?(r[n]=a.r/255,r[n+1]=a.g/255,r[n+2]=a.b/255):(r[n]=.1,r[n+1]=.2,r[n+2]=.5),n+=3;i.setAttribute("position",new p(s,3)),i.setAttribute("color",new p(r,3));const o=new u({size:.005,vertexColors:!0}),h=new _(i,o);h.rotation.x-=Math.PI/2,e.children.push(h),this._points=[]}}
/**
 * @module Loader/DBFLoader
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * From:
 * https://www.clicketyclick.dk/databases/xbase/format/db2_dbf.html#DBII_DBF_STRUCT
 * http://web.archive.org/web/20150323061445/http://ulisse.elettra.trieste.it/services/doc/dbase/DBFstruct.htm
 * http://www.dbase.com/Knowledgebase/INT/db7_file_fmt.htm
 *
 *
 */const Pt=rt({FoxPro:48,FoxPro_Autoincrement:49,dBASE_II:2,FoxPro_Var:50,dBASE_III_plus:3,dBASE_III_plus_memo:131,dBASE_IV_SQL_table:67,dBASE_IV_SQL_system:99,dBASE_IV_memo:139,dBASE_IV_memo_SQL_table:203,FoxBase:251,dBase_v_7:4,FoxPro_2_x:245,HiPerSix_memo:229}),Mt=rt({Binary:"B",Character:"C",Date:"D",Numeric:"N",Logical:"L",Memo:"M",Timestamp:"@",Long:"I",Autoincrement:"+",Float:"F",Double:"O",OLE:"G"});class Ft{constructor(i={}){const s={manager:o,logger:e,reader:new t,...i};this.manager=s.manager,this.logger=s.logger,this.reader=s.reader}get manager(){return this._manager}set manager(e){this._manager=e}get logger(){return this._logger}set logger(e){this._logger=e}get reader(){return this._reader}set reader(e){this._reader=e}setManager(e){return this.manager=e,this}setLogger(e){return this.logger=e,this}setReader(e){return this.reader=e,this}load(e,t,i,s){const r=this,n=new l(r.manager);n.setResponseType("arraybuffer"),n.load(e,(e=>{t(r.parse(e))}),i,s)}parse(e){this.reader.setEndianess(i.Big).setBuffer(e);const t=this.reader.getInt8();if(!this._isValidVersion(t))return this.logger.error(`DBFLoader: Invalid version number: ${t}`),null;const s=this._parseHeader(t);return{header:s,datas:this._parseDatas(t,s)}}_isValidVersion(e){return Pt.includes(e)}_parseHeader(e){let t={};switch(e){case Pt.FoxPro:case Pt.FoxPro_Autoincrement:case Pt.FoxPro_Var:case Pt.dBASE_II:t=this._parseHeaderV2();break;case Pt.dBASE_III_plus:case Pt.dBASE_III_plus_memo:t=this._parseHeaderV2_5();break;case Pt.dBASE_IV_memo:case Pt.dBASE_IV_memo_SQL_table:case Pt.dBASE_IV_SQL_system:case Pt.dBASE_IV_SQL_table:t=this._parseHeaderV3();break;case Pt.dBase_v_7:case Pt.FoxPro_2_x:case Pt.HiPerSix_memo:t=this._parseHeaderV4();break;default:throw new RangeError(`Invalid version parameter: ${e}`)}return this.reader.getUint8()!==Ft.Terminator&&this.logger.error("DBFLoader: Invalid terminator after field descriptors !!!"),t}_parseHeaderV2(){const e=this.reader.getInt16(),t=this.reader.getInt8()+Ft.YearOffset,i=this.reader.getInt8(),s=this.reader.getInt8(),r=this.reader.getInt16();let n,a,o,h,l,c=[];for(let t=0;t<e;t++)n=this.reader.getString(11),a=this.reader.getChar(),o=this.reader.getUint8(),h=this.reader.getInt16(),l=this.reader.getInt8(),c.push({name:n,type:a,length:o,memoryAddress:h,decimalCount:l});return{numberOfRecords:e,year:t,month:i,day:s,lengthOfEachRecords:r,fields:c}}_parseHeaderV2_5(){const e=this.reader.getInt8()+Ft.YearOffset,t=this.reader.getInt8(),s=this.reader.getInt8();this.reader.setEndianess(i.Little);const r=this.reader.getInt32(),n=this.reader.getInt16(),a=this.reader.getInt16();this.reader.setEndianess(i.Big),this.reader.skipOffsetOf(20);let o,h,l,c,d,p,u,_=[];for(let e=0;e<r;e++)o=this.reader.getString(11),h=this.reader.getChar(),c=this.reader.getInt32(),l=this.reader.getUint8(),d=this.reader.getUint8(),this.reader.skipOffsetOf(2),p=this.reader.getInt8(),this.reader.skipOffsetOf(2),u=this.reader.getInt8(),this.reader.skipOffsetOf(1),_.push({name:o,type:h,length:l,memoryAddress:c,decimalCount:d,workAreaId:p,MDXFlag:u});return{year:e,month:t,day:s,numberOfRecords:r,numberOfByteInHeader:n,numberOfByteInRecord:a,fields:_}}_parseHeaderV3(){const e=this.reader.getInt8()+Ft.YearOffset,t=this.reader.getInt8(),s=this.reader.getInt8();this.reader.setEndianess(i.Little);const r=this.reader.getInt32(),n=this.reader.getInt16(),a=this.reader.getInt16();this.reader.setEndianess(i.Big),this.reader.skipOffsetOf(2);const o=this.reader.getInt8(),h=this.reader.getInt8();this.reader.skipOffsetOf(12);const l=this.reader.getInt8(),c=this.reader.getInt8();this.reader.skipOffsetOf(2);let d,p,u,_,m,g,f=[];for(;this.reader.getOffset()<n-1;)d=this.reader.getString(11),p=this.reader.getChar(),this.reader.skipOffsetOf(4),u=this.reader.getUint8(),_=this.reader.getUint8(),this.reader.skipOffsetOf(2),m=this.reader.getInt8(),this.reader.skipOffsetOf(10),g=this.reader.getInt8(),f.push({name:d,type:p,length:u,decimalCount:_,workAreaId:m,MDXFieldFlag:g});return{year:e,month:t,day:s,numberOfRecords:r,numberOfByteInHeader:n,numberOfByteInRecord:a,incompleteTransactionFlag:o,encryptionFlag:h,MDXFlag:l,languageDriverId:c,fields:f}}_parseHeaderV4(){const e=this.reader.getInt8()+Ft.YearOffset,t=this.reader.getInt8(),s=this.reader.getInt8();this.reader.setEndianess(i.Little);const r=this.reader.getInt32(),n=this.reader.getInt16(),a=this.reader.getInt16();this.reader.setEndianess(i.Big),this.reader.skipOffsetOf(2);const o=this.reader.getInt8(),h=this.reader.getInt8();this.reader.skipOffsetOf(12);const l=this.reader.getInt8(),c=this.reader.getInt8();this.reader.skipOffsetOf(2);const d=this.reader.getString(32);this.reader.skipOffsetOf(4);let p,u,_,m,g,f,b=[];for(let e=0;e<r;e++)p=this.reader.getString(32),u=this.reader.getChar(),_=this.reader.getUint8(),m=this.reader.getUint8(),this.reader.skipOffsetOf(2),g=this.reader.getInt8(),this.reader.skipOffsetOf(2),f=this.reader.getInt32(),this.reader.skipOffsetOf(4),b.push({name:p,type:u,length:_,decimalCount:m,MDXFieldFlag:g,nextAutoincrementValue:f});return{year:e,month:t,day:s,numberOfRecords:r,numberOfByteInHeader:n,numberOfByteInRecord:a,incompleteTransactionFlag:o,encryptionFlag:h,MDXFlag:l,languageDriverId:c,languageDriverName:d,fields:b}}_parseDatas(e,t){const i=t.numberOfRecords,s=t.fields;let r=[],n=null,a=null;for(let e=0;e<i;e++){n={},n.deleted=this.reader.getUint8()===Ft.DeletedRecord;for(let e=0,t=s.length;e<t;e++)switch(a=s[e],a.type){case Mt.Binary:{const e=this.reader.getString(a.length);n[a.name]=parseInt(e)}break;case Mt.Numeric:{const e=this.reader.getString(a.length);n[a.name]=parseInt(e)}break;case Mt.Character:case Mt.Date:n[a.name]=this.reader.getString(a.length);break;case Mt.Logical:{const e=this.reader.getChar().toLowerCase();n[a.name]="t"===e||"y"===e||"f"!==e&&"n"!==e&&null}break;case Mt.Memo:n[a.name]=this.reader.getString(a.length);break;case Mt.Timestamp:break;case Mt.Long:case Mt.Autoincrement:n[a.name]=this.reader.getInt32();break;case Mt.Float:{const e=this.reader.getString(a.length);n[a.name]=parseInt(e)}break;case Mt.Double:n[a.name]=this.reader.getFloat64();break;case Mt.OLE:n[a.name]=this.reader.getString(a.length);break;default:throw new RangeError(`Invalid data type parameter: ${a.type}`)}r.push(n)}return r}_parseFieldProperties(){const e=this.reader.getInt16(),t=this.reader.getInt16(),i=this.reader.getInt16(),s=this.reader.getInt16(),r=this.reader.getInt16(),n=this.reader.getInt16(),a=this.reader.getInt16(),o=this.reader.getInt16();let h=[];for(let t=0;t<e;t++)h.push(this._getStandardProperties());let l=[];for(let e=0;e<i;e++)l.push(this._getCustomProperties());let c=[];for(let e=0;e<r;e++)c.push(this._getReferentialIntegrityProperties());return{numberOfStandardProperties:e,startOfStandardPropertiesDescriptor:t,numberOfCustomProperties:i,startOfCustomPropertiesDescriptor:s,numberOfReferentialIntegrityProperties:r,startOfReferentialIntegrityDescriptor:n,startOfData:a,sizeOfPropertiesStructure:o,standardProperties:h,customProperties:l,referentialIntegrityProperties:c}}_getStandardProperties(){const e=this.reader.getInt16(),t=this.reader.getInt16(),i=this.reader.getInt8(),s=this.reader.getInt8(),r=this.reader.getInt8();this.reader.skipOffsetOf(4);return{generationalNumber:e,tableFieldOffset:t,propertyDescribed:i,type:s,isConstraint:r,offsetFromStart:this.reader.getInt16(),widthOfDatabaseField:this.reader.getInt16()}}_getCustomProperties(){const e=this.reader.getInt16(),t=this.reader.getInt16(),i=this.reader.getInt8();this.reader.skipOffsetOf(1);return{generationalNumber:e,tableFieldOffset:t,type:i,offsetFromStartOfName:this.reader.getInt16(),lengthOfName:this.reader.getInt16(),offsetFromStartOfData:this.reader.getInt16(),lengthOfData:this.reader.getInt16()}}_getReferentialIntegrityProperties(){return{databaseState:this.reader.getInt8(),sequentialNumberRule:this.reader.getInt16(),offsetOfTheRIRuleName:this.reader.getInt16(),sizeOfTheRIRuleName:this.reader.getInt16(),offsetOfNameOfForeignTable:this.reader.getInt16(),sizeOfNameOfForeignTable:this.reader.getInt16(),stateBehaviour:this.reader.getInt8(),numberOfFieldsInLinkingKey:this.reader.getInt16(),offsetOfLocalTableTagName:this.reader.getInt16(),sizeOfTheLocalTableTagName:this.reader.getInt16(),offsetOfForeignTableTagName:this.reader.getInt16(),sizeOfTheForeignTableTagName:this.reader.getInt16()}}}Ft.Terminator=13,Ft.DeletedRecord=26,Ft.YearOffset=1900;
/**
 * @module Loader/LASLoader
 * @desc A loader for ASC cloud point files.
 *
 * @requires {@link https://github.com/Itee/itee-client itee-client}
 * @requires {@link https://github.com/Itee/three-full three-full}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 * @example
 *
 * import { LASLoader } from 'itee-plugin-three'
 *
 * const loader = new LASLoader();
 *
 * // If the ASC file need to be offseted, it can be set before loading file.
 * loader.setOffset( {
 *      x: 1.0,
 *      y: 52.0,
 *      z: -5.0
 * } );
 *
 * // Then load the file and get the threejs Point Geometry
 * loader.load('/path/to/file.asc', function (geometry) {
 *
 *      scene.add( new Mesh( geometry ) );
 *
 * } );
 *
 */
class At{static getBit(e,t){return 0==(e&1<<t)?0:1}static setBit(e,t){return e|1<<t}static clearBit(e,t){return e&~(1<<t)}static updateBit(e,t,i){return e&~(1<<t)|(i?1:0)<<t}}class St extends class{constructor(e){this._bytes=e}}{get GPSTimeType(){return At.getBit(this._bytes,0)?"AdjustedStandardGPSTime":"GPSWeekTime"}}class Dt extends St{get WaveformDataPacketsInternal(){return!!At.getBit(this._bytes,1)}get WaveformDataPacketsExternal(){return!!At.getBit(this._bytes,2)}get ReturnNumbersHaveBeenSyntheticallyGenerated(){return At.getBit(this._bytes,3)?"AdjustedStandardGPSTime":"GPSWeekTime"}}class Tt extends Dt{get SyntheticReturnNumber(){return this.ReturnNumbersHaveBeenSyntheticallyGenerated}get WKT(){return At.getBit(this._bytes,4)?"WKT":"GeoTIFF"}}class Ot{constructor(i=o,s=e){this.manager=i,this.logger=s,this._reader=new t,this._boundingBox=new h,this._points=[],this._numberOfPoints=0,this._coloredPoints=!1,this._autoOffset=!1,this._offset={x:0,y:0,z:0},this._positions=null,this._bufferIndex=0,this._positionsC=null,this._bufferIndexC=0,this.wrongPoints=0}load(e,t,i,s,r){const n=new l(this.manager);n.setResponseType("arraybuffer"),n.load(e,function(e){const n=new c;this._parse(e,n,(e=>{t(e)}),i,s,r)}.bind(this),i,s)}setOffset(e){this._offset=e,this._autoOffset=!1}_parse(e,t,i,s,r){try{this._reader.buffer=e;const t=this._parseHeader(),r=this._parseVariableLengthRecords(t);i({Header:t,VariableLengthRecords:r,PointDataRecords:this._parsePointDataRecords(t,s)})}catch(e){r(e)}}_parseHeader(){if("LASF"!==this._reader.getString(4,!1))throw new Error("Invalid las file signature. Abort parsing !");this._reader.skipOffsetOf(20);const e=this._reader.getUint8();if(1!==e)throw new Error(`Insupported major LAS file version: ${e}. Abort parsing !`);const t=this._reader.getUint8();switch(t){case 0:return this._reader.skipOffsetTo(0),this._parseHeader_1_0();case 1:return this._reader.skipOffsetTo(0),this._parseHeader_1_1();case 2:return this._reader.skipOffsetTo(0),this._parseHeader_1_2();case 3:return this._reader.skipOffsetTo(0),this._parseHeader_1_3();case 4:return this._reader.skipOffsetTo(0),this._parseHeader_1_4();default:throw new Error(`Insupported minor LAS file version: ${t}. Abort parsing !`)}}_parseHeader_1_0(){return{FileSignature:this._reader.getString(4,!1),Reserved:this._reader.skipOffsetOf(s.Four),GUID_1:this._reader.getUint32(),GUID_2:this._reader.getUint16(),GUID_3:this._reader.getUint16(),GUID_4:this._reader.getUint8Array(8),VersionMajor:this._reader.getUint8(),VersionMinor:this._reader.getUint8(),SystemIdentifier:this._reader.getString(32,!1),GeneratingSoftware:this._reader.getString(32,!1),FlightDateJulian:this._reader.getUint16(),Year:this._reader.getUint16(),HeaderSize:this._reader.getUint16(),OffsetToData:this._reader.getUint32(),NumberOfVariableLengthRecords:this._reader.getUint32(),PointDataFormatID:this._reader.getUint8(),PointDataRecordLength:this._reader.getUint16(),NumberOfPointRecords:this._reader.getUint32(),NumberOfPointsByReturn:this._reader.getUint32Array(5),XScaleFactor:this._reader.getFloat64(),YScaleFactor:this._reader.getFloat64(),ZScaleFactor:this._reader.getFloat64(),XOffset:this._reader.getFloat64(),YOffset:this._reader.getFloat64(),ZOffset:this._reader.getFloat64(),MaxX:this._reader.getFloat64(),MinX:this._reader.getFloat64(),MaxY:this._reader.getFloat64(),MinY:this._reader.getFloat64(),MaxZ:this._reader.getFloat64(),MinZ:this._reader.getFloat64()}}_parseHeader_1_1(){return{FileSignature:this._reader.getString(4,!1),FileSourceId:this._reader.getUint16(),Reserved:this._reader.skipOffsetOf(s.Two),GUID_1:this._reader.getUint32(),GUID_2:this._reader.getUint16(),GUID_3:this._reader.getUint16(),GUID_4:this._reader.getUint8Array(8),VersionMajor:this._reader.getUint8(),VersionMinor:this._reader.getUint8(),SystemIdentifier:this._reader.getString(32,!1),GeneratingSoftware:this._reader.getString(32,!1),FileCreationDayOfYear:this._reader.getUint16(),FileCreationYear:this._reader.getUint16(),HeaderSize:this._reader.getUint16(),OffsetToPointData:this._reader.getUint32(),NumberOfVariableLengthRecords:this._reader.getUint32(),PointDataFormatID:this._reader.getUint8(),PointDataRecordLength:this._reader.getUint16(),NumberOfPointRecords:this._reader.getUint32(),NumberOfPointsByReturn:this._reader.getUint32Array(5),XScaleFactor:this._reader.getFloat64(),YScaleFactor:this._reader.getFloat64(),ZScaleFactor:this._reader.getFloat64(),XOffset:this._reader.getFloat64(),YOffset:this._reader.getFloat64(),ZOffset:this._reader.getFloat64(),MaxX:this._reader.getFloat64(),MinX:this._reader.getFloat64(),MaxY:this._reader.getFloat64(),MinY:this._reader.getFloat64(),MaxZ:this._reader.getFloat64(),MinZ:this._reader.getFloat64()}}_parseHeader_1_2(){return{FileSignature:this._reader.getString(4,!1),FileSourceId:this._reader.getUint16(),GlobalEncoding:new St(this._reader.getUint16()),GUID_1:this._reader.getUint32(),GUID_2:this._reader.getUint16(),GUID_3:this._reader.getUint16(),GUID_4:this._reader.getUint8Array(8),VersionMajor:this._reader.getUint8(),VersionMinor:this._reader.getUint8(),SystemIdentifier:this._reader.getString(32,!1),GeneratingSoftware:this._reader.getString(32,!1),FileCreationDayOfYear:this._reader.getUint16(),FileCreationYear:this._reader.getUint16(),HeaderSize:this._reader.getUint16(),OffsetToPointData:this._reader.getUint32(),NumberOfVariableLengthRecords:this._reader.getUint32(),PointDataFormatID:this._reader.getUint8(),PointDataRecordLength:this._reader.getUint16(),NumberOfPointRecords:this._reader.getUint32(),NumberOfPointsByReturn:this._reader.getUint32Array(5),XScaleFactor:this._reader.getFloat64(),YScaleFactor:this._reader.getFloat64(),ZScaleFactor:this._reader.getFloat64(),XOffset:this._reader.getFloat64(),YOffset:this._reader.getFloat64(),ZOffset:this._reader.getFloat64(),MaxX:this._reader.getFloat64(),MinX:this._reader.getFloat64(),MaxY:this._reader.getFloat64(),MinY:this._reader.getFloat64(),MaxZ:this._reader.getFloat64(),MinZ:this._reader.getFloat64()}}_parseHeader_1_3(){return{FileSignature:this._reader.getString(4,!1),FileSourceId:this._reader.getUint16(),GlobalEncoding:new Dt(this._reader.getUint16()),GUID_1:this._reader.getUint32(),GUID_2:this._reader.getUint16(),GUID_3:this._reader.getUint16(),GUID_4:this._reader.getUint8Array(8),VersionMajor:this._reader.getUint8(),VersionMinor:this._reader.getUint8(),SystemIdentifier:this._reader.getString(32,!1),GeneratingSoftware:this._reader.getString(32,!1),FileCreationDayOfYear:this._reader.getUint16(),FileCreationYear:this._reader.getUint16(),HeaderSize:this._reader.getUint16(),OffsetToPointData:this._reader.getUint32(),NumberOfVariableLengthRecords:this._reader.getUint32(),PointDataFormatID:this._reader.getUint8(),PointDataRecordLength:this._reader.getUint16(),NumberOfPointRecords:this._reader.getUint32(),NumberOfPointsByReturn:this._reader.getUint32Array(5),XScaleFactor:this._reader.getFloat64(),YScaleFactor:this._reader.getFloat64(),ZScaleFactor:this._reader.getFloat64(),XOffset:this._reader.getFloat64(),YOffset:this._reader.getFloat64(),ZOffset:this._reader.getFloat64(),MaxX:this._reader.getFloat64(),MinX:this._reader.getFloat64(),MaxY:this._reader.getFloat64(),MinY:this._reader.getFloat64(),MaxZ:this._reader.getFloat64(),MinZ:this._reader.getFloat64(),StartOfWaveformDataPacketRecord:this._reader.getUint64()}}_parseHeader_1_4(){return{FileSignature:this._reader.getString(4,!1),FileSourceId:this._reader.getUint16(),GlobalEncoding:new Tt(this._reader.getUint16()),GUID_1:this._reader.getUint32(),GUID_2:this._reader.getUint16(),GUID_3:this._reader.getUint16(),GUID_4:this._reader.getUint8Array(8),VersionMajor:this._reader.getUint8(),VersionMinor:this._reader.getUint8(),SystemIdentifier:this._reader.getString(32,!1),GeneratingSoftware:this._reader.getString(32,!1),FileCreationDayOfYear:this._reader.getUint16(),FileCreationYear:this._reader.getUint16(),HeaderSize:this._reader.getUint16(),OffsetToPointData:this._reader.getUint32(),NumberOfVariableLengthRecords:this._reader.getUint32(),PointDataRecordFormat:this._reader.getUint8(),PointDataRecordLength:this._reader.getUint16(),LegacyNumberOfPointRecords:this._reader.getUint32(),LegacyNumberOfPointsByReturn:this._reader.getUint32Array(5),XScaleFactor:this._reader.getFloat64(),YScaleFactor:this._reader.getFloat64(),ZScaleFactor:this._reader.getFloat64(),XOffset:this._reader.getFloat64(),YOffset:this._reader.getFloat64(),ZOffset:this._reader.getFloat64(),MaxX:this._reader.getFloat64(),MinX:this._reader.getFloat64(),MaxY:this._reader.getFloat64(),MinY:this._reader.getFloat64(),MaxZ:this._reader.getFloat64(),MinZ:this._reader.getFloat64(),StartOfWaveformDataPacketRecord:this._reader.getUint64(),StartOfFirstExtendedVariableLengthRecord:this._reader.getUint64(),NumberOfExtendedVariableLengthRecords:this._reader.getUint32(),NumberOfPointRecords:this._reader.getUint64(),NumberOfPointsByReturn:this._reader.getUint64Array(15)}}_parseVariableLengthRecords(e){const t=e.VersionMinor,i=[];switch(t){case 0:i.push(this._parseVariableLengthRecord_1_0());break;default:throw new Error(`Insupported minor LAS file version: ${t}. Abort parsing !`)}return i}_parseVariableLengthRecord_1_0(){const e={RecordSignature:this._reader.getUint16(),UserID:this._reader.getString(16),RecordId:this._reader.getUint16(),RecordLengthAfterHeader:this._reader.getUint16(),Description:this._reader.getString(32)};if(43707!==e.RecordSignature)throw new Error("Invalid variable length record header signature... Abort parsing !");return e}_parseVariableLengthRecordHeader(){return{Reserved:this._reader.getUint16(),UserID:this._reader.getString(16),RecordId:this._reader.getUint16(),RecordLengthAfterHeader:this._reader.getUint16(),Description:this._reader.getString(32)}}_parsePointDataRecords(e,t){const i=e.OffsetToPointData,s=e.PointDataRecordFormat,r=e.VersionMinor<4?e.LegacyNumberOfPointRecords:e.NumberOfPointRecords;this._reader.skipOffsetTo(i);const n=new Array(r);switch(s){case 0:for(let e=0;e<r;e++)n[e]=this._parsePointDataRecordFormat0(),e%1e5==0&&t(new ProgressEvent("ParsePointDataRecords",{lengthComputable:!0,loaded:e,total:r}));break;case 1:for(let e=0;e<r;e++)n[e]=this._parsePointDataRecordFormat1(),e%1e5==0&&t(new ProgressEvent("ParsePointDataRecords",{lengthComputable:!0,loaded:e,total:r}));break;case 2:for(let e=0;e<r;e++)n[e]=this._parsePointDataRecordFormat2(),e%1e5==0&&t(new ProgressEvent("ParsePointDataRecords",{lengthComputable:!0,loaded:e,total:r}));break;case 3:for(let e=0;e<r;e++)n[e]=this._parsePointDataRecordFormat3(),e%1e5==0&&t(new ProgressEvent("ParsePointDataRecords",{lengthComputable:!0,loaded:e,total:r}));break;case 4:for(let e=0;e<r;e++)n[e]=this._parsePointDataRecordFormat4(),e%1e5==0&&t(new ProgressEvent("ParsePointDataRecords",{lengthComputable:!0,loaded:e,total:r}));break;case 5:for(let e=0;e<r;e++)n[e]=this._parsePointDataRecordFormat5(),e%1e5==0&&t(new ProgressEvent("ParsePointDataRecords",{lengthComputable:!0,loaded:e,total:r}));break;case 6:for(let e=0;e<r;e++)n[e]=this._parsePointDataRecordFormat6(),e%1e5==0&&t(new ProgressEvent("ParsePointDataRecords",{lengthComputable:!0,loaded:e,total:r}));break;case 7:for(let e=0;e<r;e++)n[e]=this._parsePointDataRecordFormat7(),e%1e5==0&&t(new ProgressEvent("ParsePointDataRecords",{lengthComputable:!0,loaded:e,total:r}));break;case 8:for(let e=0;e<r;e++)n[e]=this._parsePointDataRecordFormat8(),e%1e5==0&&t(new ProgressEvent("ParsePointDataRecords",{lengthComputable:!0,loaded:e,total:r}));break;case 9:for(let e=0;e<r;e++)n[e]=this._parsePointDataRecordFormat9(),e%1e5==0&&t(new ProgressEvent("ParsePointDataRecords",{lengthComputable:!0,loaded:e,total:r}));break;case 10:for(let e=0;e<r;e++)n[e]=this._parsePointDataRecordFormat10(),e%1e5==0&&t(new ProgressEvent("ParsePointDataRecords",{lengthComputable:!0,loaded:e,total:r}));break;default:throw new RangeError(`Invalid switch parameter: ${s}`)}return n}_parsePointDataRecordFormat0(){return{X:this._reader.getUint32(),Y:this._reader.getUint32(),Z:this._reader.getUint32(),Intensity:this._reader.getUint16(),_bitFields:this._reader.getUint8(),Classification:this._reader.getUint8(),ScanAngleRank:this._reader.getInt8(),UserData:this._reader.getUint8(),PointSourceId:this._reader.getUint16()}}_parsePointDataRecordFormat1(){return{X:this._reader.getUint32(),Y:this._reader.getUint32(),Z:this._reader.getUint32(),Intensity:this._reader.getUint16(),_bitFields:this._reader.getUint8(),Classification:this._reader.getUint8(),ScanAngleRank:this._reader.getInt8(),UserData:this._reader.getUint8(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64()}}_parsePointDataRecordFormat2(){return{X:this._reader.getUint32(),Y:this._reader.getUint32(),Z:this._reader.getUint32(),Intensity:this._reader.getUint16(),_bitFields:this._reader.getUint8(),Classification:this._reader.getUint8(),ScanAngleRank:this._reader.getInt8(),UserData:this._reader.getUint8(),PointSourceId:this._reader.getUint16(),R:this._reader.getUint16(),G:this._reader.getUint16(),B:this._reader.getUint16()}}_parsePointDataRecordFormat3(){return{X:this._reader.getUint32(),Y:this._reader.getUint32(),Z:this._reader.getUint32(),Intensity:this._reader.getUint16(),_bitFields:this._reader.getUint8(),Classification:this._reader.getUint8(),ScanAngleRank:this._reader.getInt8(),UserData:this._reader.getUint8(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),R:this._reader.getUint16(),G:this._reader.getUint16(),B:this._reader.getUint16()}}_parsePointDataRecordFormat4(){return{X:this._reader.getUint32(),Y:this._reader.getUint32(),Z:this._reader.getUint32(),Intensity:this._reader.getUint16(),_bitFields:this._reader.getUint8(),Classification:this._reader.getUint8(),ScanAngleRank:this._reader.getInt8(),UserData:this._reader.getUint8(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),WavePacketDescriptorIndex:this._reader.getUint8(),ByteOffsetToWaveformData:this._reader.getUint64(),WaveformPacketSizeInBytes:this._reader.getUint32(),ReturnPointWaveformLocation:this._reader.getFloat32(),Xt:this._reader.getFloat32(),Yt:this._reader.getFloat32(),Zt:this._reader.getFloat32()}}_parsePointDataRecordFormat5(){return{X:this._reader.getUint32(),Y:this._reader.getUint32(),Z:this._reader.getUint32(),Intensity:this._reader.getUint16(),_bitFields:this._reader.getUint8(),Classification:this._reader.getUint8(),ScanAngleRank:this._reader.getInt8(),UserData:this._reader.getUint8(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),R:this._reader.getUint16(),G:this._reader.getUint16(),B:this._reader.getUint16(),WavePacketDescriptorIndex:this._reader.getUint8(),ByteOffsetToWaveformData:this._reader.getUint64(),WaveformPacketSizeInBytes:this._reader.getUint32(),ReturnPointWaveformLocation:this._reader.getFloat32(),Xt:this._reader.getFloat32(),Yt:this._reader.getFloat32(),Zt:this._reader.getFloat32()}}_parsePointDataRecordFormat6(){return{X:this._reader.getUint32(),Y:this._reader.getUint32(),Z:this._reader.getUint32(),Intensity:this._reader.getUint16(),_bitFields:this._reader.getUint16(),//!\
Classification:this._reader.getUint8(),UserData:this._reader.getUint8(),ScanAngle:this._reader.getInt16(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64()}}_parsePointDataRecordFormat7(){return{X:this._reader.getUint32(),Y:this._reader.getUint32(),Z:this._reader.getUint32(),Intensity:this._reader.getUint16(),_bitFields:this._reader.getUint16(),//!\
Classification:this._reader.getUint8(),UserData:this._reader.getUint8(),ScanAngle:this._reader.getInt16(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),R:this._reader.getUint16(),G:this._reader.getUint16(),B:this._reader.getUint16()}}_parsePointDataRecordFormat8(){return{X:this._reader.getUint32(),Y:this._reader.getUint32(),Z:this._reader.getUint32(),Intensity:this._reader.getUint16(),_bitFields:this._reader.getUint16(),//!\
Classification:this._reader.getUint8(),UserData:this._reader.getUint8(),ScanAngle:this._reader.getInt16(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),R:this._reader.getUint16(),G:this._reader.getUint16(),B:this._reader.getUint16(),NIR:this._reader.getUint16()}}_parsePointDataRecordFormat9(){return{X:this._reader.getUint32(),Y:this._reader.getUint32(),Z:this._reader.getUint32(),Intensity:this._reader.getUint16(),_bitFields:this._reader.getUint16(),//!\
Classification:this._reader.getUint8(),UserData:this._reader.getUint8(),ScanAngle:this._reader.getInt16(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),WavePacketDescriptorIndex:this._reader.getUint8(),ByteOffsetToWaveformData:this._reader.getUint64(),WaveformPacketSizeInBytes:this._reader.getUint32(),ReturnPointWaveformLocation:this._reader.getFloat32(),Xt:this._reader.getFloat32(),Yt:this._reader.getFloat32(),Zt:this._reader.getFloat32()}}_parsePointDataRecordFormat10(){return{X:this._reader.getUint32(),Y:this._reader.getUint32(),Z:this._reader.getUint32(),Intensity:this._reader.getUint16(),_bitFields:this._reader.getUint16(),//!\
Classification:this._reader.getUint8(),UserData:this._reader.getUint8(),ScanAngle:this._reader.getInt16(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),R:this._reader.getUint16(),G:this._reader.getUint16(),B:this._reader.getUint16(),NIR:this._reader.getUint16(),WavePacketDescriptorIndex:this._reader.getUint8(),ByteOffsetToWaveformData:this._reader.getUint64(),WaveformPacketSizeInBytes:this._reader.getUint32(),ReturnPointWaveformLocation:this._reader.getFloat32(),Xt:this._reader.getFloat32(),Yt:this._reader.getFloat32(),Zt:this._reader.getFloat32()}}_offsetPoints(){this._autoOffset&&(this._boundingBox.setFromPoints(this._points),this.setOffset(this._boundingBox.getCenter()));const e=this._offset.x,t=this._offset.y,i=this._offset.z;let s=null;for(let r=0,n=this._points.length;r<n;++r)s=this._points[r],s.x-=e,s.y-=t,s.z-=i}_createCloudPoint(e){const t=1e6,i=this._points.length,s=Math.ceil(i/t);let r=null,n=0,a=null;for(let i=0;i<s;++i){r=this._points.splice(0,t),n=r.length;const i=new d,s=new Float32Array(3*n),o=new Float32Array(3*n);let h=0,l=null;for(let e=0;e<n;++e)l=r[e],s[h]=l.x,s[h+1]=l.y,s[h+2]=l.z,this._pointsHaveColor?(o[h]=l.r/255,o[h+1]=l.g/255,o[h+2]=l.b/255):(o[h]=.1,o[h+1]=.2,o[h+2]=.5),h+=3;i.setAttribute("position",new p(s,3)),i.setAttribute("color",new p(o,3));const c=new u({size:.01,vertexColors:!0});a=new _(i,c),e.children.push(a)}}_createSubCloudPoint(e){const t=this._points.length,i=new d,s=new Float32Array(3*t),r=new Float32Array(3*t);let n=0,a=null;for(let e=0;e<t;++e)a=this._points[e],s[n]=a.x,s[n+1]=a.y,s[n+2]=a.z,this._pointsHaveColor?(r[n]=a.r/255,r[n+1]=a.g/255,r[n+2]=a.b/255):(r[n]=.1,r[n+1]=.2,r[n+2]=.5),n+=3;i.setAttribute("position",new p(s,3)),i.setAttribute("color",new p(r,3));const o=new u({size:.005,vertexColors:!0}),h=new _(i,o);h.rotation.x-=Math.PI/2,e.children.push(h),this._points=[]}}
/**
 * @module Loader/SHPLoader
 * @desc Export SHPLoader to load .shp files
 *
 * @requires {@link https://github.com/Itee/itee-client itee-client}
 * @requires {@link https://github.com/Itee/itee-utils itee-utils}
 * @requires {@link https://github.com/Itee/three-full three-full}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 * @example Todo...
 *
 */const Ut=rt({NullShape:0,Point:1,Polyline:3,Polygon:5,MultiPoint:8,PointZ:11,PolyLineZ:13,PolygonZ:15,MultiPointZ:18,PointM:21,PolylineM:23,PolygonM:25,MultiPointM:28,MultiPatch:31});class It{constructor(i={}){const s={manager:o,logger:e,reader:new t,globalOffset:new m(0,0,0),worldAxis:{from:"zUp",to:"zForward"},...i};this.manager=s.manager,this.logger=s.logger,this.reader=s.reader,this.globalOffset=s.globalOffset,this.worldAxis=s.worldAxis}get globalOffset(){return this._globalOffset}set globalOffset(e){this._globalOffset=e}get worldAxis(){return this._worldAxis}set worldAxis(e){this._worldAxis=e}get manager(){return this._manager}set manager(e){this._manager=e}get logger(){return this._logger}set logger(e){this._logger=e}get reader(){return this._reader}set reader(e){this._reader=e}setGlobalOffset(e){return this.globalOffset=e,this}setWorldAxis(e){return this.worldAxis=e,this}setManager(e){return this.manager=e,this}setLogger(e){return this.logger=e,this}setReader(e){return this.reader=e,this}load(e,t,i,s){const r=this,n=new l(r.manager);n.setResponseType("arraybuffer"),n.load(e,(e=>{t(r.parse(e))}),i,s)}parse(e){this._reader.setEndianess(i.Big).setBuffer(e);const t=this._parseHeader();if(t.fileCode!==It.FileCode)return this.logger.error("SHPLoader: Invalide Shape file code !"),null;if(t.fileLength<It.MinFileLength)return this.logger.error("SHPLoader: Shape file have an incorrect length !"),null;if(!Object.values(Ut).includes(t.shapeType))return this.logger.error("SHPLoader: Shape file have an incorrect shape type !"),null;t.version<It.MinVersion&&this.logger.warn("SHPLoader: Version of shape file below than 1000 could be incorrectly parsed !");const s=this._parseDatas(t);return this._convertToObjects(s)}_parseHeader(){const e=this._reader.getInt32();this._reader.skipOffsetOf(20);const t=this._reader.getInt32();this._reader.setEndianess(i.Little);const s=this._reader.getInt32(),r=this._reader.getInt32(),n=this._reader.getInt32(),a=this._reader.getInt32();return{fileCode:e,fileLength:t,version:s,shapeType:r,boundingBox:{xMin:n,xMax:this._reader.getInt32(),yMin:a,yMax:this._reader.getInt32(),zMin:this._reader.getInt32(),zMax:this._reader.getInt32(),mMin:this._reader.getInt32(),mMax:this._reader.getInt32()}}}_parseDatas(e){this._reader.skipOffsetTo(100);let t,s,r,n=[];for(;!this._reader.isEndOfFile();)switch(t=this._parseRecordHeader(),s=this._reader.getOffset()+2*t.contentLength,this._reader.setEndianess(i.Little),e.shapeType){case Ut.NullShape:this._reader.skipOffsetTo(s);break;case Ut.Point:case Ut.PointZ:case Ut.PointM:for(;this._reader.getOffset()<s;)r=this._parsePoint(),r&&n.push(r);break;case Ut.Polyline:case Ut.PolyLineZ:case Ut.PolylineM:for(;this._reader.getOffset()<s;)r=this._parsePolyLine(),r&&n.push(r);break;case Ut.Polygon:case Ut.PolygonZ:case Ut.PolygonM:for(;this._reader.getOffset()<s;)r=this._parsePolyLine(),r&&n.push(r);break;case Ut.MultiPoint:case Ut.MultiPointZ:case Ut.MultiPointM:for(;this._reader.getOffset()<s;)r=this._parseMultiPoint(),r&&n.push(r);break;case Ut.MultiPatch:for(;this._reader.getOffset()<s;)r=this._parseMultiPatch(),r&&n.push(r);break;default:this.logger.error(`SHPLoader: Invalid switch parameter: ${e.shapeType}`)}return n}_parseRecordHeader(){this._reader.setEndianess(i.Big);return{recordNumber:this._reader.getInt32(),contentLength:this._reader.getInt32()}}_parseNull(){return this._reader.getInt32(),null}_parsePoint(){const e=this._reader.getInt32();if(e===Ut.NullShape)return null;return{shapeType:e,x:this._reader.getFloat64(),y:this._reader.getFloat64()}}_parsePolyLine(){const e=this._reader.getInt32();if(e===Ut.NullShape)return null;const t={xMin:this._reader.getFloat64(),yMin:this._reader.getFloat64(),xMax:this._reader.getFloat64(),yMax:this._reader.getFloat64()},i=this._reader.getInt32(),s=this._reader.getInt32(),r=new Array(i);for(let e=0;e<i;e++)r[e]=this._reader.getInt32();const n=new Array(s);for(let e=0;e<s;e++)n[e]={x:this._reader.getFloat64(),y:this._reader.getFloat64()};return{shapeType:e,boundingBox:t,numberOfParts:i,numberOfPoints:s,parts:r,points:n}}_parsePolygon(){const e=this._reader.getInt32();if(e===Ut.NullShape)return null;const t={xMin:this._reader.getFloat64(),yMin:this._reader.getFloat64(),xMax:this._reader.getFloat64(),yMax:this._reader.getFloat64()},i=this._reader.getInt32(),s=this._reader.getInt32();let r=new Array(i);for(let e=0;e<i;e++)r[e]=this._reader.getInt32();let n=new Array(s);for(let e=0;e<s;e++)n[e]={x:this._reader.getFloat64(),y:this._reader.getFloat64()};const a=[],o=[];return r.forEach(((e,t)=>{const i=n.slice(e,r[t+1]);nt(i)?a.push(i):o.push(i)})),o.forEach((e=>{a.some((t=>{if(at(t[0],e))return t.push(e),!0}))||a.push([e])})),{shapeType:e,boundingBox:t,numberOfParts:i,numberOfPoints:s,parts:r,polygons:a}}_parseMultiPoint(){const e=this._reader.getInt32();if(e===Ut.NullShape)return null;const t={xMin:this._reader.getFloat64(),xMax:this._reader.getFloat64(),yMin:this._reader.getFloat64(),yMax:this._reader.getFloat64()},i=this._reader.getInt32(),s=new Array(i);for(let e=0;e<i;e++)s.push([this._reader.getFloat64(),this._reader.getFloat64()]);return{shapeType:e,boundingBox:t,numberOfPoints:i,points:s}}_parseMultiPatch(){const e=this._reader.getInt32();return e===Ut.NullShape?null:{shapeType:e}}_convertToObjects(e){let t=[];for(let t=0,r=e.length;t<r;t++){let r=e[t];r.shapeType!==Ut.Polygon&&r.shapeType!==Ut.PolygonZ&&r.shapeType!==Ut.PolygonM||(r.points&&Array.isArray(r.points[0])?i(r.points):s(r.points))}function i(e){for(let t=0,r=e.length;t<r;t++){let r=e[t];r?Array.isArray(r[0])?i(r):s(r):this.logger.log("no array, oups !")}}function s(e){t.push(new g(e))}return t}}It.FileCode=9994,It.MinFileLength=100,It.MinVersion=1e3;
/**
 * @module Controllers/CameraControls
 * @desc This module export CameraControls class and CameraControlMode enum values.
 *
 * @requires {@link module: [itee-client]{@link https://github.com/Itee/itee-client}}
 * @requires {@link module: [itee-utils]{@link https://github.com/Itee/itee-utils}}
 * @requires {@link module: [itee-validators]{@link https://github.com/Itee/itee-validators}}
 * @requires {@link module: [three-full]{@link https://github.com/Itee/three-full}}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @example
 *
 * import { CameraControls, CameraControlMode } from 'itee-plugin-three'
 *
 */
const Ct=new m(0,0,-1),kt=new m(0,0,1),Bt=new m(0,1,0),zt=new m(0,-1,0),Rt=new m(1,0,0),Lt=new m(-1,0,0),Gt=rt({None:0,Rotating:1,Panning:2,Rolling:3,Zooming:4,Moving:5}),Ht=rt({FirstPerson:1,Orbit:2,Fly:3,Path:4});class Nt extends f{constructor(t={}){const i={logger:e,camera:null,target:new b,mode:Ht.Orbit,domElement:"function"==typeof importScripts?null:window,...t};super(),this._handlers={onMouseEnter:this._onMouseEnter.bind(this),onMouseLeave:this._onMouseLeave.bind(this),onMouseDown:this._onMouseDown.bind(this),onMouseMove:this._onMouseMove.bind(this),onMouseWheel:this._onMouseWheel.bind(this),onMouseUp:this._onMouseUp.bind(this),onDblClick:this._onDblClick.bind(this),onTouchStart:this._onTouchStart.bind(this),onTouchEnd:this._onTouchEnd.bind(this),onTouchCancel:this._onTouchCancel.bind(this),onTouchLeave:this._onTouchLeave.bind(this),onTouchMove:this._onTouchMove.bind(this),onKeyDown:this._onKeyDown.bind(this),onKeyUp:this._onKeyUp.bind(this)},this.logger=i.logger,this.camera=i.camera,this.target=i.target,this.mode=i.mode,this.domElement=i.domElement,this.enabled=!0,this._paths=[],this._trackPath=!1,this._cameraJump=.1,this._currentPathPosition=null,this._currentPathOffset=0,this._currentPathIndex=0,this._currentPath=null,this._maxJump=1,this._lockedTarget=!0,this.previousTouches=[],this.canMove=!0,this.moveSpeed=1,this.canFront=!0,this.frontMinimum=-1/0,this.frontMaximum=-1/0,this.frontMinSpeed=0,this.frontSpeed=1,this.frontMaxSpeed=1/0,this.frontAcceleration=1,this.canBack=!0,this.backMinimum=-1/0,this.backMaximum=-1/0,this.backMinSpeed=0,this.backSpeed=1,this.backMaxSpeed=1/0,this.backAcceleration=1,this.canUp=!0,this.upMinimum=-1/0,this.upMaximum=-1/0,this.upMinSpeed=0,this.upSpeed=1,this.upMaxSpeed=1/0,this.upAcceleration=1,this.canDown=!0,this.downMinimum=-1/0,this.downMaximum=-1/0,this.downMinSpeed=0,this.downSpeed=1,this.downMaxSpeed=1/0,this.downAcceleration=1,this.canLeft=!0,this.leftMinimum=-1/0,this.leftMaximum=-1/0,this.leftMinSpeed=0,this.leftSpeed=1,this.leftMaxSpeed=1/0,this.leftAcceleration=1,this.canRight=!0,this.rightMinimum=-1/0,this.rightMaximum=-1/0,this.rightMinSpeed=0,this.rightSpeed=1,this.rightMaxSpeed=1/0,this.rightAcceleration=1,this.canRotate=!0,this.minPolarAngle=.001,this.maxPolarAngle=Math.PI-.001,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.rotateMinSpeed=0,this.rotateSpeed=1,this.rotateMaxSpeed=1/0,this.rotateAcceleration=1,this.canPan=!0,this.panMinimum=-1/0,this.panMaximum=-1/0,this.panMinSpeed=0,this.panSpeed=.001,this.panMaxSpeed=1/0,this.panAcceleration=1,this.canRoll=!0,this.rollMinimum=-1/0,this.rollMaximum=-1/0,this.rollMinSpeed=0,this.rollSpeed=.1,this.rollMaxSpeed=1/0,this.rollAcceleration=1,this.canZoom=!0,this.zoomMinimum=0,this.zoomMaximum=1/0,this.zoomMinSpeed=0,this.zoomSpeed=.001,this.zoomMaxSpeed=1/0,this.zoomAcceleration=1,this.canLookAt=!0,this.actionsMap={front:[r.Z.value,r.UP_ARROW.value],back:[r.S.value,r.DOWN_ARROW.value],up:[r.A.value,r.PAGE_UP.value],down:[r.E.value,r.PAGE_DOWN.value],left:[r.Q.value,r.LEFT_ARROW.value],right:[r.D.value,r.RIGHT_ARROW.value],rotate:[n.Left.value],pan:[n.Middle.value],roll:{left:[r.R.value],right:[r.T.value]},zoom:[n.Wheel.value],lookAtFront:[r.NUMPAD_2.value],lookAtFrontLeft:[r.NUMPAD_3.value],lookAtFrontRight:[r.NUMPAD_1.value],lookAtBack:[r.NUMPAD_8.value],lookAtBackLeft:[r.NUMPAD_9.value],lookAtBackRight:[r.NUMPAD_7.value],lookAtUp:[r.NUMPAD_5.value],lookAtDown:[r.NUMPAD_0.value],lookAtLeft:[r.NUMPAD_6.value],lookAtRight:[r.NUMPAD_4.value]},this._state=Gt.None}get camera(){return this._camera}set camera(e){if(ht(e))throw new Error("Camera cannot be null ! Expect an instance of Camera");if(lt(e))throw new Error("Camera cannot be undefined ! Expect an instance of Camera");if(!e.isCamera)throw new Error(`Camera cannot be an instance of ${e.constructor.name}. Expect an instance of Camera.`);this._camera=e}get target(){return this._target}set target(e){if(ht(e))throw new Error("Target cannot be null ! Expect an instance of Object3D.");if(lt(e))throw new Error("Target cannot be undefined ! Expect an instance of Object3D.");if(!e.isObject3D)throw new Error(`Target cannot be an instance of ${e.constructor.name}. Expect an instance of Object3D.`);this._target=e}get mode(){return this._mode}set mode(e){if(ht(e))throw new Error("Mode cannot be null ! Expect a value from CameraControlMode enum.");if(lt(e))throw new Error("Mode cannot be undefined ! Expect a value from CameraControlMode enum.");if(!Ht.includes(e))throw new Error(`Mode cannot be an instance of ${e.constructor.name}. Expect a value from TCameraControlMode enum.`);this._mode=e,this._trackPath&&this._initPathDisplacement()}get paths(){return this._paths}set paths(e){this._paths=e}get trackPath(){return this._trackPath}set trackPath(e){if(ct(e))throw new Error(`Track path cannot be an instance of ${e.constructor.name}. Expect a boolean.`);this._trackPath=e,this._trackPath&&this._initPathDisplacement()}get domElement(){return this._domElement}set domElement(e){if(ht(e))throw new Error("DomElement cannot be null ! Expect an instance of HTMLDocument.");if(lt(e))throw new Error("DomElement cannot be undefined ! Expect an instance of HTMLDocument.");if(!["Window","HTMLDocument","HTMLDivElement","HTMLCanvasElement","OffscreenCanvas"].includes(e.constructor.name))throw new Error(`DomElement cannot be an instance of ${e.constructor.name}. Expect an instance of Window, HTMLDocument or HTMLDivElement.`);this._domElement&&(this._domElement.removeEventListener("mouseenter",this._handlers.onMouseEnter,!1),this._domElement.removeEventListener("mouseleave",this._handlers.onMouseLeave,!1),this.dispose()),this._domElement=e,this._domElement.addEventListener("mouseenter",this._handlers.onMouseEnter,!1),this._domElement.addEventListener("mouseleave",this._handlers.onMouseLeave,!1),this.impose()}get handlers(){return this._handlers}setCamera(e){return this.camera=e,this}setTarget(e){return this.target=e,this}setMode(e){return this.mode=e,this}setPaths(e){return this.paths=e,this}addPath(e){return this._paths.push(e),this}setTrackPath(e){return this.trackPath=e,this}setDomElement(e){return this.domElement=e,this}impose(){this._domElement.addEventListener("keydown",this._handlers.onKeyDown,!1),this._domElement.addEventListener("keyup",this._handlers.onKeyUp,!1),this._domElement.addEventListener("dblclick",this._handlers.onDblClick,!1),this._domElement.addEventListener("mousedown",this._handlers.onMouseDown,!1),this._domElement.addEventListener("mousemove",this._handlers.onMouseMove,!1),this._domElement.addEventListener("mouseup",this._handlers.onMouseUp,!1),this._domElement.addEventListener("wheel",this._handlers.onMouseWheel,{capture:!0,once:!1,passive:!1}),this._domElement.addEventListener("touchcancel",this._handlers.onTouchCancel,!1),this._domElement.addEventListener("touchend",this._handlers.onTouchEnd,!1),this._domElement.addEventListener("touchleave",this._handlers.onTouchLeave,!1),this._domElement.addEventListener("touchmove",this._handlers.onTouchMove,{capture:!0,once:!1,passive:!1}),this._domElement.addEventListener("touchstart",this._handlers.onTouchStart,{capture:!0,once:!1,passive:!1}),this.dispatchEvent({type:"impose"})}dispose(){this._domElement.removeEventListener("keydown",this._handlers.onKeyDown,!1),this._domElement.removeEventListener("keyup",this._handlers.onKeyUp,!1),this._domElement.removeEventListener("dblclick",this._handlers.onDblClick,!1),this._domElement.removeEventListener("mousedown",this._handlers.onMouseDown,!1),this._domElement.removeEventListener("mousemove",this._handlers.onMouseMove,!1),this._domElement.removeEventListener("mouseup",this._handlers.onMouseUp,!1),this._domElement.removeEventListener("wheel",this._handlers.onMouseWheel,{capture:!0,once:!1,passive:!1}),this._domElement.removeEventListener("touchcancel",this._handlers.onTouchCancel,!1),this._domElement.removeEventListener("touchend",this._handlers.onTouchEnd,!1),this._domElement.removeEventListener("touchleave",this._handlers.onTouchLeave,!1),this._domElement.removeEventListener("touchmove",this._handlers.onTouchMove,{capture:!0,once:!1,passive:!1}),this._domElement.removeEventListener("touchstart",this._handlers.onTouchStart,{capture:!0,once:!1,passive:!1}),this.dispatchEvent({type:"dispose"})}update(){}setCameraPosition(e){return this._camera.position.copy(e),this._camera.lookAt(this._target.position),this}setTargetPosition(e){return this._target.position.copy(e),this._camera.lookAt(this._target.position),this}_preventEvent(e){e.preventDefault&&e.preventDefault()}_consumeEvent(e){e.cancelable&&e.stopImmediatePropagation&&e.stopImmediatePropagation()}_onKeyDown(e){if(!this.enabled)return;this._preventEvent(e);const t=this.actionsMap,i=e.keyCode;t.front.includes(i)?(this._front(),this._consumeEvent(e)):t.back.includes(i)?(this._back(),this._consumeEvent(e)):t.up.includes(i)?(this._up(),this._consumeEvent(e)):t.down.includes(i)?(this._down(),this._consumeEvent(e)):t.left.includes(i)?(this._left(),this._consumeEvent(e)):t.right.includes(i)?(this._right(),this._consumeEvent(e)):t.rotate.includes(i)?this._rotate(1):t.pan.includes(i)?(this._pan(1),this._consumeEvent(e)):t.roll.left.includes(i)?(this._roll(1),this._consumeEvent(e)):t.roll.right.includes(i)?(this._roll(-1),this._consumeEvent(e)):t.zoom.includes(i)?(this._zoom(1),this._consumeEvent(e)):t.lookAtFront.includes(i)?(this._lookAt(Ct),this._consumeEvent(e)):t.lookAtFrontLeft.includes(i)?(this._lookAt(new m(-1,0,-1).normalize()),this._consumeEvent(e)):t.lookAtFrontRight.includes(i)?(this._lookAt(new m(1,0,-1).normalize()),this._consumeEvent(e)):t.lookAtBack.includes(i)?(this._lookAt(kt),this._consumeEvent(e)):t.lookAtBackLeft.includes(i)?(this._lookAt(new m(-1,0,1).normalize()),this._consumeEvent(e)):t.lookAtBackRight.includes(i)?(this._lookAt(new m(1,0,1).normalize()),this._consumeEvent(e)):t.lookAtUp.includes(i)?(this._lookAt(Bt),this._consumeEvent(e)):t.lookAtDown.includes(i)?(this._lookAt(zt),this._consumeEvent(e)):t.lookAtLeft.includes(i)?(this._lookAt(Lt),this._consumeEvent(e)):t.lookAtRight.includes(i)&&(this._lookAt(Rt),this._consumeEvent(e))}_onKeyUp(e){this.enabled&&this._preventEvent(e)}_onTouchStart(e){this.enabled&&(this._preventEvent(e),this.previousTouches=e.touches)}_onTouchEnd(e){this.enabled&&(this._preventEvent(e),this.previousTouches=[],this._state=Gt.None)}_onTouchCancel(e){this.enabled&&(this._preventEvent(e),this.previousTouches=[],this._state=Gt.None)}_onTouchLeave(e){this.enabled&&(this._preventEvent(e),this.previousTouches=[],this._state=Gt.None)}_onTouchMove(e){if(!this.enabled)return;this._preventEvent(e);const t=this.previousTouches,i=e.changedTouches,s=t.length,r=i.length;if(2===s&&2===r){const s=new w(t[0].clientX,t[0].clientY),r=new w(t[1].clientX,t[1].clientY),n=s.distanceTo(r),a=(new w).addVectors(s,r).divideScalar(2),o=(new w).subVectors(s,r).normalize(),h=new w(i[0].clientX,i[0].clientY),l=new w(i[1].clientX,i[1].clientY),c=h.distanceTo(l),d=(new w).addVectors(h,l).divideScalar(2),p=(new w).subVectors(s,r).normalize(),u=(new w).subVectors(d,a),_=c-n,m=p.dot(o);this._pan(u),this._zoom(_),this._roll(m),this._consumeEvent(e)}else if(1===s&&1===r){const s=new w(i[0].clientX-t[0].clientX,i[0].clientY-t[0].clientY).divideScalar(10);this._rotate(s),this._consumeEvent(e)}else this.logger.warn("Ignoring inconsistent touches event.");this.previousTouches=i}_onMouseEnter(e){this.enabled&&(this._preventEvent(e),this.impose(),e.target.constructor!==HTMLDocument&&this._domElement.focus())}_onMouseLeave(e){this.enabled&&(this._preventEvent(e),e.target.constructor!==HTMLDocument&&this._domElement.blur(),this.dispose(),this._state=Gt.None)}_onMouseDown(e){if(!this.enabled)return;this._preventEvent(e);const t=this.actionsMap,i=e.button;t.front.includes(i)?(this._state=Gt.Moving,this._front(),this._consumeEvent(e)):t.back.includes(i)?(this._state=Gt.Moving,this._back(),this._consumeEvent(e)):t.up.includes(i)?(this._state=Gt.Moving,this._up(),this._consumeEvent(e)):t.down.includes(i)?(this._state=Gt.Moving,this._down(),this._consumeEvent(e)):t.left.includes(i)?(this._state=Gt.Moving,this._left(),this._consumeEvent(e)):t.right.includes(i)?(this._state=Gt.Moving,this._right(),this._consumeEvent(e)):t.rotate.includes(i)?(this._state=Gt.Rotating,this._consumeEvent(e)):t.pan.includes(i)?(this._state=Gt.Panning,this._consumeEvent(e)):t.roll.left.includes(i)||t.roll.right.includes(i)?(this._state=Gt.Rolling,this._consumeEvent(e)):t.zoom.includes(i)?(this._state=Gt.Zooming,this._consumeEvent(e)):this._state=Gt.None}_onMouseMove(e){if(!this.enabled||this._state===Gt.None)return;this._preventEvent(e);const t=this._state,i={x:e.movementX||e.mozMovementX||e.webkitMovementX||0,y:e.movementY||e.mozMovementY||e.webkitMovementY||0};switch(t){case Gt.Moving:break;case Gt.Rotating:this._rotate(i),this._consumeEvent(e);break;case Gt.Panning:this._pan(i),this._consumeEvent(e);break;case Gt.Rolling:this._roll(i),this._consumeEvent(e);break;case Gt.Zooming:this._zoom(i),this._consumeEvent(e);break;default:throw new RangeError(`Unknown state: ${t}`)}}_onMouseWheel(e){if(!this.enabled)return;this._preventEvent(e);const t=e.wheelDelta||e.deltaY;this._zoom(t),this._consumeEvent(e)}_onMouseUp(e){this.enabled&&(this._preventEvent(e),this._state=Gt.None,this._consumeEvent(e))}_onDblClick(e){this.enabled&&(this._preventEvent(e),this.logger.warn("CameraControls: Double click events is not implemented yet, sorry for the disagreement."))}_front(){if(this.canMove&&this.canFront){if(this._camera.isPerspectiveCamera){const e=Ct.clone().applyQuaternion(this._camera.quaternion),t=this._trackPath?this._getPathDisplacement(e):e.multiplyScalar(this.frontSpeed);this._camera.position.add(t),this._target.position.add(t)}else if(this._camera.isOrthographicCamera){const e=Ct.clone().applyQuaternion(this._camera.quaternion),t=this._trackPath?this._getPathDisplacement(e):e.multiplyScalar(this.frontSpeed);this._camera.position.add(t),this._target.position.add(t);const i=this.frontSpeed*this.zoomSpeed;this._camera.zoom+=i,this._camera.updateProjectionMatrix()}else this.logger.error(`Unmanaged displacement for camera of type ${this._camera.type}`);this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_back(){if(this.canMove&&this.canBack){if(this._camera.isPerspectiveCamera){const e=kt.clone().applyQuaternion(this._camera.quaternion),t=this._trackPath?this._getPathDisplacement(e):e.multiplyScalar(this.backSpeed);this._camera.position.add(t),this._target.position.add(t)}else if(this._camera.isOrthographicCamera){const e=kt.clone().applyQuaternion(this._camera.quaternion),t=this._trackPath?this._getPathDisplacement(e):e.multiplyScalar(this.backSpeed);this._camera.position.add(t),this._target.position.add(t);const i=this.backSpeed*this.zoomSpeed;this._camera.zoom-i<=0?this._camera.zoom=.01:this._camera.zoom-=i,this._camera.updateProjectionMatrix()}else this.logger.error(`Unmanaged displacement for camera of type ${this._camera.type}`);this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_up(){if(this.canMove&&this.canUp){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const e=Bt.clone().applyQuaternion(this._camera.quaternion).multiplyScalar(this.upSpeed);this._camera.position.add(e),this._target.position.add(e)}else this.logger.error(`Unmanaged displacement for camera of type ${this._camera.type}`);this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_down(){if(this.canMove&&this.canDown){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const e=zt.clone().applyQuaternion(this._camera.quaternion).multiplyScalar(this.downSpeed);this._camera.position.add(e),this._target.position.add(e)}else this.logger.error(`Unmanaged displacement for camera of type ${this._camera.type}`);this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_left(){if(this.canMove&&this.canLeft){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const e=Lt.clone().applyQuaternion(this._camera.quaternion).multiplyScalar(this.leftSpeed);this._camera.position.add(e),this._target.position.add(e)}else this.logger.error(`Unmanaged displacement for camera of type ${this._camera.type}`);this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_right(){if(this.canMove&&this.canRight){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const e=Rt.clone().applyQuaternion(this._camera.quaternion).multiplyScalar(this.rightSpeed);this._camera.position.add(e),this._target.position.add(e)}this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_rotate(e){if(this.canRotate){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const t=this._camera.position,i=this._target.position,s=t.distanceTo(i),r=(new m).subVectors(t,i).normalize(),n=this.rotateSpeed;switch(this._mode){case Ht.FirstPerson:{const s=e.x,r=e.y,a=new m(-s,r,0).applyQuaternion(this._camera.quaternion).multiplyScalar(n).add(i),o=(new m).subVectors(a,t).normalize(),h=Bt.clone().dot(o),l=Rt.clone().dot(o),c=.97;if(h<-c||h>c||l<-2||l>2)return;const d=o.multiplyScalar(1).add(t);this.setTargetPosition(d)}break;case Ht.Orbit:{const t=(new y).setFromVector3(r),a=t.theta+ot(-e.x)*n,o=t.phi+ot(-e.y)*n;t.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,a)),t.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,o));const h=(new m).setFromSpherical(t).multiplyScalar(s).add(i);this.setCameraPosition(h)}break;default:throw new RangeError(`Unamanaged rotation for camera mode ${this._mode}`)}}this.dispatchEvent({type:"rotate"}),this.dispatchEvent({type:"change"})}}_pan(e){if(this.canPan){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const t=this._camera.position,i=this._target.position,s=t.distanceTo(i),r=new m(-e.x,e.y,0).applyQuaternion(this._camera.quaternion).multiplyScalar(this.panSpeed*s);this._camera.position.add(r),this._target.position.add(r)}this.dispatchEvent({type:"pan"}),this.dispatchEvent({type:"change"})}}_roll(e){if(this.canRoll){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const t=this._camera.position,i=this._target.position,s=(new m).subVectors(t,i).normalize(),r=e*this.rollSpeed;this._camera.up.applyAxisAngle(s,r),this._camera.lookAt(i)}this.dispatchEvent({type:"roll"}),this.dispatchEvent({type:"change"})}}_zoom(e){if(this.canZoom){if(this._camera.isPerspectiveCamera)switch(this._mode){case Ht.FirstPerson:e>0?this._camera.fov--:this._camera.fov++,this._camera.updateProjectionMatrix();break;case Ht.Orbit:{const t=this._camera.position,i=this._target.position,s=t.distanceTo(i),r=Ct.clone().applyQuaternion(this._camera.quaternion).multiplyScalar(e*this.zoomSpeed*s);let n=t.clone().add(r);const a=(new m).subVectors(n,t).normalize(),o=(new m).subVectors(t,i).normalize(),h=(new m).subVectors(n,i).normalize(),l=a.dot(o),c=a.dot(h),d=n.distanceToSquared(i);l<0&&(d<this.zoomMinimum*this.zoomMinimum||c>0)&&(n=o.clone().multiplyScalar(this.zoomMinimum).add(i)),this._camera.position.copy(n)}break;default:throw new RangeError(`Invalid camera control mode parameter: ${this._mode}`)}else if(this._camera.isOrthographicCamera){const t=this.domElement.offsetWidth/this.domElement.offsetHeight,i=this._camera.position,s=this._target.position,r=i.distanceTo(s),n=(e>0?Ct.clone():kt.clone()).applyQuaternion(this._camera.quaternion).normalize().multiplyScalar(this.zoomSpeed*r);i.add(n);const a=i.distanceTo(s),o=a/2,h=a*t/2;this._camera.top=o,this._camera.bottom=-o,this._camera.right=h,this._camera.left=-h,this._camera.updateProjectionMatrix()}this.dispatchEvent({type:"zoom"}),this.dispatchEvent({type:"change"})}}_lookAt(e){if(this.canLookAt){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const t=e.clone(),i=this._camera.position,s=this._target.position,r=i.distanceTo(s);switch(this.mode){case Ht.FirstPerson:{t.y=-t.y;const e=t.multiplyScalar(r).add(i);this.setTargetPosition(e)}break;case Ht.Orbit:{const e=t.multiplyScalar(r).add(s);this.setCameraPosition(e)}break;default:throw new RangeError(`Invalid camera control mode parameter: ${this._mode}`)}}this.dispatchEvent({type:"lookAt"}),this.dispatchEvent({type:"change"})}}_initPathDisplacement(){if(dt(this._paths))this.logger.warn("Try to init path displacement without any paths");else switch(pt(this._currentPath)&&(this._currentPathIndex=0,this._currentPathOffset=0,this._currentPath=this._paths[0]),this._currentPathPosition=this._currentPath.getPointAt(this._currentPathOffset),this._mode){case Ht.FirstPerson:if(this._lockedTarget){const e=(new m).subVectors(this._currentPathPosition,this.camera.position);this._camera.position.add(e),this._target.position.add(e)}else this.setCameraPosition(this._currentPathPosition);break;case Ht.Orbit:if(this._lockedTarget){const e=(new m).subVectors(this._currentPathPosition,this.target.position);this._camera.position.add(e),this._target.position.add(e)}else this.setTargetPosition(this._currentPathPosition);break;default:throw new RangeError(`Invalid camera control _mode parameter: ${this._mode}`)}}_getPathDisplacement(e){let t=null;const i=this._currentPathPosition,s=this._currentPathOffset+this._cameraJump,r=s<1?s:1,n=this._currentPath.getPointAt(r),a=(new m).subVectors(n,i),o=a.clone().normalize(),h=e.dot(o),l=this._currentPathOffset-this._cameraJump,c=l>0?l:0,d=this._currentPath.getPointAt(c),p=(new m).subVectors(d,i),u=p.clone().normalize(),_=e.dot(u);if(0===h&&_<0){const i=this._getDirectionsMap();let s,r,n,a=-1;i.forEach((t=>{const i=t.index,o=t.startDisplacement;if(o){const t=o.clone().normalize(),h=e.dot(t);h>a&&(s=i,r=o,a=h,n=!0)}const h=t.endDisplacement;if(h){const t=h.clone().normalize(),o=e.dot(t);o>a&&(s=i,r=h,a=o,n=!1)}})),void 0!==s?(this._currentPathIndex=s,this._currentPath=this._paths[this._currentPathIndex],this._currentPathOffset=n?this._cameraJump:1-this._cameraJump,this._currentPathPosition=this._currentPath.getPointAt(this._currentPathOffset),t=r):(this.logger.warn("Reach path end."),t=new m)}else if(h>0&&_<=0)t=a,this._currentPathOffset=r,this._currentPathPosition=n;else if(h<=0&&_>0)t=p,this._currentPathOffset=c,this._currentPathPosition=d;else if(h<0&&0===_){const i=this._getDirectionsMap();let s,r,n,a=-1;i.forEach((t=>{const i=t.index,o=t.startDisplacement;if(o){const t=o.clone().normalize(),h=e.dot(t);h>a&&(s=i,r=o,a=h,n=!0)}const h=t.endDisplacement;if(h){const t=h.clone().normalize(),o=e.dot(t);o>a&&(s=i,r=h,a=o,n=!1)}})),void 0!==s?(this._currentPathIndex=s,this._currentPath=this._paths[this._currentPathIndex],this._currentPathOffset=n?this._cameraJump:1-this._cameraJump,this._currentPathPosition=this._currentPath.getPointAt(this._currentPathOffset),t=r):(this.logger.warn("Reach path start."),t=new m)}else h<0&&_<0||h>0&&_>0?h>_?(t=a,this._currentPathOffset=r,this._currentPathPosition=n):(t=p,this._currentPathOffset=c,this._currentPathPosition=d):(this.logger.warn("Unable to find correct next path position."),t=new m);return t}_getDirectionsMap(){const e=this._currentPathPosition,t=this._currentPathIndex,i=this._cameraJump,s=this._maxJump;return this._paths.reduce(((r,n,a)=>{if(a===t)return r;const o=n.getPointAt(0);let h;e.distanceToSquared(o)<s&&(h=(new m).subVectors(n.getPointAt(i),o));const l=n.getPointAt(1);let c;return e.distanceToSquared(l)<s&&(c=(new m).subVectors(n.getPointAt(1-i),l)),(h||c)&&r.push({index:a,startDisplacement:h,endDisplacement:c}),r}),[])}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class jt extends b{constructor(e={}){const t={debug:!1,planeSize:50,...e};super(t),this.isGizmo=!0,this.type="AbstractGizmo",this.matrixAutoUpdate=!0,this.debug=t.debug;const i=new v(t.planeSize,t.planeSize,2,2),s=new x({side:E,visible:this.debug,transparent:!0,opacity:.33,color:1193046});this.intersectPlane=new P(i,s),this.intersectPlane.name="IntersectPlane",this.intersectPlane.matrixAutoUpdate=!0,this.intersectPlane.visible=!0,this.add(this.intersectPlane)}_setupHandles(e){const t=this;for(let i in e){const s=e[i];if(ut(s))s.name=i,s.renderOrder=1/0,s.updateMatrix(),t.add(s);else for(let r=s.length;r--;){const s=e[i][r][0],n=e[i][r][1],a=e[i][r][2],o=e[i][r][3],h=e[i][r][4];s.name=i,s.tag=h,s.renderOrder=1/0,n&&s.position.set(n[0],n[1],n[2]),a&&s.rotation.set(a[0],a[1],a[2]),o&&s.scale.set(o[0],o[1],o[2]),s.updateMatrix();const l=s.geometry.clone();l.applyMatrix4(s.matrix),s.geometry=l,s.position.set(0,0,0),s.rotation.set(0,0,0),s.scale.set(1,1,1),t.add(s)}}}highlight(e){for(let e in this.handleGizmos)this.handleGizmos[e].highlight(!1);const t=this.handleGizmos[e];t&&t.highlight(!0)}update(e,t){this.traverse((e=>{e.isHandle&&e.update(t)})),this.updateIntersectPlane(e)}updateIntersectPlane(e){this.intersectPlane.lookAt(e),this.intersectPlane.updateMatrix()}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Yt extends b{constructor(e={}){const t={debug:!1,color:16777215,hitbox:null,...e};super(t),this.isHandle=!0,this.type="Handle",this.matrixAutoUpdate=!0,this.debug=t.debug,this.color=t.color,this.hitbox=t.hitbox,this.baseQuaternion=new M}get color(){return this.line.material.color.clone()}set color(e){if(ht(e))throw new Error("Color cannot be null ! Expect an instance of Color.");if(lt(e))throw new Error("Color cannot be undefined ! Expect an instance of Color.");this.traverse((t=>{let i=t.material;i&&i.color.setHex(e)}))}get hitbox(){return this._hitbox}set hitbox(e){this._hitbox=e,this.add(e)}setColor(e){return this.color=e,this}setHitbox(e){return this.hitbox=e,this}setScale(e,t,i){return this.scale.set(e,t,i),this}setPosition(e,t,i){return this.position.set(e,t,i),this}highlight(e){for(let t=0,i=this.children.length;t<i;t++){const i=this.children[t];if(i.isHitbox)continue;const s=i.material;!lt(s)&&s.isHighlightableMaterial&&s.highlight(e)}}raycast(e,t){const i=e.intersectObject(this._hitbox,!1);i.length>0&&t.push({distance:i[0].distance,object:this})}setRotationFromAxisAndAngle(e,t){return this.quaternion.setFromAxisAngle(e,t),this.baseQuaternion.copy(this.quaternion),this}update(e){}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Xt extends P{constructor(e={}){const t={geometry:new d,material:new x({visible:!1,depthTest:!1,depthWrite:!1,fog:!1,side:E,color:6636321}),...e};super(t.geometry,t.material),this.isHitbox=!0,this.type="Hitbox",this.matrixAutoUpdate=!1}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Zt extends Xt{constructor(e={}){const t=new F(.2,0,1,4,1,!1);t.translate(0,.5,0);super({geometry:t,...e}),this.isCylindricaHitbox=!0,this.type="CylindricaHitbox"}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Vt extends A{constructor(e){super(e),this.isHighlightableMaterial=!0,this.depthTest=!1,this.depthWrite=!1,this.fog=!1,this.transparent=!0,this.linewidth=1,this.oldColor=this.color.clone()}highlight(e){if(e){const e=.35,t=this.color.r,i=this.color.g,s=this.color.b,r=Math.min(Math.max(0,t+t*e),1),n=Math.min(Math.max(0,i+i*e),1),a=Math.min(Math.max(0,s+s*e),1);this.color.setRGB(r,n,a)}else this.color.copy(this.oldColor)}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Wt extends x{constructor(e){super(e),this.isHighlightableMaterial=!0,this.depthTest=!1,this.depthWrite=!1,this.fog=!1,this.side=E,this.transparent=!0,this.oldColor=this.color.clone()}highlight(e){if(e){const e=.35,t=this.color.r,i=this.color.g,s=this.color.b,r=Math.min(Math.max(0,t+t*e),1),n=Math.min(Math.max(0,i+i*e),1),a=Math.min(Math.max(0,s+s*e),1);this.color.setRGB(r,n,a)}else this.color.copy(this.oldColor)}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class $t extends d{constructor(e=new m(0,0,0),t=new m(1,0,0)){super(),this.type="LineGeometry",this.setAttribute("position",new S([e.x,e.y,e.z,t.x,t.y,t.z],3))}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class qt extends Yt{constructor(e={}){const t={color:16777215,hitbox:new Zt,direction:new m(0,1,0),...e};super(t),this.isTranslateHandle=!0,this.type="TranslateHandle";const i=new $t(new m(0,0,0),new m(0,.8,0)),s=new Vt({color:t.color}),r=new D(i,s);r.matrixAutoUpdate=!1,this.add(r);const n=new T(.05,.2,12,1,!1);n.translate(0,.9,0);const a=new Wt({color:t.color}),o=new P(n,a);o.matrixAutoUpdate=!1,this.add(o),this.direction=t.direction}get direction(){return this._direction}set direction(e){if(ht(e))throw new Error("Direction cannot be null ! Expect an instance of Color.");if(lt(e))throw new Error("Direction cannot be undefined ! Expect an instance of Color.");if(!(e instanceof m))throw new Error(`Direction cannot be an instance of ${e.constructor.name}. Expect an instance of Vector3.`);if(this._direction=e,e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{const t=new m(e.z,0,-e.x).normalize(),i=Math.acos(e.y);this.quaternion.setFromAxisAngle(t,i)}}update(e){super.update(e);this._direction.dot(e)>=0&&this.flipDirection(),this.updateMatrix(),this.hitbox.updateMatrix()}setDirection(e){return this.direction=e,this}flipDirection(){this.direction=this._direction.negate()}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Kt extends Xt{constructor(e={}){const t=new S([0,0,0,.85,0,0,1.1,1.1,0,0,.85,0],3),i=new d;i.setAttribute("position",t),i.setIndex([0,1,2,2,3,0]);super({geometry:i,...e}),this.isPlanarHitbox=!0,this.type="PlanarHitbox"}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Qt extends Yt{constructor(e={}){const t={color:16777215,hitbox:new Kt,direction:new m(1,1,0),...e};super(t),this.isPlaneHandle=!0,this.type="PlaneHandle";const i=new d;i.setAttribute("position",new S([.1,.75,0,1,1,0,.75,.1,0],3));const s=new Vt({color:t.color}),r=new D(i,s);r.matrixAutoUpdate=!1,this.add(r);const n=new d;n.setAttribute("position",new S([.1,.1,0,.75,.1,0,1,1,0,.1,.75,0],3)),n.setIndex([0,1,2,2,3,0]);const a=new Wt({color:t.color,transparent:!0,opacity:.35}),o=new P(n,a);o.matrixAutoUpdate=!1,this.add(o),this.direction=t.direction,this.xDirection=new m(t.direction.x,0,0),this.yDirection=new m(0,t.direction.y,0),this.zDirection=new m(0,0,t.direction.z),this.xAxis=new m(1,0,0),this.yAxis=new m(0,1,0),this.zAxis=new m(0,0,1)}get direction(){return this._direction}set direction(e){if(ht(e))throw new Error("Direction cannot be null ! Expect an instance of Color.");if(lt(e))throw new Error("Direction cannot be undefined ! Expect an instance of Color.");if(!(e instanceof m))throw new Error(`Direction cannot be an instance of ${e.constructor.name}. Expect an instance of Vector3.`);this._direction=e}update(e){super.update(e);const t=this.xDirection.dot(e),i=this.yDirection.dot(e),s=this.zDirection.dot(e);this.quaternion.copy(this.baseQuaternion),t>0&&i>0&&0===s?this.rotateOnAxis(this.zAxis,ot(180)):t>0&&i<0&&0===s?this.rotateOnAxis(this.zAxis,ot(90)):t<0&&i>0&&0===s?this.rotateOnAxis(this.zAxis,ot(270)):t<0&&i<0&&0===s?this.rotateOnAxis(this.zAxis,ot(0)):t>0&&0===i&&s>0?this.rotateOnAxis(this.zAxis,ot(180)):t>0&&0===i&&s<0?this.rotateOnAxis(this.zAxis,ot(90)):t<0&&0===i&&s>0?this.rotateOnAxis(this.zAxis,ot(270)):t<0&&0===i&&s<0?this.rotateOnAxis(this.zAxis,ot(0)):0===t&&i>0&&s>0?this.rotateOnAxis(this.zAxis,ot(180)):0===t&&i>0&&s<0?this.rotateOnAxis(this.zAxis,ot(270)):0===t&&i<0&&s>0?this.rotateOnAxis(this.zAxis,ot(90)):0===t&&i<0&&s<0&&this.rotateOnAxis(this.zAxis,ot(0)),this.updateMatrix(),this.hitbox.updateMatrix()}setDirection(e){return this.direction=e,this}flipXAxis(){const e=this._direction.clone();e.x=-e.x,this.direction=e}flipYAxis(){const e=this._direction.clone();e.y=-e.y,this.direction=e}flipZAxis(){const e=this._direction.clone();e.z=-e.z,this.direction=e}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Jt extends Xt{constructor(e={}){super({geometry:new O(1.2,0),...e}),this.isOctahedricalHitbox=!0,this.type="OctahedricalHitbox"}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class ei extends Yt{constructor(e={}){const t={color:16777215,hitbox:new Jt,...e};super(t),this.isOmnidirectionalHandle=!0,this.type="OmnidirectionalHandle";const i=new O(.1,0),s=new Wt({color:t.color,transparent:!0,opacity:.55}),r=new P(i,s);r.matrixAutoUpdate=!1,this.add(r);const n=new U(i),a=new Vt({color:t.color,linewidth:4}),o=new I(n,a);o.matrixAutoUpdate=!1,this.add(o)}update(e){super.update(e),this.updateMatrix(),this.hitbox.updateMatrix()}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class ti extends jt{constructor(){super(),this.isTranslateGizmo=!0,this.type="TranslateGizmo",this.handleGizmos={X:new qt({color:11141120,direction:new m(1,0,0)}),Y:new qt({color:43520,direction:new m(0,1,0)}),Z:new qt({color:170,direction:new m(0,0,1)}),XY:new Qt({color:11184640,direction:new m(1,1,0)}).setScale(.33,.33,1),YZ:new Qt({color:43690,direction:new m(0,1,1)}).setScale(.33,.33,1).setRotationFromAxisAndAngle(new m(0,1,0),ot(-90)),XZ:new Qt({color:11141290,direction:new m(1,0,1)}).setScale(.33,.33,1).setRotationFromAxisAndAngle(new m(1,0,0),ot(90)),XYZ:new ei({color:11184810}).setScale(.15,.15,.15)},this._setupHandles(this.handleGizmos)}raycast(e,t){if(e.intersectObject(this.intersectPlane,!0).length>0)for(let i of this.children)i.name!==this.intersectPlane.name&&i.raycast(e,t)}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class ii extends Xt{constructor(e={}){const t=e.centered?[-.6,-.6,0,.6,-.6,0,.6,.6,0,-.6,.6,0]:[0,0,0,1.1,0,0,1.1,1.1,0,0,1.1,0],i=new d;i.setAttribute("position",new S(t,3)),i.setIndex([0,1,2,2,3,0]);super({geometry:i,...e}),this.isPlanarHitbox=!0,this.type="PlanarHitbox"}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class si extends Yt{constructor(e={}){const t={showEdges:!1,centered:!1,color:16777215,hitbox:new ii({centered:e.centered||!1}),direction:new m(0,1,0),...e};if(super(t),this.isPlaneHandle=!0,this.type="PlaneHandle",t.showEdges){const e=new d;e.setAttribute("position",new S([.75,1,0,1,1,0,1,.75,0],3));const i=new Vt({color:t.color}),s=new D(e,i);s.matrixAutoUpdate=!1,this.add(s)}const i=t.centered?[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]:[.1,.1,0,1,.1,0,1,1,0,.1,1,0],s=new d;s.setAttribute("position",new S(i,3)),s.setIndex([0,1,2,2,3,0]);const r=new Wt({color:t.color,transparent:!0,opacity:.35}),n=new P(s,r);if(n.matrixAutoUpdate=!1,this.add(n),this.xAxis=new m(1,0,0),this.yAxis=new m(0,1,0),this.zAxis=new m(0,0,1),this.xDirection=new m(t.direction.x,0,0),this.yDirection=new m(0,t.direction.y,0),this.zDirection=new m(0,0,t.direction.z),this.direction=t.direction,this.debug){const e=new m(0,0,0),i=t.direction,s=new C(i,e,1,1193046);this.add(s)}}get direction(){return this._direction}set direction(e){if(ht(e))throw new Error("Direction cannot be null ! Expect an instance of Color.");if(lt(e))throw new Error("Direction cannot be undefined ! Expect an instance of Color.");if(!(e instanceof m))throw new Error(`Direction cannot be an instance of ${e.constructor.name}. Expect an instance of Vector3.`);this._direction=e}update(e){super.update(e);const t=new m(this._direction.x,0,0),i=new m(0,this._direction.y,0),s=new m(0,0,this._direction.z),r=t.dot(e),n=i.dot(e),a=s.dot(e);this.quaternion.copy(this.baseQuaternion),r>0&&n>0&&0===a?(this.rotateOnAxis(this.zAxis,ot(180)),this.xDirection.setX(-1),this.yDirection.setY(-1),this.zDirection.setZ(0)):r>0&&n<0&&0===a?(this.rotateOnAxis(this.zAxis,ot(90)),this.xDirection.setX(-1),this.yDirection.setY(1),this.zDirection.setZ(0)):r<0&&n>0&&0===a?(this.rotateOnAxis(this.zAxis,ot(270)),this.xDirection.setX(1),this.yDirection.setY(-1),this.zDirection.setZ(0)):r<0&&n<0&&0===a?(this.rotateOnAxis(this.zAxis,ot(0)),this.xDirection.setX(1),this.yDirection.setY(1),this.zDirection.setZ(0)):r>0&&0===n&&a>0?(this.rotateOnAxis(this.zAxis,ot(180)),this.xDirection.setX(-1),this.yDirection.setY(0),this.zDirection.setZ(-1)):r>0&&0===n&&a<0?(this.rotateOnAxis(this.zAxis,ot(90)),this.xDirection.setX(-1),this.yDirection.setY(0),this.zDirection.setZ(1)):r<0&&0===n&&a>0?(this.rotateOnAxis(this.zAxis,ot(270)),this.xDirection.setX(1),this.yDirection.setY(0),this.zDirection.setZ(-1)):r<0&&0===n&&a<0?(this.rotateOnAxis(this.zAxis,ot(0)),this.xDirection.setX(1),this.yDirection.setY(0),this.zDirection.setZ(1)):0===r&&n>0&&a>0?(this.rotateOnAxis(this.zAxis,ot(180)),this.xDirection.setX(0),this.yDirection.setY(-1),this.zDirection.setZ(-1)):0===r&&n>0&&a<0?(this.rotateOnAxis(this.zAxis,ot(270)),this.xDirection.setX(0),this.yDirection.setY(-1),this.zDirection.setZ(1)):0===r&&n<0&&a>0?(this.rotateOnAxis(this.zAxis,ot(90)),this.xDirection.setX(0),this.yDirection.setY(1),this.zDirection.setZ(-1)):0===r&&n<0&&a<0&&(this.rotateOnAxis(this.zAxis,ot(0)),this.xDirection.setX(0),this.yDirection.setY(1),this.zDirection.setZ(1)),this.updateMatrix(),this.hitbox.updateMatrix()}setDirection(e){return this.direction=e,this}flipXDirection(){this.xDirection.setX(-this.xDirection.x)}flipYDirection(){this.yDirection.setY(-this.yDirection.y)}flipZDirection(){this.zDirection.setZ(-this.zDirection.z)}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class ri extends Yt{constructor(e={}){const t={color:16777215,hitbox:new Zt,direction:new m(0,1,0),...e};super(t),this.isScaleHandle=!0,this.type="ScaleHandle";const i=new $t(new m(0,0,0),new m(0,.88,0)),s=new Vt({color:t.color}),r=new D(i,s);r.matrixAutoUpdate=!1,this.add(r);const n=new k(.12,.12,.12);n.translate(0,.94,0);const a=new Wt({color:t.color}),o=new P(n,a);o.matrixAutoUpdate=!1,this.add(o),this.direction=t.direction}get direction(){return this._direction}set direction(e){if(ht(e))throw new Error("Direction cannot be null ! Expect an instance of Color.");if(lt(e))throw new Error("Direction cannot be undefined ! Expect an instance of Color.");if(!(e instanceof m))throw new Error(`Direction cannot be an instance of ${e.constructor.name}. Expect an instance of Vector3.`);if(this._direction=e,e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{const t=new m(e.z,0,-e.x).normalize(),i=Math.acos(e.y);this.quaternion.setFromAxisAngle(t,i)}}update(e){super.update(e);this._direction.dot(e)>=0&&this.flipDirection(),this.updateMatrix(),this.hitbox.updateMatrix()}setDirection(e){return this.direction=e,this}flipDirection(){this.direction=this._direction.negate()}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class ni extends jt{constructor(){super(),this.isScaleGizmo=!0,this.type="ScaleGizmo",this.handleGizmos={XYZ:new ei({color:11184810}).setScale(.15,.15,.15),XY:new si({color:11184640,direction:new m(1,1,0)}).setScale(.33,.33,1),YZ:new si({color:43690,direction:new m(0,1,1)}).setScale(.33,.33,1).setRotationFromAxisAndAngle(new m(0,1,0),ot(-90)),XZ:new si({color:11141290,direction:new m(1,0,1)}).setScale(.33,.33,1).setRotationFromAxisAndAngle(new m(1,0,0),ot(90)),X:new ri({color:11141120,direction:new m(1,0,0)}),Y:new ri({color:43520,direction:new m(0,1,0)}),Z:new ri({color:170,direction:new m(0,0,1)})},this._setupHandles(this.handleGizmos)}raycast(e,t){if(e.intersectObject(this.intersectPlane,!0).length>0)for(let i of this.children)i.name!==this.intersectPlane.name&&i.raycast(e,t)}}
/**
 * @module Controllers/ClippingController
 *
 * @author [Ahmed DCHAR]{@link https://github.com/Dragoneel}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @example Todo
 *
 */class ai extends I{constructor(){super(),this.margin=.01,this.geometry=new U(new k(2,2,2)),this.material=new A({color:16777215}),this.matrixAutoUpdate=!1,this.normalPlanes={normalRightSide:new m(-1,0,0),normalLeftSide:new m(1,0,0),normalFrontSide:new m(0,-1,0),normalBackSide:new m(0,1,0),normalTopSide:new m(0,0,-1),normalBottomSide:new m(0,0,1)},this.planes={rightSidePlane:new B(this.normalPlanes.normalRightSide.clone(),0),leftSidePlane:new B(this.normalPlanes.normalLeftSide.clone(),0),frontSidePlane:new B(this.normalPlanes.normalFrontSide.clone(),0),backSidePlane:new B(this.normalPlanes.normalBackSide.clone(),0),topSidePlane:new B(this.normalPlanes.normalTopSide.clone(),0),bottomSidePlane:new B(this.normalPlanes.normalBottomSide.clone(),0)},this._boundingBox=new h}getBoundingSphere(){return this.geometry.computeBoundingSphere(),this.geometry.boundingSphere.applyMatrix4(this.matrixWorld),this.geometry.boundingSphere}setColor(e){this.material.color.set(e)}applyClippingTo(e,t){if(pt(t))return;let i=[];for(let e in this.planes)i.push(this.planes[e]);t.traverse((t=>{if(pt(t))return;if(pt(t.geometry))return;if(pt(t.material))return;const s=_t(t.material)?t.material:[t.material];for(let t=0,r=s.length;t<r;t++){let r=s[t];r.clippingPlanes||(r.clippingPlanes=[]),r.clippingPlanes=e?i:[]}}))}updateSize(e){this.scale.set(e.x,e.y,e.z)}update(){this._boundingBox.setFromObject(this);const e=this.margin,t=this._boundingBox.min,i=this._boundingBox.max;this.planes.rightSidePlane.constant=i.x+e,this.planes.leftSidePlane.constant=-t.x+e,this.planes.frontSidePlane.constant=i.y+e,this.planes.backSidePlane.constant=-t.y+e,this.planes.topSidePlane.constant=i.z+e,this.planes.bottomSidePlane.constant=-t.z+e}}const oi=rt({None:"None",Translate:"Translate",Rotate:"Rotate",Scale:"Scale"});class hi extends b{constructor(e={}){const t={camera:null,domElement:window,mode:oi.None,objectsToClip:new b,...e};super(),this._handlers={onMouseEnter:this._onMouseEnter.bind(this),onMouseLeave:this._onMouseLeave.bind(this),onMouseDown:this._onMouseDown.bind(this),onMouseMove:this._onMouseMove.bind(this),onMouseWheel:this._onMouseWheel.bind(this),onMouseUp:this._onMouseUp.bind(this),onDblClick:this._onDblClick.bind(this),onTouchStart:this._onTouchStart.bind(this),onTouchEnd:this._onTouchEnd.bind(this),onTouchCancel:this._onTouchCancel.bind(this),onTouchLeave:this._onTouchLeave.bind(this),onTouchMove:this._onTouchMove.bind(this),onKeyDown:this._onKeyDown.bind(this),onKeyUp:this._onKeyUp.bind(this)},this._events={impose:{type:"impose"},dispose:{type:"dispose"},change:{type:"change"},translate:{type:"translate"},rotate:{type:"rotate"},scale:{type:"scale"},mouseEnter:{type:"mouseEnter"},mouseLeave:{type:"mouseLeave"},mouseDown:{type:"mouseDown"},mouseUp:{type:"mouseUp"}},this._objectsToClipBoundingBox=new h,this._objectsToClipSize=new m,this._objectsToClipCenter=new m,this._clippingBox=new ai,this.add(this._clippingBox),this.camera=t.camera,this.domElement=t.domElement,this.mode=t.mode,this.objectsToClip=t.objectsToClip,this.translationSnap=.1,this.scaleSnap=.1,this.rotationSnap=.1,this.matrixAutoUpdate=!1,this.enabled=!1,this.size=1,this._dragging=!1,this._firstPoint=new m,this._secondPoint=new m,this._mouseDisplacement=new m,this._offset=new m,this._raycaster=new z,this._pointerVector=new w,this._directionToMouse=new m,this._cameraPosition=new m,this._cameraDirection=new m,this._worldPosition=new m,this._worldRotation=new R,this._gizmos={Translate:new ti,Scale:new ni};for(let e in this._gizmos)this.add(this._gizmos[e]);this._currentGizmo=null,this._currentHandle=null,this.actionsMap={setMode:{translate:[r.T.value],rotate:[r.R.value],scale:[r.S.value]},translate:{front:[r.Z.value,r.UP_ARROW.value],back:[r.S.value,r.DOWN_ARROW.value],up:[r.A.value,r.PAGE_UP.value],down:[r.E.value,r.PAGE_DOWN.value],left:[r.Q.value,r.LEFT_ARROW.value],right:[r.D.value,r.RIGHT_ARROW.value]},scale:{widthPlus:[r.LEFT_ARROW.value],widthMinus:[r.RIGHT_ARROW.value],heightPlus:[r.PAGE_UP.value],heightMinus:[r.PAGE_DOWN.value],depthPlus:[r.UP_ARROW.value],depthMinus:[r.DOWN_ARROW.value]},rotate:{xAxis:[r.X.value],yAxis:[r.Y.value],zAxis:[r.Z.value]}}}get objectsToClip(){return this._objectsToClip}set objectsToClip(e){if(ht(e))throw new Error("Objects to clip cannot be null ! Expect an instance of Object3D");if(lt(e))throw new Error("Objects to clip cannot be undefined ! Expect an instance of Object3D");if(!(e instanceof b))throw new Error(`Objects to clip cannot be an instance of ${e.constructor.name}. Expect an instance of Object3D.`);this._objectsToClip=e,this.updateClipping()}get camera(){return this._camera}set camera(e){if(ht(e))throw new Error("Camera cannot be null ! Expect an instance of Camera");if(lt(e))throw new Error("Camera cannot be undefined ! Expect an instance of Camera");if(!e.isCamera&&!e.isPerspectiveCamera&&!e.isOrthographicCamera)throw new Error(`Camera cannot be an instance of ${e.constructor.name}. Expect an instance of Camera, PerspectiveCamera, or OrthographicCamera.`);this._camera=e}get domElement(){return this._domElement}set domElement(e){if(ht(e))throw new Error("DomElement cannot be null ! Expect an instance of Window, HTMLDocument, HTMLDivElement or HTMLCanvasElement.");if(lt(e))throw new Error("DomElement cannot be undefined ! Expect an instance of Window, HTMLDocument, HTMLDivElement or HTMLCanvasElement.");if(!(e instanceof Window||e instanceof HTMLDocument||e instanceof HTMLDivElement||e instanceof HTMLCanvasElement))throw new Error(`Target cannot be an instance of ${e.constructor.name}. Expect an instance of Window, HTMLDocument, HTMLDivElement or HTMLCanvasElement.`);this._domElement&&(this._domElement.removeEventListener("mouseenter",this._handlers.onMouseEnter,!1),this._domElement.removeEventListener("mouseleave",this._handlers.onMouseLeave,!1),this.dispose()),this._domElement=e,this._domElement.addEventListener("mouseenter",this._handlers.onMouseEnter,!1),this._domElement.addEventListener("mouseleave",this._handlers.onMouseLeave,!1),this.impose()}get mode(){return this._mode}set mode(e){if(ht(e))throw new Error("Mode cannot be null ! Expect a value from ClippingModes enum.");if(lt(e))throw new Error("Mode cannot be undefined ! Expect a value from ClippingModes enum.");this._mode=e;for(let e in this._gizmos)this._gizmos[e].visible=!1;this._mode===oi.None?this._currentGizmo=null:(this._currentGizmo=this._gizmos[this._mode],this._currentGizmo.visible=!0),this.updateGizmo()}setCamera(e){return this.camera=e,this}setDomElement(e){return this.domElement=e,this}setMode(e){return this.mode=e,this}setObjectsToClip(e){return this.objectsToClip=e,this}impose(){this._domElement.addEventListener("keydown",this._handlers.onKeyDown,!1),this._domElement.addEventListener("keyup",this._handlers.onKeyUp,!1),this._domElement.addEventListener("dblclick",this._handlers.onDblClick,!1),this._domElement.addEventListener("mousedown",this._handlers.onMouseDown,!1),this._domElement.addEventListener("mousemove",this._handlers.onMouseMove,!1),this._domElement.addEventListener("mouseup",this._handlers.onMouseUp,!1),this._domElement.addEventListener("wheel",this._handlers.onMouseWheel,{capture:!0,once:!1,passive:!1}),this._domElement.addEventListener("touchcancel",this._handlers.onTouchCancel,!1),this._domElement.addEventListener("touchend",this._handlers.onTouchEnd,!1),this._domElement.addEventListener("touchleave",this._handlers.onTouchLeave,!1),this._domElement.addEventListener("touchmove",this._handlers.onTouchMove,{capture:!0,once:!1,passive:!1}),this._domElement.addEventListener("touchstart",this._handlers.onTouchStart,{capture:!0,once:!1,passive:!1}),this.dispatchEvent(this._events.impose)}dispose(){this._domElement.removeEventListener("keydown",this._handlers.onKeyDown,!1),this._domElement.removeEventListener("keyup",this._handlers.onKeyUp,!1),this._domElement.removeEventListener("dblclick",this._handlers.onDblClick,!1),this._domElement.removeEventListener("mousedown",this._handlers.onMouseDown,!1),this._domElement.removeEventListener("mousemove",this._handlers.onMouseMove,!1),this._domElement.removeEventListener("mouseup",this._handlers.onMouseUp,!1),this._domElement.removeEventListener("wheel",this._handlers.onMouseWheel,{capture:!0,once:!1,passive:!1}),this._domElement.removeEventListener("touchcancel",this._handlers.onTouchCancel,!1),this._domElement.removeEventListener("touchend",this._handlers.onTouchEnd,!1),this._domElement.removeEventListener("touchleave",this._handlers.onTouchLeave,!1),this._domElement.removeEventListener("touchmove",this._handlers.onTouchMove,{capture:!0,once:!1,passive:!1}),this._domElement.removeEventListener("touchstart",this._handlers.onTouchStart,{capture:!0,once:!1,passive:!1}),this.dispatchEvent(this._events.dispose)}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}enable(){this.visible=!0,this.enabled=!0,mt(this._objectsToClip)&&(this._objectsToClipBoundingBox.setFromObject(this._objectsToClip),this._objectsToClipBoundingBox.getSize(this._objectsToClipSize),this._objectsToClipSize.divideScalar(2),this.scale.set(this._objectsToClipSize.x,this._objectsToClipSize.y,this._objectsToClipSize.z),this._objectsToClipBoundingBox.getCenter(this._objectsToClipCenter),this.position.set(this._objectsToClipCenter.x,this._objectsToClipCenter.y,this._objectsToClipCenter.z),this.updateMatrix(),this.updateMatrixWorld()),this.updateClipping(),this.updateGizmo()}disable(){this.visible=!1,this.enabled=!1,this.updateClipping()}updateClipping(){pt(this._objectsToClip)||(this._clippingBox.update(),this._clippingBox.applyClippingTo(this.enabled,this._objectsToClip))}updateGizmo(){this.enabled&&this._mode!==oi.None&&(pt(this._currentGizmo)||(this._camera.getWorldPosition(this._cameraPosition),this._camera.getWorldDirection(this._cameraDirection),this._currentGizmo.update(this._cameraPosition,this._cameraDirection)))}_consumeEvent(e){e.cancelable&&e.stopImmediatePropagation()}_onKeyDown(e){if(!this.enabled)return;e.preventDefault();const t=this.actionsMap,i=e.keyCode;if(e.ctrlKey)switch(this._mode){case oi.Translate:t.translate.front.includes(i)?(this._translateZ(this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.translate.back.includes(i)?(this._translateZ(-this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.translate.right.includes(i)?(this._translateX(this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.translate.left.includes(i)?(this._translateX(-this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.translate.up.includes(i)?(this._translateY(this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.translate.down.includes(i)&&(this._translateY(-this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change));break;case oi.Rotate:break;case oi.Scale:t.scale.depthPlus.includes(i)?(this._scaleZ(this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.scale.depthMinus.includes(i)?(this._scaleZ(-this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.scale.widthPlus.includes(i)?(this._scaleX(this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.scale.widthMinus.includes(i)?(this._scaleX(-this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.scale.heightPlus.includes(i)?(this._scaleY(this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.scale.heightMinus.includes(i)&&(this._scaleY(-this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change))}else t.setMode.translate.includes(i)?(this.setMode(oi.Translate),this.updateClipping(),this._consumeEvent(e)):t.setMode.rotate.includes(i)?(this.setMode(oi.Rotate),this.updateClipping(),this._consumeEvent(e)):t.setMode.scale.includes(i)&&(this.setMode(oi.Scale),this.updateClipping(),this._consumeEvent(e))}_onKeyUp(e){this.enabled&&!e.defaultPrevented&&e.preventDefault()}_onDblClick(e){this.enabled&&this._mode!==oi.None&&e.preventDefault()}_onMouseDown(e){if(!this.enabled)return;if(this._mode===oi.None)return;if(e.button!==n.Left.value)return;if(pt(this._currentHandle))return;e.preventDefault(),this._dragging=!0;const t=this.intersectObjects(e,[this._currentGizmo.intersectPlane]);t&&(this._firstPoint=t.point),this._consumeEvent(e),this.dispatchEvent(this._events.mouseDown)}_onMouseEnter(e){this.enabled&&this._mode!==oi.None&&(e.preventDefault(),this.impose(),e.target.constructor!==HTMLDocument&&this._domElement.focus())}_onMouseLeave(e){this.enabled&&this._mode!==oi.None&&(e.preventDefault(),this._dragging=!1,e.target.constructor!==HTMLDocument&&this._domElement.blur(),this.dispose())}_onMouseMove(e){if(this.enabled&&this._mode!==oi.None)if(e.preventDefault(),!1===this._dragging){const t=this.intersectObjects(e,[this._currentGizmo]);if(t){const i=t.object;this._currentHandle&&i!==this._currentHandle&&(this._currentHandle.highlight(!1),this.dispatchEvent(this._events.mouseLeave)),this._currentHandle=i,this._currentHandle.highlight(!0),this.dispatchEvent(this._events.mouseEnter),this._consumeEvent(e)}else mt(this._currentHandle)&&(this._currentHandle.highlight(!1),this._currentHandle=null,this.dispatchEvent(this._events.mouseLeave))}else{const t=this._currentHandle,i=t.name,s=this.intersectObjects(e,[this._currentGizmo.intersectPlane]);switch(s&&(this._secondPoint=s.point),this._mouseDisplacement.subVectors(this._secondPoint,this._firstPoint),this._firstPoint.copy(this._secondPoint),this._mode){case oi.Translate:"X"===i?this._offset.set(1,0,0):"Y"===i?this._offset.set(0,1,0):"Z"===i?this._offset.set(0,0,1):"XY"===i?this._offset.set(1,1,0):"YZ"===i?this._offset.set(0,1,1):"XZ"===i?this._offset.set(1,0,1):"XYZ"===i&&this._offset.set(1,1,1),this._offset.multiply(this._mouseDisplacement),this._translate(this._offset);break;case oi.Rotate:break;case oi.Scale:if(t.isScaleHandle)this._offset.copy(this._currentHandle.direction).multiply(this._mouseDisplacement);else if(t.isPlaneHandle){const e=this._currentHandle.xDirection.dot(this._mouseDisplacement);e>0?this._offset.setX(Math.abs(this._mouseDisplacement.x)):e<0?this._offset.setX(-Math.abs(this._mouseDisplacement.x)):this._offset.setX(0);const t=this._currentHandle.yDirection.dot(this._mouseDisplacement);t>0?this._offset.setY(Math.abs(this._mouseDisplacement.y)):t<0?this._offset.setY(-Math.abs(this._mouseDisplacement.y)):this._offset.setY(0);const i=this._currentHandle.zDirection.dot(this._mouseDisplacement);i>0?this._offset.setZ(Math.abs(this._mouseDisplacement.z)):i<0?this._offset.setZ(-Math.abs(this._mouseDisplacement.z)):this._offset.setZ(0)}else if(t.isOmnidirectionalHandle){this.getWorldPosition(this._worldPosition),this._directionToMouse.subVectors(this._firstPoint,this._worldPosition);const e=this._directionToMouse.dot(this._mouseDisplacement)>0?this._mouseDisplacement.length():-this._mouseDisplacement.length();this._offset.set(e,e,e)}this._scale(this._offset);break;default:throw new RangeError(`Invalid switch parameter: ${this._mode}`)}this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)}}_onMouseUp(e){if(!this.enabled)return;if(this._mode===oi.None)return;if(e.button!==n.Left.value)return;e.preventDefault(),this._dragging=!1,this.dispatchEvent(this._events.mouseUp);const t=this.intersectObjects(e,[this._currentGizmo]);t?(this._currentHandle=t.object,this._currentHandle.highlight(!0),this._consumeEvent(e),this.dispatchEvent(this._events.mouseEnter)):mt(this._currentHandle)&&(this._currentHandle.highlight(!1),this._currentHandle=null,this.dispatchEvent(this._events.mouseLeave)),this.updateGizmo()}_onMouseWheel(e){this.enabled&&e.preventDefault()}_onTouchCancel(e){this.enabled&&e.preventDefault()}_onTouchEnd(e){this.enabled&&e.preventDefault()}_onTouchLeave(e){this.enabled&&e.preventDefault()}_onTouchMove(e){this.enabled&&e.preventDefault()}_onTouchStart(e){this.enabled&&e.preventDefault()}getActiveHandle(e){}intersectObjects(e,t){const i=this._domElement.getBoundingClientRect(),s=(e.clientX-i.left)/i.width*2-1,r=-(e.clientY-i.top)/i.height*2+1;this._pointerVector.set(s,r),this._raycaster.setFromCamera(this._pointerVector,this._camera);const n=this._raycaster.intersectObjects(t,!1);return n[0]?n[0]:null}_translate(e){this.position.add(e),this.updateMatrix()}_translateX(e){this.position.setX(this.position.x+e),this.updateMatrix()}_translateY(e){this.position.setY(this.position.y+e),this.updateMatrix()}_translateZ(e){this.position.setZ(this.position.z+e),this.updateMatrix()}_translateXY(e,t){this.position.setX(this.position.x+e),this.position.setY(this.position.y+t),this.updateMatrix()}_translateXZ(e,t){this.position.setX(this.position.x+e),this.position.setZ(this.position.z+t),this.updateMatrix()}_translateYZ(e,t){this.position.setY(this.position.y+e),this.position.setZ(this.position.z+t),this.updateMatrix()}_translateXYZ(e,t,i){this.position.set(this.position.x+e,this.position.y+t,this.position.z+i),this.updateMatrix()}_rotateX(e){}_rotateY(e){}_rotateZ(e){}_rotateXY(e){}_rotateXZ(e){}_rotateYZ(e){}_rotateXYZ(e){}_scale(e){this.scale.add(e),this.updateMatrix()}_scaleX(e){this.scale.setX(this.scale.x+e),this.updateMatrix()}_scaleY(e){this.scale.setY(this.scale.y+e),this.updateMatrix()}_scaleZ(e){this.scale.setZ(this.scale.z+e),this.updateMatrix()}_scaleXY(e,t){this.scale.setX(this.scale.x+e),this.scale.setY(this.scale.y+t),this.updateMatrix()}_scaleXZ(e,t){this.scale.setX(this.scale.x+e),this.scale.setZ(this.scale.z+t),this.updateMatrix()}_scaleYZ(e,t){this.scale.setY(this.scale.y+e),this.scale.setZ(this.scale.z+t),this.updateMatrix()}_scaleXYZ(e,t,i){this.scale.set(this.scale.x+e,this.scale.y+t,this.scale.z+i),this.updateMatrix()}}
/**
 * @module Managers/CurvesManager
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @example Todo
 *
 */class li extends a{constructor(e={}){super({basePath:"/curves",...e})}convert(e){if(!e)throw new Error("CurvesManager: Unable to convert null or undefined data !");const t=e.type;let i;switch(t){case"ArcCurve":i=new K;break;case"CatmullRomCurve3":i=new q;break;case"CubicBezierCurve":i=new $;break;case"CubicBezierCurve3":i=new W;break;case"Curve":i=new V;break;case"CurvePath":i=new Z;break;case"EllipseCurve":i=new X;break;case"LineCurve":i=new Y;break;case"LineCurve3":i=new j;break;case"Path":i=new N;break;case"QuadraticBezierCurve":i=new H;break;case"QuadraticBezierCurve3":i=new G;break;case"SplineCurve":i=new L;break;case"Shape":i=new g;break;default:throw new Error(`TCurvesManager: Unknown curve of type: ${t}`)}return i.fromJSON(e),i}_onJson(e,t,i,s){const r=gt(e)?[e]:e,n={};for(let e,t=0,a=r.length;t<a;t++){e=r[t];try{n[e._id]=this.convert(e)}catch(e){s(e)}i(t/a)}t(n)}}
/**
 * @module Managers/GeometriesManager
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @requires {@link TDataBaseManager}
 * @requires '../../../node_modules/three/src/core/Geometry'
 * @requires { BufferGeometry } from 'three'
 * @requires '../../../node_modules/three/src/core/BufferAttribute'
 *
 */const ci=rt({Int8Array:0,Uint8Array:1,Uint8ClampedArray:2,Int16Array:3,Uint16Array:4,Int32Array:5,Uint32Array:6,Float32Array:7,Float64Array:8});class di extends a{constructor(e={}){const t={basePath:"/geometries",projectionSystem:"zBack",globalScale:1,computeNormals:!0,computeBoundingBox:!0,computeBoundingSphere:!0,...e};super(t),this.projectionSystem=t.projectionSystem,this.globalScale=t.globalScale,this.computeNormals=t.computeNormals,this.computeBoundingBox=t.computeBoundingBox,this.computeBoundingSphere=t.computeBoundingSphere}get computeBoundingBox(){return this._computeBoundingBox}set computeBoundingBox(e){if(ht(e))throw new TypeError("Compute bounding box cannot be null ! Expect a boolean.");if(lt(e))throw new TypeError("Compute bounding box cannot be undefined ! Expect a boolean.");if(ct(e))throw new TypeError(`Compute bounding box cannot be an instance of ${e.constructor.name} ! Expect a boolean.`);this._computeBoundingBox=e}get computeBoundingSphere(){return this._computeBoundingSphere}set computeBoundingSphere(e){if(ht(e))throw new TypeError("Compute bounding sphere cannot be null ! Expect a boolean.");if(lt(e))throw new TypeError("Compute bounding sphere cannot be undefined ! Expect a boolean.");if(ct(e))throw new TypeError(`Compute bounding sphere cannot be an instance of ${e.constructor.name} ! Expect a boolean.`);this._computeBoundingSphere=e}get computeNormals(){return this._computeNormals}set computeNormals(e){if(ht(e))throw new TypeError("Compute normals cannot be null ! Expect a boolean.");if(lt(e))throw new TypeError("Compute normals cannot be undefined ! Expect a boolean.");if(ct(e))throw new TypeError(`Compute normals cannot be an instance of ${e.constructor.name} ! Expect a boolean.`);this._computeNormals=e}get projectionSystem(){return this._projectionSystem}set projectionSystem(e){if(ht(e))throw new TypeError("Projection system cannot be null ! Expect a positive number.");if(lt(e))throw new TypeError("Projection system cannot be undefined ! Expect a positive number.");this._projectionSystem=e}get globalScale(){return this._globalScale}set globalScale(e){if(ht(e))throw new TypeError("Global scale cannot be null ! Expect a positive number.");if(lt(e))throw new TypeError("Global scale cannot be undefined ! Expect a positive number.");this._globalScale=e}setComputeBoundingBox(e){return this.computeBoundingBox=e,this}setComputeBoundingShpere(e){return this.computeBoundingSphere=e,this}setComputeNormals(e){return this.computeNormals=e,this}setProjectionSystem(e){return this.projectionSystem=e,this}setGlobalScale(e){return this.globalScale=e,this}_onJson(e,t,i,s){const r=gt(e)?[e]:e,n={};for(let e,t=0,a=r.length;t<a;t++){e=r[t];try{n[e._id]=this.convert(e)}catch(e){s(e)}i(new ProgressEvent("GeometriesManager",{lengthComputable:!0,loaded:t+1,total:a}))}t(n)}convert(e){if(!e)throw new Error("GeometriesManager: Unable to convert null or undefined data !");const t=e.type;if(!t)throw new Error("GeometriesManager: Unable to convert untyped data !");let i=null;if(e.isBufferGeometry||t.includes("BufferGeometry"))i=this._convertJsonToBufferGeometry(e),this._computeNormals&&i.computeVertexNormals();else{if(!e.isGeometry&&!t.includes("Geometry"))throw new Error(`TGeometriesManager: Unable to retrieve geometry of type ${t} !`);i=this._convertJsonToGeometry(e),this._computeNormals&&i.computeFaceNormals()}return this.computeBoundingBox&&(i.boundingBox=null,i.computeBoundingBox()),this.computeBoundingSphere&&(i.boundingSphere=null,i.computeBoundingSphere()),i}_convertJsonToGeometry(e){const t=e.types;let i=null;switch(t){case"BoxGeometry":i=new we;break;case"CircleGeometry":i=new be;break;case"CylinderGeometry":i=new fe;break;case"ConeGeometry":i=new ge;break;case"EdgesGeometry":i=new U;break;case"DodecahedronGeometry":i=new me;break;case"ExtrudeGeometry":i=new _e;break;case"Geometry":i=new ue;break;case"IcosahedronGeometry":i=new pe;break;case"LatheGeometry":i=new de;break;case"OctahedronGeometry":i=new ce;break;case"ParametricGeometry":i=new le;break;case"PlaneGeometry":i=new he;break;case"PolyhedronGeometry":i=new oe;break;case"RingGeometry":i=new ae;break;case"ShapeGeometry":i=new ne;break;case"TetrahedronGeometry":i=new re;break;case"TextGeometry":i=new se;break;case"TorusGeometry":i=new ie;break;case"TorusKnotGeometry":i=new te;break;case"TubeGeometry":i=new ee;break;case"SphereGeometry":i=new J;break;case"WireframeGeometry":i=new Q;break;default:throw new Error(`TGeometriesManager: Unknown geometry of type: ${t}`)}i.uuid=e.uuid,i.name=e.name,i.type=e.type;for(var s=[],r=void 0,n=0,a=e.vertices.length;n<a;++n)r=e.vertices[n],s.push(new m(r.x,r.y,r.z));i.vertices=s;for(var o=[],h=void 0,l=0,c=e.faces.length;l<c;l++)h=e.faces[l],o.push(new ye(h.a,h.b,h.c,h.normal,h.color,h.materialIndex));i.faces=o,i.morphTargets=[],i.morphNormals=[],i.skinWeights=[],i.skinIndices=[],i.lineDistances=[],i.elementsNeedUpdate=!0,i.verticesNeedUpdate=!0,i.uvsNeedUpdate=!0,i.normalsNeedUpdate=!0,i.colorsNeedUpdate=!0,i.lineDistancesNeedUpdate=!0,i.groupsNeedUpdate=!0}_convertJsonToBufferGeometry(e){const t=e.type;let i=null;switch(t){case"BoxBufferGeometry":i=new k;break;case"BufferGeometry":i=new d;break;case"CircleBufferGeometry":i=new ke;break;case"CylinderBufferGeometry":i=new F;break;case"ConeBufferGeometry":i=new T;break;case"DodecahedronBufferGeometry":i=new Ce;break;case"ExtrudeBufferGeometry":i=new Ie;break;case"IcosahedronBufferGeometry":i=new Ue;break;case"LatheBufferGeometry":i=new Oe;break;case"OctahedronBufferGeometry":i=new O;break;case"ParametricBufferGeometry":i=new Te;break;case"PlaneBufferGeometry":i=new v;break;case"PolyhedronBufferGeometry":i=new De;break;case"RingBufferGeometry":i=new Se;break;case"ShapeBufferGeometry":i=new d;break;case"TetrahedronBufferGeometry":i=new Ae;break;case"TextBufferGeometry":i=new Fe;break;case"TorusBufferGeometry":i=new Me;break;case"TorusKnotBufferGeometry":i=new Pe;break;case"TubeBufferGeometry":i=new Ee;break;case"SphereBufferGeometry":i=new xe;break;case"InstancedBufferGeometry":i=new ve;break;default:throw new Error(`TGeometriesManager: Unknown buffer geometry of type: ${t}`)}i._id=e._id,i.uuid=e.uuid,i.name=e.name;const s=e.index;if(s&&s.array&&s.array.length>0){const e=this.__convertBase64ToArrayBuffer(s.array),t=this.__convertArrayBufferToTypedArray(e);i.index=new p(t,s.itemSize,s.normalized)}const r=e.attributes;if(r){let e={};const t=r.position;if(t){const i=this.__convertBase64ToArrayBuffer(t.array),s=this.__convertArrayBufferToTypedArray(i),r=this.globalScale,n=new Float32Array(s);if("zBack"===this._projectionSystem){let e=null,t=null,i=null;for(let s=0,a=n.length;s<a;s+=3)e=n[s]/r,t=n[s+2]/r,i=-n[s+1]/r,n[s]=e,n[s+1]=t,n[s+2]=i}else for(let e=0,t=n.length;e<t;e++)n[e]/=r;e.position=new p(n,t.itemSize,t.normalized)}const s=r.normal;if(s){const t=this.__convertBase64ToArrayBuffer(s.array),i=this.__convertArrayBufferToTypedArray(t);e.normal=new p(i,s.itemSize,s.normalized)}const n=r.uv;if(n){const t=this.__convertBase64ToArrayBuffer(n.array),i=this.__convertArrayBufferToTypedArray(t);e.uv=new p(i,n.itemSize,n.normalized)}i.attributes=e}return mt(e.groups)&&(i.groups=e.groups),mt(e.boundingBox)&&(i.boundingBox=e.boundingBox),mt(e.boundingSphere)&&(i.boundingSphere=e.boundingSphere),"ShapeBufferGeometry"===t&&(i.shapes=e.shapes.map((e=>(new g).fromJSON(e))),i.curveSegments=e.curveSegments),i}__convertArrayBufferToTypedArray(e){const t=new DataView(e),i=e.byteLength-1,s=t.getUint8(0);let r=null;switch(s){case ci.Int8Array:r=new Int8Array(i/1);for(let e=0,s=1;s<i;e++,s+=1)r[e]=t.getInt8(s);break;case ci.Uint8Array:r=new Uint8Array(i/1);for(let e=0,s=1;s<i;e++,s+=1)r[e]=t.getUint8(s);break;case ci.Uint8ClampedArray:r=new Uint8ClampedArray(i/1);for(let e=0,s=1;s<i;e++,s+=1)r[e]=t.getUint8(s);break;case ci.Int16Array:r=new Int16Array(i/2);for(let e=0,s=1;s<i;e++,s+=2)r[e]=t.getInt16(s);break;case ci.Uint16Array:r=new Uint16Array(i/2);for(let e=0,s=1;s<i;e++,s+=2)r[e]=t.getUint16(s);break;case ci.Int32Array:r=new Int32Array(i/4);for(let e=0,s=1;s<i;e++,s+=4)r[e]=t.getInt32(s);break;case ci.Uint32Array:r=new Uint32Array(i/4);for(let e=0,s=1;s<i;e++,s+=4)r[e]=t.getUint32(s);break;case ci.Float32Array:r=new Float32Array(i/4);for(let e=0,s=1;s<i;e++,s+=4)r[e]=t.getFloat32(s);break;case ci.Float64Array:r=new Float64Array(i/8);for(let e=0,s=1;s<i;e++,s+=8)r[e]=t.getFloat64(s);break;default:throw new RangeError(`Invalid switch parameter: ${s}`)}return r}__convertBase64ToArrayBuffer(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=new Uint8Array(256);for(let e=0;e<t.length;e++)i[t.charCodeAt(e)]=e;const s=e.length;let r=.75*s;"="===e[s-1]&&(r--,"="===e[s-2]&&r--);let n,a,o,h,l=new ArrayBuffer(r),c=new Uint8Array(l);for(let t=0,r=0;t<s;t+=4)n=i[e.charCodeAt(t)],a=i[e.charCodeAt(t+1)],o=i[e.charCodeAt(t+2)],h=i[e.charCodeAt(t+3)],c[r++]=n<<2|a>>4,c[r++]=(15&a)<<4|o>>2,c[r++]=(3&o)<<6|63&h;return l}}
/**
 * @module Managers/TexturesManager
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class pi extends a{constructor(e={}){super({basePath:"/textures",...e})}convert(e){if(!e)throw new Error("TexturesManager: Unable to convert null or undefined data !");const t=e.type;throw new Error(`TTexturesManager: Unknown texture of type: ${t}`)}_onJson(e,t,i,s){const r=gt(e)?[e]:e,n={};for(let e,t=0,a=r.length;t<a;t++){e=r[t];try{n[e._id]=this.convert(e)}catch(e){s(e)}i(t/a)}t(n)}}
/**
 * @module Managers/MaterialsManager
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @requires TDataBaseManager
 *
 */const ui=(new Be).load("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH4gkKDRoGpGNegQAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAAMSURBVAjXY/j//z8ABf4C/tzMWecAAAAASUVORK5CYII=");class _i extends a{constructor(e={}){const t={basePath:"/materials",texturesPath:"/textures",texturesProvider:new ze,generateMipmap:!1,autoFillTextures:!0,...e};super(t),this.texturesPath=t.texturesPath,this.texturesProvider=t.texturesProvider,this.generateMipmap=t.generateMipmap,this.autoFillTextures=t.autoFillTextures}get texturesPath(){return this._texturesPath}set texturesPath(e){if(ht(e))throw new TypeError("Textures path cannot be null ! Expect a non empty string.");if(lt(e))throw new TypeError("Textures path cannot be undefined ! Expect a non empty string.");if(ft(e))throw new TypeError(`Textures path cannot be an instance of ${e.constructor.name} ! Expect a non empty string.`);if(bt(e))throw new TypeError("Textures path cannot be empty ! Expect a non empty string.");if(wt(e))throw new TypeError("Textures path cannot contain only whitespace ! Expect a non empty string.");this._texturesPath=e}get texturesProvider(){return this._texturesProvider}set texturesProvider(e){if(ht(e))throw new TypeError("Textures provider cannot be null ! Expect an instance of TextureLoader.");if(lt(e))throw new TypeError("Textures provider cannot be undefined ! Expect an instance of TextureLoader.");if(!(e instanceof pi||e instanceof ze))throw new TypeError(`Textures provider cannot be an instance of ${e.constructor.name} ! Expect an instance of TTexturesManager.`);this._texturesProvider=e}get generateMipmap(){return this._generateMipmap}set generateMipmap(e){if(ht(e))throw new TypeError("Generate mipmap cannot be null ! Expect a boolean.");if(lt(e))throw new TypeError("Generate mipmap cannot be undefined ! Expect a boolean.");if(ct(e))throw new TypeError(`Generate mipmap cannot be an instance of ${e.constructor.name} ! Expect a boolean.`);this._generateMipmap=e}get autoFillTextures(){return this._autoFillTextures}set autoFillTextures(e){if(ht(e))throw new TypeError("Global scale cannot be null ! Expect a boolean.");if(lt(e))throw new TypeError("Global scale cannot be undefined ! Expect a positive number.");if(ct(e))throw new TypeError("Global scale cannot be null ! Expect a boolean.");this._autoFillTextures=e}setTexturesPath(e){return this.texturesPath=e,this}setTexturesProvider(e){return this.texturesProvider=e,this}setGenerateMipmap(e){return this.generateMipmap=e,this}setAutoFillTextures(e){return this.autoFillTextures=e,this}_onJson(e,t,i,s){const r=gt(e)?[e]:e,n={};for(let e,t=0,a=r.length;t<a;t++){e=r[t];try{n[e._id]=this.convert(e)}catch(e){s(e)}i(new ProgressEvent("MaterialsManager",{lengthComputable:!0,loaded:t+1,total:a}))}this._autoFillTextures?this.fillTextures(n,t,i,s):t(n)}convert(e){if(!e)throw new Error("MaterialsManager: Unable to convert null or undefined data !");const t=e.type;let i=null;switch(t){case"MeshPhongMaterial":{i=new Le,this._fillBaseMaterialData(i,e);const t=e.color;mt(t)&&(i.color=this._setColor(t));const s=e.specular;mt(s)&&(i.specular=this._setColor(s));const r=e.shininess;mt(r)&&(i.shininess=r);const n=e.map;mt(n)&&(i.map=n);const a=e.lightMap;mt(a)&&(i.lightMap=a);const o=e.lightMapIntensity;mt(o)&&(i.lightMapIntensity=o);const h=e.aoMap;mt(h)&&(i.aoMap=h);const l=e.aoMapIntensity;mt(l)&&(i.aoMapIntensity=l);const c=e.emissive;mt(c)&&(i.emissive=this._setColor(c));const d=e.emissiveIntensity;mt(d)&&(i.emissiveIntensity=d);const p=e.emissiveMap;mt(p)&&(i.emissiveMap=p);const u=e.bumpMap;mt(u)&&(i.bumpMap=u);const _=e.bumpScale;mt(_)&&(i.bumpScale=_);const m=e.normalMap;mt(m)&&(i.normalMap=m);const g=e.normalScale;mt(g)&&(i.normalScale=this._setVector2(g));const f=e.displacementMap;mt(f)&&(i.displacementMap=f);const b=e.displacementScale;mt(b)&&(i.displacementScale=b);const w=e.displacementBias;mt(w)&&(i.displacementBias=w);const y=e.specularMap;mt(y)&&(i.specularMap=y);const v=e.alphaMap;mt(v)&&(i.alphaMap=v);const x=e.envMap;mt(x)&&(i.envMap=x);const E=e.combine;mt(E)&&(i.combine=E);const P=e.reflectivity;mt(P)&&(i.reflectivity=P);const M=e.refractionRatio;mt(M)&&(i.refractionRatio=M);const F=e.wireframe;mt(F)&&(i.wireframe=F);const A=e.wireframeLinewidth;mt(A)&&(i.wireframeLinewidth=A);const S=e.wireframeLinecap;mt(S)&&(i.wireframeLinecap=S);const D=e.wireframeLinejoin;mt(D)&&(i.wireframeLinejoin=D);const T=e.skinning;mt(T)&&(i.skinning=T);const O=e.morphTargets;mt(O)&&(i.morphTargets=O);const U=e.morphNormals;mt(U)&&(i.morphNormals=U)}break;case"MeshLambertMaterial":{i=new Re,this._fillBaseMaterialData(i,e);const t=e.color;mt(t)&&(i.color=this._setColor(t));const s=e.map;mt(s)&&(i.map=s);const r=e.lightMap;mt(r)&&(i.lightMap=r);const n=e.lightMapIntensity;mt(n)&&(i.lightMapIntensity=n);const a=e.aoMap;mt(a)&&(i.aoMap=a);const o=e.aoMapIntensity;mt(o)&&(i.aoMapIntensity=o);const h=e.emissive;mt(h)&&(i.emissive=this._setColor(h));const l=e.emissiveIntensity;mt(l)&&(i.emissiveIntensity=l);const c=e.emissiveMap;mt(c)&&(i.emissiveMap=c);const d=e.specularMap;mt(d)&&(i.specularMap=d);const p=e.alphaMap;mt(p)&&(i.alphaMap=p);const u=e.envMap;mt(u)&&(i.envMap=u);const _=e.combine;mt(_)&&(i.combine=_);const m=e.reflectivity;mt(m)&&(i.reflectivity=m);const g=e.refractionRatio;mt(g)&&(i.refractionRatio=g);const f=e.wireframe;mt(f)&&(i.wireframe=f);const b=e.wireframeLinewidth;mt(b)&&(i.wireframeLinewidth=b);const w=e.wireframeLinecap;mt(w)&&(i.wireframeLinecap=w);const y=e.wireframeLinejoin;mt(y)&&(i.wireframeLinejoin=y);const v=e.skinning;mt(v)&&(i.skinning=v);const x=e.morphTargets;mt(x)&&(i.morphTargets=x);const E=e.morphNormals;mt(E)&&(i.morphNormals=E)}break;case"LineBasicMaterial":{i=new A,this._fillBaseMaterialData(i,e);const t=e.color;mt(t)&&(i.color=this._setColor(t))}break;case"PointsMaterial":{i=new u,this._fillBaseMaterialData(i,e);const t=e.color;mt(t)&&(i.color=this._setColor(t));const s=e.map;mt(s)&&(i.map=s);const r=e.morphTargets;mt(r)&&(i.morphTargets=r);const n=e.size;mt(n)&&(i.size=n);const a=e.sizeAttenuation;mt(a)&&(i.sizeAttenuation=a)}break;default:throw new Error(`TMaterialsManager: Unmanaged material of type: ${t}`)}return i}_fillBaseMaterialData(e,t){const i=t._id;mt(i)&&yt(i)&&(e._id=i);const s=t.uuid;mt(s)&&yt(s)&&(e.uuid=s);const r=t.name;mt(r)&&yt(r)&&(e.name=r);const n=t.fog;mt(n)&&(e.fog=n);const a=t.lights;mt(a)&&(e.lights=a);const o=t.blending;mt(o)&&(e.blending=o);const h=t.side;mt(h)&&(e.side=h);const l=t.flatShading;mt(l)&&(e.flatShading=l);const c=t.vertexColors;mt(c)&&(e.vertexColors=c);const d=t.opacity;mt(d)&&(e.opacity=d);const p=t.transparent;mt(p)&&(e.transparent=p);const u=t.blendSrc;mt(u)&&(e.blendSrc=u);const _=t.blendDst;mt(_)&&(e.blendDst=_);const m=t.blendEquation;mt(m)&&(e.blendEquation=m);const g=t.blendSrcAlpha;mt(g)&&(e.blendSrcAlpha=g);const f=t.blendDstAlpha;mt(f)&&(e.blendDstAlpha=f);const b=t.blendEquationAlpha;mt(b)&&(e.blendEquationAlpha=b);const w=t.depthFunc;mt(w)&&(e.depthFunc=w);const y=t.depthTest;mt(y)&&(e.depthTest=y);const v=t.depthWrite;mt(v)&&(e.depthWrite=v);const x=t.clippingPlanes;mt(x)&&(e.clippingPlanes=x);const E=t.clipIntersection;mt(E)&&(e.clipIntersection=E);const P=t.clipShadows;mt(P)&&(e.clipShadows=P);const M=t.colorWrite;mt(M)&&(e.colorWrite=M);const F=t.precision;mt(F)&&(e.precision=F);const A=t.polygonOffset;mt(A)&&(e.polygonOffset=A);const S=t.polygonOffsetFactor;mt(S)&&(e.polygonOffsetFactor=S);const D=t.polygonOffsetUnits;mt(D)&&(e.polygonOffsetUnits=D);const T=t.dithering;mt(T)&&(e.dithering=T);const O=t.alphaTest;mt(O)&&(e.alphaTest=O);const U=t.premultipliedAlpha;mt(U)&&(e.premultipliedAlpha=U);const I=t.overdraw;mt(I)&&(e.overdraw=I);const C=t.visible;mt(C)&&(e.visible=C);const k=t.userData;mt(k)&&(e.userData=k);const B=t.needsUpdate;mt(B)&&(e.needsUpdate=B)}_setVector2(e){const t=e.x,i=e.y;if(pt(t)||pt(i))throw new Error("MaterialsManager: Unable to convert null or undefined vector 2 !");return new w(t,i)}_setColor(e){const t=e.r,i=e.g,s=e.b;if(pt(t)||pt(i)||pt(s))throw new Error("MaterialsManager: Unable to convert null or undefined color !");return new Ge(t,i,s)}fillTextures(e,t){const i=this._retrieveTexturesOf(e);for(let t in e){const s=e[t],r=i[t];for(let e in r)s[e]=r[e]}t(e)}_retrieveTexturesOf(e){const t=["map","lightMap","aoMap","emissiveMap","bumpMap","normalMap","displacementMap","specularMap","alphaMap","envMap"],i={},s={};for(let r in e){const n=e[r];let a={};for(let e=0,i=t.length;e<i;e++){let i=t[e];const r=n[i];if(mt(r)&&yt(r)&&vt(r)){const e=`${this._texturesPath}/${r}`,t=s[e];if(mt(t))a[i]=t;else{const t=this._texturesProvider.load(e,(()=>{}),(()=>{}),(()=>{t.image||(t.image=ui,t.needsUpdate=!0)}));t.name=r,this._generateMipmap||(t.generateMipmaps=!1,t.magFilter=He,t.minFilter=He),s[e]=t,a[i]=t}}}i[r]=a}return i}}
/**
 * @module Managers/ObjectsManager
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 */class mi extends a{constructor(e={}){const t={basePath:"/objects",geometriesProvider:new di,materialsProvider:new _i,projectionSystem:"zBack",globalScale:1,autoFillObjects3D:!0,...e};super(t),this.geometriesProvider=t.geometriesProvider,this.materialsProvider=t.materialsProvider,this.projectionSystem=t.projectionSystem,this.globalScale=t.globalScale,this.autoFillObjects3D=t.autoFillObjects3D}get geometriesProvider(){return this._geometriesProvider}set geometriesProvider(e){if(ht(e))throw new TypeError("Geometries provider cannot be null ! Expect an instance of GeometriesManager.");if(lt(e))throw new TypeError("Geometries provider cannot be undefined ! Expect an instance of GeometriesManager.");if(!(e instanceof di))throw new TypeError(`Geometries provider cannot be an instance of ${e.constructor.name} ! Expect an instance of TGeometriesManager.`);this._geometriesProvider=e}get materialsProvider(){return this._materialsProvider}set materialsProvider(e){if(ht(e))throw new TypeError("Materials provider cannot be null ! Expect an instance of MaterialsManager.");if(lt(e))throw new TypeError("Materials provider cannot be undefined ! Expect an instance of MaterialsManager.");if(!(e instanceof _i))throw new TypeError(`Materials provider cannot be an instance of ${e.constructor.name} ! Expect an instance of TMaterialsManager.`);this._materialsProvider=e}get projectionSystem(){return this._projectionSystem}set projectionSystem(e){if(ht(e))throw new TypeError("Projection system cannot be null ! Expect a positive number.");if(lt(e))throw new TypeError("Projection system cannot be undefined ! Expect a positive number.");this._projectionSystem=e}get globalScale(){return this._globalScale}set globalScale(e){if(ht(e))throw new TypeError("Global scale cannot be null ! Expect a positive number.");if(lt(e))throw new TypeError("Global scale cannot be undefined ! Expect a positive number.");this._globalScale=e}get autoFillObjects3D(){return this._autoFillObjects3D}set autoFillObjects3D(e){if(ht(e))throw new TypeError("Global scale cannot be null ! Expect a boolean.");if(lt(e))throw new TypeError("Global scale cannot be undefined ! Expect a positive number.");if(ct(e))throw new TypeError("Global scale cannot be null ! Expect a boolean.");this._autoFillObjects3D=e}setGeometriesProvider(e){return this.geometriesProvider=e,this}setMaterialsProvider(e){return this.materialsProvider=e,this}setProjectionSystem(e){return this.projectionSystem=e,this}setGlobalScale(e){return this.globalScale=e,this}setAutoFillObjects3D(e){return this.autoFillObjects3D=e,this}_onJson(e,t,i,s){const r={};for(let t,n=0,a=e.length;n<a;n++){t=e[n];try{r[t._id]=this.convert(t)}catch(e){s(e)}i(new ProgressEvent("ObjectsManager",{lengthComputable:!0,loaded:n+1,total:a}))}this._autoFillObjects3D?this.fillObjects3D(r,t,i,s):t(r)}_onArrayBuffer(e,t,i,s){}_onBlob(e,t,i,s){}_onText(e,t,i,s){}convert(e){if(!e)throw new Error("ObjectsManager: Unable to convert null or undefined data !");const t=e.type;let i=null;switch(t){case"Object3D":i=new b,this._fillBaseObjectsData(i,e);break;case"Scene":i=new et,this._fillBaseObjectsData(i,e),mt(e.background)&&Number.isInteger(e.background)&&(i.background=new Ge(e.background)),mt(e.fog)&&("Fog"===e.fog.type?i.fog=new tt(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(i.fog=new it(e.fog.color,e.fog.density))),i.overrideMaterial=e.overrideMaterial,i.autoUpdate=e.autoUpdate;break;case"PerspectiveCamera":i=new Je,this._fillBaseObjectsData(i,e),i.fov=e.fov,i.aspect=e.aspect,i.near=e.near,i.far=e.far,mt(e.focus)&&(i.focus=e.focus),mt(e.zoom)&&(i.zoom=e.zoom),mt(e.filmGauge)&&(i.filmGauge=e.filmGauge),mt(e.filmOffset)&&(i.filmOffset=e.filmOffset),mt(e.view)&&(i.view=Object.assign({},e.view));break;case"OrthographicCamera":i=new Qe(e.left,e.right,e.top,e.bottom,e.near,e.far),this._fillBaseObjectsData(i,e);break;case"AmbientLight":i=new Ke(e.color,e.intensity),this._fillBaseObjectsData(i,e);break;case"DirectionalLight":i=new qe(e.color,e.intensity),this._fillBaseObjectsData(i,e);break;case"PointLight":i=new $e(e.color,e.intensity,e.distance,e.decay),this._fillBaseObjectsData(i,e);break;case"RectAreaLight":i=new We(e.color,e.intensity,e.width,e.height),this._fillBaseObjectsData(i,e);break;case"SpotLight":i=new Ve(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),this._fillBaseObjectsData(i,e);break;case"HemisphereLight":i=new Ze(e.color,e.groundColor,e.intensity),this._fillBaseObjectsData(i,e);break;case"SkinnedMesh":i=new Xe,this._fillBaseObjectsData(i,e),i.geometry=e.geometry,i.material=e.material,i.drawMode=e.drawMode,i.bindMode=e.bindMode,i.bindMatrix=e.bindMatrix,i.bindMatrixInverse=e.bindMatrixInverse;break;case"Mesh":i=new P,this._fillBaseObjectsData(i,e),i.geometry=e.geometry,i.material=e.material,i.drawMode=e.drawMode;break;case"LOD":i=new Ye,this._fillBaseObjectsData(i,e),i.levels=e.levels;break;case"Line":i=new D,this._fillBaseObjectsData(i,e),i.geometry=e.geometry,i.material=e.material,i.drawMode=e.drawMode;break;case"LineLoop":i=new je,this._fillBaseObjectsData(i,e),i.geometry=e.geometry,i.material=e.material,i.drawMode=e.drawMode;break;case"LineSegments":i=new I,this._fillBaseObjectsData(i,e),i.geometry=e.geometry,i.material=e.material,i.drawMode=e.drawMode;break;case"Points":i=new _,this._fillBaseObjectsData(i,e),i.geometry=e.geometry,i.material=e.material,i.drawMode=e.drawMode;break;case"Sprite":i=new Ne,this._fillBaseObjectsData(i,e),i.material=e.material;break;case"Group":i=new c,this._fillBaseObjectsData(i,e);break;default:throw new Error(`TObjectsManager: Unknown object of type: ${t}`)}return i}_fillBaseObjectsData(e,t){e._id=t._id,mt(t.uuid)&&(e.uuid=t.uuid),mt(t.name)&&(e.name=t.name),mt(t.parent)&&(e.parent=t.parent),xt(t.children)&&(e.children=t.children),mt(t.up)&&(e.up.x=t.up.x,e.up.y=t.up.y,e.up.z=t.up.z),mt(t.position)&&("zBack"===this._projectionSystem?(e.position.x=t.position.x/this._globalScale,e.position.y=t.position.z/this._globalScale,e.position.z=-t.position.y/this._globalScale):(e.position.x=t.position.x/this._globalScale,e.position.y=t.position.y/this._globalScale,e.position.z=t.position.z/this._globalScale)),mt(t.rotation)&&("zBack"===this._projectionSystem?(e.rotation.x=t.rotation.x,e.rotation.y=t.rotation.z,e.rotation.z=-t.rotation.y,e.rotation.order=t.rotation.order):(e.rotation.x=t.rotation.x,e.rotation.y=t.rotation.y,e.rotation.z=t.rotation.z,e.rotation.order=t.rotation.order)),mt(t.quaternion)&&("zBack"===this._projectionSystem?(e.quaternion.x=t.quaternion.x,e.quaternion.y=t.quaternion.z,e.quaternion.z=-t.quaternion.y,e.quaternion.w=t.quaternion.w):(e.quaternion.x=t.quaternion.x,e.quaternion.y=t.quaternion.y,e.quaternion.z=t.quaternion.z,e.quaternion.w=t.quaternion.w)),mt(t.scale)&&(0!==t.scale.x&&0!==t.scale.y&&0!==t.scale.z?(e.scale.x=t.scale.x,e.scale.y=t.scale.y,e.scale.z=t.scale.z):this.logger.warn("Try to assign null scale !")),mt(t.modelViewMatrix)&&xt(t.modelViewMatrix)&&e.modelViewMatrix.fromArray(t.modelViewMatrix),mt(t.normalMatrix)&&xt(t.normalMatrix)&&e.normalMatrix.fromArray(t.normalMatrix),mt(t.matrix)&&xt(t.matrix)&&e.matrix.fromArray(t.matrix),mt(t.matrixWorld)&&xt(t.matrixWorld)&&e.matrixWorld.fromArray(t.matrixWorld),mt(t.matrixAutoUpdate)&&(e.matrixAutoUpdate=t.matrixAutoUpdate),mt(t.matrixWorldNeedsUpdate)&&(e.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate),mt(t.layers)&&(e.layers.mask=t.layers),mt(t.visible)&&(e.visible=t.visible),mt(t.castShadow)&&(e.castShadow=t.castShadow),mt(t.receiveShadow)&&(e.receiveShadow=t.receiveShadow),mt(t.frustumCulled)&&(e.frustumCulled=t.frustumCulled),mt(t.renderOrder)&&(e.renderOrder=t.renderOrder),mt(t.userData)&&(e.userData=t.userData)}fillObjects3D(e,t,i,s){const r=this,n=[];for(let t in e){const i=e[t];(i.geometry||i.material)&&n.push(e[t])}if(0===n.length)return void t(e);let a,o;function h(){if(a&&o){for(let t in e){const i=e[t];r.applyGeometry(i,a),r.applyMaterials(i,o)}t(e)}}this._retrieveGeometriesOf(n,(e=>{a=e,h()}),i,s),this._retrieveMaterialsOf(n,(e=>{o=e,h()}),i,s)}_retrieveGeometriesOf(e,t,i,s){const r=e.map((e=>e.geometry)).filter(((e,t,i)=>e&&i.indexOf(e)===t));0!==r.length?this._geometriesProvider.read(r,null,t,i,s):t({})}_retrieveMaterialsOf(e,t,i,s){const r=e.map((e=>e.material)),n=[].concat.apply([],r).filter(((e,t,i)=>e&&i.indexOf(e)===t));0!==n.length?this._materialsProvider.read(n,null,t,i,s):t({})}applyGeometry(e,t){const i=e.geometry;if(!i)return;const s=t[i];s?e.geometry=s:this.logger.error("Unable to retrieve geometry !!!")}applyMaterials(e,t){const i=e.material;if(i)if(Array.isArray(i))if(1===i.length){const s=t[i[0]];if(!s)return this.logger.error("Unable to retrieve material !!!"),null;e.material=s.clone()}else{e.material=[];for(let s=0,r=i.length;s<r;s++){const r=t[i[s]];if(!r)return this.logger.error("Unable to retrieve material !!!"),null;e.material.push(r.clone())}}else if("string"==typeof i){const s=t[i];if(!s)return void this.logger.error("Unable to retrieve material !!!");e.material=s.clone()}else this.logger.error("Invalid material ids, expected string or array of string")}}
/**
 * @module Objects3D/OrbitControlsHelper
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 */class gi extends I{constructor(e={}){const t={radius:2,radials:16,circles:2,divisions:64,innerColor:new Ge(4473924),outerColor:new Ge(8947848),...e};super(gi._createInternalGeometry(t.radius,t.radials,t.circles,t.divisions,t.innerColor,t.outerColor),gi._createInternalMaterial()),this.matrixAutoUpdate=!1,this._intervalId=void 0}static _createInternalGeometry(e,t,i,s,r,n){const a=[],o=[];let h,l,c,p,u,_,m;for(p=0;p<=t;p++)c=p/t*(2*Math.PI),h=Math.sin(c)*e,l=Math.cos(c)*e,a.push(0,0,0),a.push(h,0,l),m=1&p?r:n,o.push(m.r,m.g,m.b),o.push(m.r,m.g,m.b);for(p=0;p<=i;p++){for(m=1&p?r:n,_=e-e/i*p,u=0;u<s;u++)c=u/s*(2*Math.PI),h=Math.sin(c)*_,l=Math.cos(c)*_,a.push(h,0,l),o.push(m.r,m.g,m.b),c=(u+1)/s*(2*Math.PI),h=Math.sin(c)*_,l=Math.cos(c)*_,a.push(h,0,l),o.push(m.r,m.g,m.b);a.push(-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1),o.push(0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1)}const g=new S(a,3);g.name="TOrbitControlsHelperPositionBufferAttribute";const f=new S(o,3);f.name="TOrbitControlsHelperColorBufferAttribute";const b=new d;return b.setAttribute("position",g),b.setAttribute("color",f),b.name="TOrbitControlsHelperGeometry",b}static _createInternalMaterial(){const e=new A({vertexColors:st});return e.transparent=!0,e.opacity=0,e.name="TOrbitControlsHelperMaterial",e}startOpacityAnimation(){void 0!==this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this.material.opacity=1}endOpacityAnimation(){this._intervalId=setInterval(function(){this.material.opacity<=0?(this.material.opacity=0,clearInterval(this._intervalId),this._intervalId=void 0):this.material.opacity-=.1}.bind(this),100)}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class fi extends Xt{constructor(e={}){super({geometry:new Me(1,.12,4,12,Math.PI),...e}),this.isTorusHitbox=!0,this.type="TorusHitbox"}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class bi extends jt{constructor(){super(),this.isRotateGizmo=!0,this.type="RotateGizmo";const e=(e,t,i)=>{const s=new d;let r=[];i=i||1;for(let s=0;s<=64*i;++s)"x"===t&&r.push(0,Math.cos(s/32*Math.PI)*e,Math.sin(s/32*Math.PI)*e),"y"===t&&r.push(Math.cos(s/32*Math.PI)*e,0,Math.sin(s/32*Math.PI)*e),"z"===t&&r.push(Math.sin(s/32*Math.PI)*e,Math.cos(s/32*Math.PI)*e,0);return s.setAttribute("position",new S(r,3)),s};this.handleGizmos={X:[[new D(new e(1,"x",.5),new Vt({color:16711680}))],[new P(new O(.04,0),new Wt({color:16711680})),[0,0,.99],null,[3,1,1]]],Y:[[new D(new e(1,"y",.5),new Vt({color:65280}))],[new P(new O(.04,0),new Wt({color:65280})),[0,0,.99],null,[3,1,1]]],Z:[[new D(new e(1,"z",.5),new Vt({color:255}))],[new P(new O(.04,0),new Wt({color:255})),[.99,0,0],null,[1,3,1]]],E:[[new D(new e(1.25,"z",1),new Vt({color:13421568}))]],XYZ:[[new D(new e(1,"z",1),new Vt({color:7895160}))]]},this.pickerGizmos={X:[[new fi,[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new fi,[0,0,0],[Math.PI/2,0,0]]],Z:[[new fi,[0,0,0],[0,0,-Math.PI/2]]],E:[[new fi({radius:1.25,tube:.12,radialSegments:2,tubularSegments:24})]],XYZ:[[new fi]]},this._setupHandles(this.handleGizmos)}raycast(e,t){if(e.intersectObject(this.intersectPlane,!0).length>0)for(let i of this.children)i.name!==this.intersectPlane.name&&i.raycast(e,t)}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class wi extends Xt{constructor(e={}){super({geometry:new k(1,1,1,1,1,1),...e}),this.isBoxHitbox=!0,this.type="BoxHitbox"}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class yi extends Yt{constructor(e={}){const t={boxColor:1067907,edgesColor:1193046,hitbox:new wi({geometry:new k(1.1,1.1,1.1,1,1,1)}),...e};super(t),this.isOmnidirectionalHandle=!0,this.type="OmnidirectionalHandle";const i=new k(1,1,1,1,1,1);i.name="BoxHandle_Box_Geometry";const s=new Wt({color:t.boxColor,transparent:!1,opacity:1});s.name="BoxHandle_Box_Material";const r=new P(i,s);r.name="BoxHandle_Box",r.matrixAutoUpdate=!1,this.add(r);const n=new U(i);n.name="BoxHandle_Edges_Geometry";const a=new Vt({color:t.edgesColor,linewidth:4,transparent:!1,opacity:1});a.name="BoxHandle_Edges_Material";const o=new I(n,a);o.name="BoxHandle_Edges",o.matrixAutoUpdate=!1,this.add(o)}update(e){super.update(e),this.updateMatrix(),this.hitbox.updateMatrix()}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class vi extends Yt{constructor(e={}){const t={coneColor:1067907,edgesColor:1193046,hitbox:new wi({geometry:new T(1.1,1.1)}),...e};super(t),this.isOmnidirectionalHandle=!0,this.type="OmnidirectionalHandle";const i=new T(1,1);i.name="ConeHandle_Cone_Geometry";const s=new Wt({color:t.coneColor,transparent:!1,opacity:1});s.name="ConeHandle_Cone_Material";const r=new P(i,s);r.name="ConeHandle_Cone",r.matrixAutoUpdate=!0,this.add(r)}update(e){super.update(e),this.updateMatrix(),this.hitbox.updateMatrix()}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class xi extends jt{constructor(e={}){const t={boxColor:11119017,edgesColor:13882323,...e};super(t),this.isLookAtGizmo=!0,this.type="LookAtGizmo",this.explodeFactor=.25,this.handleGizmos={FACE_RIGHT:new vi({coneColor:14483456}).setPosition(+(4+this.explodeFactor),0,0).setRotationFromAxisAndAngle(new m(0,0,1),ot(90)).setScale(1,4,1),FACE_LEFT:new vi({coneColor:5570560}).setPosition(-(4+this.explodeFactor),0,0).setRotationFromAxisAndAngle(new m(0,0,1),ot(-90)).setScale(1,4,1),FACE_TOP:new vi({coneColor:221}).setPosition(0,+(4+this.explodeFactor),0).setRotationFromAxisAndAngle(new m(1,0,0),ot(180)).setScale(1,4,1),FACE_BOTTOM:new vi({coneColor:85}).setPosition(0,-(4+this.explodeFactor),0).setScale(1,4,1),FACE_FRONT:new vi({coneColor:21760}).setPosition(0,0,+(4+this.explodeFactor)).setRotationFromAxisAndAngle(new m(1,0,0),ot(-90)).setScale(1,4,1),FACE_BACK:new vi({coneColor:56576}).setPosition(0,0,-(4+this.explodeFactor)).setRotationFromAxisAndAngle(new m(1,0,0),ot(90)).setScale(1,4,1),CORNER_TOP_LEFT_FRONT:new yi(t).setPosition(-(2+this.explodeFactor),+(2+this.explodeFactor),+(2+this.explodeFactor)),CORNER_TOP_LEFT_BACK:new yi(t).setPosition(-(2+this.explodeFactor),+(2+this.explodeFactor),-(2+this.explodeFactor)),CORNER_TOP_RIGHT_FRONT:new yi(t).setPosition(+(2+this.explodeFactor),+(2+this.explodeFactor),+(2+this.explodeFactor)),CORNER_TOP_RIGHT_BACK:new yi(t).setPosition(+(2+this.explodeFactor),+(2+this.explodeFactor),-(2+this.explodeFactor)),CORNER_BOTTOM_LEFT_FRONT:new yi(t).setPosition(-(2+this.explodeFactor),-(2+this.explodeFactor),+(2+this.explodeFactor)),CORNER_BOTTOM_LEFT_BACK:new yi(t).setPosition(-(2+this.explodeFactor),-(2+this.explodeFactor),-(2+this.explodeFactor)),CORNER_BOTTOM_RIGHT_FRONT:new yi(t).setPosition(+(2+this.explodeFactor),-(2+this.explodeFactor),+(2+this.explodeFactor)),CORNER_BOTTOM_RIGHT_BACK:new yi(t).setPosition(+(2+this.explodeFactor),-(2+this.explodeFactor),-(2+this.explodeFactor)),EDGE_TOP_FRONT:new yi(t).setPosition(0,+(2+this.explodeFactor),+(2+this.explodeFactor)).setScale(3,1,1),EDGE_TOP_LEFT:new yi(t).setPosition(-(2+this.explodeFactor),+(2+this.explodeFactor),0).setScale(1,1,3),EDGE_TOP_BACK:new yi(t).setPosition(0,+(2+this.explodeFactor),-(2+this.explodeFactor)).setScale(3,1,1),EDGE_TOP_RIGHT:new yi(t).setPosition(+(2+this.explodeFactor),+(2+this.explodeFactor),0).setScale(1,1,3),EDGE_LEFT_FRONT:new yi(t).setPosition(-(2+this.explodeFactor),0,+(2+this.explodeFactor)).setScale(1,3,1),EDGE_LEFT_BACK:new yi(t).setPosition(-(2+this.explodeFactor),0,-(2+this.explodeFactor)).setScale(1,3,1),EDGE_RIGHT_FRONT:new yi(t).setPosition(+(2+this.explodeFactor),0,+(2+this.explodeFactor)).setScale(1,3,1),EDGE_RIGHT_BACK:new yi(t).setPosition(+(2+this.explodeFactor),0,-(2+this.explodeFactor)).setScale(1,3,1),EDGE_BOTTOM_FRONT:new yi(t).setPosition(0,-(2+this.explodeFactor),+(2+this.explodeFactor)).setScale(3,1,1),EDGE_BOTTOM_LEFT:new yi(t).setPosition(-(2+this.explodeFactor),-(2+this.explodeFactor),0).setScale(1,1,3),EDGE_BOTTOM_BACK:new yi(t).setPosition(0,-(2+this.explodeFactor),-(2+this.explodeFactor)).setScale(3,1,1),EDGE_BOTTOM_RIGHT:new yi(t).setPosition(+(2+this.explodeFactor),-(2+this.explodeFactor),0).setScale(1,1,3)},this._setupHandles(this.handleGizmos)}raycast(e,t){if(e.intersectObject(this.intersectPlane,!0).length>0)for(let i of this.children)i.raycast(e,t)}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Ei extends Yt{constructor(e={}){super({...e}),this.isRotateHandle=!0,this.type="RotateHandle"}update(e){super.update(e),this.updateMatrix(),this.hitbox.updateMatrix()}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Pi extends Xt{constructor(e={}){super({geometry:new xe(1,8,6,0,2*Math.PI,0,Math.PI),...e}),this.isSphericalHitbox=!0,this.type="SphericalHitbox"}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Mi extends P{constructor(e,t={}){super(e,new Wt({color:t.color,transparent:!0,opacity:.55})),this.isHighlightableMesh=!0,this.type="HighlightableMesh"}highlight(e){this.material.highlight(e)}}export{Et as ASCLoader,jt as AbstractGizmo,Yt as AbstractHandle,Xt as AbstractHitbox,Ht as CameraControlMode,Nt as CameraControls,ai as ClippingBox,hi as ClippingControls,oi as ClippingModes,li as CurvesManager,Zt as CylindricaHitbox,Ft as DBFLoader,di as GeometriesManager,Mi as HighlightableMesh,Ot as LASLoader,xi as LookAtGizmo,Qt as LozengeHandle,Kt as LozengeHitbox,_i as MaterialsManager,mi as ObjectsManager,ei as OctahedricalHandle,Jt as OctahedricalHitbox,gi as OrbitControlsHelper,ii as PlanarHitbox,si as PlaneHandle,bi as RotateGizmo,Ei as RotateHandle,It as SHPLoader,ni as ScaleGizmo,ri as ScaleHandle,Ut as ShapeType,Pi as SphericalHitbox,pi as TexturesManager,fi as TorusHitbox,ti as TranslateGizmo,qt as TranslateHandle};
