import{toEnum as e,ringClockwise as t,ringContainsSome as i,degreesToRadians as s}from"itee-utils";import{OneHalf as r,SquareRootOfThreeOnTwo as n,SquareRootOfTwoOnTwo as a,DefaultLogger as o}from"itee-core";import{DefaultLoadingManager as h,Box3 as l,FileLoader as c,Group as d,BufferGeometry as u,BufferAttribute as p,PointsMaterial as _,Points as g,Vector3 as m,Shape as f,EventDispatcher as w,Object3D as b,Vector2 as y,Spherical as x,LineBasicMaterial as v,MeshBasicMaterial as M,DoubleSide as E,Mesh as S,OctahedronBufferGeometry as P,Quaternion as F,EdgesGeometry as A,LineSegments as O,Float32BufferAttribute as C,Line as D,ArrowHelper as z,CylinderBufferGeometry as T,BoxBufferGeometry as k,PlaneBufferGeometry as B,ConeBufferGeometry as I,Plane as U,Raycaster as R,Euler as L,SplineCurve as G,QuadraticBezierCurve3 as H,QuadraticBezierCurve as N,Path as j,LineCurve3 as Y,LineCurve as W,EllipseCurve as X,CurvePath as Z,Curve as V,CubicBezierCurve3 as q,CubicBezierCurve as K,CatmullRomCurve3 as $,ArcCurve as Q,WireframeGeometry as J,SphereGeometry as ee,TubeGeometry as te,TorusKnotGeometry as ie,TorusGeometry as se,TextGeometry as re,TetrahedronGeometry as ne,ShapeGeometry as ae,RingGeometry as oe,PolyhedronGeometry as he,PlaneGeometry as le,ParametricGeometry as ce,OctahedronGeometry as de,LatheGeometry as ue,IcosahedronGeometry as pe,Geometry as _e,ExtrudeGeometry as ge,DodecahedronGeometry as me,ConeGeometry as fe,CylinderGeometry as we,CircleGeometry as be,BoxGeometry as ye,Face3 as xe,InstancedBufferGeometry as ve,SphereBufferGeometry as Me,TubeBufferGeometry as Ee,TorusKnotBufferGeometry as Se,TorusBufferGeometry as Pe,TextBufferGeometry as Fe,TetrahedronBufferGeometry as Ae,RingBufferGeometry as Oe,PolyhedronBufferGeometry as Ce,ParametricBufferGeometry as De,LatheBufferGeometry as ze,IcosahedronBufferGeometry as Te,ExtrudeBufferGeometry as ke,DodecahedronBufferGeometry as Be,CircleBufferGeometry as Ie,TextureLoader as Ue,MeshLambertMaterial as Re,MeshPhongMaterial as Le,Color as Ge,ImageLoader as He,LinearFilter as Ne,Sprite as je,LineLoop as Ye,LOD as We,SkinnedMesh as Xe,HemisphereLight as Ze,SpotLight as Ve,RectAreaLight as qe,PointLight as Ke,DirectionalLight as $e,AmbientLight as Qe,OrthographicCamera as Je,PerspectiveCamera as et,Scene as tt,Fog as it,FogExp2 as st,VertexColors as rt}from"three-full";import{TBinaryReader as nt,Endianness as at,Byte as ot,Keys as ht,Mouse as lt,TDataBaseManager as ct}from"itee-client";import{isDefined as dt,isNull as ut,isUndefined as pt,isNotBoolean as _t,isEmptyArray as gt,isNotDefined as mt,isNotArray as ft,isArray as wt,isObject as bt,isNotString as yt,isEmptyString as xt,isBlankString as vt,isString as Mt,isNotEmptyString as Et,isNotEmptyArray as St}from"itee-validators";
/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Pt="srgb",Ft="srgb-linear";function At(e,t,i){return Math.max(t,Math.min(i,e))}function Ot(e,t,i){return(1-i)*e+i*t}function Ct(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Dt(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}const zt={[Pt]:{[Ft]:Ct},[Ft]:{[Pt]:Dt}},Tt={legacyMode:!0,get workingColorSpace(){return Ft},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,i){if(this.legacyMode||t===i||!t||!i)return e;if(zt[t]&&void 0!==zt[t][i]){const s=zt[t][i];return e.r=s(e.r),e.g=s(e.g),e.b=s(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},kt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Bt={r:0,g:0,b:0},It={h:0,s:0,l:0},Ut={h:0,s:0,l:0};function Rt(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}function Lt(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}class Gt{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Pt){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Tt.toWorkingColorSpace(this,t),this}setRGB(e,t,i,s=Tt.workingColorSpace){return this.r=e,this.g=t,this.b=i,Tt.toWorkingColorSpace(this,s),this}setHSL(e,t,i,s=Tt.workingColorSpace){var r;if(e=(e%(r=1)+r)%r,t=At(t,0,1),i=At(i,0,1),0===t)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+t):i+t-i*t,r=2*i-s;this.r=Rt(r,s,e+1/3),this.g=Rt(r,s,e),this.b=Rt(r,s,e-1/3)}return Tt.toWorkingColorSpace(this,s),this}setStyle(e,t=Pt){function i(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let s;if(s=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const r=s[1],n=s[2];switch(r){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,Tt.toWorkingColorSpace(this,t),i(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,Tt.toWorkingColorSpace(this,t),i(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n)){const s=parseFloat(e[1])/360,r=parseFloat(e[2])/100,n=parseFloat(e[3])/100;return i(e[4]),this.setHSL(s,r,n,t)}}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=s[1],i=e.length;if(3===i)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,Tt.toWorkingColorSpace(this,t),this;if(6===i)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,Tt.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=Pt){const i=kt[e.toLowerCase()];return void 0!==i?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Ct(e.r),this.g=Ct(e.g),this.b=Ct(e.b),this}copyLinearToSRGB(e){return this.r=Dt(e.r),this.g=Dt(e.g),this.b=Dt(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Pt){return Tt.fromWorkingColorSpace(Lt(this,Bt),e),At(255*Bt.r,0,255)<<16^At(255*Bt.g,0,255)<<8^At(255*Bt.b,0,255)}getHexString(e=Pt){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Tt.workingColorSpace){Tt.fromWorkingColorSpace(Lt(this,Bt),t);const i=Bt.r,s=Bt.g,r=Bt.b,n=Math.max(i,s,r),a=Math.min(i,s,r);let o,h;const l=(a+n)/2;if(a===n)o=0,h=0;else{const e=n-a;switch(h=l<=.5?e/(n+a):e/(2-n-a),n){case i:o=(s-r)/e+(s<r?6:0);break;case s:o=(r-i)/e+2;break;case r:o=(i-s)/e+4}o/=6}return e.h=o,e.s=h,e.l=l,e}getRGB(e,t=Tt.workingColorSpace){return Tt.fromWorkingColorSpace(Lt(this,Bt),t),e.r=Bt.r,e.g=Bt.g,e.b=Bt.b,e}getStyle(e=Pt){return Tt.fromWorkingColorSpace(Lt(this,Bt),e),e!==Pt?`color(${e} ${Bt.r} ${Bt.g} ${Bt.b})`:`rgb(${255*Bt.r|0},${255*Bt.g|0},${255*Bt.b|0})`}offsetHSL(e,t,i){return this.getHSL(It),It.h+=e,It.s+=t,It.l+=i,this.setHSL(It.h,It.s,It.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(It),e.getHSL(Ut);const i=Ot(It.h,Ut.h,t),s=Ot(It.s,Ut.s,t),r=Ot(It.l,Ut.l,t);return this.setHSL(i,s,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}Gt.NAMES=kt;class Ht{constructor(e=0,t=0,i=0,s=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=s}static slerpFlat(e,t,i,s,r,n,a){let o=i[s+0],h=i[s+1],l=i[s+2],c=i[s+3];const d=r[n+0],u=r[n+1],p=r[n+2],_=r[n+3];if(0===a)return e[t+0]=o,e[t+1]=h,e[t+2]=l,void(e[t+3]=c);if(1===a)return e[t+0]=d,e[t+1]=u,e[t+2]=p,void(e[t+3]=_);if(c!==_||o!==d||h!==u||l!==p){let e=1-a;const t=o*d+h*u+l*p+c*_,i=t>=0?1:-1,s=1-t*t;if(s>Number.EPSILON){const r=Math.sqrt(s),n=Math.atan2(r,t*i);e=Math.sin(e*n)/r,a=Math.sin(a*n)/r}const r=a*i;if(o=o*e+d*r,h=h*e+u*r,l=l*e+p*r,c=c*e+_*r,e===1-a){const e=1/Math.sqrt(o*o+h*h+l*l+c*c);o*=e,h*=e,l*=e,c*=e}}e[t]=o,e[t+1]=h,e[t+2]=l,e[t+3]=c}static multiplyQuaternionsFlat(e,t,i,s,r,n){const a=i[s],o=i[s+1],h=i[s+2],l=i[s+3],c=r[n],d=r[n+1],u=r[n+2],p=r[n+3];return e[t]=a*p+l*c+o*u-h*d,e[t+1]=o*p+l*d+h*c-a*u,e[t+2]=h*p+l*u+a*d-o*c,e[t+3]=l*p-a*c-o*d-h*u,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,s){return this._x=e,this._y=t,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const i=e._x,s=e._y,r=e._z,n=e._order,a=Math.cos,o=Math.sin,h=a(i/2),l=a(s/2),c=a(r/2),d=o(i/2),u=o(s/2),p=o(r/2);switch(n){case"XYZ":this._x=d*l*c+h*u*p,this._y=h*u*c-d*l*p,this._z=h*l*p+d*u*c,this._w=h*l*c-d*u*p;break;case"YXZ":this._x=d*l*c+h*u*p,this._y=h*u*c-d*l*p,this._z=h*l*p-d*u*c,this._w=h*l*c+d*u*p;break;case"ZXY":this._x=d*l*c-h*u*p,this._y=h*u*c+d*l*p,this._z=h*l*p+d*u*c,this._w=h*l*c-d*u*p;break;case"ZYX":this._x=d*l*c-h*u*p,this._y=h*u*c+d*l*p,this._z=h*l*p-d*u*c,this._w=h*l*c+d*u*p;break;case"YZX":this._x=d*l*c+h*u*p,this._y=h*u*c+d*l*p,this._z=h*l*p-d*u*c,this._w=h*l*c-d*u*p;break;case"XZY":this._x=d*l*c-h*u*p,this._y=h*u*c-d*l*p,this._z=h*l*p+d*u*c,this._w=h*l*c+d*u*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+n)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,s=Math.sin(i);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],s=t[4],r=t[8],n=t[1],a=t[5],o=t[9],h=t[2],l=t[6],c=t[10],d=i+a+c;if(d>0){const e=.5/Math.sqrt(d+1);this._w=.25/e,this._x=(l-o)*e,this._y=(r-h)*e,this._z=(n-s)*e}else if(i>a&&i>c){const e=2*Math.sqrt(1+i-a-c);this._w=(l-o)/e,this._x=.25*e,this._y=(s+n)/e,this._z=(r+h)/e}else if(a>c){const e=2*Math.sqrt(1+a-i-c);this._w=(r-h)/e,this._x=(s+n)/e,this._y=.25*e,this._z=(o+l)/e}else{const e=2*Math.sqrt(1+c-i-a);this._w=(n-s)/e,this._x=(r+h)/e,this._y=(o+l)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(At(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(0===i)return this;const s=Math.min(1,t/i);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,s=e._y,r=e._z,n=e._w,a=t._x,o=t._y,h=t._z,l=t._w;return this._x=i*l+n*a+s*h-r*o,this._y=s*l+n*o+r*a-i*h,this._z=r*l+n*h+i*o-s*a,this._w=n*l-i*a-s*o-r*h,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const i=this._x,s=this._y,r=this._z,n=this._w;let a=n*e._w+i*e._x+s*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=n,this._x=i,this._y=s,this._z=r,this;const o=1-a*a;if(o<=Number.EPSILON){const e=1-t;return this._w=e*n+t*this._w,this._x=e*i+t*this._x,this._y=e*s+t*this._y,this._z=e*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const h=Math.sqrt(o),l=Math.atan2(h,a),c=Math.sin((1-t)*l)/h,d=Math.sin(t*l)/h;return this._w=n*c+this._w*d,this._x=i*c+this._x*d,this._y=s*c+this._y*d,this._z=r*c+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),s=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(s),i*Math.sin(r),i*Math.cos(r),t*Math.sin(s))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Nt{constructor(e=0,t=0,i=0){Nt.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Yt.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Yt.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*s,this.y=r[1]*t+r[4]*i+r[7]*s,this.z=r[2]*t+r[5]*i+r[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,r=e.elements,n=1/(r[3]*t+r[7]*i+r[11]*s+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*s+r[12])*n,this.y=(r[1]*t+r[5]*i+r[9]*s+r[13])*n,this.z=(r[2]*t+r[6]*i+r[10]*s+r[14])*n,this}applyQuaternion(e){const t=this.x,i=this.y,s=this.z,r=e.x,n=e.y,a=e.z,o=e.w,h=o*t+n*s-a*i,l=o*i+a*t-r*s,c=o*s+r*i-n*t,d=-r*t-n*i-a*s;return this.x=h*o+d*-r+l*-a-c*-n,this.y=l*o+d*-n+c*-r-h*-a,this.z=c*o+d*-a+h*-n-l*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*s,this.y=r[1]*t+r[5]*i+r[9]*s,this.z=r[2]*t+r[6]*i+r[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,s=e.y,r=e.z,n=t.x,a=t.y,o=t.z;return this.x=s*o-r*a,this.y=r*n-i*o,this.z=i*a-s*n,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return jt.copy(this).projectOnVector(e),this.sub(jt)}reflect(e){return this.sub(jt.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(At(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,s=this.z-e.z;return t*t+i*i+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const s=Math.sin(t)*e;return this.x=s*Math.sin(i),this.y=Math.cos(t)*e,this.z=s*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const jt=new Nt,Yt=new Ht;"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"149"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="149")
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */;const Wt=e({Black:new Gt("#000000"),Navy:new Gt("#000080"),DarkBlue:new Gt("#00008b"),MediumBlue:new Gt("#0000cd"),Blue:new Gt("#0000ff"),DarkGreen:new Gt("#006400"),Green:new Gt("#008000"),Teal:new Gt("#008080"),DarkCyan:new Gt("#008b8b"),DeepSkyBlue:new Gt("#00bfff"),DarkTurquoise:new Gt("#00ced1"),MediumSpringGreen:new Gt("#00fa9a"),Lime:new Gt("#00ff00"),SpringGreen:new Gt("#00ff7f"),Aqua:new Gt("#00ffff"),Cyan:new Gt("#00ffff"),MidnightBlue:new Gt("#191970"),DodgerBlue:new Gt("#1e90ff"),LightSeaGreen:new Gt("#20b2aa"),ForestGreen:new Gt("#228b22"),SeaGreen:new Gt("#2e8b57"),DarkSlateGray:new Gt("#2f4f4f"),DarkSlateGrey:new Gt("#2f4f4f"),LimeGreen:new Gt("#32cd32"),MediumSeaGreen:new Gt("#3cb371"),Turquoise:new Gt("#40e0d0"),RoyalBlue:new Gt("#4169e1"),SteelBlue:new Gt("#4682b4"),DarkSlateBlue:new Gt("#483d8b"),MediumTurquoise:new Gt("#48d1cc"),Indigo:new Gt("#4b0082"),DarkOliveGreen:new Gt("#556b2f"),CadetBlue:new Gt("#5f9ea0"),CornflowerBlue:new Gt("#6495ed"),RebeccaPurple:new Gt("#663399"),MediumAquaMarine:new Gt("#66cdaa"),DimGray:new Gt("#696969"),DimGrey:new Gt("#696969"),SlateBlue:new Gt("#6a5acd"),OliveDrab:new Gt("#6b8e23"),SlateGray:new Gt("#708090"),SlateGrey:new Gt("#708090"),LightSlateGray:new Gt("#778899"),LightSlateGrey:new Gt("#778899"),MediumSlateBlue:new Gt("#7b68ee"),LawnGreen:new Gt("#7cfc00"),Chartreuse:new Gt("#7fff00"),Aquamarine:new Gt("#7fffd4"),Maroon:new Gt("#800000"),Purple:new Gt("#800080"),Olive:new Gt("#808000"),Gray:new Gt("#808080"),Grey:new Gt("#808080"),SkyBlue:new Gt("#87ceeb"),LightSkyBlue:new Gt("#87cefa"),BlueViolet:new Gt("#8a2be2"),DarkRed:new Gt("#8b0000"),DarkMagenta:new Gt("#8b008b"),SaddleBrown:new Gt("#8b4513"),DarkSeaGreen:new Gt("#8fbc8f"),LightGreen:new Gt("#90ee90"),MediumPurple:new Gt("#9370db"),DarkViolet:new Gt("#9400d3"),PaleGreen:new Gt("#98fb98"),DarkOrchid:new Gt("#9932cc"),YellowGreen:new Gt("#9acd32"),Sienna:new Gt("#a0522d"),Brown:new Gt("#a52a2a"),DarkGray:new Gt("#a9a9a9"),DarkGrey:new Gt("#a9a9a9"),LightBlue:new Gt("#add8e6"),GreenYellow:new Gt("#adff2f"),PaleTurquoise:new Gt("#afeeee"),LightSteelBlue:new Gt("#b0c4de"),PowderBlue:new Gt("#b0e0e6"),FireBrick:new Gt("#b22222"),DarkGoldenRod:new Gt("#b8860b"),MediumOrchid:new Gt("#ba55d3"),RosyBrown:new Gt("#bc8f8f"),DarkKhaki:new Gt("#bdb76b"),Silver:new Gt("#c0c0c0"),MediumVioletRed:new Gt("#c71585"),IndianRed:new Gt("#cd5c5c"),Peru:new Gt("#cd853f"),Chocolate:new Gt("#d2691e"),Tan:new Gt("#d2b48c"),LightGray:new Gt("#d3d3d3"),LightGrey:new Gt("#d3d3d3"),Thistle:new Gt("#d8bfd8"),Orchid:new Gt("#da70d6"),GoldenRod:new Gt("#daa520"),PaleVioletRed:new Gt("#db7093"),Crimson:new Gt("#dc143c"),Gainsboro:new Gt("#dcdcdc"),Plum:new Gt("#dda0dd"),BurlyWood:new Gt("#deb887"),LightCyan:new Gt("#e0ffff"),Lavender:new Gt("#e6e6fa"),DarkSalmon:new Gt("#e9967a"),Violet:new Gt("#ee82ee"),PaleGoldenRod:new Gt("#eee8aa"),LightCoral:new Gt("#f08080"),Khaki:new Gt("#f0e68c"),AliceBlue:new Gt("#f0f8ff"),HoneyDew:new Gt("#f0fff0"),Azure:new Gt("#f0ffff"),SandyBrown:new Gt("#f4a460"),Wheat:new Gt("#f5deb3"),Beige:new Gt("#f5f5dc"),WhiteSmoke:new Gt("#f5f5f5"),MintCream:new Gt("#f5fffa"),GhostWhite:new Gt("#f8f8ff"),Salmon:new Gt("#fa8072"),AntiqueWhite:new Gt("#faebd7"),Linen:new Gt("#faf0e6"),LightGoldenRodYellow:new Gt("#fafad2"),OldLace:new Gt("#fdf5e6"),Red:new Gt("#ff0000"),Fuchsia:new Gt("#ff00ff"),Magenta:new Gt("#ff00ff"),DeepPink:new Gt("#ff1493"),OrangeRed:new Gt("#ff4500"),Tomato:new Gt("#ff6347"),HotPink:new Gt("#ff69b4"),Coral:new Gt("#ff7f50"),DarkOrange:new Gt("#ff8c00"),LightSalmon:new Gt("#ffa07a"),Orange:new Gt("#ffa500"),LightPink:new Gt("#ffb6c1"),Pink:new Gt("#ffc0cb"),Gold:new Gt("#ffd700"),PeachPuff:new Gt("#ffdab9"),NavajoWhite:new Gt("#ffdead"),Moccasin:new Gt("#ffe4b5"),Bisque:new Gt("#ffe4c4"),MistyRose:new Gt("#ffe4e1"),BlanchedAlmond:new Gt("#ffebcd"),PapayaWhip:new Gt("#ffefd5"),LavenderBlush:new Gt("#fff0f5"),SeaShell:new Gt("#fff5ee"),Cornsilk:new Gt("#fff8dc"),LemonChiffon:new Gt("#fffacd"),FloralWhite:new Gt("#fffaf0"),Snow:new Gt("#fffafa"),Yellow:new Gt("#ffff00"),LightYellow:new Gt("#ffffe0"),Ivory:new Gt("#fffff0"),White:new Gt("#ffffff")});class Xt{constructor(e){e.default?this.default.set(e.default):this.default.set(Wt.Fuchsia),e.intersected?this.intersected.set(e.intersected):this.default.set(Wt.PeachPuff),e.selected?this.selected.set(e.selected):this.default.set(Wt.DarkOrange),e.active?this.active.set(e.active):this.default.set(Wt.YellowGreen),e.inactive?this.inactive.set(e.inactive):this.default.set(Wt.LightCyan),e.enabled?this.enabled.set(e.enabled):this.default.set(Wt.Lavender),e.disabled?this.disabled.set(e.disabled):this.default.set(Wt.Grey)}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */const Zt=new Nt(-1,-1,-1).normalize(),Vt=new Nt(-1,-1,0).normalize(),qt=new Nt(-1,-1,1).normalize(),Kt=new Nt(-1,0,-1).normalize(),$t=new Nt(-1,0,0).normalize(),Qt=new Nt(-1,0,1).normalize(),Jt=new Nt(-1,1,-1).normalize(),ei=new Nt(-1,1,0).normalize(),ti=new Nt(-1,1,1).normalize(),ii=new Nt(0,-1,-1).normalize(),si=new Nt(0,-1,0).normalize(),ri=new Nt(0,-1,1).normalize(),ni=new Nt(0,0,-1).normalize(),ai=new Nt(0,0,0).normalize(),oi=new Nt(0,0,1).normalize(),hi=new Nt(0,1,-1).normalize(),li=new Nt(0,1,0).normalize(),ci=new Nt(0,1,1).normalize(),di=new Nt(1,-1,-1).normalize(),ui=new Nt(1,-1,0).normalize(),pi=new Nt(1,-1,1).normalize(),_i=new Nt(1,0,-1).normalize(),gi=new Nt(1,0,0).normalize(),mi={Left_Down_Back:Zt,Left_Down:Vt,Left_Down_Front:qt,Left_Back:Kt,Left:$t,Left_Front:Qt,Left_Up_Back:Jt,Left_Up:ei,Left_Up_Front:ti,Down_Back:ii,Down:si,Down_Front:ri,Back:ni,Null:ai,Front:oi,Up_Back:hi,Up:li,Up_Front:ci,Right_Down_Back:di,Right_Down:ui,Right_Down_Front:pi,Right_Back:_i,Right:gi,Right_Front:new Nt(1,0,1).normalize(),Right_Up_Back:new Nt(1,1,-1).normalize(),Right_Up:new Nt(1,1,0).normalize(),Right_Up_Front:new Nt(1,1,1).normalize(),Cardinales:{North:ni,North_North_East:new Nt(r,0,-n).normalize(),North_East:new Nt(a,0,-a).normalize(),East_North_East:new Nt(n,0,-r).normalize(),East:gi,East_South_East:new Nt(n,0,- -r).normalize(),South_East:new Nt(a,0,- -a).normalize(),South_South_East:new Nt(r,0,- -n).normalize(),South:oi,South_South_West:new Nt(-r,0,- -n).normalize(),South_West:new Nt(-a,0,- -a).normalize(),West_South_West:new Nt(-n,0,- -r).normalize(),West:$t,West_North_West:new Nt(-n,0,-r).normalize(),North_West:new Nt(-a,0,-a).normalize(),North_North_West:new Nt(-r,0,-n).normalize()}};
/**
 * @module Loader/ASCLoader
 * @desc A loader for ASC cloud point files.
 *
 * @requires {@link https://github.com/Itee/itee-client itee-client}
 * @requires {@link https://github.com/Itee/three-full three-full}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 * @example
 *
 * import { ASCLoader } from 'itee-plugin-three'
 *
 * const loader = new ASCLoader();
 *
 * // If the ASC file need to be offseted, it can be set before loading file.
 * loader.setOffset( {
 *      x: 1.0,
 *      y: 52.0,
 *      z: -5.0
 * } );
 *
 * // Then load the file and get the threejs Point Geometry
 * loader.load('/path/to/file.asc', function (geometry) {
 *
 *      scene.add( new Mesh( geometry ) );
 *
 * } );
 *
 */
class fi{constructor(e=h,t=o){this.manager=e,this.logger=t,this._boundingBox=new l,this._points=[],this._numberOfPoints=0,this._coloredPoints=!1,this._autoOffset=!1,this._offset={x:0,y:0,z:0},this._positions=null,this._bufferIndex=0,this._positionsC=null,this._bufferIndexC=0,this.wrongPoints=0}load(e,t,i,s,r){const n=new c(this.manager);n.setResponseType("blob"),n.load(e,function(e){const n=new d;this._parse(e,n,t,i,s,r),t(n)}.bind(this),i,s)}setOffset(e){this._offset=e,this._autoOffset=!1}_parse(e,t,i,s,r,n){const a=this,o=n||100,h=new FileReader,l=134217728;let c=0;function d(){if(c>=e.size)return;const t=e.slice(c,c+l,"text/plain");h.readAsText(t)}h.onabort=e=>{this.logger.log("abortEvent:"),this.logger.log(e)},h.onerror=e=>{this.logger.log("errorEvent:"),this.logger.log(e),r&&r(e)},h.onloadstart=e=>{this.logger.log("loadStartEvent:"),this.logger.log(e)},h.onprogress=e=>{this.logger.log("progressEvent:"),this.logger.log(e),s&&s(e)},h.onload=e=>{this.logger.log("loadEvent:"),this.logger.log(e);const t=e.target.result.split("\n"),i=t.length;c-=t[i-1].length;const s=Math.round(100/o);for(let e=0;e<i-1;e++)e%s===0&&a._parseLine(t[e])},h.onloadend=i=>{this.logger.log("loadEndEvent"),this.logger.log(i),(this._points.length>1e6||c+l>=e.size)&&(this._offsetPoints(),this._createSubCloudPoint(t)),c+=l,d()},d()}_parseLine(e){const t=e.split(/\s/g).filter(Boolean),i=t.length;3===i?this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2])}):4===i?(this._pointsHaveIntensity=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3])})):6===i?(this._pointsHaveColor=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),r:parseFloat(t[3]),g:parseFloat(t[4]),b:parseFloat(t[5])})):7===i?(this._pointsHaveIntensity=!0,this._pointsHaveColor=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),r:parseFloat(t[4]),g:parseFloat(t[5]),b:parseFloat(t[6])})):9===i?(this._pointsHaveColor=!0,this._pointsHaveNormals=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),r:parseFloat(t[3]),g:parseFloat(t[4]),b:parseFloat(t[5]),nx:parseFloat(t[6]),ny:parseFloat(t[7]),nz:parseFloat(t[8])})):10===i?(this._pointsHaveIntensity=!0,this._pointsHaveColor=!0,this._pointsHaveNormals=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),r:parseFloat(t[4]),g:parseFloat(t[5]),b:parseFloat(t[6]),nx:parseFloat(t[7]),ny:parseFloat(t[8]),nz:parseFloat(t[9])})):this.logger.error(`Invalid data line: ${e}`)}_parseLines(e){const t=e[0].split(/\s/g).filter(Boolean).length;3===t?this._parseLinesAsXYZ(e):4===t?this._parseLinesAsXYZI(e):6===t?this._parseLinesAsXYZRGB(e):7===t?this._parseLinesAsXYZIRGB(e):9===t?this._parseLinesAsXYZRGBnXnYnZ(e):10===t?this._parseLinesAsXYZIRGBnXnYnZ(e):this.logger.error(`Invalid data line: ${e}`)}_parseLinesAsXYZ(e){let t=[];for(let i=0,s=e.length;i<s;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2])})}_parseLinesAsXYZI(e){this._pointsHaveIntensity=!0;let t=[];for(let i=0,s=e.length;i<s;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3])})}_parseLinesAsXYZRGB(e){this._pointsHaveColor=!0;let t=[];for(let i=0,s=e.length;i<s;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),r:parseFloat(t[3]),g:parseFloat(t[4]),b:parseFloat(t[5])})}_parseLinesAsXYZnXnYnZ(e){let t=[];for(let i=0,s=e.length;i<s;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),nx:parseFloat(t[7]),ny:parseFloat(t[8]),nz:parseFloat(t[9])})}_parseLinesAsXYZIRGB(e){this._pointsHaveIntensity=!0,this._pointsHaveColor=!0;let t=[];for(let i=0,s=e.length;i<s;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),r:parseFloat(t[4]),g:parseFloat(t[5]),b:parseFloat(t[6])})}_parseLinesAsXYZInXnYnZ(e){let t=[];for(let i=0,s=e.length;i<s;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),nx:parseFloat(t[7]),ny:parseFloat(t[8]),nz:parseFloat(t[9])})}_parseLinesAsXYZRGBnXnYnZ(e){this._pointsHaveColor=!0,this._pointsHaveNormals=!0;let t=[];for(let i=0,s=e.length;i<s;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),r:parseFloat(t[3]),g:parseFloat(t[4]),b:parseFloat(t[5]),nx:parseFloat(t[6]),ny:parseFloat(t[7]),nz:parseFloat(t[8])})}_parseLinesAsXYZIRGBnXnYnZ(e){this._pointsHaveIntensity=!0,this._pointsHaveColor=!0,this._pointsHaveNormals=!0;let t=[];for(let i=0,s=e.length;i<s;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),r:parseFloat(t[4]),g:parseFloat(t[5]),b:parseFloat(t[6]),nx:parseFloat(t[7]),ny:parseFloat(t[8]),nz:parseFloat(t[9])})}_parseLineB(e){const t=e.split(/\s/g).filter(Boolean),i=t.length,s=this._bufferIndex;3===i&&(this._positions[s]=parseFloat(t[0]),this._positions[s+1]=parseFloat(t[1]),this._positions[s+2]=parseFloat(t[2]),this._bufferIndex+=3)}_parseLineC(e){const t=e.split(/\s/g).filter(Boolean),i=t.length,s=this._bufferIndexC;3===i&&(this._positionsC[s]=Number.parseFloat(t[0]),this._positionsC[s+1]=Number.parseFloat(t[1]),this._positionsC[s+2]=Number.parseFloat(t[2]),this._bufferIndexC+=3)}_offsetPoints(){this._autoOffset&&(this._boundingBox.setFromPoints(this._points),this.setOffset(this._boundingBox.getCenter()));const e=this._offset.x,t=this._offset.y,i=this._offset.z;let s=null;for(let r=0,n=this._points.length;r<n;++r)s=this._points[r],s.x-=e,s.y-=t,s.z-=i}_createCloudPoint(e){const t=1e6,i=this._points.length,s=Math.ceil(i/t);let r=null,n=0,a=null;for(let i=0;i<s;++i){r=this._points.splice(0,t),n=r.length;const i=new u,s=new Float32Array(3*n),o=new Float32Array(3*n);let h=0,l=null;for(let e=0;e<n;++e)l=r[e],s[h]=l.x,s[h+1]=l.y,s[h+2]=l.z,this._pointsHaveColor?(o[h]=l.r/255,o[h+1]=l.g/255,o[h+2]=l.b/255):(o[h]=.1,o[h+1]=.2,o[h+2]=.5),h+=3;i.setAttribute("position",new p(s,3)),i.setAttribute("color",new p(o,3));const c=new _({size:.01,vertexColors:!0});a=new g(i,c),e.children.push(a)}}_createSubCloudPoint(e){const t=this._points.length,i=new u,s=new Float32Array(3*t),r=new Float32Array(3*t);let n=0,a=null;for(let e=0;e<t;++e)a=this._points[e],s[n]=a.x,s[n+1]=a.y,s[n+2]=a.z,this._pointsHaveColor?(r[n]=a.r/255,r[n+1]=a.g/255,r[n+2]=a.b/255):(r[n]=.1,r[n+1]=.2,r[n+2]=.5),n+=3;i.setAttribute("position",new p(s,3)),i.setAttribute("color",new p(r,3));const o=new _({size:.005,vertexColors:!0}),h=new g(i,o);h.rotation.x-=Math.PI/2,e.children.push(h),this._points=[]}}
/**
 * @module Loader/DBFLoader
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * From:
 * https://www.clicketyclick.dk/databases/xbase/format/db2_dbf.html#DBII_DBF_STRUCT
 * http://web.archive.org/web/20150323061445/http://ulisse.elettra.trieste.it/services/doc/dbase/DBFstruct.htm
 * http://www.dbase.com/Knowledgebase/INT/db7_file_fmt.htm
 *
 *
 */const wi=e({FoxPro:48,FoxPro_Autoincrement:49,dBASE_II:2,FoxPro_Var:50,dBASE_III_plus:3,dBASE_III_plus_memo:131,dBASE_IV_SQL_table:67,dBASE_IV_SQL_system:99,dBASE_IV_memo:139,dBASE_IV_memo_SQL_table:203,FoxBase:251,dBase_v_7:4,FoxPro_2_x:245,HiPerSix_memo:229}),bi=e({Binary:"B",Character:"C",Date:"D",Numeric:"N",Logical:"L",Memo:"M",Timestamp:"@",Long:"I",Autoincrement:"+",Float:"F",Double:"O",OLE:"G"});class yi{constructor(e={}){const t={manager:h,logger:o,reader:new nt,...e};this.manager=t.manager,this.logger=t.logger,this.reader=t.reader}get manager(){return this._manager}set manager(e){this._manager=e}get logger(){return this._logger}set logger(e){this._logger=e}get reader(){return this._reader}set reader(e){this._reader=e}setManager(e){return this.manager=e,this}setLogger(e){return this.logger=e,this}setReader(e){return this.reader=e,this}load(e,t,i,s){const r=this,n=new c(r.manager);n.setResponseType("arraybuffer"),n.load(e,e=>{t(r.parse(e))},i,s)}parse(e){this.reader.setEndianess(at.Big).setBuffer(e);const t=this.reader.getInt8();if(!this._isValidVersion(t))return this.logger.error(`DBFLoader: Invalid version number: ${t}`),null;const i=this._parseHeader(t);return{header:i,datas:this._parseDatas(t,i)}}_isValidVersion(e){return wi.includes(e)}_parseHeader(e){let t={};switch(e){case wi.FoxPro:case wi.FoxPro_Autoincrement:case wi.FoxPro_Var:case wi.dBASE_II:t=this._parseHeaderV2();break;case wi.dBASE_III_plus:case wi.dBASE_III_plus_memo:t=this._parseHeaderV2_5();break;case wi.dBASE_IV_memo:case wi.dBASE_IV_memo_SQL_table:case wi.dBASE_IV_SQL_system:case wi.dBASE_IV_SQL_table:t=this._parseHeaderV3();break;case wi.dBase_v_7:case wi.FoxPro_2_x:case wi.HiPerSix_memo:t=this._parseHeaderV4();break;default:throw new RangeError(`Invalid version parameter: ${e}`)}return this.reader.getUint8()!==yi.Terminator&&this.logger.error("DBFLoader: Invalid terminator after field descriptors !!!"),t}_parseHeaderV2(){const e=this.reader.getInt16(),t=this.reader.getInt8()+yi.YearOffset,i=this.reader.getInt8(),s=this.reader.getInt8(),r=this.reader.getInt16();let n,a,o,h,l,c=[];for(let t=0;t<e;t++)n=this.reader.getString(11),a=this.reader.getChar(),o=this.reader.getUint8(),h=this.reader.getInt16(),l=this.reader.getInt8(),c.push({name:n,type:a,length:o,memoryAddress:h,decimalCount:l});return{numberOfRecords:e,year:t,month:i,day:s,lengthOfEachRecords:r,fields:c}}_parseHeaderV2_5(){const e=this.reader.getInt8()+yi.YearOffset,t=this.reader.getInt8(),i=this.reader.getInt8();this.reader.setEndianess(at.Little);const s=this.reader.getInt32(),r=this.reader.getInt16(),n=this.reader.getInt16();this.reader.setEndianess(at.Big),this.reader.skipOffsetOf(20);let a,o,h,l,c,d,u,p=[];for(let e=0;e<s;e++)a=this.reader.getString(11),o=this.reader.getChar(),l=this.reader.getInt32(),h=this.reader.getUint8(),c=this.reader.getUint8(),this.reader.skipOffsetOf(2),d=this.reader.getInt8(),this.reader.skipOffsetOf(2),u=this.reader.getInt8(),this.reader.skipOffsetOf(1),p.push({name:a,type:o,length:h,memoryAddress:l,decimalCount:c,workAreaId:d,MDXFlag:u});return{year:e,month:t,day:i,numberOfRecords:s,numberOfByteInHeader:r,numberOfByteInRecord:n,fields:p}}_parseHeaderV3(){const e=this.reader.getInt8()+yi.YearOffset,t=this.reader.getInt8(),i=this.reader.getInt8();this.reader.setEndianess(at.Little);const s=this.reader.getInt32(),r=this.reader.getInt16(),n=this.reader.getInt16();this.reader.setEndianess(at.Big),this.reader.skipOffsetOf(2);const a=this.reader.getInt8(),o=this.reader.getInt8();this.reader.skipOffsetOf(12);const h=this.reader.getInt8(),l=this.reader.getInt8();this.reader.skipOffsetOf(2);let c,d,u,p,_,g,m=[];for(;this.reader.getOffset()<r-1;)c=this.reader.getString(11),d=this.reader.getChar(),this.reader.skipOffsetOf(4),u=this.reader.getUint8(),p=this.reader.getUint8(),this.reader.skipOffsetOf(2),_=this.reader.getInt8(),this.reader.skipOffsetOf(10),g=this.reader.getInt8(),m.push({name:c,type:d,length:u,decimalCount:p,workAreaId:_,MDXFieldFlag:g});return{year:e,month:t,day:i,numberOfRecords:s,numberOfByteInHeader:r,numberOfByteInRecord:n,incompleteTransactionFlag:a,encryptionFlag:o,MDXFlag:h,languageDriverId:l,fields:m}}_parseHeaderV4(){const e=this.reader.getInt8()+yi.YearOffset,t=this.reader.getInt8(),i=this.reader.getInt8();this.reader.setEndianess(at.Little);const s=this.reader.getInt32(),r=this.reader.getInt16(),n=this.reader.getInt16();this.reader.setEndianess(at.Big),this.reader.skipOffsetOf(2);const a=this.reader.getInt8(),o=this.reader.getInt8();this.reader.skipOffsetOf(12);const h=this.reader.getInt8(),l=this.reader.getInt8();this.reader.skipOffsetOf(2);const c=this.reader.getString(32);this.reader.skipOffsetOf(4);let d,u,p,_,g,m,f=[];for(let e=0;e<s;e++)d=this.reader.getString(32),u=this.reader.getChar(),p=this.reader.getUint8(),_=this.reader.getUint8(),this.reader.skipOffsetOf(2),g=this.reader.getInt8(),this.reader.skipOffsetOf(2),m=this.reader.getInt32(),this.reader.skipOffsetOf(4),f.push({name:d,type:u,length:p,decimalCount:_,MDXFieldFlag:g,nextAutoincrementValue:m});return{year:e,month:t,day:i,numberOfRecords:s,numberOfByteInHeader:r,numberOfByteInRecord:n,incompleteTransactionFlag:a,encryptionFlag:o,MDXFlag:h,languageDriverId:l,languageDriverName:c,fields:f}}_parseDatas(e,t){const i=t.numberOfRecords,s=t.fields;let r=[],n=null,a=null;for(let e=0;e<i;e++){n={},n.deleted=this.reader.getUint8()===yi.DeletedRecord;for(let e=0,t=s.length;e<t;e++)switch(a=s[e],a.type){case bi.Binary:{const e=this.reader.getString(a.length);n[a.name]=parseInt(e)}break;case bi.Numeric:{const e=this.reader.getString(a.length);n[a.name]=parseInt(e)}break;case bi.Character:case bi.Date:n[a.name]=this.reader.getString(a.length);break;case bi.Logical:{const e=this.reader.getChar().toLowerCase();n[a.name]="t"===e||"y"===e||"f"!==e&&"n"!==e&&null}break;case bi.Memo:n[a.name]=this.reader.getString(a.length);break;case bi.Timestamp:break;case bi.Long:case bi.Autoincrement:n[a.name]=this.reader.getInt32();break;case bi.Float:{const e=this.reader.getString(a.length);n[a.name]=parseInt(e)}break;case bi.Double:n[a.name]=this.reader.getFloat64();break;case bi.OLE:n[a.name]=this.reader.getString(a.length);break;default:throw new RangeError(`Invalid data type parameter: ${a.type}`)}r.push(n)}return r}_parseFieldProperties(){const e=this.reader.getInt16(),t=this.reader.getInt16(),i=this.reader.getInt16(),s=this.reader.getInt16(),r=this.reader.getInt16(),n=this.reader.getInt16(),a=this.reader.getInt16(),o=this.reader.getInt16();let h=[];for(let t=0;t<e;t++)h.push(this._getStandardProperties());let l=[];for(let e=0;e<i;e++)l.push(this._getCustomProperties());let c=[];for(let e=0;e<r;e++)c.push(this._getReferentialIntegrityProperties());return{numberOfStandardProperties:e,startOfStandardPropertiesDescriptor:t,numberOfCustomProperties:i,startOfCustomPropertiesDescriptor:s,numberOfReferentialIntegrityProperties:r,startOfReferentialIntegrityDescriptor:n,startOfData:a,sizeOfPropertiesStructure:o,standardProperties:h,customProperties:l,referentialIntegrityProperties:c}}_getStandardProperties(){const e=this.reader.getInt16(),t=this.reader.getInt16(),i=this.reader.getInt8(),s=this.reader.getInt8(),r=this.reader.getInt8();this.reader.skipOffsetOf(4);return{generationalNumber:e,tableFieldOffset:t,propertyDescribed:i,type:s,isConstraint:r,offsetFromStart:this.reader.getInt16(),widthOfDatabaseField:this.reader.getInt16()}}_getCustomProperties(){const e=this.reader.getInt16(),t=this.reader.getInt16(),i=this.reader.getInt8();this.reader.skipOffsetOf(1);return{generationalNumber:e,tableFieldOffset:t,type:i,offsetFromStartOfName:this.reader.getInt16(),lengthOfName:this.reader.getInt16(),offsetFromStartOfData:this.reader.getInt16(),lengthOfData:this.reader.getInt16()}}_getReferentialIntegrityProperties(){return{databaseState:this.reader.getInt8(),sequentialNumberRule:this.reader.getInt16(),offsetOfTheRIRuleName:this.reader.getInt16(),sizeOfTheRIRuleName:this.reader.getInt16(),offsetOfNameOfForeignTable:this.reader.getInt16(),sizeOfNameOfForeignTable:this.reader.getInt16(),stateBehaviour:this.reader.getInt8(),numberOfFieldsInLinkingKey:this.reader.getInt16(),offsetOfLocalTableTagName:this.reader.getInt16(),sizeOfTheLocalTableTagName:this.reader.getInt16(),offsetOfForeignTableTagName:this.reader.getInt16(),sizeOfTheForeignTableTagName:this.reader.getInt16()}}}yi.Terminator=13,yi.DeletedRecord=26,yi.YearOffset=1900;
/**
 * @module Loader/LASLoader
 * @desc A loader for ASC cloud point files.
 *
 * @requires {@link https://github.com/Itee/itee-client itee-client}
 * @requires {@link https://github.com/Itee/three-full three-full}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 * @example
 *
 * import { LASLoader } from 'itee-plugin-three'
 *
 * const loader = new LASLoader();
 *
 * // If the ASC file need to be offseted, it can be set before loading file.
 * loader.setOffset( {
 *      x: 1.0,
 *      y: 52.0,
 *      z: -5.0
 * } );
 *
 * // Then load the file and get the threejs Point Geometry
 * loader.load('/path/to/file.asc', function (geometry) {
 *
 *      scene.add( new Mesh( geometry ) );
 *
 * } );
 *
 */
const xi=new RegExp("\0","g"),vi=e({Created:0,Unclassified:1,Ground:2,LowVegetation:3,MediumVegetation:4,HighVegetation:5,Building:6,LowPoint:7,ModelKeyPoint:8,Water:9,OverlapPoints:12});class Mi{constructor(e=h,t=o){this.manager=e,this.logger=t,this._reader=new nt,this._fullVersion="",this._boundingBox=new l,this._points=[],this._numberOfPoints=0,this._coloredPoints=!1,this._autoOffset=!1,this._offset={x:0,y:0,z:0},this.colorForPointClass={Created:{r:255,g:255,b:255},Unclassified:{r:60,g:60,b:60},Ground:{r:125,g:95,b:5},LowVegetation:{r:153,g:212,b:36},MediumVegetation:{r:52,g:148,b:25},HighVegetation:{r:27,g:77,b:13},Building:{r:153,g:138,b:95},LowPoint:{r:200,g:200,b:200},ModelKeyPoint:{r:237,g:31,b:31},Water:{r:31,g:186,b:237},OverlapPoints:{r:0,g:0,b:0}}}load(e,t,i,s,r){const n=new c(this.manager);n.setResponseType("arraybuffer"),n.load(e,e=>{this.parse(e,t,i,s,r)},i,s)}setOffset(e){this._offset=e,this._autoOffset=!1}parse(e,t,i,s){try{this._reader.buffer=e;if("LASF"!==this._reader.getString(4,!1))throw new Error("Invalid las file signature. Abort parsing !");this._reader.skipOffsetOf(24);const r=this._reader.getUint8(),n=this._reader.getUint8();this._reader.skipOffsetTo(0);const a=`${r}.${n}`,o=this._parseHeader(a),h=this._parseVariableLengthRecords(o),l=this._parsePointDataRecords(o,i);this.convert({Header:o,VariableLengthRecords:h,PointDataRecords:l},t,i,s)}catch(e){s(e)}}_parseHeader(e){switch(e){case"1.0":return this._parseHeader_1_0();case"1.1":return this._parseHeader_1_1();case"1.2":return this._parseHeader_1_2();case"1.3":return this._parseHeader_1_3();case"1.4":return this._parseHeader_1_4();default:throw new Error(`Insupported LAS file version: ${e}. Abort parsing !`)}}_parseHeader_1_0(){return{FileSignature:this._reader.getString(4),Reserved:this._reader.skipOffsetOf(ot.Four),GUID_1:this._reader.getUint32(),GUID_2:this._reader.getUint16(),GUID_3:this._reader.getUint16(),GUID_4:this._reader.getUint8Array(8),VersionMajor:this._reader.getUint8(),VersionMinor:this._reader.getUint8(),SystemIdentifier:this._reader.getString(32).replace(xi,""),GeneratingSoftware:this._reader.getString(32).replace(xi,""),FlightDateJulian:this._reader.getUint16(),Year:this._reader.getUint16(),HeaderSize:this._reader.getUint16(),OffsetToPointData:this._reader.getUint32(),NumberOfVariableLengthRecords:this._reader.getUint32(),PointDataFormatID:this._reader.getUint8(),PointDataRecordLength:this._reader.getUint16(),NumberOfPointRecords:this._reader.getUint32(),NumberOfPointsByReturn:this._reader.getUint32Array(5),XScaleFactor:this._reader.getFloat64(),YScaleFactor:this._reader.getFloat64(),ZScaleFactor:this._reader.getFloat64(),XOffset:this._reader.getFloat64(),YOffset:this._reader.getFloat64(),ZOffset:this._reader.getFloat64(),MaxX:this._reader.getFloat64(),MinX:this._reader.getFloat64(),MaxY:this._reader.getFloat64(),MinY:this._reader.getFloat64(),MaxZ:this._reader.getFloat64(),MinZ:this._reader.getFloat64()}}_parseHeader_1_1(){return{FileSignature:this._reader.getString(4),FileSourceId:this._reader.getUint16(),Reserved:this._reader.skipOffsetOf(ot.Two)&&null,GUID_1:this._reader.getUint32(),GUID_2:this._reader.getUint16(),GUID_3:this._reader.getUint16(),GUID_4:this._reader.getUint8Array(8),VersionMajor:this._reader.getUint8(),VersionMinor:this._reader.getUint8(),SystemIdentifier:this._reader.getString(32).replace(xi,""),GeneratingSoftware:this._reader.getString(32).replace(xi,""),FileCreationDayOfYear:this._reader.getUint16(),FileCreationYear:this._reader.getUint16(),HeaderSize:this._reader.getUint16(),OffsetToPointData:this._reader.getUint32(),NumberOfVariableLengthRecords:this._reader.getUint32(),PointDataFormatID:this._reader.getUint8(),PointDataRecordLength:this._reader.getUint16(),NumberOfPointRecords:this._reader.getUint32(),NumberOfPointsByReturn:this._reader.getUint32Array(5),XScaleFactor:this._reader.getFloat64(),YScaleFactor:this._reader.getFloat64(),ZScaleFactor:this._reader.getFloat64(),XOffset:this._reader.getFloat64(),YOffset:this._reader.getFloat64(),ZOffset:this._reader.getFloat64(),MaxX:this._reader.getFloat64(),MinX:this._reader.getFloat64(),MaxY:this._reader.getFloat64(),MinY:this._reader.getFloat64(),MaxZ:this._reader.getFloat64(),MinZ:this._reader.getFloat64()}}_parseHeader_1_2(){return{FileSignature:this._reader.getString(4),FileSourceId:this._reader.getUint16(),GlobalEncoding:{GPSTimeType:this._reader.getBit16()?"AdjustedStandardGPSTime":"GPSWeekTime",Reserved:this._reader.skipBitOffsetOf(15)},GUID_1:this._reader.getUint32(),GUID_2:this._reader.getUint16(),GUID_3:this._reader.getUint16(),GUID_4:this._reader.getUint8Array(8),VersionMajor:this._reader.getUint8(),VersionMinor:this._reader.getUint8(),SystemIdentifier:this._reader.getString(32).replace(xi,""),GeneratingSoftware:this._reader.getString(32).replace(xi,""),FileCreationDayOfYear:this._reader.getUint16(),FileCreationYear:this._reader.getUint16(),HeaderSize:this._reader.getUint16(),OffsetToPointData:this._reader.getUint32(),NumberOfVariableLengthRecords:this._reader.getUint32(),PointDataFormatID:this._reader.getUint8(),PointDataRecordLength:this._reader.getUint16(),NumberOfPointRecords:this._reader.getUint32(),NumberOfPointsByReturn:this._reader.getUint32Array(5),XScaleFactor:this._reader.getFloat64(),YScaleFactor:this._reader.getFloat64(),ZScaleFactor:this._reader.getFloat64(),XOffset:this._reader.getFloat64(),YOffset:this._reader.getFloat64(),ZOffset:this._reader.getFloat64(),MaxX:this._reader.getFloat64(),MinX:this._reader.getFloat64(),MaxY:this._reader.getFloat64(),MinY:this._reader.getFloat64(),MaxZ:this._reader.getFloat64(),MinZ:this._reader.getFloat64()}}_parseHeader_1_3(){return{FileSignature:this._reader.getString(4),FileSourceId:this._reader.getUint16(),GlobalEncoding:{GPSTimeType:this._reader.getBit16()?"AdjustedStandardGPSTime":"GPSWeekTime",WaveformDataPacketsInternal:this._reader.getBit16(),WaveformDataPacketsExternal:this._reader.getBit16(),ReturnNumbersHaveBeenSyntheticallyGenerated:this._reader.getBit16(),Reserved:this._reader.skipBitOffsetOf(12)},GUID_1:this._reader.getUint32(),GUID_2:this._reader.getUint16(),GUID_3:this._reader.getUint16(),GUID_4:this._reader.getUint8Array(8),VersionMajor:this._reader.getUint8(),VersionMinor:this._reader.getUint8(),SystemIdentifier:this._reader.getString(32).replace(xi,""),GeneratingSoftware:this._reader.getString(32).replace(xi,""),FileCreationDayOfYear:this._reader.getUint16(),FileCreationYear:this._reader.getUint16(),HeaderSize:this._reader.getUint16(),OffsetToPointData:this._reader.getUint32(),NumberOfVariableLengthRecords:this._reader.getUint32(),PointDataFormatID:this._reader.getUint8(),PointDataRecordLength:this._reader.getUint16(),NumberOfPointRecords:this._reader.getUint32(),NumberOfPointsByReturn:this._reader.getUint32Array(5),XScaleFactor:this._reader.getFloat64(),YScaleFactor:this._reader.getFloat64(),ZScaleFactor:this._reader.getFloat64(),XOffset:this._reader.getFloat64(),YOffset:this._reader.getFloat64(),ZOffset:this._reader.getFloat64(),MaxX:this._reader.getFloat64(),MinX:this._reader.getFloat64(),MaxY:this._reader.getFloat64(),MinY:this._reader.getFloat64(),MaxZ:this._reader.getFloat64(),MinZ:this._reader.getFloat64(),StartOfWaveformDataPacketRecord:this._reader.getUint64()}}_parseHeader_1_4(){return{FileSignature:this._reader.getString(4),FileSourceId:this._reader.getUint16(),GlobalEncoding:{GPSTimeType:this._reader.getBit16()?"AdjustedStandardGPSTime":"GPSWeekTime",WaveformDataPacketsInternal:this._reader.getBit16(),WaveformDataPacketsExternal:this._reader.getBit16(),ReturnNumbersHaveBeenSyntheticallyGenerated:this._reader.getBit16(),WKT:this._reader.getBit16()?"WKT":"GeoTIFF",Reserved:this._reader.skipBitOffsetOf(11)},GUID_1:this._reader.getUint32(),GUID_2:this._reader.getUint16(),GUID_3:this._reader.getUint16(),GUID_4:this._reader.getUint8Array(8),VersionMajor:this._reader.getUint8(),VersionMinor:this._reader.getUint8(),SystemIdentifier:this._reader.getString(32).replace(xi,""),GeneratingSoftware:this._reader.getString(32).replace(xi,""),FileCreationDayOfYear:this._reader.getUint16(),FileCreationYear:this._reader.getUint16(),HeaderSize:this._reader.getUint16(),OffsetToPointData:this._reader.getUint32(),NumberOfVariableLengthRecords:this._reader.getUint32(),PointDataRecordFormat:this._reader.getUint8(),PointDataRecordLength:this._reader.getUint16(),LegacyNumberOfPointRecords:this._reader.getUint32(),LegacyNumberOfPointsByReturn:this._reader.getUint32Array(5),XScaleFactor:this._reader.getFloat64(),YScaleFactor:this._reader.getFloat64(),ZScaleFactor:this._reader.getFloat64(),XOffset:this._reader.getFloat64(),YOffset:this._reader.getFloat64(),ZOffset:this._reader.getFloat64(),MaxX:this._reader.getFloat64(),MinX:this._reader.getFloat64(),MaxY:this._reader.getFloat64(),MinY:this._reader.getFloat64(),MaxZ:this._reader.getFloat64(),MinZ:this._reader.getFloat64(),StartOfWaveformDataPacketRecord:this._reader.getUint64(),StartOfFirstExtendedVariableLengthRecord:this._reader.getUint64(),NumberOfExtendedVariableLengthRecords:this._reader.getUint32(),NumberOfPointRecords:this._reader.getUint64(),NumberOfPointsByReturn:this._reader.getUint64Array(15)}}_parseVariableLengthRecords(e){const t=`${e.VersionMajor}.${e.VersionMinor}`,i=[];for(let s=0;s<e.NumberOfVariableLengthRecords;s++){const e=this._parseVariableLengthRecordHeader();
//!\ Legacy => RecordSignature = Reserved since las v1.1
if("1.0"===t&&43707!==e.Reserved)throw new Error("Invalid variable length record header signature... Abort parsing !");const s=e.UserID,r=e.RecordID,n=e.RecordLengthAfterHeader,a=this._parseVariableLengthRecordContent(s,r,n);i.push({Header:e,Content:a})}return i}_parseVariableLengthRecordHeader(){return{Reserved:this._reader.getUint16(),UserID:this._reader.getString(16).replace(xi,""),RecordID:this._reader.getUint16(),RecordLengthAfterHeader:this._reader.getUint16(),Description:this._reader.getString(32).replace(xi,"")}}_parseVariableLengthRecordContent(e,t,i){switch(e){case"LASF_Projection":return this._parseProjectionRecord(t,i);case"LASF_Spec":return this._parseSpecRecord();default:return this._parseCustomRecord(i)}}_parseProjectionRecord(e,t){switch(e){case 2111:return this._parseOGCMathTransformWKT();case 2112:return this._parseOGCCoordinateTransformWKT();case 34735:return this._parseGeoKeyDirectoryTag();case 34736:return this._parseGeoDoubleParamsTag(t);case 34737:return this._parseGeoASCIIParamsTag(t);default:console.error("Unable to determine LASF_Projection underlying type ! Skip current record."),this._reader.skipOffsetOf(t)}}_parseOGCMathTransformWKT(){}_parseOGCCoordinateTransformWKT(){}_parseGeoKeyDirectoryTag(){const e={wKeyDirectoryVersion:this._reader.getUint16(),wKeyRevision:this._reader.getUint16(),wMinorRevision:this._reader.getUint16(),wNumberOfKeys:this._reader.getUint16(),sKeyEntry:[]};for(let t=0;t<e.wNumberOfKeys;t++)e.sKeyEntry.push({wKeyID:this._reader.getUint16(),wTIFFTagLocation:this._reader.getUint16(),wCount:this._reader.getUint16(),wValue_Offset:this._reader.getUint16()});return e}_parseGeoDoubleParamsTag(e){const t=e/ot.Height,i=[];for(let e=0;e<t;e++)i[e]=this._reader.getFloat64();return i}_parseGeoASCIIParamsTag(e){return this._reader.getString(e).replace(xi,"")}_parseSpecRecord(e){if(!(e<100)){if(e>=100&&e<355)return this._parseWaveformPacketDesciptor();if(65535===e)return this._parseWaveformDataPacket();throw new RangeError(`Invalid spec record id: ${e}`)}switch(e){case 0:return this._parseClassificationLookupRecord();case 1:return this._parseHeaderLookupForFlightLinesRecord();case 2:return this._parseHistogramRecord();case 3:return this._parseTextAreaDescriptionRecord();case 4:return this._parseExtraBytesRecord();case 7:return this._parseSupersededRecord();default:throw new RangeError(`Invalid spec record id: ${e}`)}}_parseClassificationLookupRecord(){const e=[];for(let t=0;t<256;t++)e.push({ClassNumber:this._reader.getUint8(),Description:this._reader.getString(15).replace(xi,"")});return e}_parseHeaderLookupForFlightLinesRecord(){return{FileMarkerNumber:this._reader.getUint8(),Filename:this._reader.getString(256).replace(xi,"")}}_parseHistogramRecord(){}_parseTextAreaDescriptionRecord(){}_parseExtraBytesRecord(){}_parseSupersededRecord(){}_parseWaveformPacketDesciptor(){}_parseWaveformDataPacket(){}_parseCustomRecord(e){const t=new Uint8Array(e);for(let i=0;i<e;i++)t[i]=this._reader.getUint8();return t}_parsePointDataRecords(e,t){const i=e.OffsetToPointData;this._reader.offset!==i&&(console.error("The current reader offset does not match the header offset to point data ! Defaulting to header value."),this._reader.skipOffsetTo(i));const s=e.VersionMinor<4?e.PointDataFormatID:e.PointDataRecordFormat,r=this._getPointDataRecordFormat(s),n=e.VersionMinor<4?e.NumberOfPointRecords:e.LegacyNumberOfPointRecords,a=new Array(n);for(let e=0;e<n;e++)a[e]=r(),e%1e5==0&&t(new ProgressEvent("ParsePointDataRecords",{lengthComputable:!0,loaded:e,total:n}));return a}_getPointDataRecordFormat(e){switch(e){case 0:return this._parsePointDataRecordFormat_0.bind(this);case 1:return this._parsePointDataRecordFormat_1.bind(this);case 2:return this._parsePointDataRecordFormat_2.bind(this);case 3:return this._parsePointDataRecordFormat_3.bind(this);case 4:return this._parsePointDataRecordFormat_4.bind(this);case 5:return this._parsePointDataRecordFormat_5.bind(this);case 6:return this._parsePointDataRecordFormat_6.bind(this);case 7:return this._parsePointDataRecordFormat_7.bind(this);case 8:return this._parsePointDataRecordFormat_8.bind(this);case 9:return this._parsePointDataRecordFormat_9.bind(this);case 10:return this._parsePointDataRecordFormat_10.bind(this);default:throw new RangeError(`Invalid PointDataRecordFormat parameter: ${e}`)}}_parsePointDataRecordFormat_0(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits8(3),NumberOfReturns:this._reader.getBits8(3),ScanDirectionFlag:this._reader.getBit8(),EdgeOfFlightLine:this._reader.getBit8(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},ScanAngleRank:this._reader.getInt8(),UserData:this._reader.getUint8(),PointSourceId:this._reader.getUint16()}}_parsePointDataRecordFormat_1(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits8(3),NumberOfReturns:this._reader.getBits8(3),ScanDirectionFlag:this._reader.getBit8(),EdgeOfFlightLine:this._reader.getBit8(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},ScanAngleRank:this._reader.getInt8(),UserData:this._reader.getUint8(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64()}}_parsePointDataRecordFormat_2(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits8(3),NumberOfReturns:this._reader.getBits8(3),ScanDirectionFlag:this._reader.getBit8(),EdgeOfFlightLine:this._reader.getBit8(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},ScanAngleRank:this._reader.getInt8(),UserData:this._reader.getUint8(),PointSourceId:this._reader.getUint16(),R:this._reader.getUint16(),G:this._reader.getUint16(),B:this._reader.getUint16()}}_parsePointDataRecordFormat_3(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits8(3),NumberOfReturns:this._reader.getBits8(3),ScanDirectionFlag:this._reader.getBit8(),EdgeOfFlightLine:this._reader.getBit8(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},ScanAngleRank:this._reader.getInt8(),UserData:this._reader.getUint8(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),R:this._reader.getUint16(),G:this._reader.getUint16(),B:this._reader.getUint16()}}_parsePointDataRecordFormat_4(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits8(3),NumberOfReturns:this._reader.getBits8(3),ScanDirectionFlag:this._reader.getBit8(),EdgeOfFlightLine:this._reader.getBit8(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},ScanAngleRank:this._reader.getInt8(),UserData:this._reader.getUint8(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),WavePacketDescriptorIndex:this._reader.getUint8(),ByteOffsetToWaveformData:this._reader.getUint64(),WaveformPacketSizeInBytes:this._reader.getUint32(),ReturnPointWaveformLocation:this._reader.getFloat32(),Xt:this._reader.getFloat32(),Yt:this._reader.getFloat32(),Zt:this._reader.getFloat32()}}_parsePointDataRecordFormat_5(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits8(3),NumberOfReturns:this._reader.getBits8(3),ScanDirectionFlag:this._reader.getBit8(),EdgeOfFlightLine:this._reader.getBit8(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},ScanAngleRank:this._reader.getInt8(),UserData:this._reader.getUint8(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),R:this._reader.getUint16(),G:this._reader.getUint16(),B:this._reader.getUint16(),WavePacketDescriptorIndex:this._reader.getUint8(),ByteOffsetToWaveformData:this._reader.getUint64(),WaveformPacketSizeInBytes:this._reader.getUint32(),ReturnPointWaveformLocation:this._reader.getFloat32(),Xt:this._reader.getFloat32(),Yt:this._reader.getFloat32(),Zt:this._reader.getFloat32()}}_parsePointDataRecordFormat_6(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits16(4),NumberOfReturns:this._reader.getBits16(4),ClassificationFlags:this._reader.getBits16(4),ScannerChannel:this._reader.getBits16(2),ScanDirectionFlag:this._reader.getBit16(),EdgeOfFlightLine:this._reader.getBit16(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},UserData:this._reader.getUint8(),ScanAngle:this._reader.getInt16(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64()}}_parsePointDataRecordFormat_7(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits16(4),NumberOfReturns:this._reader.getBits16(4),ClassificationFlags:this._reader.getBits16(4),ScannerChannel:this._reader.getBits16(2),ScanDirectionFlag:this._reader.getBit16(),EdgeOfFlightLine:this._reader.getBit16(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},UserData:this._reader.getUint8(),ScanAngle:this._reader.getInt16(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),R:this._reader.getUint16(),G:this._reader.getUint16(),B:this._reader.getUint16()}}_parsePointDataRecordFormat_8(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits16(4),NumberOfReturns:this._reader.getBits16(4),ClassificationFlags:this._reader.getBits16(4),ScannerChannel:this._reader.getBits16(2),ScanDirectionFlag:this._reader.getBit16(),EdgeOfFlightLine:this._reader.getBit16(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},UserData:this._reader.getUint8(),ScanAngle:this._reader.getInt16(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),R:this._reader.getUint16(),G:this._reader.getUint16(),B:this._reader.getUint16(),NIR:this._reader.getUint16()}}_parsePointDataRecordFormat_9(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits16(4),NumberOfReturns:this._reader.getBits16(4),ClassificationFlags:this._reader.getBits16(4),ScannerChannel:this._reader.getBits16(2),ScanDirectionFlag:this._reader.getBit16(),EdgeOfFlightLine:this._reader.getBit16(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},UserData:this._reader.getUint8(),ScanAngle:this._reader.getInt16(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),WavePacketDescriptorIndex:this._reader.getUint8(),ByteOffsetToWaveformData:this._reader.getUint64(),WaveformPacketSizeInBytes:this._reader.getUint32(),ReturnPointWaveformLocation:this._reader.getFloat32(),Xt:this._reader.getFloat32(),Yt:this._reader.getFloat32(),Zt:this._reader.getFloat32()}}_parsePointDataRecordFormat_10(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits16(4),NumberOfReturns:this._reader.getBits16(4),ClassificationFlags:this._reader.getBits16(4),ScannerChannel:this._reader.getBits16(2),ScanDirectionFlag:this._reader.getBit16(),EdgeOfFlightLine:this._reader.getBit16(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},UserData:this._reader.getUint8(),ScanAngle:this._reader.getInt16(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),R:this._reader.getUint16(),G:this._reader.getUint16(),B:this._reader.getUint16(),NIR:this._reader.getUint16(),WavePacketDescriptorIndex:this._reader.getUint8(),ByteOffsetToWaveformData:this._reader.getUint64(),WaveformPacketSizeInBytes:this._reader.getUint32(),ReturnPointWaveformLocation:this._reader.getFloat32(),Xt:this._reader.getFloat32(),Yt:this._reader.getFloat32(),Zt:this._reader.getFloat32()}}convert(e,t,i,s){try{const s=new d;s.name="Cloud",s.matrixAutoUpdate=!1,s.position.x=e.Header.XOffset,s.position.y=e.Header.YOffset,s.position.z=e.Header.ZOffset,s.userData={header:e.Header,records:e.VariableLengthRecords},this._createCloudPoints(s,e,i),t(s)}catch(e){s(e)}}_offsetPoints(){this._autoOffset&&(this._boundingBox.setFromPoints(this._points),this.setOffset(this._boundingBox.getCenter()));const e=this._offset.x,t=this._offset.y,i=this._offset.z;let s=null;for(let r=0,n=this._points.length;r<n;++r)s=this._points[r],s.x-=e,s.y-=t,s.z-=i}_createCloudPoints(e,t,i){const s={0:"Created",1:"Unclassified",2:"Ground",3:"LowVegetation",4:"MediumVegetation",5:"HighVegetation",6:"Building",7:"LowPoint",8:"ModelKeyPoint",9:"Water",12:"OverlapPoints"};let r=-1/0;for(let e of t.PointDataRecords){const t=e.Intensity;t>r&&(r=t)}const n=t.Header.XScaleFactor,a=t.Header.YScaleFactor,o=t.Header.ZScaleFactor,h=1e6,l=t.PointDataRecords.length,c=Math.ceil(l/h),d=t.Header.VersionMinor<4?t.Header.PointDataFormatID:t.Header.PointDataRecordFormat,m=![0,1,4,6,9].includes(d),f=new _({size:.01,vertexColors:!0});let w=0,b=null,y=null;for(let d=0;d<c;++d){b=t.PointDataRecords.splice(0,h),w=b.length;const c=new u,_=new Float32Array(3*w),x=new Float32Array(3*w);let v=0,M=null;for(let e=0;e<w;++e){const t=e+d*h;if(t%1e5==0&&i(new ProgressEvent("ConvertPointDataRecords",{lengthComputable:!0,loaded:t,total:l})),M=b[e],_[v]=M.X*n,_[v+1]=M.Y*a,_[v+2]=M.Z*o,m)x[v]=M.R/65535,x[v+1]=M.G/65535,x[v+2]=M.B/65535;else{const e=this.colorForPointClass[s[M.Classification.Class]];if(dt(e))x[v]=e.r/255,x[v+1]=e.g/255,x[v+2]=e.b/255;else{const e=M.Intensity;x[v]=e/r,x[v+1]=e/r,x[v+2]=e/r}}v+=3}c.setAttribute("position",new p(_,3)),c.setAttribute("color",new p(x,3)),y=new g(c,f),e.add(y)}}_createSubCloudPoint(e){const t=this._points.length,i=new u,s=new Float32Array(3*t),r=new Float32Array(3*t);let n=0,a=null;for(let e=0;e<t;++e)a=this._points[e],s[n]=a.x,s[n+1]=a.y,s[n+2]=a.z,this._pointsHaveColor?(r[n]=a.r/255,r[n+1]=a.g/255,r[n+2]=a.b/255):(r[n]=.1,r[n+1]=.2,r[n+2]=.5),n+=3;i.setAttribute("position",new p(s,3)),i.setAttribute("color",new p(r,3));const o=new _({size:.005,vertexColors:!0}),h=new g(i,o);h.rotation.x-=Math.PI/2,e.children.push(h),this._points=[]}}
/**
 * @module Loader/SHPLoader
 * @desc Export SHPLoader to load .shp files
 *
 * @requires {@link https://github.com/Itee/itee-client itee-client}
 * @requires {@link https://github.com/Itee/itee-utils itee-utils}
 * @requires {@link https://github.com/Itee/three-full three-full}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 * @example Todo...
 *
 */const Ei=e({NullShape:0,Point:1,Polyline:3,Polygon:5,MultiPoint:8,PointZ:11,PolyLineZ:13,PolygonZ:15,MultiPointZ:18,PointM:21,PolylineM:23,PolygonM:25,MultiPointM:28,MultiPatch:31});class Si{constructor(e={}){const t={manager:h,logger:o,reader:new nt,globalOffset:new m(0,0,0),worldAxis:{from:"zUp",to:"zForward"},...e};this.manager=t.manager,this.logger=t.logger,this.reader=t.reader,this.globalOffset=t.globalOffset,this.worldAxis=t.worldAxis}get globalOffset(){return this._globalOffset}set globalOffset(e){this._globalOffset=e}get worldAxis(){return this._worldAxis}set worldAxis(e){this._worldAxis=e}get manager(){return this._manager}set manager(e){this._manager=e}get logger(){return this._logger}set logger(e){this._logger=e}get reader(){return this._reader}set reader(e){this._reader=e}setGlobalOffset(e){return this.globalOffset=e,this}setWorldAxis(e){return this.worldAxis=e,this}setManager(e){return this.manager=e,this}setLogger(e){return this.logger=e,this}setReader(e){return this.reader=e,this}load(e,t,i,s){const r=this,n=new c(r.manager);n.setResponseType("arraybuffer"),n.load(e,e=>{t(r.parse(e))},i,s)}parse(e){this._reader.setEndianess(at.Big).setBuffer(e);const t=this._parseHeader();if(t.fileCode!==Si.FileCode)return this.logger.error("SHPLoader: Invalide Shape file code !"),null;if(t.fileLength<Si.MinFileLength)return this.logger.error("SHPLoader: Shape file have an incorrect length !"),null;if(!Object.values(Ei).includes(t.shapeType))return this.logger.error("SHPLoader: Shape file have an incorrect shape type !"),null;t.version<Si.MinVersion&&this.logger.warn("SHPLoader: Version of shape file below than 1000 could be incorrectly parsed !");const i=this._parseDatas(t);return this._convertToObjects(i)}_parseHeader(){const e=this._reader.getInt32();this._reader.skipOffsetOf(20);const t=this._reader.getInt32();this._reader.setEndianess(at.Little);const i=this._reader.getInt32(),s=this._reader.getInt32(),r=this._reader.getInt32(),n=this._reader.getInt32();return{fileCode:e,fileLength:t,version:i,shapeType:s,boundingBox:{xMin:r,xMax:this._reader.getInt32(),yMin:n,yMax:this._reader.getInt32(),zMin:this._reader.getInt32(),zMax:this._reader.getInt32(),mMin:this._reader.getInt32(),mMax:this._reader.getInt32()}}}_parseDatas(e){this._reader.skipOffsetTo(100);let t,i,s,r=[];for(;!this._reader.isEndOfFile();)switch(t=this._parseRecordHeader(),i=this._reader.getOffset()+2*t.contentLength,this._reader.setEndianess(at.Little),e.shapeType){case Ei.NullShape:this._reader.skipOffsetTo(i);break;case Ei.Point:case Ei.PointZ:case Ei.PointM:for(;this._reader.getOffset()<i;)s=this._parsePoint(),s&&r.push(s);break;case Ei.Polyline:case Ei.PolyLineZ:case Ei.PolylineM:for(;this._reader.getOffset()<i;)s=this._parsePolyLine(),s&&r.push(s);break;case Ei.Polygon:case Ei.PolygonZ:case Ei.PolygonM:for(;this._reader.getOffset()<i;)s=this._parsePolyLine(),s&&r.push(s);break;case Ei.MultiPoint:case Ei.MultiPointZ:case Ei.MultiPointM:for(;this._reader.getOffset()<i;)s=this._parseMultiPoint(),s&&r.push(s);break;case Ei.MultiPatch:for(;this._reader.getOffset()<i;)s=this._parseMultiPatch(),s&&r.push(s);break;default:this.logger.error(`SHPLoader: Invalid switch parameter: ${e.shapeType}`)}return r}_parseRecordHeader(){this._reader.setEndianess(at.Big);return{recordNumber:this._reader.getInt32(),contentLength:this._reader.getInt32()}}_parseNull(){return this._reader.getInt32(),null}_parsePoint(){const e=this._reader.getInt32();if(e===Ei.NullShape)return null;return{shapeType:e,x:this._reader.getFloat64(),y:this._reader.getFloat64()}}_parsePolyLine(){const e=this._reader.getInt32();if(e===Ei.NullShape)return null;const t={xMin:this._reader.getFloat64(),yMin:this._reader.getFloat64(),xMax:this._reader.getFloat64(),yMax:this._reader.getFloat64()},i=this._reader.getInt32(),s=this._reader.getInt32(),r=new Array(i);for(let e=0;e<i;e++)r[e]=this._reader.getInt32();const n=new Array(s);for(let e=0;e<s;e++)n[e]={x:this._reader.getFloat64(),y:this._reader.getFloat64()};return{shapeType:e,boundingBox:t,numberOfParts:i,numberOfPoints:s,parts:r,points:n}}_parsePolygon(){const e=this._reader.getInt32();if(e===Ei.NullShape)return null;const s={xMin:this._reader.getFloat64(),yMin:this._reader.getFloat64(),xMax:this._reader.getFloat64(),yMax:this._reader.getFloat64()},r=this._reader.getInt32(),n=this._reader.getInt32();let a=new Array(r);for(let e=0;e<r;e++)a[e]=this._reader.getInt32();let o=new Array(n);for(let e=0;e<n;e++)o[e]={x:this._reader.getFloat64(),y:this._reader.getFloat64()};const h=[],l=[];return a.forEach((e,i)=>{const s=o.slice(e,a[i+1]);t(s)?h.push(s):l.push(s)}),l.forEach(e=>{h.some(t=>{if(i(t[0],e))return t.push(e),!0})||h.push([e])}),{shapeType:e,boundingBox:s,numberOfParts:r,numberOfPoints:n,parts:a,polygons:h}}_parseMultiPoint(){const e=this._reader.getInt32();if(e===Ei.NullShape)return null;const t={xMin:this._reader.getFloat64(),xMax:this._reader.getFloat64(),yMin:this._reader.getFloat64(),yMax:this._reader.getFloat64()},i=this._reader.getInt32(),s=new Array(i);for(let e=0;e<i;e++)s.push([this._reader.getFloat64(),this._reader.getFloat64()]);return{shapeType:e,boundingBox:t,numberOfPoints:i,points:s}}_parseMultiPatch(){const e=this._reader.getInt32();return e===Ei.NullShape?null:{shapeType:e}}_convertToObjects(e){let t=[];for(let t=0,r=e.length;t<r;t++){let r=e[t];r.shapeType!==Ei.Polygon&&r.shapeType!==Ei.PolygonZ&&r.shapeType!==Ei.PolygonM||(r.points&&Array.isArray(r.points[0])?i(r.points):s(r.points))}function i(e){for(let t=0,r=e.length;t<r;t++){let r=e[t];r?Array.isArray(r[0])?i(r):s(r):this.logger.log("no array, oups !")}}function s(e){t.push(new f(e))}return t}}Si.FileCode=9994,Si.MinFileLength=100,Si.MinVersion=1e3;class Pi{constructor(e,t){if(this.m_bits=new Array,t&&t.length)for(let e=0;e<t.length;e++)this.m_bits.push(t[e]?Pi._ON:Pi._OFF);else isNaN(t)||(this.m_bits=Pi.shred(t).m_bits);if(e&&this.m_bits.length!==e)if(this.m_bits.length<e)for(let t=this.m_bits.length;t<e;t++)this.m_bits.push(Pi._OFF);else for(let t=e;t>this.m_bits.length;t--)this.m_bits.pop()}static _intersect(e,t){return e===Pi._ON&&t===Pi._ON?Pi._ON:Pi._OFF}static _union(e,t){return e===Pi._ON||t===Pi._ON?Pi._ON:Pi._OFF}static _difference(e,t){return e===Pi._ON&&t!==Pi._ON?Pi._ON:Pi._OFF}static _getLen(e,t,i){var s=e.getLength(),r=t.getLength();return i?r:s}static getUnion(e,t){for(var i=Pi._getLen(e,t,!0),s=new Pi(i),r=0;r<i;r++)s.setAt(r,Pi._union(e.getAt(r),t.getAt(r)));return s}static getIntersection(e,t){for(var i=Pi._getLen(e,t,!0),s=new Pi(i),r=0;r<i;r++)s.setAt(r,Pi._intersect(e.getAt(r),t.getAt(r)));return s}static getDifference(e,t){for(var i=Pi._getLen(e,t,!0),s=new Pi(i),r=0;r<i;r++)s.setAt(r,Pi._difference(e.getAt(r),t.getAt(r)));return s}static shred(e){var t=new Array,i=e;do{t.push(i%2),i=Math.floor(i/2)}while(i>0);return new Pi(t.length,t.reverse())}getLength(){return this.m_bits.length}getAt(e){return e<this.m_bits.length?this.m_bits[e]:null}setAt(e,t){e<this.m_bits.length&&(this.m_bits[e]=t?Pi._ON:Pi._OFF)}resize(e){for(var t=new Array,i=0;i<e;i++)i<this.m_bits.length?t.push(this.m_bits[i]):t.push(Pi._OFF);this.m_bits=t}getCompliment(){for(var e=new Pi(this.m_bits.length),t=0;t<this.m_bits.length;t++)e.setAt(t,this.m_bits[t]?Pi._OFF:Pi._ON);return e}toString(){for(var e=new String,t=0;t<this.m_bits.length;t++)e=e.concat(this.m_bits[t]===Pi._ON?"1":"0");return e}toNumber(){for(var e=0,t=0,i=this.m_bits.length-1;i>=0;i--)this.m_bits[i]===Pi._ON&&(t+=Math.pow(2,e)),e++;return t}}Pi._ON=1,Pi._OFF=0;class Fi{static getBit(e,t){return e&1<<t?1:0}static setBit(e,t){return e|1<<t}static clearBit(e,t){return e&~(1<<t)}static updateBit(e,t,i){return e&~(1<<t)|(i?1:0)<<t}static getBits(e,t){let i=0;for(let s of t)Fi.getBit(e,s)&&(i=Fi.setBit(i,s));return i}}
/**
 * @module Controllers/CameraControls
 * @desc This module export CameraControls class and CameraControlMode enum values.
 *
 * @requires {@link module: [itee-client]{@link https://github.com/Itee/itee-client}}
 * @requires {@link module: [itee-utils]{@link https://github.com/Itee/itee-utils}}
 * @requires {@link module: [itee-validators]{@link https://github.com/Itee/itee-validators}}
 * @requires {@link module: [three-full]{@link https://github.com/Itee/three-full}}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @example
 *
 * import { CameraControls, CameraControlMode } from 'itee-plugin-three'
 *
 */const Ai=new m(0,0,-1),Oi=new m(0,0,1),Ci=new m(0,1,0),Di=new m(0,-1,0),zi=new m(1,0,0),Ti=new m(-1,0,0),ki=e({None:0,Rotating:1,Panning:2,Rolling:3,Zooming:4,Moving:5}),Bi=e({FirstPerson:1,Orbit:2,Fly:3,Path:4});class Ii extends w{constructor(e={}){const t={logger:o,camera:null,target:new b,mode:Bi.Orbit,domElement:"function"==typeof importScripts?null:window,...e};super(),this._handlers={onMouseEnter:this._onMouseEnter.bind(this),onMouseLeave:this._onMouseLeave.bind(this),onMouseDown:this._onMouseDown.bind(this),onMouseMove:this._onMouseMove.bind(this),onMouseWheel:this._onMouseWheel.bind(this),onMouseUp:this._onMouseUp.bind(this),onDblClick:this._onDblClick.bind(this),onTouchStart:this._onTouchStart.bind(this),onTouchEnd:this._onTouchEnd.bind(this),onTouchCancel:this._onTouchCancel.bind(this),onTouchLeave:this._onTouchLeave.bind(this),onTouchMove:this._onTouchMove.bind(this),onKeyDown:this._onKeyDown.bind(this),onKeyUp:this._onKeyUp.bind(this)},this.logger=t.logger,this.camera=t.camera,this.target=t.target,this.mode=t.mode,this.domElement=t.domElement,this.enabled=!0,this._paths=[],this._trackPath=!1,this._cameraJump=.1,this._currentPathPosition=null,this._currentPathOffset=0,this._currentPathIndex=0,this._currentPath=null,this._maxJump=1,this._lockedTarget=!0,this.previousTouches=[],this.canMove=!0,this.moveSpeed=1,this.canFront=!0,this.frontMinimum=-1/0,this.frontMaximum=-1/0,this.frontMinSpeed=0,this.frontSpeed=1,this.frontMaxSpeed=1/0,this.frontAcceleration=1,this.canBack=!0,this.backMinimum=-1/0,this.backMaximum=-1/0,this.backMinSpeed=0,this.backSpeed=1,this.backMaxSpeed=1/0,this.backAcceleration=1,this.canUp=!0,this.upMinimum=-1/0,this.upMaximum=-1/0,this.upMinSpeed=0,this.upSpeed=1,this.upMaxSpeed=1/0,this.upAcceleration=1,this.canDown=!0,this.downMinimum=-1/0,this.downMaximum=-1/0,this.downMinSpeed=0,this.downSpeed=1,this.downMaxSpeed=1/0,this.downAcceleration=1,this.canLeft=!0,this.leftMinimum=-1/0,this.leftMaximum=-1/0,this.leftMinSpeed=0,this.leftSpeed=1,this.leftMaxSpeed=1/0,this.leftAcceleration=1,this.canRight=!0,this.rightMinimum=-1/0,this.rightMaximum=-1/0,this.rightMinSpeed=0,this.rightSpeed=1,this.rightMaxSpeed=1/0,this.rightAcceleration=1,this.canRotate=!0,this.minPolarAngle=.001,this.maxPolarAngle=Math.PI-.001,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.rotateMinSpeed=0,this.rotateSpeed=1,this.rotateMaxSpeed=1/0,this.rotateAcceleration=1,this.canPan=!0,this.panMinimum=-1/0,this.panMaximum=-1/0,this.panMinSpeed=0,this.panSpeed=.001,this.panMaxSpeed=1/0,this.panAcceleration=1,this.canRoll=!0,this.rollMinimum=-1/0,this.rollMaximum=-1/0,this.rollMinSpeed=0,this.rollSpeed=.1,this.rollMaxSpeed=1/0,this.rollAcceleration=1,this.canZoom=!0,this.zoomMinimum=0,this.zoomMaximum=1/0,this.zoomMinSpeed=0,this.zoomSpeed=.001,this.zoomMaxSpeed=1/0,this.zoomAcceleration=1,this.canLookAt=!0,this.actionsMap={front:[ht.Z.value,ht.UP_ARROW.value],back:[ht.S.value,ht.DOWN_ARROW.value],up:[ht.A.value,ht.PAGE_UP.value],down:[ht.E.value,ht.PAGE_DOWN.value],left:[ht.Q.value,ht.LEFT_ARROW.value],right:[ht.D.value,ht.RIGHT_ARROW.value],rotate:[lt.Left.value],pan:[lt.Middle.value],roll:{left:[ht.R.value],right:[ht.T.value]},zoom:[lt.Wheel.value],lookAtFront:[ht.NUMPAD_2.value],lookAtFrontLeft:[ht.NUMPAD_3.value],lookAtFrontRight:[ht.NUMPAD_1.value],lookAtBack:[ht.NUMPAD_8.value],lookAtBackLeft:[ht.NUMPAD_9.value],lookAtBackRight:[ht.NUMPAD_7.value],lookAtUp:[ht.NUMPAD_5.value],lookAtDown:[ht.NUMPAD_0.value],lookAtLeft:[ht.NUMPAD_6.value],lookAtRight:[ht.NUMPAD_4.value]},this._state=ki.None}get camera(){return this._camera}set camera(e){if(ut(e))throw new Error("Camera cannot be null ! Expect an instance of Camera");if(pt(e))throw new Error("Camera cannot be undefined ! Expect an instance of Camera");if(!e.isCamera)throw new Error(`Camera cannot be an instance of ${e.constructor.name}. Expect an instance of Camera.`);this._camera=e}get target(){return this._target}set target(e){if(ut(e))throw new Error("Target cannot be null ! Expect an instance of Object3D.");if(pt(e))throw new Error("Target cannot be undefined ! Expect an instance of Object3D.");if(!e.isObject3D)throw new Error(`Target cannot be an instance of ${e.constructor.name}. Expect an instance of Object3D.`);this._target=e}get mode(){return this._mode}set mode(e){if(ut(e))throw new Error("Mode cannot be null ! Expect a value from CameraControlMode enum.");if(pt(e))throw new Error("Mode cannot be undefined ! Expect a value from CameraControlMode enum.");if(!Bi.includes(e))throw new Error(`Mode cannot be an instance of ${e.constructor.name}. Expect a value from TCameraControlMode enum.`);this._mode=e,this._trackPath&&this._initPathDisplacement()}get paths(){return this._paths}set paths(e){this._paths=e}get trackPath(){return this._trackPath}set trackPath(e){if(_t(e))throw new Error(`Track path cannot be an instance of ${e.constructor.name}. Expect a boolean.`);this._trackPath=e,this._trackPath&&this._initPathDisplacement()}get domElement(){return this._domElement}set domElement(e){if(ut(e))throw new Error("DomElement cannot be null ! Expect an instance of HTMLDocument.");if(pt(e))throw new Error("DomElement cannot be undefined ! Expect an instance of HTMLDocument.");if(!["Window","HTMLDocument","HTMLDivElement","HTMLCanvasElement","OffscreenCanvas"].includes(e.constructor.name))throw new Error(`DomElement cannot be an instance of ${e.constructor.name}. Expect an instance of Window, HTMLDocument or HTMLDivElement.`);this._domElement&&(this._domElement.removeEventListener("mouseenter",this._handlers.onMouseEnter,!1),this._domElement.removeEventListener("mouseleave",this._handlers.onMouseLeave,!1),this.dispose()),this._domElement=e,this._domElement.addEventListener("mouseenter",this._handlers.onMouseEnter,!1),this._domElement.addEventListener("mouseleave",this._handlers.onMouseLeave,!1),this.impose()}get handlers(){return this._handlers}setCamera(e){return this.camera=e,this}setTarget(e){return this.target=e,this}setMode(e){return this.mode=e,this}setPaths(e){return this.paths=e,this}addPath(e){return this._paths.push(e),this}setTrackPath(e){return this.trackPath=e,this}setDomElement(e){return this.domElement=e,this}impose(){this._domElement.addEventListener("keydown",this._handlers.onKeyDown,!1),this._domElement.addEventListener("keyup",this._handlers.onKeyUp,!1),this._domElement.addEventListener("dblclick",this._handlers.onDblClick,!1),this._domElement.addEventListener("mousedown",this._handlers.onMouseDown,!1),this._domElement.addEventListener("mousemove",this._handlers.onMouseMove,!1),this._domElement.addEventListener("mouseup",this._handlers.onMouseUp,!1),this._domElement.addEventListener("wheel",this._handlers.onMouseWheel,{capture:!0,once:!1,passive:!1}),this._domElement.addEventListener("touchcancel",this._handlers.onTouchCancel,!1),this._domElement.addEventListener("touchend",this._handlers.onTouchEnd,!1),this._domElement.addEventListener("touchleave",this._handlers.onTouchLeave,!1),this._domElement.addEventListener("touchmove",this._handlers.onTouchMove,{capture:!0,once:!1,passive:!1}),this._domElement.addEventListener("touchstart",this._handlers.onTouchStart,{capture:!0,once:!1,passive:!1}),this.dispatchEvent({type:"impose"})}dispose(){this._domElement.removeEventListener("keydown",this._handlers.onKeyDown,!1),this._domElement.removeEventListener("keyup",this._handlers.onKeyUp,!1),this._domElement.removeEventListener("dblclick",this._handlers.onDblClick,!1),this._domElement.removeEventListener("mousedown",this._handlers.onMouseDown,!1),this._domElement.removeEventListener("mousemove",this._handlers.onMouseMove,!1),this._domElement.removeEventListener("mouseup",this._handlers.onMouseUp,!1),this._domElement.removeEventListener("wheel",this._handlers.onMouseWheel,{capture:!0,once:!1,passive:!1}),this._domElement.removeEventListener("touchcancel",this._handlers.onTouchCancel,!1),this._domElement.removeEventListener("touchend",this._handlers.onTouchEnd,!1),this._domElement.removeEventListener("touchleave",this._handlers.onTouchLeave,!1),this._domElement.removeEventListener("touchmove",this._handlers.onTouchMove,{capture:!0,once:!1,passive:!1}),this._domElement.removeEventListener("touchstart",this._handlers.onTouchStart,{capture:!0,once:!1,passive:!1}),this.dispatchEvent({type:"dispose"})}update(){}setCameraPosition(e){return this._camera.position.copy(e),this._camera.lookAt(this._target.position),this}setTargetPosition(e){return this._target.position.copy(e),this._camera.lookAt(this._target.position),this}_preventEvent(e){e.preventDefault&&e.preventDefault()}_consumeEvent(e){e.cancelable&&e.stopImmediatePropagation&&e.stopImmediatePropagation()}_onKeyDown(e){if(!this.enabled)return;this._preventEvent(e);const t=this.actionsMap,i=e.keyCode;t.front.includes(i)?(this._front(),this._consumeEvent(e)):t.back.includes(i)?(this._back(),this._consumeEvent(e)):t.up.includes(i)?(this._up(),this._consumeEvent(e)):t.down.includes(i)?(this._down(),this._consumeEvent(e)):t.left.includes(i)?(this._left(),this._consumeEvent(e)):t.right.includes(i)?(this._right(),this._consumeEvent(e)):t.rotate.includes(i)?this._rotate(1):t.pan.includes(i)?(this._pan(1),this._consumeEvent(e)):t.roll.left.includes(i)?(this._roll(1),this._consumeEvent(e)):t.roll.right.includes(i)?(this._roll(-1),this._consumeEvent(e)):t.zoom.includes(i)?(this._zoom(1),this._consumeEvent(e)):t.lookAtFront.includes(i)?(this._lookAt(Ai),this._consumeEvent(e)):t.lookAtFrontLeft.includes(i)?(this._lookAt(new m(-1,0,-1).normalize()),this._consumeEvent(e)):t.lookAtFrontRight.includes(i)?(this._lookAt(new m(1,0,-1).normalize()),this._consumeEvent(e)):t.lookAtBack.includes(i)?(this._lookAt(Oi),this._consumeEvent(e)):t.lookAtBackLeft.includes(i)?(this._lookAt(new m(-1,0,1).normalize()),this._consumeEvent(e)):t.lookAtBackRight.includes(i)?(this._lookAt(new m(1,0,1).normalize()),this._consumeEvent(e)):t.lookAtUp.includes(i)?(this._lookAt(Ci),this._consumeEvent(e)):t.lookAtDown.includes(i)?(this._lookAt(Di),this._consumeEvent(e)):t.lookAtLeft.includes(i)?(this._lookAt(Ti),this._consumeEvent(e)):t.lookAtRight.includes(i)&&(this._lookAt(zi),this._consumeEvent(e))}_onKeyUp(e){this.enabled&&this._preventEvent(e)}_onTouchStart(e){this.enabled&&(this._preventEvent(e),this.previousTouches=e.touches)}_onTouchEnd(e){this.enabled&&(this._preventEvent(e),this.previousTouches=[],this._state=ki.None)}_onTouchCancel(e){this.enabled&&(this._preventEvent(e),this.previousTouches=[],this._state=ki.None)}_onTouchLeave(e){this.enabled&&(this._preventEvent(e),this.previousTouches=[],this._state=ki.None)}_onTouchMove(e){if(!this.enabled)return;this._preventEvent(e);const t=this.previousTouches,i=e.changedTouches,s=t.length,r=i.length;if(2===s&&2===r){const s=new y(t[0].clientX,t[0].clientY),r=new y(t[1].clientX,t[1].clientY),n=s.distanceTo(r),a=(new y).addVectors(s,r).divideScalar(2),o=(new y).subVectors(s,r).normalize(),h=new y(i[0].clientX,i[0].clientY),l=new y(i[1].clientX,i[1].clientY),c=h.distanceTo(l),d=(new y).addVectors(h,l).divideScalar(2),u=(new y).subVectors(s,r).normalize(),p=(new y).subVectors(d,a),_=c-n,g=u.dot(o);this._pan(p),this._zoom(_),this._roll(g),this._consumeEvent(e)}else if(1===s&&1===r){const s=new y(i[0].clientX-t[0].clientX,i[0].clientY-t[0].clientY).divideScalar(10);this._rotate(s),this._consumeEvent(e)}else this.logger.warn("Ignoring inconsistent touches event.");this.previousTouches=i}_onMouseEnter(e){this.enabled&&(this._preventEvent(e),this.impose(),e.target.constructor!==HTMLDocument&&this._domElement.focus())}_onMouseLeave(e){this.enabled&&(this._preventEvent(e),e.target.constructor!==HTMLDocument&&this._domElement.blur(),this.dispose(),this._state=ki.None)}_onMouseDown(e){if(!this.enabled)return;this._preventEvent(e);const t=this.actionsMap,i=e.button;t.front.includes(i)?(this._state=ki.Moving,this._front(),this._consumeEvent(e)):t.back.includes(i)?(this._state=ki.Moving,this._back(),this._consumeEvent(e)):t.up.includes(i)?(this._state=ki.Moving,this._up(),this._consumeEvent(e)):t.down.includes(i)?(this._state=ki.Moving,this._down(),this._consumeEvent(e)):t.left.includes(i)?(this._state=ki.Moving,this._left(),this._consumeEvent(e)):t.right.includes(i)?(this._state=ki.Moving,this._right(),this._consumeEvent(e)):t.rotate.includes(i)?(this._state=ki.Rotating,this._consumeEvent(e)):t.pan.includes(i)?(this._state=ki.Panning,this._consumeEvent(e)):t.roll.left.includes(i)||t.roll.right.includes(i)?(this._state=ki.Rolling,this._consumeEvent(e)):t.zoom.includes(i)?(this._state=ki.Zooming,this._consumeEvent(e)):this._state=ki.None}_onMouseMove(e){if(!this.enabled||this._state===ki.None)return;this._preventEvent(e);const t=this._state,i={x:e.movementX||e.mozMovementX||e.webkitMovementX||0,y:e.movementY||e.mozMovementY||e.webkitMovementY||0};switch(t){case ki.Moving:break;case ki.Rotating:this._rotate(i),this._consumeEvent(e);break;case ki.Panning:this._pan(i),this._consumeEvent(e);break;case ki.Rolling:this._roll(i),this._consumeEvent(e);break;case ki.Zooming:this._zoom(i),this._consumeEvent(e);break;default:throw new RangeError(`Unknown state: ${t}`)}}_onMouseWheel(e){if(!this.enabled)return;this._preventEvent(e);const t=e.wheelDelta||e.deltaY;this._zoom(t),this._consumeEvent(e)}_onMouseUp(e){this.enabled&&(this._preventEvent(e),this._state=ki.None,this._consumeEvent(e))}_onDblClick(e){this.enabled&&(this._preventEvent(e),this.logger.warn("CameraControls: Double click events is not implemented yet, sorry for the disagreement."))}_front(){if(this.canMove&&this.canFront){if(this._camera.isPerspectiveCamera){const e=Ai.clone().applyQuaternion(this._camera.quaternion),t=this._trackPath?this._getPathDisplacement(e):e.multiplyScalar(this.frontSpeed);this._camera.position.add(t),this._target.position.add(t)}else if(this._camera.isOrthographicCamera){const e=Ai.clone().applyQuaternion(this._camera.quaternion),t=this._trackPath?this._getPathDisplacement(e):e.multiplyScalar(this.frontSpeed);this._camera.position.add(t),this._target.position.add(t);const i=this.frontSpeed*this.zoomSpeed;this._camera.zoom+=i,this._camera.updateProjectionMatrix()}else this.logger.error(`Unmanaged displacement for camera of type ${this._camera.type}`);this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_back(){if(this.canMove&&this.canBack){if(this._camera.isPerspectiveCamera){const e=Oi.clone().applyQuaternion(this._camera.quaternion),t=this._trackPath?this._getPathDisplacement(e):e.multiplyScalar(this.backSpeed);this._camera.position.add(t),this._target.position.add(t)}else if(this._camera.isOrthographicCamera){const e=Oi.clone().applyQuaternion(this._camera.quaternion),t=this._trackPath?this._getPathDisplacement(e):e.multiplyScalar(this.backSpeed);this._camera.position.add(t),this._target.position.add(t);const i=this.backSpeed*this.zoomSpeed;this._camera.zoom-i<=0?this._camera.zoom=.01:this._camera.zoom-=i,this._camera.updateProjectionMatrix()}else this.logger.error(`Unmanaged displacement for camera of type ${this._camera.type}`);this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_up(){if(this.canMove&&this.canUp){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const e=Ci.clone().applyQuaternion(this._camera.quaternion).multiplyScalar(this.upSpeed);this._camera.position.add(e),this._target.position.add(e)}else this.logger.error(`Unmanaged displacement for camera of type ${this._camera.type}`);this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_down(){if(this.canMove&&this.canDown){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const e=Di.clone().applyQuaternion(this._camera.quaternion).multiplyScalar(this.downSpeed);this._camera.position.add(e),this._target.position.add(e)}else this.logger.error(`Unmanaged displacement for camera of type ${this._camera.type}`);this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_left(){if(this.canMove&&this.canLeft){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const e=Ti.clone().applyQuaternion(this._camera.quaternion).multiplyScalar(this.leftSpeed);this._camera.position.add(e),this._target.position.add(e)}else this.logger.error(`Unmanaged displacement for camera of type ${this._camera.type}`);this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_right(){if(this.canMove&&this.canRight){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const e=zi.clone().applyQuaternion(this._camera.quaternion).multiplyScalar(this.rightSpeed);this._camera.position.add(e),this._target.position.add(e)}this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_rotate(e){if(this.canRotate){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const t=this._camera.position,i=this._target.position,r=t.distanceTo(i),n=(new m).subVectors(t,i).normalize(),a=this.rotateSpeed;switch(this._mode){case Bi.FirstPerson:{const s=e.x,r=e.y,n=new m(-s,r,0).applyQuaternion(this._camera.quaternion).multiplyScalar(a).add(i),o=(new m).subVectors(n,t).normalize(),h=Ci.clone().dot(o),l=zi.clone().dot(o),c=.97;if(h<-c||h>c||l<-2||l>2)return;const d=o.multiplyScalar(1).add(t);this.setTargetPosition(d)}break;case Bi.Orbit:{const t=(new x).setFromVector3(n),o=t.theta+s(-e.x)*a,h=t.phi+s(-e.y)*a;t.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,o)),t.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,h));const l=(new m).setFromSpherical(t).multiplyScalar(r).add(i);this.setCameraPosition(l)}break;default:throw new RangeError(`Unamanaged rotation for camera mode ${this._mode}`)}}this.dispatchEvent({type:"rotate"}),this.dispatchEvent({type:"change"})}}_pan(e){if(this.canPan){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const t=this._camera.position,i=this._target.position,s=t.distanceTo(i),r=new m(-e.x,e.y,0).applyQuaternion(this._camera.quaternion).multiplyScalar(this.panSpeed*s);this._camera.position.add(r),this._target.position.add(r)}this.dispatchEvent({type:"pan"}),this.dispatchEvent({type:"change"})}}_roll(e){if(this.canRoll){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const t=this._camera.position,i=this._target.position,s=(new m).subVectors(t,i).normalize(),r=e*this.rollSpeed;this._camera.up.applyAxisAngle(s,r),this._camera.lookAt(i)}this.dispatchEvent({type:"roll"}),this.dispatchEvent({type:"change"})}}_zoom(e){if(this.canZoom){if(this._camera.isPerspectiveCamera)switch(this._mode){case Bi.FirstPerson:e>0?this._camera.fov--:this._camera.fov++,this._camera.updateProjectionMatrix();break;case Bi.Orbit:{const t=this._camera.position,i=this._target.position,s=t.distanceTo(i),r=Ai.clone().applyQuaternion(this._camera.quaternion).multiplyScalar(e*this.zoomSpeed*s);let n=t.clone().add(r);const a=(new m).subVectors(n,t).normalize(),o=(new m).subVectors(t,i).normalize(),h=(new m).subVectors(n,i).normalize(),l=a.dot(o),c=a.dot(h),d=n.distanceToSquared(i);l<0&&(d<this.zoomMinimum*this.zoomMinimum||c>0)&&(n=o.clone().multiplyScalar(this.zoomMinimum).add(i)),this._camera.position.copy(n)}break;default:throw new RangeError(`Invalid camera control mode parameter: ${this._mode}`)}else if(this._camera.isOrthographicCamera){const t=this.domElement.offsetWidth/this.domElement.offsetHeight,i=this._camera.position,s=this._target.position,r=i.distanceTo(s),n=(e>0?Ai.clone():Oi.clone()).applyQuaternion(this._camera.quaternion).normalize().multiplyScalar(this.zoomSpeed*r);i.add(n);const a=i.distanceTo(s),o=a/2,h=a*t/2;this._camera.top=o,this._camera.bottom=-o,this._camera.right=h,this._camera.left=-h,this._camera.updateProjectionMatrix()}this.dispatchEvent({type:"zoom"}),this.dispatchEvent({type:"change"})}}_lookAt(e){if(this.canLookAt){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const t=e.clone(),i=this._camera.position,s=this._target.position,r=i.distanceTo(s);switch(this.mode){case Bi.FirstPerson:{t.y=-t.y;const e=t.multiplyScalar(r).add(i);this.setTargetPosition(e)}break;case Bi.Orbit:{const e=t.multiplyScalar(r).add(s);this.setCameraPosition(e)}break;default:throw new RangeError(`Invalid camera control mode parameter: ${this._mode}`)}}this.dispatchEvent({type:"lookAt"}),this.dispatchEvent({type:"change"})}}_initPathDisplacement(){if(gt(this._paths))this.logger.warn("Try to init path displacement without any paths");else switch(mt(this._currentPath)&&(this._currentPathIndex=0,this._currentPathOffset=0,this._currentPath=this._paths[0]),this._currentPathPosition=this._currentPath.getPointAt(this._currentPathOffset),this._mode){case Bi.FirstPerson:if(this._lockedTarget){const e=(new m).subVectors(this._currentPathPosition,this.camera.position);this._camera.position.add(e),this._target.position.add(e)}else this.setCameraPosition(this._currentPathPosition);break;case Bi.Orbit:if(this._lockedTarget){const e=(new m).subVectors(this._currentPathPosition,this.target.position);this._camera.position.add(e),this._target.position.add(e)}else this.setTargetPosition(this._currentPathPosition);break;default:throw new RangeError(`Invalid camera control _mode parameter: ${this._mode}`)}}_getPathDisplacement(e){let t=null;const i=this._currentPathPosition,s=this._currentPathOffset+this._cameraJump,r=s<1?s:1,n=this._currentPath.getPointAt(r),a=(new m).subVectors(n,i),o=a.clone().normalize(),h=e.dot(o),l=this._currentPathOffset-this._cameraJump,c=l>0?l:0,d=this._currentPath.getPointAt(c),u=(new m).subVectors(d,i),p=u.clone().normalize(),_=e.dot(p);if(0===h&&_<0){const i=this._getDirectionsMap();let s,r,n,a=-1;i.forEach(t=>{const i=t.index,o=t.startDisplacement;if(o){const t=o.clone().normalize(),h=e.dot(t);h>a&&(s=i,r=o,a=h,n=!0)}const h=t.endDisplacement;if(h){const t=h.clone().normalize(),o=e.dot(t);o>a&&(s=i,r=h,a=o,n=!1)}}),void 0!==s?(this._currentPathIndex=s,this._currentPath=this._paths[this._currentPathIndex],this._currentPathOffset=n?this._cameraJump:1-this._cameraJump,this._currentPathPosition=this._currentPath.getPointAt(this._currentPathOffset),t=r):(this.logger.warn("Reach path end."),t=new m)}else if(h>0&&_<=0)t=a,this._currentPathOffset=r,this._currentPathPosition=n;else if(h<=0&&_>0)t=u,this._currentPathOffset=c,this._currentPathPosition=d;else if(h<0&&0===_){const i=this._getDirectionsMap();let s,r,n,a=-1;i.forEach(t=>{const i=t.index,o=t.startDisplacement;if(o){const t=o.clone().normalize(),h=e.dot(t);h>a&&(s=i,r=o,a=h,n=!0)}const h=t.endDisplacement;if(h){const t=h.clone().normalize(),o=e.dot(t);o>a&&(s=i,r=h,a=o,n=!1)}}),void 0!==s?(this._currentPathIndex=s,this._currentPath=this._paths[this._currentPathIndex],this._currentPathOffset=n?this._cameraJump:1-this._cameraJump,this._currentPathPosition=this._currentPath.getPointAt(this._currentPathOffset),t=r):(this.logger.warn("Reach path start."),t=new m)}else h<0&&_<0||h>0&&_>0?h>_?(t=a,this._currentPathOffset=r,this._currentPathPosition=n):(t=u,this._currentPathOffset=c,this._currentPathPosition=d):(this.logger.warn("Unable to find correct next path position."),t=new m);return t}_getDirectionsMap(){const e=this._currentPathPosition,t=this._currentPathIndex,i=this._cameraJump,s=this._maxJump;return this._paths.reduce((r,n,a)=>{if(a===t)return r;const o=n.getPointAt(0);let h;e.distanceToSquared(o)<s&&(h=(new m).subVectors(n.getPointAt(i),o));const l=n.getPointAt(1);let c;return e.distanceToSquared(l)<s&&(c=(new m).subVectors(n.getPointAt(1-i),l)),(h||c)&&r.push({index:a,startDisplacement:h,endDisplacement:c}),r},[])}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Ui extends v{constructor(e){super(e),this.isHighlightableMaterial=!0,this.depthTest=!1,this.depthWrite=!1,this.fog=!1,this.transparent=!0,this.linewidth=1,this.oldColor=this.color.clone()}highlight(e){if(e){const e=.35,t=this.color.r,i=this.color.g,s=this.color.b,r=Math.min(Math.max(0,t+t*e),1),n=Math.min(Math.max(0,i+i*e),1),a=Math.min(Math.max(0,s+s*e),1);this.color.setRGB(r,n,a)}else this.color.copy(this.oldColor)}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Ri extends M{constructor(e){super(e),this.isHighlightableMaterial=!0,this.depthTest=!1,this.depthWrite=!1,this.fog=!1,this.side=E,this.transparent=!0,this.oldColor=this.color.clone()}highlight(e){if(e){const e=.35,t=this.color.r,i=this.color.g,s=this.color.b,r=Math.min(Math.max(0,t+t*e),1),n=Math.min(Math.max(0,i+i*e),1),a=Math.min(Math.max(0,s+s*e),1);this.color.setRGB(r,n,a)}else this.color.copy(this.oldColor)}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Li extends S{constructor(e={}){const t={geometry:new u,material:new M({visible:!1,depthTest:!1,depthWrite:!1,fog:!1,side:E,color:6636321}),...e};super(t.geometry,t.material),this.isHitbox=!0,this.type="Hitbox",this.matrixAutoUpdate=!1}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Gi extends Li{constructor(e={}){super({geometry:new P(1.2,0),...e}),this.isOctahedricalHitbox=!0,this.type="OctahedricalHitbox"}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Hi extends b{constructor(e={}){const t={debug:!1,color:16777215,hitbox:null,...e};super(t),this.isHandle=!0,this.type="Handle",this.matrixAutoUpdate=!0,this.debug=t.debug,this.color=t.color,this.hitbox=t.hitbox,this.baseQuaternion=new F}get color(){return this.line.material.color.clone()}set color(e){if(ut(e))throw new Error("Color cannot be null ! Expect an instance of Color.");if(pt(e))throw new Error("Color cannot be undefined ! Expect an instance of Color.");this.traverse(t=>{let i=t.material;i&&i.color.setHex(e)})}get hitbox(){return this._hitbox}set hitbox(e){this._hitbox=e,this.add(e)}setColor(e){return this.color=e,this}setHitbox(e){return this.hitbox=e,this}setScale(e,t,i){return this.scale.set(e,t,i),this}setPosition(e,t,i){return this.position.set(e,t,i),this}highlight(e){for(let t=0,i=this.children.length;t<i;t++){const i=this.children[t];if(i.isHitbox)continue;const s=i.material;!pt(s)&&s.isHighlightableMaterial&&s.highlight(e)}}raycast(e,t){const i=e.intersectObject(this._hitbox,!1);i.length>0&&t.push({distance:i[0].distance,object:this})}setRotationFromAxisAndAngle(e,t){return this.quaternion.setFromAxisAngle(e,t),this.baseQuaternion.copy(this.quaternion),this}update(e){}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Ni extends Hi{constructor(e={}){const t={color:16777215,hitbox:new Gi,...e};super(t),this.isOmnidirectionalHandle=!0,this.type="OmnidirectionalHandle";const i=new P(.1,0),s=new Ri({color:t.color,transparent:!0,opacity:.55}),r=new S(i,s);r.matrixAutoUpdate=!1,this.add(r);const n=new A(i),a=new Ui({color:t.color,linewidth:4}),o=new O(n,a);o.matrixAutoUpdate=!1,this.add(o)}update(e){super.update(e),this.updateMatrix(),this.hitbox.updateMatrix()}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class ji extends Li{constructor(e={}){const t=e.centered?[-.6,-.6,0,.6,-.6,0,.6,.6,0,-.6,.6,0]:[0,0,0,1.1,0,0,1.1,1.1,0,0,1.1,0],i=new u;i.setAttribute("position",new C(t,3)),i.setIndex([0,1,2,2,3,0]);super({geometry:i,...e}),this.isPlanarHitbox=!0,this.type="PlanarHitbox"}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Yi extends Hi{constructor(e={}){const t={showEdges:!1,centered:!1,color:16777215,hitbox:new ji({centered:e.centered||!1}),direction:new m(0,1,0),...e};if(super(t),this.isPlaneHandle=!0,this.type="PlaneHandle",t.showEdges){const e=new u;e.setAttribute("position",new C([.75,1,0,1,1,0,1,.75,0],3));const i=new Ui({color:t.color}),s=new D(e,i);s.matrixAutoUpdate=!1,this.add(s)}const i=t.centered?[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]:[.1,.1,0,1,.1,0,1,1,0,.1,1,0],s=new u;s.setAttribute("position",new C(i,3)),s.setIndex([0,1,2,2,3,0]);const r=new Ri({color:t.color,transparent:!0,opacity:.35}),n=new S(s,r);if(n.matrixAutoUpdate=!1,this.add(n),this.xAxis=new m(1,0,0),this.yAxis=new m(0,1,0),this.zAxis=new m(0,0,1),this.xDirection=new m(t.direction.x,0,0),this.yDirection=new m(0,t.direction.y,0),this.zDirection=new m(0,0,t.direction.z),this.direction=t.direction,this.debug){const e=new m(0,0,0),i=t.direction,s=new z(i,e,1,1193046);this.add(s)}}get direction(){return this._direction}set direction(e){if(ut(e))throw new Error("Direction cannot be null ! Expect an instance of Color.");if(pt(e))throw new Error("Direction cannot be undefined ! Expect an instance of Color.");if(!(e instanceof m))throw new Error(`Direction cannot be an instance of ${e.constructor.name}. Expect an instance of Vector3.`);this._direction=e}update(e){super.update(e);const t=new m(this._direction.x,0,0),i=new m(0,this._direction.y,0),r=new m(0,0,this._direction.z),n=t.dot(e),a=i.dot(e),o=r.dot(e);this.quaternion.copy(this.baseQuaternion),n>0&&a>0&&0===o?(this.rotateOnAxis(this.zAxis,s(180)),this.xDirection.setX(-1),this.yDirection.setY(-1),this.zDirection.setZ(0)):n>0&&a<0&&0===o?(this.rotateOnAxis(this.zAxis,s(90)),this.xDirection.setX(-1),this.yDirection.setY(1),this.zDirection.setZ(0)):n<0&&a>0&&0===o?(this.rotateOnAxis(this.zAxis,s(270)),this.xDirection.setX(1),this.yDirection.setY(-1),this.zDirection.setZ(0)):n<0&&a<0&&0===o?(this.rotateOnAxis(this.zAxis,s(0)),this.xDirection.setX(1),this.yDirection.setY(1),this.zDirection.setZ(0)):n>0&&0===a&&o>0?(this.rotateOnAxis(this.zAxis,s(180)),this.xDirection.setX(-1),this.yDirection.setY(0),this.zDirection.setZ(-1)):n>0&&0===a&&o<0?(this.rotateOnAxis(this.zAxis,s(90)),this.xDirection.setX(-1),this.yDirection.setY(0),this.zDirection.setZ(1)):n<0&&0===a&&o>0?(this.rotateOnAxis(this.zAxis,s(270)),this.xDirection.setX(1),this.yDirection.setY(0),this.zDirection.setZ(-1)):n<0&&0===a&&o<0?(this.rotateOnAxis(this.zAxis,s(0)),this.xDirection.setX(1),this.yDirection.setY(0),this.zDirection.setZ(1)):0===n&&a>0&&o>0?(this.rotateOnAxis(this.zAxis,s(180)),this.xDirection.setX(0),this.yDirection.setY(-1),this.zDirection.setZ(-1)):0===n&&a>0&&o<0?(this.rotateOnAxis(this.zAxis,s(270)),this.xDirection.setX(0),this.yDirection.setY(-1),this.zDirection.setZ(1)):0===n&&a<0&&o>0?(this.rotateOnAxis(this.zAxis,s(90)),this.xDirection.setX(0),this.yDirection.setY(1),this.zDirection.setZ(-1)):0===n&&a<0&&o<0&&(this.rotateOnAxis(this.zAxis,s(0)),this.xDirection.setX(0),this.yDirection.setY(1),this.zDirection.setZ(1)),this.updateMatrix(),this.hitbox.updateMatrix()}setDirection(e){return this.direction=e,this}flipXDirection(){this.xDirection.setX(-this.xDirection.x)}flipYDirection(){this.yDirection.setY(-this.yDirection.y)}flipZDirection(){this.zDirection.setZ(-this.zDirection.z)}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Wi extends u{constructor(e=new m(0,0,0),t=new m(1,0,0)){super(),this.type="LineGeometry",this.setAttribute("position",new C([e.x,e.y,e.z,t.x,t.y,t.z],3))}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Xi extends Li{constructor(e={}){const t=new T(.2,0,1,4,1,!1);t.translate(0,.5,0);super({geometry:t,...e}),this.isCylindricaHitbox=!0,this.type="CylindricaHitbox"}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Zi extends Hi{constructor(e={}){const t={color:16777215,hitbox:new Xi,direction:new m(0,1,0),...e};super(t),this.isScaleHandle=!0,this.type="ScaleHandle";const i=new Wi(new m(0,0,0),new m(0,.88,0)),s=new Ui({color:t.color}),r=new D(i,s);r.matrixAutoUpdate=!1,this.add(r);const n=new k(.12,.12,.12);n.translate(0,.94,0);const a=new Ri({color:t.color}),o=new S(n,a);o.matrixAutoUpdate=!1,this.add(o),this.direction=t.direction}get direction(){return this._direction}set direction(e){if(ut(e))throw new Error("Direction cannot be null ! Expect an instance of Color.");if(pt(e))throw new Error("Direction cannot be undefined ! Expect an instance of Color.");if(!(e instanceof m))throw new Error(`Direction cannot be an instance of ${e.constructor.name}. Expect an instance of Vector3.`);if(this._direction=e,e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{const t=new m(e.z,0,-e.x).normalize(),i=Math.acos(e.y);this.quaternion.setFromAxisAngle(t,i)}}update(e){super.update(e);this._direction.dot(e)>=0&&this.flipDirection(),this.updateMatrix(),this.hitbox.updateMatrix()}setDirection(e){return this.direction=e,this}flipDirection(){this.direction=this._direction.negate()}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Vi extends b{constructor(e={}){const t={debug:!1,planeSize:50,...e};super(t),this.isGizmo=!0,this.type="AbstractGizmo",this.matrixAutoUpdate=!0,this.debug=t.debug;const i=new B(t.planeSize,t.planeSize,2,2),s=new M({side:E,visible:this.debug,transparent:!0,opacity:.33,color:1193046});this.intersectPlane=new S(i,s),this.intersectPlane.name="IntersectPlane",this.intersectPlane.matrixAutoUpdate=!0,this.intersectPlane.visible=!0,this.add(this.intersectPlane)}_setupHandles(e){const t=this;for(let i in e){const s=e[i];if(ft(s))s.name=i,s.renderOrder=1/0,s.updateMatrix(),t.add(s);else for(let r=s.length;r--;){const s=e[i][r][0],n=e[i][r][1],a=e[i][r][2],o=e[i][r][3],h=e[i][r][4];s.name=i,s.tag=h,s.renderOrder=1/0,n&&s.position.set(n[0],n[1],n[2]),a&&s.rotation.set(a[0],a[1],a[2]),o&&s.scale.set(o[0],o[1],o[2]),s.updateMatrix();const l=s.geometry.clone();l.applyMatrix4(s.matrix),s.geometry=l,s.position.set(0,0,0),s.rotation.set(0,0,0),s.scale.set(1,1,1),t.add(s)}}}highlight(e){for(let e in this.handleGizmos)this.handleGizmos[e].highlight(!1);const t=this.handleGizmos[e];t&&t.highlight(!0)}update(e,t){this.traverse(e=>{e.isHandle&&e.update(t)}),this.updateIntersectPlane(e)}updateIntersectPlane(e){this.intersectPlane.lookAt(e),this.intersectPlane.updateMatrix()}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class qi extends Vi{constructor(){super(),this.isScaleGizmo=!0,this.type="ScaleGizmo",this.handleGizmos={XYZ:new Ni({color:11184810}).setScale(.15,.15,.15),XY:new Yi({color:11184640,direction:new m(1,1,0)}).setScale(.33,.33,1),YZ:new Yi({color:43690,direction:new m(0,1,1)}).setScale(.33,.33,1).setRotationFromAxisAndAngle(new m(0,1,0),s(-90)),XZ:new Yi({color:11141290,direction:new m(1,0,1)}).setScale(.33,.33,1).setRotationFromAxisAndAngle(new m(1,0,0),s(90)),X:new Zi({color:11141120,direction:new m(1,0,0)}),Y:new Zi({color:43520,direction:new m(0,1,0)}),Z:new Zi({color:170,direction:new m(0,0,1)})},this._setupHandles(this.handleGizmos)}raycast(e,t){if(e.intersectObject(this.intersectPlane,!0).length>0)for(let i of this.children)i.name!==this.intersectPlane.name&&i.raycast(e,t)}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Ki extends Li{constructor(e={}){const t=new C([0,0,0,.85,0,0,1.1,1.1,0,0,.85,0],3),i=new u;i.setAttribute("position",t),i.setIndex([0,1,2,2,3,0]);super({geometry:i,...e}),this.isPlanarHitbox=!0,this.type="PlanarHitbox"}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class $i extends Hi{constructor(e={}){const t={color:16777215,hitbox:new Ki,direction:new m(1,1,0),...e};super(t),this.isPlaneHandle=!0,this.type="PlaneHandle";const i=new u;i.setAttribute("position",new C([.1,.75,0,1,1,0,.75,.1,0],3));const s=new Ui({color:t.color}),r=new D(i,s);r.matrixAutoUpdate=!1,this.add(r);const n=new u;n.setAttribute("position",new C([.1,.1,0,.75,.1,0,1,1,0,.1,.75,0],3)),n.setIndex([0,1,2,2,3,0]);const a=new Ri({color:t.color,transparent:!0,opacity:.35}),o=new S(n,a);o.matrixAutoUpdate=!1,this.add(o),this.direction=t.direction,this.xDirection=new m(t.direction.x,0,0),this.yDirection=new m(0,t.direction.y,0),this.zDirection=new m(0,0,t.direction.z),this.xAxis=new m(1,0,0),this.yAxis=new m(0,1,0),this.zAxis=new m(0,0,1)}get direction(){return this._direction}set direction(e){if(ut(e))throw new Error("Direction cannot be null ! Expect an instance of Color.");if(pt(e))throw new Error("Direction cannot be undefined ! Expect an instance of Color.");if(!(e instanceof m))throw new Error(`Direction cannot be an instance of ${e.constructor.name}. Expect an instance of Vector3.`);this._direction=e}update(e){super.update(e);const t=this.xDirection.dot(e),i=this.yDirection.dot(e),r=this.zDirection.dot(e);this.quaternion.copy(this.baseQuaternion),t>0&&i>0&&0===r?this.rotateOnAxis(this.zAxis,s(180)):t>0&&i<0&&0===r?this.rotateOnAxis(this.zAxis,s(90)):t<0&&i>0&&0===r?this.rotateOnAxis(this.zAxis,s(270)):t<0&&i<0&&0===r?this.rotateOnAxis(this.zAxis,s(0)):t>0&&0===i&&r>0?this.rotateOnAxis(this.zAxis,s(180)):t>0&&0===i&&r<0?this.rotateOnAxis(this.zAxis,s(90)):t<0&&0===i&&r>0?this.rotateOnAxis(this.zAxis,s(270)):t<0&&0===i&&r<0?this.rotateOnAxis(this.zAxis,s(0)):0===t&&i>0&&r>0?this.rotateOnAxis(this.zAxis,s(180)):0===t&&i>0&&r<0?this.rotateOnAxis(this.zAxis,s(270)):0===t&&i<0&&r>0?this.rotateOnAxis(this.zAxis,s(90)):0===t&&i<0&&r<0&&this.rotateOnAxis(this.zAxis,s(0)),this.updateMatrix(),this.hitbox.updateMatrix()}setDirection(e){return this.direction=e,this}flipXAxis(){const e=this._direction.clone();e.x=-e.x,this.direction=e}flipYAxis(){const e=this._direction.clone();e.y=-e.y,this.direction=e}flipZAxis(){const e=this._direction.clone();e.z=-e.z,this.direction=e}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Qi extends Hi{constructor(e={}){const t={color:16777215,hitbox:new Xi,direction:new m(0,1,0),...e};super(t),this.isTranslateHandle=!0,this.type="TranslateHandle";const i=new Wi(new m(0,0,0),new m(0,.8,0)),s=new Ui({color:t.color}),r=new D(i,s);r.matrixAutoUpdate=!1,this.add(r);const n=new I(.05,.2,12,1,!1);n.translate(0,.9,0);const a=new Ri({color:t.color}),o=new S(n,a);o.matrixAutoUpdate=!1,this.add(o),this.direction=t.direction}get direction(){return this._direction}set direction(e){if(ut(e))throw new Error("Direction cannot be null ! Expect an instance of Color.");if(pt(e))throw new Error("Direction cannot be undefined ! Expect an instance of Color.");if(!(e instanceof m))throw new Error(`Direction cannot be an instance of ${e.constructor.name}. Expect an instance of Vector3.`);if(this._direction=e,e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{const t=new m(e.z,0,-e.x).normalize(),i=Math.acos(e.y);this.quaternion.setFromAxisAngle(t,i)}}update(e){super.update(e);this._direction.dot(e)>=0&&this.flipDirection(),this.updateMatrix(),this.hitbox.updateMatrix()}setDirection(e){return this.direction=e,this}flipDirection(){this.direction=this._direction.negate()}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Ji extends Vi{constructor(){super(),this.isTranslateGizmo=!0,this.type="TranslateGizmo",this.handleGizmos={X:new Qi({color:11141120,direction:new m(1,0,0)}),Y:new Qi({color:43520,direction:new m(0,1,0)}),Z:new Qi({color:170,direction:new m(0,0,1)}),XY:new $i({color:11184640,direction:new m(1,1,0)}).setScale(.33,.33,1),YZ:new $i({color:43690,direction:new m(0,1,1)}).setScale(.33,.33,1).setRotationFromAxisAndAngle(new m(0,1,0),s(-90)),XZ:new $i({color:11141290,direction:new m(1,0,1)}).setScale(.33,.33,1).setRotationFromAxisAndAngle(new m(1,0,0),s(90)),XYZ:new Ni({color:11184810}).setScale(.15,.15,.15)},this._setupHandles(this.handleGizmos)}raycast(e,t){if(e.intersectObject(this.intersectPlane,!0).length>0)for(let i of this.children)i.name!==this.intersectPlane.name&&i.raycast(e,t)}}
/**
 * @module Controllers/ClippingController
 *
 * @author [Ahmed DCHAR]{@link https://github.com/Dragoneel}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @example Todo
 *
 */class es extends O{constructor(){super(),this.margin=.01,this.geometry=new A(new k(2,2,2)),this.material=new v({color:16777215}),this.matrixAutoUpdate=!1,this.normalPlanes={normalRightSide:new m(-1,0,0),normalLeftSide:new m(1,0,0),normalFrontSide:new m(0,-1,0),normalBackSide:new m(0,1,0),normalTopSide:new m(0,0,-1),normalBottomSide:new m(0,0,1)},this.planes={rightSidePlane:new U(this.normalPlanes.normalRightSide.clone(),0),leftSidePlane:new U(this.normalPlanes.normalLeftSide.clone(),0),frontSidePlane:new U(this.normalPlanes.normalFrontSide.clone(),0),backSidePlane:new U(this.normalPlanes.normalBackSide.clone(),0),topSidePlane:new U(this.normalPlanes.normalTopSide.clone(),0),bottomSidePlane:new U(this.normalPlanes.normalBottomSide.clone(),0)},this._boundingBox=new l}getBoundingSphere(){return this.geometry.computeBoundingSphere(),this.geometry.boundingSphere.applyMatrix4(this.matrixWorld),this.geometry.boundingSphere}setColor(e){this.material.color.set(e)}applyClippingTo(e,t){if(mt(t))return;let i=[];for(let e in this.planes)i.push(this.planes[e]);t.traverse(t=>{if(mt(t))return;if(mt(t.geometry))return;if(mt(t.material))return;const s=wt(t.material)?t.material:[t.material];for(let t=0,r=s.length;t<r;t++){let r=s[t];r.clippingPlanes||(r.clippingPlanes=[]),r.clippingPlanes=e?i:[]}})}updateSize(e){this.scale.set(e.x,e.y,e.z)}update(){this._boundingBox.setFromObject(this);const e=this.margin,t=this._boundingBox.min,i=this._boundingBox.max;this.planes.rightSidePlane.constant=i.x+e,this.planes.leftSidePlane.constant=-t.x+e,this.planes.frontSidePlane.constant=i.y+e,this.planes.backSidePlane.constant=-t.y+e,this.planes.topSidePlane.constant=i.z+e,this.planes.bottomSidePlane.constant=-t.z+e}}const ts=e({None:"None",Translate:"Translate",Rotate:"Rotate",Scale:"Scale"});class is extends b{constructor(e={}){const t={camera:null,domElement:window,mode:ts.None,objectsToClip:new b,...e};super(),this._handlers={onMouseEnter:this._onMouseEnter.bind(this),onMouseLeave:this._onMouseLeave.bind(this),onMouseDown:this._onMouseDown.bind(this),onMouseMove:this._onMouseMove.bind(this),onMouseWheel:this._onMouseWheel.bind(this),onMouseUp:this._onMouseUp.bind(this),onDblClick:this._onDblClick.bind(this),onTouchStart:this._onTouchStart.bind(this),onTouchEnd:this._onTouchEnd.bind(this),onTouchCancel:this._onTouchCancel.bind(this),onTouchLeave:this._onTouchLeave.bind(this),onTouchMove:this._onTouchMove.bind(this),onKeyDown:this._onKeyDown.bind(this),onKeyUp:this._onKeyUp.bind(this)},this._events={impose:{type:"impose"},dispose:{type:"dispose"},change:{type:"change"},translate:{type:"translate"},rotate:{type:"rotate"},scale:{type:"scale"},mouseEnter:{type:"mouseEnter"},mouseLeave:{type:"mouseLeave"},mouseDown:{type:"mouseDown"},mouseUp:{type:"mouseUp"}},this._objectsToClipBoundingBox=new l,this._objectsToClipSize=new m,this._objectsToClipCenter=new m,this._clippingBox=new es,this.add(this._clippingBox),this.camera=t.camera,this.domElement=t.domElement,this.mode=t.mode,this.objectsToClip=t.objectsToClip,this.translationSnap=.1,this.scaleSnap=.1,this.rotationSnap=.1,this.matrixAutoUpdate=!1,this.enabled=!1,this.size=1,this._dragging=!1,this._firstPoint=new m,this._secondPoint=new m,this._mouseDisplacement=new m,this._offset=new m,this._raycaster=new R,this._pointerVector=new y,this._directionToMouse=new m,this._cameraPosition=new m,this._cameraDirection=new m,this._worldPosition=new m,this._worldRotation=new L,this._gizmos={Translate:new Ji,Scale:new qi};for(let e in this._gizmos)this.add(this._gizmos[e]);this._currentGizmo=null,this._currentHandle=null,this.actionsMap={setMode:{translate:[ht.T.value],rotate:[ht.R.value],scale:[ht.S.value]},translate:{front:[ht.Z.value,ht.UP_ARROW.value],back:[ht.S.value,ht.DOWN_ARROW.value],up:[ht.A.value,ht.PAGE_UP.value],down:[ht.E.value,ht.PAGE_DOWN.value],left:[ht.Q.value,ht.LEFT_ARROW.value],right:[ht.D.value,ht.RIGHT_ARROW.value]},scale:{widthPlus:[ht.LEFT_ARROW.value],widthMinus:[ht.RIGHT_ARROW.value],heightPlus:[ht.PAGE_UP.value],heightMinus:[ht.PAGE_DOWN.value],depthPlus:[ht.UP_ARROW.value],depthMinus:[ht.DOWN_ARROW.value]},rotate:{xAxis:[ht.X.value],yAxis:[ht.Y.value],zAxis:[ht.Z.value]}}}get objectsToClip(){return this._objectsToClip}set objectsToClip(e){if(ut(e))throw new Error("Objects to clip cannot be null ! Expect an instance of Object3D");if(pt(e))throw new Error("Objects to clip cannot be undefined ! Expect an instance of Object3D");if(!(e instanceof b))throw new Error(`Objects to clip cannot be an instance of ${e.constructor.name}. Expect an instance of Object3D.`);this._objectsToClip=e,this.updateClipping()}get camera(){return this._camera}set camera(e){if(ut(e))throw new Error("Camera cannot be null ! Expect an instance of Camera");if(pt(e))throw new Error("Camera cannot be undefined ! Expect an instance of Camera");if(!e.isCamera&&!e.isPerspectiveCamera&&!e.isOrthographicCamera)throw new Error(`Camera cannot be an instance of ${e.constructor.name}. Expect an instance of Camera, PerspectiveCamera, or OrthographicCamera.`);this._camera=e}get domElement(){return this._domElement}set domElement(e){if(ut(e))throw new Error("DomElement cannot be null ! Expect an instance of Window, HTMLDocument, HTMLDivElement or HTMLCanvasElement.");if(pt(e))throw new Error("DomElement cannot be undefined ! Expect an instance of Window, HTMLDocument, HTMLDivElement or HTMLCanvasElement.");if(!(e instanceof Window||e instanceof HTMLDocument||e instanceof HTMLDivElement||e instanceof HTMLCanvasElement))throw new Error(`Target cannot be an instance of ${e.constructor.name}. Expect an instance of Window, HTMLDocument, HTMLDivElement or HTMLCanvasElement.`);this._domElement&&(this._domElement.removeEventListener("mouseenter",this._handlers.onMouseEnter,!1),this._domElement.removeEventListener("mouseleave",this._handlers.onMouseLeave,!1),this.dispose()),this._domElement=e,this._domElement.addEventListener("mouseenter",this._handlers.onMouseEnter,!1),this._domElement.addEventListener("mouseleave",this._handlers.onMouseLeave,!1),this.impose()}get mode(){return this._mode}set mode(e){if(ut(e))throw new Error("Mode cannot be null ! Expect a value from ClippingModes enum.");if(pt(e))throw new Error("Mode cannot be undefined ! Expect a value from ClippingModes enum.");this._mode=e;for(let e in this._gizmos)this._gizmos[e].visible=!1;this._mode===ts.None?this._currentGizmo=null:(this._currentGizmo=this._gizmos[this._mode],this._currentGizmo.visible=!0),this.updateGizmo()}setCamera(e){return this.camera=e,this}setDomElement(e){return this.domElement=e,this}setMode(e){return this.mode=e,this}setObjectsToClip(e){return this.objectsToClip=e,this}impose(){this._domElement.addEventListener("keydown",this._handlers.onKeyDown,!1),this._domElement.addEventListener("keyup",this._handlers.onKeyUp,!1),this._domElement.addEventListener("dblclick",this._handlers.onDblClick,!1),this._domElement.addEventListener("mousedown",this._handlers.onMouseDown,!1),this._domElement.addEventListener("mousemove",this._handlers.onMouseMove,!1),this._domElement.addEventListener("mouseup",this._handlers.onMouseUp,!1),this._domElement.addEventListener("wheel",this._handlers.onMouseWheel,{capture:!0,once:!1,passive:!1}),this._domElement.addEventListener("touchcancel",this._handlers.onTouchCancel,!1),this._domElement.addEventListener("touchend",this._handlers.onTouchEnd,!1),this._domElement.addEventListener("touchleave",this._handlers.onTouchLeave,!1),this._domElement.addEventListener("touchmove",this._handlers.onTouchMove,{capture:!0,once:!1,passive:!1}),this._domElement.addEventListener("touchstart",this._handlers.onTouchStart,{capture:!0,once:!1,passive:!1}),this.dispatchEvent(this._events.impose)}dispose(){this._domElement.removeEventListener("keydown",this._handlers.onKeyDown,!1),this._domElement.removeEventListener("keyup",this._handlers.onKeyUp,!1),this._domElement.removeEventListener("dblclick",this._handlers.onDblClick,!1),this._domElement.removeEventListener("mousedown",this._handlers.onMouseDown,!1),this._domElement.removeEventListener("mousemove",this._handlers.onMouseMove,!1),this._domElement.removeEventListener("mouseup",this._handlers.onMouseUp,!1),this._domElement.removeEventListener("wheel",this._handlers.onMouseWheel,{capture:!0,once:!1,passive:!1}),this._domElement.removeEventListener("touchcancel",this._handlers.onTouchCancel,!1),this._domElement.removeEventListener("touchend",this._handlers.onTouchEnd,!1),this._domElement.removeEventListener("touchleave",this._handlers.onTouchLeave,!1),this._domElement.removeEventListener("touchmove",this._handlers.onTouchMove,{capture:!0,once:!1,passive:!1}),this._domElement.removeEventListener("touchstart",this._handlers.onTouchStart,{capture:!0,once:!1,passive:!1}),this.dispatchEvent(this._events.dispose)}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}enable(){this.visible=!0,this.enabled=!0,dt(this._objectsToClip)&&(this._objectsToClipBoundingBox.setFromObject(this._objectsToClip),this._objectsToClipBoundingBox.getSize(this._objectsToClipSize),this._objectsToClipSize.divideScalar(2),this.scale.set(this._objectsToClipSize.x,this._objectsToClipSize.y,this._objectsToClipSize.z),this._objectsToClipBoundingBox.getCenter(this._objectsToClipCenter),this.position.set(this._objectsToClipCenter.x,this._objectsToClipCenter.y,this._objectsToClipCenter.z),this.updateMatrix(),this.updateMatrixWorld()),this.updateClipping(),this.updateGizmo()}disable(){this.visible=!1,this.enabled=!1,this.updateClipping()}updateClipping(){mt(this._objectsToClip)||(this._clippingBox.update(),this._clippingBox.applyClippingTo(this.enabled,this._objectsToClip))}updateGizmo(){this.enabled&&this._mode!==ts.None&&(mt(this._currentGizmo)||(this._camera.getWorldPosition(this._cameraPosition),this._camera.getWorldDirection(this._cameraDirection),this._currentGizmo.update(this._cameraPosition,this._cameraDirection)))}_consumeEvent(e){e.cancelable&&e.stopImmediatePropagation()}_onKeyDown(e){if(!this.enabled)return;e.preventDefault();const t=this.actionsMap,i=e.keyCode;if(e.ctrlKey)switch(this._mode){case ts.Translate:t.translate.front.includes(i)?(this._translateZ(this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.translate.back.includes(i)?(this._translateZ(-this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.translate.right.includes(i)?(this._translateX(this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.translate.left.includes(i)?(this._translateX(-this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.translate.up.includes(i)?(this._translateY(this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.translate.down.includes(i)&&(this._translateY(-this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change));break;case ts.Rotate:break;case ts.Scale:t.scale.depthPlus.includes(i)?(this._scaleZ(this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.scale.depthMinus.includes(i)?(this._scaleZ(-this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.scale.widthPlus.includes(i)?(this._scaleX(this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.scale.widthMinus.includes(i)?(this._scaleX(-this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.scale.heightPlus.includes(i)?(this._scaleY(this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.scale.heightMinus.includes(i)&&(this._scaleY(-this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change))}else t.setMode.translate.includes(i)?(this.setMode(ts.Translate),this.updateClipping(),this._consumeEvent(e)):t.setMode.rotate.includes(i)?(this.setMode(ts.Rotate),this.updateClipping(),this._consumeEvent(e)):t.setMode.scale.includes(i)&&(this.setMode(ts.Scale),this.updateClipping(),this._consumeEvent(e))}_onKeyUp(e){this.enabled&&!e.defaultPrevented&&e.preventDefault()}_onDblClick(e){this.enabled&&this._mode!==ts.None&&e.preventDefault()}_onMouseDown(e){if(!this.enabled)return;if(this._mode===ts.None)return;if(e.button!==lt.Left.value)return;if(mt(this._currentHandle))return;e.preventDefault(),this._dragging=!0;const t=this.intersectObjects(e,[this._currentGizmo.intersectPlane]);t&&(this._firstPoint=t.point),this._consumeEvent(e),this.dispatchEvent(this._events.mouseDown)}_onMouseEnter(e){this.enabled&&this._mode!==ts.None&&(e.preventDefault(),this.impose(),e.target.constructor!==HTMLDocument&&this._domElement.focus())}_onMouseLeave(e){this.enabled&&this._mode!==ts.None&&(e.preventDefault(),this._dragging=!1,e.target.constructor!==HTMLDocument&&this._domElement.blur(),this.dispose())}_onMouseMove(e){if(this.enabled&&this._mode!==ts.None)if(e.preventDefault(),!1===this._dragging){const t=this.intersectObjects(e,[this._currentGizmo]);if(t){const i=t.object;this._currentHandle&&i!==this._currentHandle&&(this._currentHandle.highlight(!1),this.dispatchEvent(this._events.mouseLeave)),this._currentHandle=i,this._currentHandle.highlight(!0),this.dispatchEvent(this._events.mouseEnter),this._consumeEvent(e)}else dt(this._currentHandle)&&(this._currentHandle.highlight(!1),this._currentHandle=null,this.dispatchEvent(this._events.mouseLeave))}else{const t=this._currentHandle,i=t.name,s=this.intersectObjects(e,[this._currentGizmo.intersectPlane]);switch(s&&(this._secondPoint=s.point),this._mouseDisplacement.subVectors(this._secondPoint,this._firstPoint),this._firstPoint.copy(this._secondPoint),this._mode){case ts.Translate:"X"===i?this._offset.set(1,0,0):"Y"===i?this._offset.set(0,1,0):"Z"===i?this._offset.set(0,0,1):"XY"===i?this._offset.set(1,1,0):"YZ"===i?this._offset.set(0,1,1):"XZ"===i?this._offset.set(1,0,1):"XYZ"===i&&this._offset.set(1,1,1),this._offset.multiply(this._mouseDisplacement),this._translate(this._offset);break;case ts.Rotate:break;case ts.Scale:if(t.isScaleHandle)this._offset.copy(this._currentHandle.direction).multiply(this._mouseDisplacement);else if(t.isPlaneHandle){const e=this._currentHandle.xDirection.dot(this._mouseDisplacement);e>0?this._offset.setX(Math.abs(this._mouseDisplacement.x)):e<0?this._offset.setX(-Math.abs(this._mouseDisplacement.x)):this._offset.setX(0);const t=this._currentHandle.yDirection.dot(this._mouseDisplacement);t>0?this._offset.setY(Math.abs(this._mouseDisplacement.y)):t<0?this._offset.setY(-Math.abs(this._mouseDisplacement.y)):this._offset.setY(0);const i=this._currentHandle.zDirection.dot(this._mouseDisplacement);i>0?this._offset.setZ(Math.abs(this._mouseDisplacement.z)):i<0?this._offset.setZ(-Math.abs(this._mouseDisplacement.z)):this._offset.setZ(0)}else if(t.isOmnidirectionalHandle){this.getWorldPosition(this._worldPosition),this._directionToMouse.subVectors(this._firstPoint,this._worldPosition);const e=this._directionToMouse.dot(this._mouseDisplacement)>0?this._mouseDisplacement.length():-this._mouseDisplacement.length();this._offset.set(e,e,e)}this._scale(this._offset);break;default:throw new RangeError(`Invalid switch parameter: ${this._mode}`)}this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)}}_onMouseUp(e){if(!this.enabled)return;if(this._mode===ts.None)return;if(e.button!==lt.Left.value)return;e.preventDefault(),this._dragging=!1,this.dispatchEvent(this._events.mouseUp);const t=this.intersectObjects(e,[this._currentGizmo]);t?(this._currentHandle=t.object,this._currentHandle.highlight(!0),this._consumeEvent(e),this.dispatchEvent(this._events.mouseEnter)):dt(this._currentHandle)&&(this._currentHandle.highlight(!1),this._currentHandle=null,this.dispatchEvent(this._events.mouseLeave)),this.updateGizmo()}_onMouseWheel(e){this.enabled&&e.preventDefault()}_onTouchCancel(e){this.enabled&&e.preventDefault()}_onTouchEnd(e){this.enabled&&e.preventDefault()}_onTouchLeave(e){this.enabled&&e.preventDefault()}_onTouchMove(e){this.enabled&&e.preventDefault()}_onTouchStart(e){this.enabled&&e.preventDefault()}getActiveHandle(e){}intersectObjects(e,t){const i=this._domElement.getBoundingClientRect(),s=(e.clientX-i.left)/i.width*2-1,r=-(e.clientY-i.top)/i.height*2+1;this._pointerVector.set(s,r),this._raycaster.setFromCamera(this._pointerVector,this._camera);const n=this._raycaster.intersectObjects(t,!1);return n[0]?n[0]:null}_translate(e){this.position.add(e),this.updateMatrix()}_translateX(e){this.position.setX(this.position.x+e),this.updateMatrix()}_translateY(e){this.position.setY(this.position.y+e),this.updateMatrix()}_translateZ(e){this.position.setZ(this.position.z+e),this.updateMatrix()}_translateXY(e,t){this.position.setX(this.position.x+e),this.position.setY(this.position.y+t),this.updateMatrix()}_translateXZ(e,t){this.position.setX(this.position.x+e),this.position.setZ(this.position.z+t),this.updateMatrix()}_translateYZ(e,t){this.position.setY(this.position.y+e),this.position.setZ(this.position.z+t),this.updateMatrix()}_translateXYZ(e,t,i){this.position.set(this.position.x+e,this.position.y+t,this.position.z+i),this.updateMatrix()}_rotateX(e){}_rotateY(e){}_rotateZ(e){}_rotateXY(e){}_rotateXZ(e){}_rotateYZ(e){}_rotateXYZ(e){}_scale(e){this.scale.add(e),this.updateMatrix()}_scaleX(e){this.scale.setX(this.scale.x+e),this.updateMatrix()}_scaleY(e){this.scale.setY(this.scale.y+e),this.updateMatrix()}_scaleZ(e){this.scale.setZ(this.scale.z+e),this.updateMatrix()}_scaleXY(e,t){this.scale.setX(this.scale.x+e),this.scale.setY(this.scale.y+t),this.updateMatrix()}_scaleXZ(e,t){this.scale.setX(this.scale.x+e),this.scale.setZ(this.scale.z+t),this.updateMatrix()}_scaleYZ(e,t){this.scale.setY(this.scale.y+e),this.scale.setZ(this.scale.z+t),this.updateMatrix()}_scaleXYZ(e,t,i){this.scale.set(this.scale.x+e,this.scale.y+t,this.scale.z+i),this.updateMatrix()}}
/**
 * @module Managers/CurvesManager
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @example Todo
 *
 */class ss extends ct{constructor(e={}){super({basePath:"/curves",...e})}convert(e){if(!e)throw new Error("CurvesManager: Unable to convert null or undefined data !");const t=e.type;let i;switch(t){case"ArcCurve":i=new Q;break;case"CatmullRomCurve3":i=new $;break;case"CubicBezierCurve":i=new K;break;case"CubicBezierCurve3":i=new q;break;case"Curve":i=new V;break;case"CurvePath":i=new Z;break;case"EllipseCurve":i=new X;break;case"LineCurve":i=new W;break;case"LineCurve3":i=new Y;break;case"Path":i=new j;break;case"QuadraticBezierCurve":i=new N;break;case"QuadraticBezierCurve3":i=new H;break;case"SplineCurve":i=new G;break;case"Shape":i=new f;break;default:throw new Error(`TCurvesManager: Unknown curve of type: ${t}`)}return i.fromJSON(e),i}_onJson(e,t,i,s){const r=bt(e)?[e]:e,n={};for(let e,t=0,a=r.length;t<a;t++){e=r[t];try{n[e._id]=this.convert(e)}catch(e){s(e)}i(t/a)}t(n)}}
/**
 * @module Managers/GeometriesManager
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @requires {@link TDataBaseManager}
 * @requires '../../../node_modules/three/src/core/Geometry'
 * @requires { BufferGeometry } from 'three'
 * @requires '../../../node_modules/three/src/core/BufferAttribute'
 *
 */const rs=e({Int8Array:0,Uint8Array:1,Uint8ClampedArray:2,Int16Array:3,Uint16Array:4,Int32Array:5,Uint32Array:6,Float32Array:7,Float64Array:8});class ns extends ct{constructor(e={}){const t={basePath:"/geometries",projectionSystem:"zBack",globalScale:1,computeNormals:!0,computeBoundingBox:!0,computeBoundingSphere:!0,...e};super(t),this.projectionSystem=t.projectionSystem,this.globalScale=t.globalScale,this.computeNormals=t.computeNormals,this.computeBoundingBox=t.computeBoundingBox,this.computeBoundingSphere=t.computeBoundingSphere}get computeBoundingBox(){return this._computeBoundingBox}set computeBoundingBox(e){if(ut(e))throw new TypeError("Compute bounding box cannot be null ! Expect a boolean.");if(pt(e))throw new TypeError("Compute bounding box cannot be undefined ! Expect a boolean.");if(_t(e))throw new TypeError(`Compute bounding box cannot be an instance of ${e.constructor.name} ! Expect a boolean.`);this._computeBoundingBox=e}get computeBoundingSphere(){return this._computeBoundingSphere}set computeBoundingSphere(e){if(ut(e))throw new TypeError("Compute bounding sphere cannot be null ! Expect a boolean.");if(pt(e))throw new TypeError("Compute bounding sphere cannot be undefined ! Expect a boolean.");if(_t(e))throw new TypeError(`Compute bounding sphere cannot be an instance of ${e.constructor.name} ! Expect a boolean.`);this._computeBoundingSphere=e}get computeNormals(){return this._computeNormals}set computeNormals(e){if(ut(e))throw new TypeError("Compute normals cannot be null ! Expect a boolean.");if(pt(e))throw new TypeError("Compute normals cannot be undefined ! Expect a boolean.");if(_t(e))throw new TypeError(`Compute normals cannot be an instance of ${e.constructor.name} ! Expect a boolean.`);this._computeNormals=e}get projectionSystem(){return this._projectionSystem}set projectionSystem(e){if(ut(e))throw new TypeError("Projection system cannot be null ! Expect a positive number.");if(pt(e))throw new TypeError("Projection system cannot be undefined ! Expect a positive number.");this._projectionSystem=e}get globalScale(){return this._globalScale}set globalScale(e){if(ut(e))throw new TypeError("Global scale cannot be null ! Expect a positive number.");if(pt(e))throw new TypeError("Global scale cannot be undefined ! Expect a positive number.");this._globalScale=e}setComputeBoundingBox(e){return this.computeBoundingBox=e,this}setComputeBoundingShpere(e){return this.computeBoundingSphere=e,this}setComputeNormals(e){return this.computeNormals=e,this}setProjectionSystem(e){return this.projectionSystem=e,this}setGlobalScale(e){return this.globalScale=e,this}_onJson(e,t,i,s){const r=bt(e)?[e]:e,n={};for(let e,t=0,a=r.length;t<a;t++){e=r[t];try{n[e._id]=this.convert(e)}catch(e){s(e)}i(new ProgressEvent("GeometriesManager",{lengthComputable:!0,loaded:t+1,total:a}))}t(n)}convert(e){if(!e)throw new Error("GeometriesManager: Unable to convert null or undefined data !");const t=e.type;if(!t)throw new Error("GeometriesManager: Unable to convert untyped data !");let i=null;if(e.isBufferGeometry||t.includes("BufferGeometry"))i=this._convertJsonToBufferGeometry(e),this._computeNormals&&i.computeVertexNormals();else{if(!e.isGeometry&&!t.includes("Geometry"))throw new Error(`TGeometriesManager: Unable to retrieve geometry of type ${t} !`);i=this._convertJsonToGeometry(e),this._computeNormals&&i.computeFaceNormals()}return this.computeBoundingBox&&(i.boundingBox=null,i.computeBoundingBox()),this.computeBoundingSphere&&(i.boundingSphere=null,i.computeBoundingSphere()),i}_convertJsonToGeometry(e){const t=e.types;let i=null;switch(t){case"BoxGeometry":i=new ye;break;case"CircleGeometry":i=new be;break;case"CylinderGeometry":i=new we;break;case"ConeGeometry":i=new fe;break;case"EdgesGeometry":i=new A;break;case"DodecahedronGeometry":i=new me;break;case"ExtrudeGeometry":i=new ge;break;case"Geometry":i=new _e;break;case"IcosahedronGeometry":i=new pe;break;case"LatheGeometry":i=new ue;break;case"OctahedronGeometry":i=new de;break;case"ParametricGeometry":i=new ce;break;case"PlaneGeometry":i=new le;break;case"PolyhedronGeometry":i=new he;break;case"RingGeometry":i=new oe;break;case"ShapeGeometry":i=new ae;break;case"TetrahedronGeometry":i=new ne;break;case"TextGeometry":i=new re;break;case"TorusGeometry":i=new se;break;case"TorusKnotGeometry":i=new ie;break;case"TubeGeometry":i=new te;break;case"SphereGeometry":i=new ee;break;case"WireframeGeometry":i=new J;break;default:throw new Error(`TGeometriesManager: Unknown geometry of type: ${t}`)}i.uuid=e.uuid,i.name=e.name,i.type=e.type;for(var s=[],r=void 0,n=0,a=e.vertices.length;n<a;++n)r=e.vertices[n],s.push(new m(r.x,r.y,r.z));i.vertices=s;for(var o=[],h=void 0,l=0,c=e.faces.length;l<c;l++)h=e.faces[l],o.push(new xe(h.a,h.b,h.c,h.normal,h.color,h.materialIndex));i.faces=o,i.morphTargets=[],i.morphNormals=[],i.skinWeights=[],i.skinIndices=[],i.lineDistances=[],i.elementsNeedUpdate=!0,i.verticesNeedUpdate=!0,i.uvsNeedUpdate=!0,i.normalsNeedUpdate=!0,i.colorsNeedUpdate=!0,i.lineDistancesNeedUpdate=!0,i.groupsNeedUpdate=!0}_convertJsonToBufferGeometry(e){const t=e.type;let i=null;switch(t){case"BoxBufferGeometry":i=new k;break;case"BufferGeometry":case"ShapeBufferGeometry":i=new u;break;case"CircleBufferGeometry":i=new Ie;break;case"CylinderBufferGeometry":i=new T;break;case"ConeBufferGeometry":i=new I;break;case"DodecahedronBufferGeometry":i=new Be;break;case"ExtrudeBufferGeometry":i=new ke;break;case"IcosahedronBufferGeometry":i=new Te;break;case"LatheBufferGeometry":i=new ze;break;case"OctahedronBufferGeometry":i=new P;break;case"ParametricBufferGeometry":i=new De;break;case"PlaneBufferGeometry":i=new B;break;case"PolyhedronBufferGeometry":i=new Ce;break;case"RingBufferGeometry":i=new Oe;break;case"TetrahedronBufferGeometry":i=new Ae;break;case"TextBufferGeometry":i=new Fe;break;case"TorusBufferGeometry":i=new Pe;break;case"TorusKnotBufferGeometry":i=new Se;break;case"TubeBufferGeometry":i=new Ee;break;case"SphereBufferGeometry":i=new Me;break;case"InstancedBufferGeometry":i=new ve;break;default:throw new Error(`TGeometriesManager: Unknown buffer geometry of type: ${t}`)}i._id=e._id,i.uuid=e.uuid,i.name=e.name;const s=e.index;if(s&&s.array&&s.array.length>0){const e=this.__convertBase64ToArrayBuffer(s.array),t=this.__convertArrayBufferToTypedArray(e);i.index=new p(t,s.itemSize,s.normalized)}const r=e.attributes;if(r){let e={};const t=r.position;if(t){const i=this.__convertBase64ToArrayBuffer(t.array),s=this.__convertArrayBufferToTypedArray(i),r=this.globalScale,n=new Float32Array(s);if("zBack"===this._projectionSystem){let e=null,t=null,i=null;for(let s=0,a=n.length;s<a;s+=3)e=n[s]/r,t=n[s+2]/r,i=-n[s+1]/r,n[s]=e,n[s+1]=t,n[s+2]=i}else for(let e=0,t=n.length;e<t;e++)n[e]/=r;e.position=new p(n,t.itemSize,t.normalized)}const s=r.normal;if(s){const t=this.__convertBase64ToArrayBuffer(s.array),i=this.__convertArrayBufferToTypedArray(t);e.normal=new p(i,s.itemSize,s.normalized)}const n=r.uv;if(n){const t=this.__convertBase64ToArrayBuffer(n.array),i=this.__convertArrayBufferToTypedArray(t);e.uv=new p(i,n.itemSize,n.normalized)}i.attributes=e}return dt(e.groups)&&(i.groups=e.groups),dt(e.boundingBox)&&(i.boundingBox=e.boundingBox),dt(e.boundingSphere)&&(i.boundingSphere=e.boundingSphere),"ShapeBufferGeometry"===t&&(i.shapes=e.shapes.map(e=>(new f).fromJSON(e)),i.curveSegments=e.curveSegments),i}__convertArrayBufferToTypedArray(e){const t=new DataView(e),i=e.byteLength-1,s=t.getUint8(0);let r=null;switch(s){case rs.Int8Array:r=new Int8Array(i/1);for(let e=0,s=1;s<i;e++,s+=1)r[e]=t.getInt8(s);break;case rs.Uint8Array:r=new Uint8Array(i/1);for(let e=0,s=1;s<i;e++,s+=1)r[e]=t.getUint8(s);break;case rs.Uint8ClampedArray:r=new Uint8ClampedArray(i/1);for(let e=0,s=1;s<i;e++,s+=1)r[e]=t.getUint8(s);break;case rs.Int16Array:r=new Int16Array(i/2);for(let e=0,s=1;s<i;e++,s+=2)r[e]=t.getInt16(s);break;case rs.Uint16Array:r=new Uint16Array(i/2);for(let e=0,s=1;s<i;e++,s+=2)r[e]=t.getUint16(s);break;case rs.Int32Array:r=new Int32Array(i/4);for(let e=0,s=1;s<i;e++,s+=4)r[e]=t.getInt32(s);break;case rs.Uint32Array:r=new Uint32Array(i/4);for(let e=0,s=1;s<i;e++,s+=4)r[e]=t.getUint32(s);break;case rs.Float32Array:r=new Float32Array(i/4);for(let e=0,s=1;s<i;e++,s+=4)r[e]=t.getFloat32(s);break;case rs.Float64Array:r=new Float64Array(i/8);for(let e=0,s=1;s<i;e++,s+=8)r[e]=t.getFloat64(s);break;default:throw new RangeError(`Invalid switch parameter: ${s}`)}return r}__convertBase64ToArrayBuffer(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=new Uint8Array(256);for(let e=0;e<64;e++)i[t.charCodeAt(e)]=e;const s=e.length;let r=.75*s;"="===e[s-1]&&(r--,"="===e[s-2]&&r--);let n,a,o,h,l=new ArrayBuffer(r),c=new Uint8Array(l);for(let t=0,r=0;t<s;t+=4)n=i[e.charCodeAt(t)],a=i[e.charCodeAt(t+1)],o=i[e.charCodeAt(t+2)],h=i[e.charCodeAt(t+3)],c[r++]=n<<2|a>>4,c[r++]=(15&a)<<4|o>>2,c[r++]=(3&o)<<6|63&h;return l}}
/**
 * @module Managers/TexturesManager
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class as extends ct{constructor(e={}){super({basePath:"/textures",...e})}convert(e){if(!e)throw new Error("TexturesManager: Unable to convert null or undefined data !");const t=e.type;throw new Error(`TTexturesManager: Unknown texture of type: ${t}`)}_onJson(e,t,i,s){const r=bt(e)?[e]:e,n={};for(let e,t=0,a=r.length;t<a;t++){e=r[t];try{n[e._id]=this.convert(e)}catch(e){s(e)}i(t/a)}t(n)}}
/**
 * @module Managers/MaterialsManager
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @requires TDataBaseManager
 *
 */const os=(new He).load("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH4gkKDRoGpGNegQAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAAMSURBVAjXY/j//z8ABf4C/tzMWecAAAAASUVORK5CYII=");class hs extends ct{constructor(e={}){const t={basePath:"/materials",texturesPath:"/textures",texturesProviderOptions:{},generateMipmap:!1,autoFillTextures:!0,...e};super(t),this.texturesPath=t.texturesPath,this.generateMipmap=t.generateMipmap,this.autoFillTextures=t.autoFillTextures,this.texturesProvider=new Ue(t.texturesProviderOptions)}get texturesPath(){return this._texturesPath}set texturesPath(e){if(ut(e))throw new TypeError("Textures path cannot be null ! Expect a non empty string.");if(pt(e))throw new TypeError("Textures path cannot be undefined ! Expect a non empty string.");if(yt(e))throw new TypeError(`Textures path cannot be an instance of ${e.constructor.name} ! Expect a non empty string.`);if(xt(e))throw new TypeError("Textures path cannot be empty ! Expect a non empty string.");if(vt(e))throw new TypeError("Textures path cannot contain only whitespace ! Expect a non empty string.");this._texturesPath=e}get texturesProvider(){return this._texturesProvider}set texturesProvider(e){if(ut(e))throw new TypeError("Textures provider cannot be null ! Expect an instance of TextureLoader.");if(pt(e))throw new TypeError("Textures provider cannot be undefined ! Expect an instance of TextureLoader.");if(!(e instanceof as||e instanceof Ue))throw new TypeError(`Textures provider cannot be an instance of ${e.constructor.name} ! Expect an instance of TTexturesManager.`);this._texturesProvider=e}get generateMipmap(){return this._generateMipmap}set generateMipmap(e){if(ut(e))throw new TypeError("Generate mipmap cannot be null ! Expect a boolean.");if(pt(e))throw new TypeError("Generate mipmap cannot be undefined ! Expect a boolean.");if(_t(e))throw new TypeError(`Generate mipmap cannot be an instance of ${e.constructor.name} ! Expect a boolean.`);this._generateMipmap=e}get autoFillTextures(){return this._autoFillTextures}set autoFillTextures(e){if(ut(e))throw new TypeError("Global scale cannot be null ! Expect a boolean.");if(pt(e))throw new TypeError("Global scale cannot be undefined ! Expect a positive number.");if(_t(e))throw new TypeError("Global scale cannot be null ! Expect a boolean.");this._autoFillTextures=e}setTexturesPath(e){return this.texturesPath=e,this}setTexturesProvider(e){return this.texturesProvider=e,this}setGenerateMipmap(e){return this.generateMipmap=e,this}setAutoFillTextures(e){return this.autoFillTextures=e,this}_onJson(e,t,i,s){const r=bt(e)?[e]:e,n={};for(let e,t=0,a=r.length;t<a;t++){e=r[t];try{n[e._id]=this.convert(e)}catch(e){s(e)}i(new ProgressEvent("MaterialsManager",{lengthComputable:!0,loaded:t+1,total:a}))}this._autoFillTextures?this.fillTextures(n,t,i,s):t(n)}convert(e){if(!e)throw new Error("MaterialsManager: Unable to convert null or undefined data !");const t=e.type;let i=null;switch(t){case"MeshPhongMaterial":{i=new Le,this._fillBaseMaterialData(i,e);const t=e.color;dt(t)&&(i.color=this._setColor(t));const s=e.specular;dt(s)&&(i.specular=this._setColor(s));const r=e.shininess;dt(r)&&(i.shininess=r);const n=e.map;dt(n)&&(i.map=n);const a=e.lightMap;dt(a)&&(i.lightMap=a);const o=e.lightMapIntensity;dt(o)&&(i.lightMapIntensity=o);const h=e.aoMap;dt(h)&&(i.aoMap=h);const l=e.aoMapIntensity;dt(l)&&(i.aoMapIntensity=l);const c=e.emissive;dt(c)&&(i.emissive=this._setColor(c));const d=e.emissiveIntensity;dt(d)&&(i.emissiveIntensity=d);const u=e.emissiveMap;dt(u)&&(i.emissiveMap=u);const p=e.bumpMap;dt(p)&&(i.bumpMap=p);const _=e.bumpScale;dt(_)&&(i.bumpScale=_);const g=e.normalMap;dt(g)&&(i.normalMap=g);const m=e.normalScale;dt(m)&&(i.normalScale=this._setVector2(m));const f=e.displacementMap;dt(f)&&(i.displacementMap=f);const w=e.displacementScale;dt(w)&&(i.displacementScale=w);const b=e.displacementBias;dt(b)&&(i.displacementBias=b);const y=e.specularMap;dt(y)&&(i.specularMap=y);const x=e.alphaMap;dt(x)&&(i.alphaMap=x);const v=e.envMap;dt(v)&&(i.envMap=v);const M=e.combine;dt(M)&&(i.combine=M);const E=e.reflectivity;dt(E)&&(i.reflectivity=E);const S=e.refractionRatio;dt(S)&&(i.refractionRatio=S);const P=e.wireframe;dt(P)&&(i.wireframe=P);const F=e.wireframeLinewidth;dt(F)&&(i.wireframeLinewidth=F);const A=e.wireframeLinecap;dt(A)&&(i.wireframeLinecap=A);const O=e.wireframeLinejoin;dt(O)&&(i.wireframeLinejoin=O);const C=e.skinning;dt(C)&&(i.skinning=C);const D=e.morphTargets;dt(D)&&(i.morphTargets=D);const z=e.morphNormals;dt(z)&&(i.morphNormals=z)}break;case"MeshLambertMaterial":{i=new Re,this._fillBaseMaterialData(i,e);const t=e.color;dt(t)&&(i.color=this._setColor(t));const s=e.map;dt(s)&&(i.map=s);const r=e.lightMap;dt(r)&&(i.lightMap=r);const n=e.lightMapIntensity;dt(n)&&(i.lightMapIntensity=n);const a=e.aoMap;dt(a)&&(i.aoMap=a);const o=e.aoMapIntensity;dt(o)&&(i.aoMapIntensity=o);const h=e.emissive;dt(h)&&(i.emissive=this._setColor(h));const l=e.emissiveIntensity;dt(l)&&(i.emissiveIntensity=l);const c=e.emissiveMap;dt(c)&&(i.emissiveMap=c);const d=e.specularMap;dt(d)&&(i.specularMap=d);const u=e.alphaMap;dt(u)&&(i.alphaMap=u);const p=e.envMap;dt(p)&&(i.envMap=p);const _=e.combine;dt(_)&&(i.combine=_);const g=e.reflectivity;dt(g)&&(i.reflectivity=g);const m=e.refractionRatio;dt(m)&&(i.refractionRatio=m);const f=e.wireframe;dt(f)&&(i.wireframe=f);const w=e.wireframeLinewidth;dt(w)&&(i.wireframeLinewidth=w);const b=e.wireframeLinecap;dt(b)&&(i.wireframeLinecap=b);const y=e.wireframeLinejoin;dt(y)&&(i.wireframeLinejoin=y);const x=e.skinning;dt(x)&&(i.skinning=x);const v=e.morphTargets;dt(v)&&(i.morphTargets=v);const M=e.morphNormals;dt(M)&&(i.morphNormals=M)}break;case"LineBasicMaterial":{i=new v,this._fillBaseMaterialData(i,e);const t=e.color;dt(t)&&(i.color=this._setColor(t))}break;case"PointsMaterial":{i=new _,this._fillBaseMaterialData(i,e);const t=e.color;dt(t)&&(i.color=this._setColor(t));const s=e.map;dt(s)&&(i.map=s);const r=e.morphTargets;dt(r)&&(i.morphTargets=r);const n=e.size;dt(n)&&(i.size=n);const a=e.sizeAttenuation;dt(a)&&(i.sizeAttenuation=a)}break;default:throw new Error(`TMaterialsManager: Unmanaged material of type: ${t}`)}return i}_fillBaseMaterialData(e,t){const i=t._id;dt(i)&&Mt(i)&&(e._id=i);const s=t.uuid;dt(s)&&Mt(s)&&(e.uuid=s);const r=t.name;dt(r)&&Mt(r)&&(e.name=r);const n=t.fog;dt(n)&&(e.fog=n);const a=t.lights;dt(a)&&(e.lights=a);const o=t.blending;dt(o)&&(e.blending=o);const h=t.side;dt(h)&&(e.side=h);const l=t.flatShading;dt(l)&&(e.flatShading=l);const c=t.vertexColors;dt(c)&&(e.vertexColors=c);const d=t.opacity;dt(d)&&(e.opacity=d);const u=t.transparent;dt(u)&&(e.transparent=u);const p=t.blendSrc;dt(p)&&(e.blendSrc=p);const _=t.blendDst;dt(_)&&(e.blendDst=_);const g=t.blendEquation;dt(g)&&(e.blendEquation=g);const m=t.blendSrcAlpha;dt(m)&&(e.blendSrcAlpha=m);const f=t.blendDstAlpha;dt(f)&&(e.blendDstAlpha=f);const w=t.blendEquationAlpha;dt(w)&&(e.blendEquationAlpha=w);const b=t.depthFunc;dt(b)&&(e.depthFunc=b);const y=t.depthTest;dt(y)&&(e.depthTest=y);const x=t.depthWrite;dt(x)&&(e.depthWrite=x);const v=t.clippingPlanes;dt(v)&&(e.clippingPlanes=v);const M=t.clipIntersection;dt(M)&&(e.clipIntersection=M);const E=t.clipShadows;dt(E)&&(e.clipShadows=E);const S=t.colorWrite;dt(S)&&(e.colorWrite=S);const P=t.precision;dt(P)&&(e.precision=P);const F=t.polygonOffset;dt(F)&&(e.polygonOffset=F);const A=t.polygonOffsetFactor;dt(A)&&(e.polygonOffsetFactor=A);const O=t.polygonOffsetUnits;dt(O)&&(e.polygonOffsetUnits=O);const C=t.dithering;dt(C)&&(e.dithering=C);const D=t.alphaTest;dt(D)&&(e.alphaTest=D);const z=t.premultipliedAlpha;dt(z)&&(e.premultipliedAlpha=z);const T=t.overdraw;dt(T)&&(e.overdraw=T);const k=t.visible;dt(k)&&(e.visible=k);const B=t.userData;dt(B)&&(e.userData=B);const I=t.needsUpdate;dt(I)&&(e.needsUpdate=I)}_setVector2(e){const t=e.x,i=e.y;if(mt(t)||mt(i))throw new Error("MaterialsManager: Unable to convert null or undefined vector 2 !");return new y(t,i)}_setColor(e){const t=e.r,i=e.g,s=e.b;if(mt(t)||mt(i)||mt(s))throw new Error("MaterialsManager: Unable to convert null or undefined color !");return new Ge(t,i,s)}fillTextures(e,t){const i=this._retrieveTexturesOf(e);for(let t in e){const s=e[t],r=i[t];for(let e in r)s[e]=r[e]}t(e)}_retrieveTexturesOf(e){const t=["map","lightMap","aoMap","emissiveMap","bumpMap","normalMap","displacementMap","specularMap","alphaMap","envMap"],i={},s={};for(let r in e){const n=e[r];let a={};for(let e=0,i=t.length;e<i;e++){let i=t[e];const r=n[i];if(dt(r)&&Mt(r)&&Et(r)){const e=`${this._texturesPath}/${r}`,t=s[e];if(dt(t))a[i]=t;else{const t=this._texturesProvider.load(e,()=>{},()=>{},()=>{t.image||(t.image=os,t.needsUpdate=!0)});t.name=r,this._generateMipmap||(t.generateMipmaps=!1,t.magFilter=Ne,t.minFilter=Ne),s[e]=t,a[i]=t}}}i[r]=a}return i}}
/**
 * @module Managers/ObjectsManager
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 */class ls extends ct{constructor(e={}){const t={basePath:"/objects",geometriesProviderOptions:{},materialsProviderOptions:{},projectionSystem:"zBack",globalScale:1,autoFillObjects3D:!0,...e};super(t),this.projectionSystem=t.projectionSystem,this.globalScale=t.globalScale,this.autoFillObjects3D=t.autoFillObjects3D,this.geometriesProvider=new ns(t.geometriesProviderOptions),this.materialsProvider=new hs(t.materialsProviderOptions)}get geometriesProvider(){return this._geometriesProvider}set geometriesProvider(e){if(ut(e))throw new TypeError("Geometries provider cannot be null ! Expect an instance of GeometriesManager.");if(pt(e))throw new TypeError("Geometries provider cannot be undefined ! Expect an instance of GeometriesManager.");if(!(e instanceof ns))throw new TypeError(`Geometries provider cannot be an instance of ${e.constructor.name} ! Expect an instance of TGeometriesManager.`);this._geometriesProvider=e}get materialsProvider(){return this._materialsProvider}set materialsProvider(e){if(ut(e))throw new TypeError("Materials provider cannot be null ! Expect an instance of MaterialsManager.");if(pt(e))throw new TypeError("Materials provider cannot be undefined ! Expect an instance of MaterialsManager.");if(!(e instanceof hs))throw new TypeError(`Materials provider cannot be an instance of ${e.constructor.name} ! Expect an instance of TMaterialsManager.`);this._materialsProvider=e}get projectionSystem(){return this._projectionSystem}set projectionSystem(e){if(ut(e))throw new TypeError("Projection system cannot be null ! Expect a positive number.");if(pt(e))throw new TypeError("Projection system cannot be undefined ! Expect a positive number.");this._projectionSystem=e}get globalScale(){return this._globalScale}set globalScale(e){if(ut(e))throw new TypeError("Global scale cannot be null ! Expect a positive number.");if(pt(e))throw new TypeError("Global scale cannot be undefined ! Expect a positive number.");this._globalScale=e}get autoFillObjects3D(){return this._autoFillObjects3D}set autoFillObjects3D(e){if(ut(e))throw new TypeError("Global scale cannot be null ! Expect a boolean.");if(pt(e))throw new TypeError("Global scale cannot be undefined ! Expect a positive number.");if(_t(e))throw new TypeError("Global scale cannot be null ! Expect a boolean.");this._autoFillObjects3D=e}setGeometriesProvider(e){return this.geometriesProvider=e,this}setMaterialsProvider(e){return this.materialsProvider=e,this}setProjectionSystem(e){return this.projectionSystem=e,this}setGlobalScale(e){return this.globalScale=e,this}setAutoFillObjects3D(e){return this.autoFillObjects3D=e,this}_onJson(e,t,i,s){const r={};for(let t,n=0,a=e.length;n<a;n++){t=e[n];try{r[t._id]=this.convert(t)}catch(e){s(e)}i(new ProgressEvent("ObjectsManager",{lengthComputable:!0,loaded:n+1,total:a}))}this._autoFillObjects3D?this.fillObjects3D(r,t,i,s):t(r)}_onArrayBuffer(e,t,i,s){}_onBlob(e,t,i,s){}_onText(e,t,i,s){}convert(e){if(!e)throw new Error("ObjectsManager: Unable to convert null or undefined data !");const t=e.type;let i=null;switch(t){case"Object3D":i=new b,this._fillBaseObjectsData(i,e);break;case"Scene":i=new tt,this._fillBaseObjectsData(i,e),dt(e.background)&&Number.isInteger(e.background)&&(i.background=new Ge(e.background)),dt(e.fog)&&("Fog"===e.fog.type?i.fog=new it(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(i.fog=new st(e.fog.color,e.fog.density))),i.overrideMaterial=e.overrideMaterial,i.autoUpdate=e.autoUpdate;break;case"PerspectiveCamera":i=new et,this._fillBaseObjectsData(i,e),i.fov=e.fov,i.aspect=e.aspect,i.near=e.near,i.far=e.far,dt(e.focus)&&(i.focus=e.focus),dt(e.zoom)&&(i.zoom=e.zoom),dt(e.filmGauge)&&(i.filmGauge=e.filmGauge),dt(e.filmOffset)&&(i.filmOffset=e.filmOffset),dt(e.view)&&(i.view=Object.assign({},e.view));break;case"OrthographicCamera":i=new Je(e.left,e.right,e.top,e.bottom,e.near,e.far),this._fillBaseObjectsData(i,e);break;case"AmbientLight":i=new Qe(e.color,e.intensity),this._fillBaseObjectsData(i,e);break;case"DirectionalLight":i=new $e(e.color,e.intensity),this._fillBaseObjectsData(i,e);break;case"PointLight":i=new Ke(e.color,e.intensity,e.distance,e.decay),this._fillBaseObjectsData(i,e);break;case"RectAreaLight":i=new qe(e.color,e.intensity,e.width,e.height),this._fillBaseObjectsData(i,e);break;case"SpotLight":i=new Ve(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),this._fillBaseObjectsData(i,e);break;case"HemisphereLight":i=new Ze(e.color,e.groundColor,e.intensity),this._fillBaseObjectsData(i,e);break;case"SkinnedMesh":i=new Xe,this._fillBaseObjectsData(i,e),i.geometry=e.geometry,i.material=e.material,i.drawMode=e.drawMode,i.bindMode=e.bindMode,i.bindMatrix=e.bindMatrix,i.bindMatrixInverse=e.bindMatrixInverse;break;case"Mesh":i=new S,this._fillBaseObjectsData(i,e),i.geometry=e.geometry,i.material=e.material,i.drawMode=e.drawMode;break;case"LOD":i=new We,this._fillBaseObjectsData(i,e),i.levels=e.levels;break;case"Line":i=new D,this._fillBaseObjectsData(i,e),i.geometry=e.geometry,i.material=e.material,i.drawMode=e.drawMode;break;case"LineLoop":i=new Ye,this._fillBaseObjectsData(i,e),i.geometry=e.geometry,i.material=e.material,i.drawMode=e.drawMode;break;case"LineSegments":i=new O,this._fillBaseObjectsData(i,e),i.geometry=e.geometry,i.material=e.material,i.drawMode=e.drawMode;break;case"Points":i=new g,this._fillBaseObjectsData(i,e),i.geometry=e.geometry,i.material=e.material,i.drawMode=e.drawMode;break;case"Sprite":i=new je,this._fillBaseObjectsData(i,e),i.material=e.material;break;case"Group":i=new d,this._fillBaseObjectsData(i,e);break;default:throw new Error(`TObjectsManager: Unknown object of type: ${t}`)}return i}_fillBaseObjectsData(e,t){e._id=t._id,dt(t.uuid)&&(e.uuid=t.uuid),dt(t.name)&&(e.name=t.name),dt(t.parent)&&(e.parent=t.parent),St(t.children)&&(e.children=t.children),dt(t.up)&&(e.up.x=t.up.x,e.up.y=t.up.y,e.up.z=t.up.z),dt(t.position)&&("zBack"===this._projectionSystem?(e.position.x=t.position.x/this._globalScale,e.position.y=t.position.z/this._globalScale,e.position.z=-t.position.y/this._globalScale):(e.position.x=t.position.x/this._globalScale,e.position.y=t.position.y/this._globalScale,e.position.z=t.position.z/this._globalScale)),dt(t.rotation)&&("zBack"===this._projectionSystem?(e.rotation.x=t.rotation.x,e.rotation.y=t.rotation.z,e.rotation.z=-t.rotation.y,e.rotation.order=t.rotation.order):(e.rotation.x=t.rotation.x,e.rotation.y=t.rotation.y,e.rotation.z=t.rotation.z,e.rotation.order=t.rotation.order)),dt(t.quaternion)&&("zBack"===this._projectionSystem?(e.quaternion.x=t.quaternion.x,e.quaternion.y=t.quaternion.z,e.quaternion.z=-t.quaternion.y,e.quaternion.w=t.quaternion.w):(e.quaternion.x=t.quaternion.x,e.quaternion.y=t.quaternion.y,e.quaternion.z=t.quaternion.z,e.quaternion.w=t.quaternion.w)),dt(t.scale)&&(0!==t.scale.x&&0!==t.scale.y&&0!==t.scale.z?(e.scale.x=t.scale.x,e.scale.y=t.scale.y,e.scale.z=t.scale.z):this.logger.warn("Try to assign null scale !")),dt(t.modelViewMatrix)&&St(t.modelViewMatrix)&&e.modelViewMatrix.fromArray(t.modelViewMatrix),dt(t.normalMatrix)&&St(t.normalMatrix)&&e.normalMatrix.fromArray(t.normalMatrix),dt(t.matrix)&&St(t.matrix)&&e.matrix.fromArray(t.matrix),dt(t.matrixWorld)&&St(t.matrixWorld)&&e.matrixWorld.fromArray(t.matrixWorld),dt(t.matrixAutoUpdate)&&(e.matrixAutoUpdate=t.matrixAutoUpdate),dt(t.matrixWorldNeedsUpdate)&&(e.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate),dt(t.layers)&&(e.layers.mask=t.layers),dt(t.visible)&&(e.visible=t.visible),dt(t.castShadow)&&(e.castShadow=t.castShadow),dt(t.receiveShadow)&&(e.receiveShadow=t.receiveShadow),dt(t.frustumCulled)&&(e.frustumCulled=t.frustumCulled),dt(t.renderOrder)&&(e.renderOrder=t.renderOrder),dt(t.userData)&&(e.userData=t.userData)}fillObjects3D(e,t,i,s){const r=this,n=[];for(let t in e){const i=e[t];(i.geometry||i.material)&&n.push(e[t])}if(0===n.length)return void t(e);let a,o;function h(){if(a&&o){for(let t in e){const i=e[t];r.applyGeometry(i,a),r.applyMaterials(i,o)}t(e)}}this._retrieveGeometriesOf(n,e=>{a=e,h()},i,s),this._retrieveMaterialsOf(n,e=>{o=e,h()},i,s)}_retrieveGeometriesOf(e,t,i,s){const r=e.map(e=>e.geometry).filter((e,t,i)=>e&&i.indexOf(e)===t);0!==r.length?this._geometriesProvider.read(r,null,t,i,s):t({})}_retrieveMaterialsOf(e,t,i,s){const r=e.map(e=>e.material),n=[].concat.apply([],r).filter((e,t,i)=>e&&i.indexOf(e)===t);0!==n.length?this._materialsProvider.read(n,null,t,i,s):t({})}applyGeometry(e,t){const i=e.geometry;if(!i)return;const s=t[i];s?e.geometry=s:this.logger.error("Unable to retrieve geometry !!!")}applyMaterials(e,t){const i=e.material;if(i)if(Array.isArray(i))if(1===i.length){const s=t[i[0]];if(!s)return this.logger.error("Unable to retrieve material !!!"),null;e.material=s.clone()}else{e.material=[];for(let s=0,r=i.length;s<r;s++){const r=t[i[s]];if(!r)return this.logger.error("Unable to retrieve material !!!"),null;e.material.push(r.clone())}}else if("string"==typeof i){const s=t[i];if(!s)return void this.logger.error("Unable to retrieve material !!!");e.material=s.clone()}else this.logger.error("Invalid material ids, expected string or array of string")}}
/**
 * @module Objects3D/OrbitControlsHelper
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 */class cs extends O{constructor(e={}){const t={radius:2,radials:16,circles:2,divisions:64,innerColor:new Ge(4473924),outerColor:new Ge(8947848),...e};super(cs._createInternalGeometry(t.radius,t.radials,t.circles,t.divisions,t.innerColor,t.outerColor),cs._createInternalMaterial()),this.matrixAutoUpdate=!1,this._intervalId=void 0}static _createInternalGeometry(e,t,i,s,r,n){const a=[],o=[];let h,l,c,d,p,_,g;for(d=0;d<=t;d++)c=d/t*(2*Math.PI),h=Math.sin(c)*e,l=Math.cos(c)*e,a.push(0,0,0),a.push(h,0,l),g=1&d?r:n,o.push(g.r,g.g,g.b),o.push(g.r,g.g,g.b);for(d=0;d<=i;d++){for(g=1&d?r:n,_=e-e/i*d,p=0;p<s;p++)c=p/s*(2*Math.PI),h=Math.sin(c)*_,l=Math.cos(c)*_,a.push(h,0,l),o.push(g.r,g.g,g.b),c=(p+1)/s*(2*Math.PI),h=Math.sin(c)*_,l=Math.cos(c)*_,a.push(h,0,l),o.push(g.r,g.g,g.b);a.push(-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1),o.push(0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1)}const m=new C(a,3);m.name="TOrbitControlsHelperPositionBufferAttribute";const f=new C(o,3);f.name="TOrbitControlsHelperColorBufferAttribute";const w=new u;return w.setAttribute("position",m),w.setAttribute("color",f),w.name="TOrbitControlsHelperGeometry",w}static _createInternalMaterial(){const e=new v({vertexColors:rt});return e.transparent=!0,e.opacity=0,e.name="TOrbitControlsHelperMaterial",e}startOpacityAnimation(){void 0!==this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this.material.opacity=1}endOpacityAnimation(){this._intervalId=setInterval(function(){this.material.opacity<=0?(this.material.opacity=0,clearInterval(this._intervalId),this._intervalId=void 0):this.material.opacity-=.1}.bind(this),100)}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class ds extends Li{constructor(e={}){super({geometry:new Pe(1,.12,4,12,Math.PI),...e}),this.isTorusHitbox=!0,this.type="TorusHitbox"}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class us extends Vi{constructor(){super(),this.isRotateGizmo=!0,this.type="RotateGizmo";const e=(e,t,i)=>{const s=new u;let r=[];i=i||1;for(let s=0;s<=64*i;++s)"x"===t&&r.push(0,Math.cos(s/32*Math.PI)*e,Math.sin(s/32*Math.PI)*e),"y"===t&&r.push(Math.cos(s/32*Math.PI)*e,0,Math.sin(s/32*Math.PI)*e),"z"===t&&r.push(Math.sin(s/32*Math.PI)*e,Math.cos(s/32*Math.PI)*e,0);return s.setAttribute("position",new C(r,3)),s};this.handleGizmos={X:[[new D(new e(1,"x",.5),new Ui({color:16711680}))],[new S(new P(.04,0),new Ri({color:16711680})),[0,0,.99],null,[3,1,1]]],Y:[[new D(new e(1,"y",.5),new Ui({color:65280}))],[new S(new P(.04,0),new Ri({color:65280})),[0,0,.99],null,[3,1,1]]],Z:[[new D(new e(1,"z",.5),new Ui({color:255}))],[new S(new P(.04,0),new Ri({color:255})),[.99,0,0],null,[1,3,1]]],E:[[new D(new e(1.25,"z",1),new Ui({color:13421568}))]],XYZ:[[new D(new e(1,"z",1),new Ui({color:7895160}))]]},this.pickerGizmos={X:[[new ds,[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new ds,[0,0,0],[Math.PI/2,0,0]]],Z:[[new ds,[0,0,0],[0,0,-Math.PI/2]]],E:[[new ds({radius:1.25,tube:.12,radialSegments:2,tubularSegments:24})]],XYZ:[[new ds]]},this._setupHandles(this.handleGizmos)}raycast(e,t){if(e.intersectObject(this.intersectPlane,!0).length>0)for(let i of this.children)i.name!==this.intersectPlane.name&&i.raycast(e,t)}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class ps extends Li{constructor(e={}){super({geometry:new k(1,1,1,1,1,1),...e}),this.isBoxHitbox=!0,this.type="BoxHitbox"}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class _s extends Hi{constructor(e={}){const t={boxColor:1067907,edgesColor:1193046,hitbox:new ps({geometry:new k(1.1,1.1,1.1,1,1,1)}),...e};super(t),this.isOmnidirectionalHandle=!0,this.type="OmnidirectionalHandle";const i=new k(1,1,1,1,1,1);i.name="BoxHandle_Box_Geometry";const s=new Ri({color:t.boxColor,transparent:!1,opacity:1});s.name="BoxHandle_Box_Material";const r=new S(i,s);r.name="BoxHandle_Box",r.matrixAutoUpdate=!1,this.add(r);const n=new A(i);n.name="BoxHandle_Edges_Geometry";const a=new Ui({color:t.edgesColor,linewidth:4,transparent:!1,opacity:1});a.name="BoxHandle_Edges_Material";const o=new O(n,a);o.name="BoxHandle_Edges",o.matrixAutoUpdate=!1,this.add(o)}update(e){super.update(e),this.updateMatrix(),this.hitbox.updateMatrix()}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class gs extends Hi{constructor(e={}){const t={coneColor:1067907,edgesColor:1193046,hitbox:new ps({geometry:new I(1.1,1.1)}),...e};super(t),this.isOmnidirectionalHandle=!0,this.type="OmnidirectionalHandle";const i=new I(1,1);i.name="ConeHandle_Cone_Geometry";const s=new Ri({color:t.coneColor,transparent:!1,opacity:1});s.name="ConeHandle_Cone_Material";const r=new S(i,s);r.name="ConeHandle_Cone",r.matrixAutoUpdate=!0,this.add(r)}update(e){super.update(e),this.updateMatrix(),this.hitbox.updateMatrix()}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class ms extends Vi{constructor(e={}){const t={boxColor:11119017,edgesColor:13882323,...e};super(t),this.isLookAtGizmo=!0,this.type="LookAtGizmo",this.explodeFactor=.25,this.handleGizmos={FACE_RIGHT:new gs({coneColor:14483456}).setPosition(+(4+this.explodeFactor),0,0).setRotationFromAxisAndAngle(new m(0,0,1),s(90)).setScale(1,4,1),FACE_LEFT:new gs({coneColor:5570560}).setPosition(-(4+this.explodeFactor),0,0).setRotationFromAxisAndAngle(new m(0,0,1),s(-90)).setScale(1,4,1),FACE_TOP:new gs({coneColor:221}).setPosition(0,+(4+this.explodeFactor),0).setRotationFromAxisAndAngle(new m(1,0,0),s(180)).setScale(1,4,1),FACE_BOTTOM:new gs({coneColor:85}).setPosition(0,-(4+this.explodeFactor),0).setScale(1,4,1),FACE_FRONT:new gs({coneColor:21760}).setPosition(0,0,+(4+this.explodeFactor)).setRotationFromAxisAndAngle(new m(1,0,0),s(-90)).setScale(1,4,1),FACE_BACK:new gs({coneColor:56576}).setPosition(0,0,-(4+this.explodeFactor)).setRotationFromAxisAndAngle(new m(1,0,0),s(90)).setScale(1,4,1),CORNER_TOP_LEFT_FRONT:new _s(t).setPosition(-(2+this.explodeFactor),+(2+this.explodeFactor),+(2+this.explodeFactor)),CORNER_TOP_LEFT_BACK:new _s(t).setPosition(-(2+this.explodeFactor),+(2+this.explodeFactor),-(2+this.explodeFactor)),CORNER_TOP_RIGHT_FRONT:new _s(t).setPosition(+(2+this.explodeFactor),+(2+this.explodeFactor),+(2+this.explodeFactor)),CORNER_TOP_RIGHT_BACK:new _s(t).setPosition(+(2+this.explodeFactor),+(2+this.explodeFactor),-(2+this.explodeFactor)),CORNER_BOTTOM_LEFT_FRONT:new _s(t).setPosition(-(2+this.explodeFactor),-(2+this.explodeFactor),+(2+this.explodeFactor)),CORNER_BOTTOM_LEFT_BACK:new _s(t).setPosition(-(2+this.explodeFactor),-(2+this.explodeFactor),-(2+this.explodeFactor)),CORNER_BOTTOM_RIGHT_FRONT:new _s(t).setPosition(+(2+this.explodeFactor),-(2+this.explodeFactor),+(2+this.explodeFactor)),CORNER_BOTTOM_RIGHT_BACK:new _s(t).setPosition(+(2+this.explodeFactor),-(2+this.explodeFactor),-(2+this.explodeFactor)),EDGE_TOP_FRONT:new _s(t).setPosition(0,+(2+this.explodeFactor),+(2+this.explodeFactor)).setScale(3,1,1),EDGE_TOP_LEFT:new _s(t).setPosition(-(2+this.explodeFactor),+(2+this.explodeFactor),0).setScale(1,1,3),EDGE_TOP_BACK:new _s(t).setPosition(0,+(2+this.explodeFactor),-(2+this.explodeFactor)).setScale(3,1,1),EDGE_TOP_RIGHT:new _s(t).setPosition(+(2+this.explodeFactor),+(2+this.explodeFactor),0).setScale(1,1,3),EDGE_LEFT_FRONT:new _s(t).setPosition(-(2+this.explodeFactor),0,+(2+this.explodeFactor)).setScale(1,3,1),EDGE_LEFT_BACK:new _s(t).setPosition(-(2+this.explodeFactor),0,-(2+this.explodeFactor)).setScale(1,3,1),EDGE_RIGHT_FRONT:new _s(t).setPosition(+(2+this.explodeFactor),0,+(2+this.explodeFactor)).setScale(1,3,1),EDGE_RIGHT_BACK:new _s(t).setPosition(+(2+this.explodeFactor),0,-(2+this.explodeFactor)).setScale(1,3,1),EDGE_BOTTOM_FRONT:new _s(t).setPosition(0,-(2+this.explodeFactor),+(2+this.explodeFactor)).setScale(3,1,1),EDGE_BOTTOM_LEFT:new _s(t).setPosition(-(2+this.explodeFactor),-(2+this.explodeFactor),0).setScale(1,1,3),EDGE_BOTTOM_BACK:new _s(t).setPosition(0,-(2+this.explodeFactor),-(2+this.explodeFactor)).setScale(3,1,1),EDGE_BOTTOM_RIGHT:new _s(t).setPosition(+(2+this.explodeFactor),-(2+this.explodeFactor),0).setScale(1,1,3)},this._setupHandles(this.handleGizmos)}raycast(e,t){if(e.intersectObject(this.intersectPlane,!0).length>0)for(let i of this.children)i.raycast(e,t)}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class fs extends Hi{constructor(e={}){super({...e}),this.isRotateHandle=!0,this.type="RotateHandle"}update(e){super.update(e),this.updateMatrix(),this.hitbox.updateMatrix()}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class ws extends Li{constructor(e={}){super({geometry:new Me(1,8,6,0,2*Math.PI,0,Math.PI),...e}),this.isSphericalHitbox=!0,this.type="SphericalHitbox"}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class bs extends S{constructor(e,t={}){super(e,new Ri({color:t.color,transparent:!0,opacity:.55})),this.isHighlightableMesh=!0,this.type="HighlightableMesh"}highlight(e){this.material.highlight(e)}}export{fi as ASCLoader,Vi as AbstractGizmo,Hi as AbstractHandle,Li as AbstractHitbox,Pi as BitArray,Fi as BitManager,Bi as CameraControlMode,Ii as CameraControls,es as ClippingBox,is as ClippingControls,ts as ClippingModes,Xt as ColorPalette,Wt as Colors,ss as CurvesManager,Xi as CylindricaHitbox,yi as DBFLoader,mi as Directions,ns as GeometriesManager,bs as HighlightableMesh,Mi as LASLoader,ms as LookAtGizmo,$i as LozengeHandle,Ki as LozengeHitbox,hs as MaterialsManager,ls as ObjectsManager,Ni as OctahedricalHandle,Gi as OctahedricalHitbox,cs as OrbitControlsHelper,ji as PlanarHitbox,Yi as PlaneHandle,vi as PointClasses,us as RotateGizmo,fs as RotateHandle,Si as SHPLoader,qi as ScaleGizmo,Zi as ScaleHandle,Ei as ShapeType,ws as SphericalHitbox,as as TexturesManager,ds as TorusHitbox,Ji as TranslateGizmo,Qi as TranslateHandle};
