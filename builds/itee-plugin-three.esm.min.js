import{DefaultLogger as e,TBinaryReader as t,Endianness as n,FileFormat as s,Keys as i,Mouse as o,TDataBaseManager as r,ResponseType as a}from"itee-client";import{Box3 as h,DefaultLoadingManager as l,FileLoader as c,Group as d,BufferGeometry as u,BufferAttribute as p,PointsMaterial as m,Points as f,TextureLoader as _,Mesh as g,PlaneGeometry as v,MeshBasicMaterial as b,DoubleSide as w,_Math as y,Vector3 as x,Shape as E,ColladaLoader as M,FBXLoader as P,ObjectLoader as A,OBJLoader as T,ShapeBufferGeometry as S,MeshPhongMaterial as D,STLLoader as O,MTLLoader as k,EventDispatcher as I,Object3D as C,Camera as F,Vector2 as z,Spherical as L,Quaternion as B,MOUSE as j,LineSegments as R,EdgesGeometry as G,BoxBufferGeometry as H,LineBasicMaterial as U,Plane as N,CylinderBufferGeometry as X,Float32BufferAttribute as Z,OctahedronBufferGeometry as Y,SphereBufferGeometry as V,TorusBufferGeometry as W,Line as $,ConeBufferGeometry as q,PlaneBufferGeometry as J,Raycaster as K,Euler as Q,Scene as ee,ArcCurve as te,CatmullRomCurve3 as ne,CubicBezierCurve as se,CubicBezierCurve3 as ie,Curve as oe,CurvePath as re,EllipseCurve as ae,LineCurve as he,LineCurve3 as le,Path as ce,QuadraticBezierCurve as de,QuadraticBezierCurve3 as ue,SplineCurve as pe,BoxGeometry as me,CircleGeometry as fe,CylinderGeometry as _e,ConeGeometry as ge,DodecahedronGeometry as ve,ExtrudeGeometry as be,Geometry as we,IcosahedronGeometry as ye,LatheGeometry as xe,OctahedronGeometry as Ee,ParametricGeometry as Me,PolyhedronGeometry as Pe,RingGeometry as Ae,ShapeGeometry as Te,TetrahedronGeometry as Se,TextGeometry as De,TorusGeometry as Oe,TorusKnotGeometry as ke,TubeGeometry as Ie,SphereGeometry as Ce,WireframeGeometry as Fe,Face3 as ze,CircleBufferGeometry as Le,DodecahedronBufferGeometry as Be,ExtrudeBufferGeometry as je,IcosahedronBufferGeometry as Re,LatheBufferGeometry as Ge,ParametricBufferGeometry as He,PolyhedronBufferGeometry as Ue,RingBufferGeometry as Ne,TetrahedronBufferGeometry as Xe,TextBufferGeometry as Ze,TorusKnotBufferGeometry as Ye,TubeBufferGeometry as Ve,InstancedBufferGeometry as We,ImageLoader as $e,MeshLambertMaterial as qe,Color as Je,LinearFilter as Ke,Fog as Qe,FogExp2 as et,PerspectiveCamera as tt,OrthographicCamera as nt,AmbientLight as st,DirectionalLight as it,PointLight as ot,RectAreaLight as rt,SpotLight as at,HemisphereLight as ht,SkinnedMesh as lt,LOD as ct,LineLoop as dt,Sprite as ut,VertexColors as pt}from"three-full";import{degreesToRadians as mt,toEnum as ft}from"itee-utils";import{isObject as _t,isFunction as gt,isArray as vt,isString as bt,isNull as wt,isUndefined as yt,isNotBoolean as xt,isEmptyArray as Et,isNotDefined as Mt,isDefined as Pt,isNotArray as At,isNotString as Tt,isEmptyString as St,isBlankString as Dt,isNotEmptyString as Ot,isNotEmptyArray as kt}from"itee-validators";class It{constructor(t=l,n=e){this.manager=t,this.logger=n,this._boundingBox=new h,this._points=[],this._numberOfPoints=0,this._coloredPoints=!1,this._autoOffset=!1,this._offset={x:0,y:0,z:0},this._positions=null,this._bufferIndex=0,this._positionsC=null,this._bufferIndexC=0,this.wrongPoints=0}load(e,t,n,s,i){const o=new c(this.manager);o.setResponseType("blob"),o.load(e,function(e){const o=new d;this._parse(e,o,t,n,s,i),t(o)}.bind(this),n,s)}setOffset(e){this._offset=e,this._autoOffset=!1}_parse(e,t,n,s,i,o){const r=this,a=o||100,h=new FileReader,l=134217728;let c=0;function d(){if(c>=e.size)return;const t=e.slice(c,c+l,"text/plain");h.readAsText(t)}h.onabort=e=>{this.logger.log("abortEvent:"),this.logger.log(e)},h.onerror=e=>{this.logger.log("errorEvent:"),this.logger.log(e),i&&i(e)},h.onloadstart=e=>{this.logger.log("loadStartEvent:"),this.logger.log(e)},h.onprogress=e=>{this.logger.log("progressEvent:"),this.logger.log(e),s&&s(e)},h.onload=e=>{this.logger.log("loadEvent:"),this.logger.log(e);const t=e.target.result.split("\n"),n=t.length;c-=t[n-1].length;const s=Math.round(100/a);for(let e=0;e<n-1;e++)e%s==0&&r._parseLine(t[e])},h.onloadend=n=>{this.logger.log("loadEndEvent"),this.logger.log(n),(this._points.length>1e6||c+l>=e.size)&&(this._offsetPoints(),this._createSubCloudPoint(t)),c+=l,d()},d()}_parseLine(e){const t=e.split(/\s/g).filter(Boolean),n=t.length;3===n?this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2])}):4===n?(this._pointsHaveIntensity=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3])})):6===n?(this._pointsHaveColor=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),r:parseFloat(t[3]),g:parseFloat(t[4]),b:parseFloat(t[5])})):7===n?(this._pointsHaveIntensity=!0,this._pointsHaveColor=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),r:parseFloat(t[4]),g:parseFloat(t[5]),b:parseFloat(t[6])})):9===n?(this._pointsHaveColor=!0,this._pointsHaveNormals=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),r:parseFloat(t[3]),g:parseFloat(t[4]),b:parseFloat(t[5]),nx:parseFloat(t[6]),ny:parseFloat(t[7]),nz:parseFloat(t[8])})):10===n?(this._pointsHaveIntensity=!0,this._pointsHaveColor=!0,this._pointsHaveNormals=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),r:parseFloat(t[4]),g:parseFloat(t[5]),b:parseFloat(t[6]),nx:parseFloat(t[7]),ny:parseFloat(t[8]),nz:parseFloat(t[9])})):this.logger.error(`Invalid data line: ${e}`)}_parseLines(e){const t=e[0].split(/\s/g).filter(Boolean).length;3===t?this._parseLinesAsXYZ(e):4===t?this._parseLinesAsXYZI(e):6===t?this._parseLinesAsXYZRGB(e):7===t?this._parseLinesAsXYZIRGB(e):9===t?this._parseLinesAsXYZRGBnXnYnZ(e):10===t?this._parseLinesAsXYZIRGBnXnYnZ(e):this.logger.error(`Invalid data line: ${e}`)}_parseLinesAsXYZ(e){let t=[];for(let n=0,s=e.length;n<s;n++)t=e[n].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2])})}_parseLinesAsXYZI(e){this._pointsHaveIntensity=!0;let t=[];for(let n=0,s=e.length;n<s;n++)t=e[n].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3])})}_parseLinesAsXYZRGB(e){this._pointsHaveColor=!0;let t=[];for(let n=0,s=e.length;n<s;n++)t=e[n].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),r:parseFloat(t[3]),g:parseFloat(t[4]),b:parseFloat(t[5])})}_parseLinesAsXYZnXnYnZ(e){let t=[];for(let n=0,s=e.length;n<s;n++)t=e[n].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),nx:parseFloat(t[7]),ny:parseFloat(t[8]),nz:parseFloat(t[9])})}_parseLinesAsXYZIRGB(e){this._pointsHaveIntensity=!0,this._pointsHaveColor=!0;let t=[];for(let n=0,s=e.length;n<s;n++)t=e[n].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),r:parseFloat(t[4]),g:parseFloat(t[5]),b:parseFloat(t[6])})}_parseLinesAsXYZInXnYnZ(e){let t=[];for(let n=0,s=e.length;n<s;n++)t=e[n].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),nx:parseFloat(t[7]),ny:parseFloat(t[8]),nz:parseFloat(t[9])})}_parseLinesAsXYZRGBnXnYnZ(e){this._pointsHaveColor=!0,this._pointsHaveNormals=!0;let t=[];for(let n=0,s=e.length;n<s;n++)t=e[n].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),r:parseFloat(t[3]),g:parseFloat(t[4]),b:parseFloat(t[5]),nx:parseFloat(t[6]),ny:parseFloat(t[7]),nz:parseFloat(t[8])})}_parseLinesAsXYZIRGBnXnYnZ(e){this._pointsHaveIntensity=!0,this._pointsHaveColor=!0,this._pointsHaveNormals=!0;let t=[];for(let n=0,s=e.length;n<s;n++)t=e[n].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),r:parseFloat(t[4]),g:parseFloat(t[5]),b:parseFloat(t[6]),nx:parseFloat(t[7]),ny:parseFloat(t[8]),nz:parseFloat(t[9])})}_parseLineB(e){const t=e.split(/\s/g).filter(Boolean),n=t.length,s=this._bufferIndex;3===n&&(this._positions[s]=parseFloat(t[0]),this._positions[s+1]=parseFloat(t[1]),this._positions[s+2]=parseFloat(t[2]),this._bufferIndex+=3)}_parseLineC(e){const t=e.split(/\s/g).filter(Boolean),n=t.length,s=this._bufferIndexC;3===n&&(this._positionsC[s]=Number.parseFloat(t[0]),this._positionsC[s+1]=Number.parseFloat(t[1]),this._positionsC[s+2]=Number.parseFloat(t[2]),this._bufferIndexC+=3)}_offsetPoints(){this._autoOffset&&(this._boundingBox.setFromPoints(this._points),this.setOffset(this._boundingBox.getCenter()));const e=this._offset.x,t=this._offset.y,n=this._offset.z;let s=null;for(let i=0,o=this._points.length;i<o;++i)(s=this._points[i]).x-=e,s.y-=t,s.z-=n}_createCloudPoint(e){const t=this._points.length,n=Math.ceil(t/1e6);let s=null,i=0,o=null;for(let t=0;t<n;++t){i=(s=this._points.splice(0,1e6)).length;const t=new u,n=new Float32Array(3*i),r=new Float32Array(3*i);let a=0,h=null;for(let e=0;e<i;++e)h=s[e],n[a]=h.x,n[a+1]=h.y,n[a+2]=h.z,this._pointsHaveColor?(r[a]=h.r/255,r[a+1]=h.g/255,r[a+2]=h.b/255):(r[a]=.1,r[a+1]=.2,r[a+2]=.5),a+=3;t.addAttribute("position",new p(n,3)),t.addAttribute("color",new p(r,3));const l=new m({size:.01,vertexColors:!0});o=new f(t,l),e.children.push(o)}}_createSubCloudPoint(e){const t=this._points.length,n=new u,s=new Float32Array(3*t),i=new Float32Array(3*t);let o=0,r=null;for(let e=0;e<t;++e)r=this._points[e],s[o]=r.x,s[o+1]=r.y,s[o+2]=r.z,this._pointsHaveColor?(i[o]=r.r/255,i[o+1]=r.g/255,i[o+2]=r.b/255):(i[o]=.1,i[o+1]=.2,i[o+2]=.5),o+=3;n.addAttribute("position",new p(s,3)),n.addAttribute("color",new p(i,3));const a=new m({size:.005,vertexColors:!0}),h=new f(n,a);h.rotation.x-=Math.PI/2,e.children.push(h),this._points=[]}}const Ct=Object.freeze({FoxPro:48,FoxPro_Autoincrement:49,dBASE_II:2,FoxPro_Var:50,dBASE_III_plus:3,dBASE_III_plus_memo:131,dBASE_IV_SQL_table:67,dBASE_IV_SQL_system:99,dBASE_IV_memo:139,dBASE_IV_memo_SQL_table:203,FoxBase:251,dBase_v_7:4,FoxPro_2_x:245,HiPerSix_memo:229}),Ft=Object.freeze({Binary:"B",Character:"C",Date:"D",Numeric:"N",Logical:"L",Memo:"M",Timestamp:"@",Long:"I",Autoincrement:"+",Float:"F",Double:"O",OLE:"G"});function zt(n=l,s=e){this.manager=n,this.logger=s,this.reader=new t}function Lt(t=l,n=e){this.manager=t,this.logger=n,this.textureLoader=new _,this.imagesShotData=[]}Object.assign(zt,{Terminator:13,DeletedRecord:26,YearOffset:1900}),Object.assign(zt.prototype,{load(e,t,n,s){const i=this,o=new c(i.manager);o.setResponseType("arraybuffer"),o.load(e,e=>{t(i.parse(e))},n,s)},parse(e){this.reader.setEndianess(n.Big).setBuffer(e);const t=this.reader.getInt8();if(!this._isValidVersion(t))return this.logger.error(`DBFLoader: Invalid version number: ${t}`),null;const s=this._parseHeader(t);return{header:s,datas:this._parseDatas(t,s)}},_isValidVersion:e=>Object.values(Ct).includes(e),_parseHeader(e){let t={};switch(e){case Ct.FoxPro:case Ct.FoxPro_Autoincrement:case Ct.FoxPro_Var:case Ct.dBASE_II:t=this._parseHeaderV2();break;case Ct.dBASE_III_plus:case Ct.dBASE_III_plus_memo:t=this._parseHeaderV2_5();break;case Ct.dBASE_IV_memo:case Ct.dBASE_IV_memo_SQL_table:case Ct.dBASE_IV_SQL_system:case Ct.dBASE_IV_SQL_table:t=this._parseHeaderV3();break;case Ct.dBase_v_7:case Ct.FoxPro_2_x:case Ct.HiPerSix_memo:t=this._parseHeaderV4();break;default:throw new RangeError(`Invalid version parameter: ${e}`)}return this.reader.getUint8()!==zt.Terminator&&this.logger.error("DBFLoader: Invalid terminator after field descriptors !!!"),t},_parseHeaderV2(){const e=this.reader.getInt16(),t=this.reader.getInt8()+zt.YearOffset,n=this.reader.getInt8(),s=this.reader.getInt8(),i=this.reader.getInt16();let o=[],r=void 0,a=void 0,h=void 0,l=void 0,c=void 0;for(let t=0;t<e;t++)r=this.reader.getString(11),a=this.reader.getChar(),h=this.reader.getUint8(),l=this.reader.getInt16(),c=this.reader.getInt8(),o.push({name:r,type:a,length:h,memoryAddress:l,decimalCount:c});return{numberOfRecords:e,year:t,month:n,day:s,lengthOfEachRecords:i,fields:o}},_parseHeaderV2_5(){const e=this.reader.getInt8()+zt.YearOffset,t=this.reader.getInt8(),s=this.reader.getInt8();this.reader.setEndianess(n.Little);const i=this.reader.getInt32(),o=this.reader.getInt16(),r=this.reader.getInt16();this.reader.setEndianess(n.Big),this.reader.skipOffsetOf(20);let a=[],h=void 0,l=void 0,c=void 0,d=void 0,u=void 0,p=void 0,m=void 0;for(let e=0;e<i;e++)h=this.reader.getString(11),l=this.reader.getChar(),d=this.reader.getInt32(),c=this.reader.getUint8(),u=this.reader.getUint8(),this.reader.skipOffsetOf(2),p=this.reader.getInt8(),this.reader.skipOffsetOf(2),m=this.reader.getInt8(),this.reader.skipOffsetOf(1),a.push({name:h,type:l,length:c,memoryAddress:d,decimalCount:u,workAreaId:p,MDXFlag:m});return{year:e,month:t,day:s,numberOfRecords:i,numberOfByteInHeader:o,numberOfByteInRecord:r,fields:a}},_parseHeaderV3(){const e=this.reader.getInt8()+zt.YearOffset,t=this.reader.getInt8(),s=this.reader.getInt8();this.reader.setEndianess(n.Little);const i=this.reader.getInt32(),o=this.reader.getInt16(),r=this.reader.getInt16();this.reader.setEndianess(n.Big),this.reader.skipOffsetOf(2);const a=this.reader.getInt8(),h=this.reader.getInt8();this.reader.skipOffsetOf(12);const l=this.reader.getInt8(),c=this.reader.getInt8();this.reader.skipOffsetOf(2);let d=[],u=void 0,p=void 0,m=void 0,f=void 0,_=void 0,g=void 0;for(;this.reader.getOffset()<o-1;)u=this.reader.getString(11),p=this.reader.getChar(),this.reader.skipOffsetOf(4),m=this.reader.getUint8(),f=this.reader.getUint8(),this.reader.skipOffsetOf(2),_=this.reader.getInt8(),this.reader.skipOffsetOf(10),g=this.reader.getInt8(),d.push({name:u,type:p,length:m,decimalCount:f,workAreaId:_,MDXFieldFlag:g});return{year:e,month:t,day:s,numberOfRecords:i,numberOfByteInHeader:o,numberOfByteInRecord:r,incompleteTransactionFlag:a,encryptionFlag:h,MDXFlag:l,languageDriverId:c,fields:d}},_parseHeaderV4(){const e=this.reader.getInt8()+zt.YearOffset,t=this.reader.getInt8(),s=this.reader.getInt8();this.reader.setEndianess(n.Little);const i=this.reader.getInt32(),o=this.reader.getInt16(),r=this.reader.getInt16();this.reader.setEndianess(n.Big),this.reader.skipOffsetOf(2);const a=this.reader.getInt8(),h=this.reader.getInt8();this.reader.skipOffsetOf(12);const l=this.reader.getInt8(),c=this.reader.getInt8();this.reader.skipOffsetOf(2);const d=this.reader.getString(32);this.reader.skipOffsetOf(4);let u=[],p=void 0,m=void 0,f=void 0,_=void 0,g=void 0,v=void 0;for(let e=0;e<i;e++)p=this.reader.getString(32),m=this.reader.getChar(),f=this.reader.getUint8(),_=this.reader.getUint8(),this.reader.skipOffsetOf(2),g=this.reader.getInt8(),this.reader.skipOffsetOf(2),v=this.reader.getInt32(),this.reader.skipOffsetOf(4),u.push({name:p,type:m,length:f,decimalCount:_,MDXFieldFlag:g,nextAutoincrementValue:v});return{year:e,month:t,day:s,numberOfRecords:i,numberOfByteInHeader:o,numberOfByteInRecord:r,incompleteTransactionFlag:a,encryptionFlag:h,MDXFlag:l,languageDriverId:c,languageDriverName:d,fields:u}},_parseDatas(e,t){const n=t.numberOfRecords,s=t.fields;let i=[],o=null,r=null;for(let e=0;e<n;e++){(o={}).deleted=this.reader.getUint8()===zt.DeletedRecord;for(let e=0,t=s.length;e<t;e++)switch((r=s[e]).type){case Ft.Binary:{const e=this.reader.getString(r.length);o[r.name]=parseInt(e)}break;case Ft.Numeric:{const e=this.reader.getString(r.length);o[r.name]=parseInt(e)}break;case Ft.Character:case Ft.Date:o[r.name]=this.reader.getString(r.length);break;case Ft.Logical:{const e=this.reader.getChar().toLowerCase();o[r.name]="t"===e||"y"===e||"f"!==e&&"n"!==e&&null}break;case Ft.Memo:o[r.name]=this.reader.getString(r.length);break;case Ft.Timestamp:break;case Ft.Long:case Ft.Autoincrement:o[r.name]=this.reader.getInt32();break;case Ft.Float:{const e=this.reader.getString(r.length);o[r.name]=parseInt(e)}break;case Ft.Double:o[r.name]=this.reader.getFloat64();break;case Ft.OLE:o[r.name]=this.reader.getString(r.length);break;default:throw new RangeError(`Invalid data type parameter: ${r.type}`)}i.push(o)}return i},_parseFieldProperties(){const e=this.reader.getInt16(),t=this.reader.getInt16(),n=this.reader.getInt16(),s=this.reader.getInt16(),i=this.reader.getInt16(),o=this.reader.getInt16(),r=this.reader.getInt16(),a=this.reader.getInt16();let h=[];for(let t=0;t<e;t++)h.push(this._getStandardProperties());let l=[];for(let e=0;e<n;e++)l.push(this._getCustomProperties());let c=[];for(let e=0;e<i;e++)c.push(this._getReferentialIntegrityProperties());return{numberOfStandardProperties:e,startOfStandardPropertiesDescriptor:t,numberOfCustomProperties:n,startOfCustomPropertiesDescriptor:s,numberOfReferentialIntegrityProperties:i,startOfReferentialIntegrityDescriptor:o,startOfData:r,sizeOfPropertiesStructure:a,standardProperties:h,customProperties:l,referentialIntegrityProperties:c}},_getStandardProperties(){const e=this.reader.getInt16(),t=this.reader.getInt16(),n=this.reader.getInt8(),s=this.reader.getInt8(),i=this.reader.getInt8();return this.reader.skipOffsetOf(4),{generationalNumber:e,tableFieldOffset:t,propertyDescribed:n,type:s,isConstraint:i,offsetFromStart:this.reader.getInt16(),widthOfDatabaseField:this.reader.getInt16()}},_getCustomProperties(){const e=this.reader.getInt16(),t=this.reader.getInt16(),n=this.reader.getInt8();return this.reader.skipOffsetOf(1),{generationalNumber:e,tableFieldOffset:t,type:n,offsetFromStartOfName:this.reader.getInt16(),lengthOfName:this.reader.getInt16(),offsetFromStartOfData:this.reader.getInt16(),lengthOfData:this.reader.getInt16()}},_getReferentialIntegrityProperties(){return{databaseState:this.reader.getInt8(),sequentialNumberRule:this.reader.getInt16(),offsetOfTheRIRuleName:this.reader.getInt16(),sizeOfTheRIRuleName:this.reader.getInt16(),offsetOfNameOfForeignTable:this.reader.getInt16(),sizeOfNameOfForeignTable:this.reader.getInt16(),stateBehaviour:this.reader.getInt8(),numberOfFieldsInLinkingKey:this.reader.getInt16(),offsetOfLocalTableTagName:this.reader.getInt16(),sizeOfTheLocalTableTagName:this.reader.getInt16(),offsetOfForeignTableTagName:this.reader.getInt16(),sizeOfTheForeignTableTagName:this.reader.getInt16()}}}),Object.assign(Lt.prototype,{constructor:Lt,load:function(e,t,n,s){const i=e.replace(/[^/]*$/,""),o=new c(this.manager);o.setResponseType("text/plain"),o.load(e,e=>{t(this._parse(e,i))},n,s)},_parse(e,t){let n=null;if(window.DOMParser){n=(new DOMParser).parseFromString(e,"text/xml")}else(n=new window.ActiveXObject("Microsoft.XMLDOM")).async=!1,n.loadXML(e);const s=n.getElementsByTagName("SHOT");let i=null,o=null,r=null,a=null;for(let e=0,t=s.length;e<t;++e)r=(o=(i=s[e]).children[0]).children[0],a=o.children[1],this.imagesShotData.push({imageName:i.attributes.n.value,position:{x:parseFloat(r.attributes.x.value),y:parseFloat(r.attributes.y.value),z:parseFloat(r.attributes.z.value)},rotation:{x:parseFloat(a.attributes.x.value),y:parseFloat(a.attributes.y.value),z:parseFloat(a.attributes.z.value)}});return this._createImagesPacks(t)},_createImagesPacks(e){for(var t=this.imagesShotData,n=new d,s=void 0,i=void 0,o=0,r=t.length;o<r;++o)s=t[o],(i=new g(new v(.06528,.04896,1,1),new b({color:16777215,side:w}))).name=s.imageName,i.position.x=s.position.x-600200,i.position.y=s.position.y-131400,i.position.z=s.position.z-60-.34,i.rotation.x=y.degToRad(s.rotation.x),i.rotation.y=y.degToRad(s.rotation.z),i.rotation.z=-y.degToRad(s.rotation.y),i.userData={filePath:e},n.add(i);return n.rotateX(-Math.PI/2),n}});const Bt=Object.freeze({NullShape:0,Point:1,Polyline:3,Polygon:5,MultiPoint:8,PointZ:11,PolyLineZ:13,PolygonZ:15,MultiPointZ:18,PointM:21,PolylineM:23,PolygonM:25,MultiPointM:28,MultiPatch:31});function jt(e,t){let n=t[0],s=t[1],i=-1;for(let o=0,r=e.length,a=r-1;o<r;a=o++){const r=e[o],h=r[0],l=r[1],c=e[a],d=c[0],u=c[1];Rt(r,c,t)?i=0:l>s!=u>s&&n<(d-h)*(s-l)/(u-l)+h&&(i=-i)}return i}function Rt(e,t,n){var s=n[0]-e[0],i=n[1]-e[1];if(0===s&&0===i)return!0;var o=t[0]-e[0],r=t[1]-e[1];if(0===o&&0===r)return!1;var a=(s*o+i*r)/(o*o+r*r);return!(a<0||a>1)&&(0===a||1===a||a*o===s&&a*r===i)}function Gt(n=l,s=e){this.manager=n,this.logger=s,this.globalOffset=new x,this.worldAxis={from:"zUp",to:"zForward"},this._reader=new t}function Ht(e){return e.substring(e.lastIndexOf("/")+1)}function Ut(e){return e.slice(2+(e.lastIndexOf(".")-1>>>0))}function Nt(e){const t=function(e){return e.substring(0,e.lastIndexOf("/"))}(e);return e.indexOf("blob")>-1?t:e}function Xt(t=l,n=e){this.manager=t,this.logger=n}Object.assign(Gt,{FileCode:9994,MinFileLength:100,MinVersion:1e3}),Object.assign(Gt.prototype,{load(e,t,n,s){const i=this,o=new c(i.manager);o.setResponseType("arraybuffer"),o.load(e,e=>{t(i.parse(e))},n,s)},parse(e){this._reader.setEndianess(n.Big).setBuffer(e);const t=this._parseHeader();if(t.fileCode!==Gt.FileCode)return this.logger.error("SHPLoader: Invalide Shape file code !"),null;if(t.fileLength<Gt.MinFileLength)return this.logger.error("SHPLoader: Shape file have an incorrect length !"),null;if(!Object.values(Bt).includes(t.shapeType))return this.logger.error("SHPLoader: Shape file have an incorrect shape type !"),null;t.version<Gt.MinVersion&&this.logger.warn("SHPLoader: Version of shape file below than 1000 could be incorrectly parsed !");const s=this._parseDatas(t);return this._convertToObjects(s)},_parseHeader(){const e=this._reader.getInt32();this._reader.skipOffsetOf(20);const t=this._reader.getInt32();this._reader.setEndianess(n.Little);const s=this._reader.getInt32(),i=this._reader.getInt32(),o=this._reader.getInt32(),r=this._reader.getInt32();return{fileCode:e,fileLength:t,version:s,shapeType:i,boundingBox:{xMin:o,xMax:this._reader.getInt32(),yMin:r,yMax:this._reader.getInt32(),zMin:this._reader.getInt32(),zMax:this._reader.getInt32(),mMin:this._reader.getInt32(),mMax:this._reader.getInt32()}}},_parseDatas(e){this._reader.skipOffsetTo(100);let t=[],s=void 0,i=void 0,o=void 0;for(;!this._reader.isEndOfFile();)switch(s=this._parseRecordHeader(),i=this._reader.getOffset()+2*s.contentLength,this._reader.setEndianess(n.Little),e.shapeType){case Bt.NullShape:this._reader.skipOffsetTo(i);break;case Bt.Point:case Bt.PointZ:case Bt.PointM:for(;this._reader.getOffset()<i;)(o=this._parsePoint())&&t.push(o);break;case Bt.Polyline:case Bt.PolyLineZ:case Bt.PolylineM:for(;this._reader.getOffset()<i;)(o=this._parsePolyLine())&&t.push(o);break;case Bt.Polygon:case Bt.PolygonZ:case Bt.PolygonM:for(;this._reader.getOffset()<i;)(o=this._parsePolyLine())&&t.push(o);break;case Bt.MultiPoint:case Bt.MultiPointZ:case Bt.MultiPointM:for(;this._reader.getOffset()<i;)(o=this._parseMultiPoint())&&t.push(o);break;case Bt.MultiPatch:for(;this._reader.getOffset()<i;)(o=this._parseMultiPatch())&&t.push(o);break;default:this.logger.error(`SHPLoader: Invalid switch parameter: ${e.shapeType}`)}return t},_parseRecordHeader(){return this._reader.setEndianess(n.Big),{recordNumber:this._reader.getInt32(),contentLength:this._reader.getInt32()}},_parsePoint(){const e=this._reader.getInt32();return e===Bt.NullShape?null:{shapeType:e,x:this._reader.getFloat64(),y:this._reader.getFloat64()}},_parsePolyLine(){const e=this._reader.getInt32();if(e===Bt.NullShape)return null;const t={xMin:this._reader.getFloat64(),yMin:this._reader.getFloat64(),xMax:this._reader.getFloat64(),yMax:this._reader.getFloat64()},n=this._reader.getInt32(),s=this._reader.getInt32(),i=new Array(n);for(let e=0;e<n;e++)i[e]=this._reader.getInt32();const o=new Array(s);for(let e=0;e<s;e++)o[e]={x:this._reader.getFloat64(),y:this._reader.getFloat64()};return{shapeType:e,boundingBox:t,numberOfParts:n,numberOfPoints:s,parts:i,points:o}},_parsePolygon(){const e=this._reader.getInt32();if(e===Bt.NullShape)return null;const t={xMin:this._reader.getFloat64(),yMin:this._reader.getFloat64(),xMax:this._reader.getFloat64(),yMax:this._reader.getFloat64()},n=this._reader.getInt32(),s=this._reader.getInt32();let i=new Array(n);for(let e=0;e<n;e++)i[e]=this._reader.getInt32();let o=new Array(s);for(let e=0;e<s;e++)o[e]={x:this._reader.getFloat64(),y:this._reader.getFloat64()};const r=[],a=[];return i.forEach((e,t)=>{const n=o.slice(e,i[t+1]);!function(e){if((t=e.length)<4)return!1;for(var t,n=0,s=e[t-1][1]*e[0][0]-e[t-1][0]*e[0][1];++n<t;)s+=e[n-1][1]*e[n][0]-e[n-1][0]*e[n][1];return s>=0}(n)?a.push(n):r.push(n)}),a.forEach(e=>{r.some(t=>{if(function(e,t){let n=0,s=t.length;do{if(jt(e,t[n])>0)return!0}while(++n<s);return!1}(t[0],e))return t.push(e),!0})||r.push([e])}),{shapeType:e,boundingBox:t,numberOfParts:n,numberOfPoints:s,parts:i,polygons:r}},_parseMultiPoint(){const e=this._reader.getInt32();if(e===Bt.NullShape)return null;const t={xMin:this._reader.getFloat64(),xMax:this._reader.getFloat64(),yMin:this._reader.getFloat64(),yMax:this._reader.getFloat64()},n=this._reader.getInt32(),s=new Array(n);for(let e=0;e<n;e++)s.push([this._reader.getFloat64(),this._reader.getFloat64()]);return{shapeType:e,boundingBox:t,numberOfPoints:n,points:s}},_parseMultiPatch(){const e=this._reader.getInt32();return e===Bt.NullShape?null:{shapeType:e}},_convertToObjects(e){let t=[];for(let t=0,i=e.length;t<i;t++){let i=e[t];i.shapeType!==Bt.Polygon&&i.shapeType!==Bt.PolygonZ&&i.shapeType!==Bt.PolygonM||(i.points&&Array.isArray(i.points[0])?n(i.points):s(i.points))}function n(e){for(let t=0,i=e.length;t<i;t++){let i=e[t];i?Array.isArray(i[0])?n(i):s(i):this.logger.log("no array, oups !")}}function s(e){t.push(new E(e))}return t}}),Object.assign(Xt.prototype,{load(e,t,n,s){if(e)if(e instanceof FileList){const i=e.length;this.logger.log(`numberOfFiles: ${i}`);const o=[];let r="",a=null;for(let t=0;t<i;++t)a=e[t],r=`${URL.createObjectURL(a)}/${a.name}`,o.push({url:r});this.load(o,t,n,s)}else if(e instanceof File){const i=`${URL.createObjectURL(e)}/${e.name}`;this.loadSingleFile({url:i},t,n,s)}else if(_t(e))this.loadSingleFile(e,t,n,s);else if(gt(e))this.load(e(),t,n,s);else if(vt(e))if(2===e.length&&_t(e[0])&&_t(e[1]))this.loadAssociatedFiles(e,t,n,s);else for(let i=0,o=e.length;i<o;i++)this.load(e[i],t,n,s);else bt(e)?this.loadSingleFile({url:e},t,n,s):this.logger.error("TUniversalLoader: Invalid files parameter !!!");else this.logger.error("Unable to load null or undefined files !")},loadSingleFile(e,t,n,i){const o=e.url,r=Ut(Ht(o));switch(e.url=Nt(o),r){case s.Asc.value:this._loadAsc(e,t,n,i);break;case s.Dae.value:this._loadDae(e,t,n,i);break;case s.Dbf.value:this._loadDbf(e,t,n,i);break;case s.Fbx.value:this._loadFbx(e,t,n,i);break;case s.Json.value:this._loadJson(e,t,n,i);break;case s.Obj.value:this._loadObj(e,t,n,i);break;case s.Shp.value:this._loadShp(e,t,n,i);break;case s.Stl.value:this._loadStl(e,t,n,i);break;default:throw new RangeError(`Invalid file extension: ${r}. Supported formats are: ${s.toString()}`)}},loadAssociatedFiles(e,t,n,i){const o=e[0],r=o.url,a=Ut(Ht(r));o.url=Nt(r);const h=e[1],l=h.url,c=Ut(Ht(l));h.url=Nt(l),a===s.Mtl.value&&c===s.Obj.value?this._loadObjMtlCouple(h,o,t,n,i):a===s.Obj.value&&c===s.Mtl.value?this._loadObjMtlCouple(o,h,t,n,i):a===s.Shp.value&&c===s.Dbf.value?this._loadShpDbfCouple(o,h,t,n,i):a===s.Dbf.value&&c===s.Shp.value?this._loadShpDbfCouple(h,o,t,n,i):(this.loadSingleFile(e[0],t,n,i),this.loadSingleFile(e[1],t,n,i))},_loadAsc(e,t,n,s){new It(this.manager).load(e.url,t,n,s)},_loadDae(e,t,n,s){new M(this.manager).load(e.url,e=>{t(e.scene)},n,s)},_loadDbf(e,t,n,s){new zt(this.manager).load(e.url,t,n,s)},_loadFbx(e,t,n,s){new P(this.manager).load(e.url,n=>{const s=e.position;s&&n.position.set(s.x,s.y,s.z),t(n)},n,s)},_loadJson(e,t,n,s){new A(this.manager).load(e.url,t,n,s)},_loadObj(e,t,n,s){new T(this.manager).load(e.url,t,n,s)},_loadShp(e,t,n,s){new Gt(this.manager).load(e.url,e=>{const n=new d;for(let t=0,s=e.length;t<s;t++)n.add(new g(new S(e[t]),new D({color:16777215*Math.random(),side:w})));n.rotateX(mt(-90)),t(n)},n,s)},_loadStl(e,t,n,s){new O(this.manager).load(e.url,n=>{const s=new D,i=new g(n,s),o=e.position;o&&i.position.set(o.x,o.y,o.z),t(i)},n,s)},_loadObjMtlCouple(e,t,n,s,i){const o=new k(this.manager),r=new T(this.manager),a=t.texturePath;a&&o.setTexturePath(a),o.load(t.url,t=>{t.preload();for(let e=0,n=t.materials.length;e<n;e++){const n=t.materials[e];n.opacity=1,t.materials[e]=n}r.setMaterials(t),r.load(e.url,n,s,i)},s,i)},_loadShpDbfCouple(e,t,n,s,i){let o=void 0,r=void 0;function a(){if(!o||!r)return;const e=new d;e.name="Locaux";let t=void 0;for(let n=0,s=o.length;n<s;n++){t=new g(new S(o[n]),new D({color:11596470,side:w}));const s=r.datas[n].CODE;t.name=s,t.userData.Code=s,e.add(t)}n(e)}new Gt(this.manager).load(e.url,e=>{o=e,a()},s,i),new zt(this.manager).load(t.url,e=>{r=e,a()},s,i)}});const Zt=new x(0,0,-1),Yt=new x(0,0,1),Vt=new x(0,1,0),Wt=new x(0,-1,0),$t=new x(1,0,0),qt=new x(-1,0,0),Jt=ft({None:0,Rotating:1,Panning:2,Rolling:3,Zooming:4,Moving:5}),Kt=ft({FirstPerson:1,Orbit:2,Fly:3,Path:4});class Qt extends I{constructor(t={}){const n={logger:e,camera:null,target:new C,mode:Kt.Orbit,domElement:window,...t};super(),this._handlers={onMouseEnter:this._onMouseEnter.bind(this),onMouseLeave:this._onMouseLeave.bind(this),onMouseDown:this._onMouseDown.bind(this),onMouseMove:this._onMouseMove.bind(this),onMouseWheel:this._onMouseWheel.bind(this),onMouseUp:this._onMouseUp.bind(this),onDblClick:this._onDblClick.bind(this),onTouchStart:this._onTouchStart.bind(this),onTouchEnd:this._onTouchEnd.bind(this),onTouchCancel:this._onTouchCancel.bind(this),onTouchLeave:this._onTouchLeave.bind(this),onTouchMove:this._onTouchMove.bind(this),onKeyDown:this._onKeyDown.bind(this),onKeyUp:this._onKeyUp.bind(this)},this.logger=n.logger,this.camera=n.camera,this.target=n.target,this.mode=n.mode,this.domElement=n.domElement,this.enabled=!0,this._paths=[],this._trackPath=!1,this._cameraJump=.1,this._currentPathPosition=null,this._currentPathOffset=0,this._currentPathIndex=0,this._currentPath=null,this._maxJump=1,this._lockedTarget=!0,this.previousTouches=[],this.canMove=!0,this.moveSpeed=1,this.canFront=!0,this.frontMinimum=-1/0,this.frontMaximum=-1/0,this.frontMinSpeed=0,this.frontSpeed=1,this.frontMaxSpeed=1/0,this.frontAcceleration=1,this.canBack=!0,this.backMinimum=-1/0,this.backMaximum=-1/0,this.backMinSpeed=0,this.backSpeed=1,this.backMaxSpeed=1/0,this.backAcceleration=1,this.canUp=!0,this.upMinimum=-1/0,this.upMaximum=-1/0,this.upMinSpeed=0,this.upSpeed=1,this.upMaxSpeed=1/0,this.upAcceleration=1,this.canDown=!0,this.downMinimum=-1/0,this.downMaximum=-1/0,this.downMinSpeed=0,this.downSpeed=1,this.downMaxSpeed=1/0,this.downAcceleration=1,this.canLeft=!0,this.leftMinimum=-1/0,this.leftMaximum=-1/0,this.leftMinSpeed=0,this.leftSpeed=1,this.leftMaxSpeed=1/0,this.leftAcceleration=1,this.canRight=!0,this.rightMinimum=-1/0,this.rightMaximum=-1/0,this.rightMinSpeed=0,this.rightSpeed=1,this.rightMaxSpeed=1/0,this.rightAcceleration=1,this.canRotate=!0,this.minPolarAngle=.001,this.maxPolarAngle=Math.PI-.001,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.rotateMinSpeed=0,this.rotateSpeed=1,this.rotateMaxSpeed=1/0,this.rotateAcceleration=1,this.canPan=!0,this.panMinimum=-1/0,this.panMaximum=-1/0,this.panMinSpeed=0,this.panSpeed=.001,this.panMaxSpeed=1/0,this.panAcceleration=1,this.canRoll=!0,this.rollMinimum=-1/0,this.rollMaximum=-1/0,this.rollMinSpeed=0,this.rollSpeed=.1,this.rollMaxSpeed=1/0,this.rollAcceleration=1,this.canZoom=!0,this.zoomMinimum=0,this.zoomMaximum=1/0,this.zoomMinSpeed=0,this.zoomSpeed=.001,this.zoomMaxSpeed=1/0,this.zoomAcceleration=1,this.canLookAt=!0,this.actionsMap={front:[i.Z.value,i.UP_ARROW.value],back:[i.S.value,i.DOWN_ARROW.value],up:[i.A.value,i.PAGE_UP.value],down:[i.E.value,i.PAGE_DOWN.value],left:[i.Q.value,i.LEFT_ARROW.value],right:[i.D.value,i.RIGHT_ARROW.value],rotate:[o.LEFT.value],pan:[o.MIDDLE.value],roll:{left:[i.R.value],right:[i.T.value]},zoom:[o.WHEEL.value],lookAtFront:[i.NUMPAD_2.value],lookAtFrontLeft:[i.NUMPAD_3.value],lookAtFrontRight:[i.NUMPAD_1.value],lookAtBack:[i.NUMPAD_8.value],lookAtBackLeft:[i.NUMPAD_9.value],lookAtBackRight:[i.NUMPAD_7.value],lookAtUp:[i.NUMPAD_5.value],lookAtDown:[i.NUMPAD_0.value],lookAtLeft:[i.NUMPAD_6.value],lookAtRight:[i.NUMPAD_4.value]},this._state=Jt.None}get camera(){return this._camera}set camera(e){if(wt(e))throw new Error("Camera cannot be null ! Expect an instance of Camera");if(yt(e))throw new Error("Camera cannot be undefined ! Expect an instance of Camera");if(!(e instanceof F))throw new Error(`Camera cannot be an instance of ${e.constructor.name}. Expect an instance of Camera.`);this._camera=e}get target(){return this._target}set target(e){if(wt(e))throw new Error("Target cannot be null ! Expect an instance of Object3D.");if(yt(e))throw new Error("Target cannot be undefined ! Expect an instance of Object3D.");if(!(e instanceof C))throw new Error(`Target cannot be an instance of ${e.constructor.name}. Expect an instance of Object3D.`);this._target=e}get mode(){return this._mode}set mode(e){if(wt(e))throw new Error("Mode cannot be null ! Expect a value from CameraControlMode enum.");if(yt(e))throw new Error("Mode cannot be undefined ! Expect a value from CameraControlMode enum.");this._mode=e,this._trackPath&&this._initPathDisplacement()}get paths(){return this._paths}set paths(e){this._paths=e}get trackPath(){return this._trackPath}set trackPath(e){if(xt(e))throw new Error(`Track path cannot be an instance of ${e.constructor.name}. Expect a boolean.`);this._trackPath=e,this._trackPath&&this._initPathDisplacement()}get domElement(){return this._domElement}set domElement(e){if(wt(e))throw new Error("DomElement cannot be null ! Expect an instance of HTMLDocument.");if(yt(e))throw new Error("DomElement cannot be undefined ! Expect an instance of HTMLDocument.");if(!(e instanceof Window||e instanceof HTMLDocument||e instanceof HTMLDivElement||e instanceof HTMLCanvasElement))throw new Error(`DomElement cannot be an instance of ${e.constructor.name}. Expect an instance of Window, HTMLDocument or HTMLDivElement.`);this._domElement&&(this._domElement.removeEventListener("mouseenter",this._handlers.onMouseEnter,!1),this._domElement.removeEventListener("mouseleave",this._handlers.onMouseLeave,!1),this.dispose()),this._domElement=e,this._domElement.addEventListener("mouseenter",this._handlers.onMouseEnter,!1),this._domElement.addEventListener("mouseleave",this._handlers.onMouseLeave,!1),this.impose()}setCamera(e){return this.camera=e,this}setTarget(e){return this.target=e,this}setMode(e){return this.mode=e,this}setPaths(e){return this.paths=e,this}addPath(e){return this._paths.push(e),this}setTrackPath(e){return this.trackPath=e,this}setDomElement(e){return this.domElement=e,this}impose(){this._domElement.addEventListener("keydown",this._handlers.onKeyDown,!1),this._domElement.addEventListener("keyup",this._handlers.onKeyUp,!1),this._domElement.addEventListener("dblclick",this._handlers.onDblClick,!1),this._domElement.addEventListener("mousedown",this._handlers.onMouseDown,!1),this._domElement.addEventListener("mousemove",this._handlers.onMouseMove,!1),this._domElement.addEventListener("mouseup",this._handlers.onMouseUp,!1),this._domElement.addEventListener("wheel",this._handlers.onMouseWheel,{capture:!0,once:!1,passive:!1}),this._domElement.addEventListener("touchcancel",this._handlers.onTouchCancel,!1),this._domElement.addEventListener("touchend",this._handlers.onTouchEnd,!1),this._domElement.addEventListener("touchleave",this._handlers.onTouchLeave,!1),this._domElement.addEventListener("touchmove",this._handlers.onTouchMove,{capture:!0,once:!1,passive:!1}),this._domElement.addEventListener("touchstart",this._handlers.onTouchStart,{capture:!0,once:!1,passive:!1}),this.dispatchEvent({type:"impose"})}dispose(){this._domElement.removeEventListener("keydown",this._handlers.onKeyDown,!1),this._domElement.removeEventListener("keyup",this._handlers.onKeyUp,!1),this._domElement.removeEventListener("dblclick",this._handlers.onDblClick,!1),this._domElement.removeEventListener("mousedown",this._handlers.onMouseDown,!1),this._domElement.removeEventListener("mousemove",this._handlers.onMouseMove,!1),this._domElement.removeEventListener("mouseup",this._handlers.onMouseUp,!1),this._domElement.removeEventListener("wheel",this._handlers.onMouseWheel,{capture:!0,once:!1,passive:!1}),this._domElement.removeEventListener("touchcancel",this._handlers.onTouchCancel,!1),this._domElement.removeEventListener("touchend",this._handlers.onTouchEnd,!1),this._domElement.removeEventListener("touchleave",this._handlers.onTouchLeave,!1),this._domElement.removeEventListener("touchmove",this._handlers.onTouchMove,{capture:!0,once:!1,passive:!1}),this._domElement.removeEventListener("touchstart",this._handlers.onTouchStart,{capture:!0,once:!1,passive:!1}),this.dispatchEvent({type:"dispose"})}update(){}setCameraPosition(e){return this._camera.position.copy(e),this._camera.lookAt(this._target.position),this}setTargetPosition(e){return this._target.position.copy(e),this._camera.lookAt(this._target.position),this}_consumeEvent(e){e.cancelable&&e.stopImmediatePropagation()}_onKeyDown(e){if(!this.enabled)return;e.preventDefault();const t=this.actionsMap,n=e.keyCode;t.front.includes(n)?(this._front(),this._consumeEvent(e)):t.back.includes(n)?(this._back(),this._consumeEvent(e)):t.up.includes(n)?(this._up(),this._consumeEvent(e)):t.down.includes(n)?(this._down(),this._consumeEvent(e)):t.left.includes(n)?(this._left(),this._consumeEvent(e)):t.right.includes(n)?(this._right(),this._consumeEvent(e)):t.rotate.includes(n)?this._rotate(1):t.pan.includes(n)?(this._pan(1),this._consumeEvent(e)):t.roll.left.includes(n)?(this._roll(1),this._consumeEvent(e)):t.roll.right.includes(n)?(this._roll(-1),this._consumeEvent(e)):t.zoom.includes(n)?(this._zoom(1),this._consumeEvent(e)):t.lookAtFront.includes(n)?(this._lookAt(Zt),this._consumeEvent(e)):t.lookAtFrontLeft.includes(n)?(this._lookAt(new x(-1,0,-1).normalize()),this._consumeEvent(e)):t.lookAtFrontRight.includes(n)?(this._lookAt(new x(1,0,-1).normalize()),this._consumeEvent(e)):t.lookAtBack.includes(n)?(this._lookAt(Yt),this._consumeEvent(e)):t.lookAtBackLeft.includes(n)?(this._lookAt(new x(-1,0,1).normalize()),this._consumeEvent(e)):t.lookAtBackRight.includes(n)?(this._lookAt(new x(1,0,1).normalize()),this._consumeEvent(e)):t.lookAtUp.includes(n)?(this._lookAt(Vt),this._consumeEvent(e)):t.lookAtDown.includes(n)?(this._lookAt(Wt),this._consumeEvent(e)):t.lookAtLeft.includes(n)?(this._lookAt(qt),this._consumeEvent(e)):t.lookAtRight.includes(n)&&(this._lookAt($t),this._consumeEvent(e))}_onKeyUp(e){this.enabled&&e.preventDefault()}_onTouchStart(e){this.enabled&&(e.preventDefault(),this.previousTouches=e.touches)}_onTouchEnd(e){this.enabled&&(e.preventDefault(),this.previousTouches=[],this._state=Jt.None)}_onTouchCancel(e){this.enabled&&(e.preventDefault(),this.previousTouches=[],this._state=Jt.None)}_onTouchLeave(e){this.enabled&&(e.preventDefault(),this.previousTouches=[],this._state=Jt.None)}_onTouchMove(e){if(!this.enabled)return;e.preventDefault();const t=this.previousTouches,n=e.changedTouches,s=t.length,i=n.length;if(2===s&&2===i){const s=new z(t[0].clientX,t[0].clientY),i=new z(t[1].clientX,t[1].clientY),o=s.distanceTo(i),r=(new z).addVectors(s,i).divideScalar(2),a=(new z).subVectors(s,i).normalize(),h=new z(n[0].clientX,n[0].clientY),l=new z(n[1].clientX,n[1].clientY),c=h.distanceTo(l),d=(new z).addVectors(h,l).divideScalar(2),u=(new z).subVectors(s,i).normalize(),p=(new z).subVectors(d,r),m=c-o,f=u.dot(a);this._pan(p),this._zoom(m),this._roll(f),this._consumeEvent(e)}else if(1===s&&1===i){const s=new z(n[0].clientX-t[0].clientX,n[0].clientY-t[0].clientY).divideScalar(10);this._rotate(s),this._consumeEvent(e)}else this.logger.warn("Ignoring inconsistent touches event.");this.previousTouches=n}_onMouseEnter(e){this.enabled&&(e.preventDefault(),this.impose(),e.target.constructor!==HTMLDocument&&this._domElement.focus())}_onMouseLeave(e){this.enabled&&(e.preventDefault(),e.target.constructor!==HTMLDocument&&this._domElement.blur(),this.dispose(),this._state=Jt.None)}_onMouseDown(e){if(!this.enabled)return;e.preventDefault();const t=this.actionsMap,n=e.button;t.front.includes(n)?(this._state=Jt.Moving,this._front(),this._consumeEvent(e)):t.back.includes(n)?(this._state=Jt.Moving,this._back(),this._consumeEvent(e)):t.up.includes(n)?(this._state=Jt.Moving,this._up(),this._consumeEvent(e)):t.down.includes(n)?(this._state=Jt.Moving,this._down(),this._consumeEvent(e)):t.left.includes(n)?(this._state=Jt.Moving,this._left(),this._consumeEvent(e)):t.right.includes(n)?(this._state=Jt.Moving,this._right(),this._consumeEvent(e)):t.rotate.includes(n)?(this._state=Jt.Rotating,this._consumeEvent(e)):t.pan.includes(n)?(this._state=Jt.Panning,this._consumeEvent(e)):t.roll.left.includes(n)?(this._state=Jt.Rolling,this._consumeEvent(e)):t.roll.right.includes(n)?(this._state=Jt.Rolling,this._consumeEvent(e)):t.zoom.includes(n)?(this._state=Jt.Zooming,this._consumeEvent(e)):this._state=Jt.None}_onMouseMove(e){if(!this.enabled||this._state===Jt.None)return;e.preventDefault();const t=this._state,n={x:e.movementX||e.mozMovementX||e.webkitMovementX||0,y:e.movementY||e.mozMovementY||e.webkitMovementY||0};switch(t){case Jt.Moving:break;case Jt.Rotating:this._rotate(n),this._consumeEvent(e);break;case Jt.Panning:this._pan(n),this._consumeEvent(e);break;case Jt.Rolling:this._roll(n),this._consumeEvent(e);break;case Jt.Zooming:this._zoom(n),this._consumeEvent(e);break;default:throw new RangeError(`Unknown state: ${t}`)}}_onMouseWheel(e){if(!this.enabled)return;e.preventDefault();const t=e.wheelDelta||e.deltaY;this._zoom(t),this._consumeEvent(e)}_onMouseUp(e){this.enabled&&(e.preventDefault(),this._state=Jt.None)}_onDblClick(e){this.enabled&&(e.preventDefault(),this.logger.warn("CameraControls: Double click events is not implemented yet, sorry for the disagreement."))}_front(){if(this.canMove&&this.canFront){if("PerspectiveCamera"===this._camera.type){const e=Zt.clone().applyQuaternion(this._camera.quaternion),t=this._trackPath?this._getPathDisplacement(e):e.multiplyScalar(this.frontSpeed);this._camera.position.add(t),this._target.position.add(t)}this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_back(){if(this.canMove&&this.canBack){if("PerspectiveCamera"===this._camera.type){const e=Yt.clone().applyQuaternion(this._camera.quaternion),t=this._trackPath?this._getPathDisplacement(e):e.multiplyScalar(this.backSpeed);this._camera.position.add(t),this._target.position.add(t)}this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_up(){if(this.canMove&&this.canUp){if("PerspectiveCamera"===this._camera.type){const e=Vt.clone().applyQuaternion(this._camera.quaternion).multiplyScalar(this.upSpeed);this._camera.position.add(e),this._target.position.add(e)}this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_down(){if(this.canMove&&this.canDown){if("PerspectiveCamera"===this._camera.type){const e=Wt.clone().applyQuaternion(this._camera.quaternion).multiplyScalar(this.downSpeed);this._camera.position.add(e),this._target.position.add(e)}this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_left(){if(this.canMove&&this.canLeft){if("PerspectiveCamera"===this._camera.type){const e=qt.clone().applyQuaternion(this._camera.quaternion).multiplyScalar(this.leftSpeed);this._camera.position.add(e),this._target.position.add(e)}this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_right(){if(this.canMove&&this.canRight){if("PerspectiveCamera"===this._camera.type){const e=$t.clone().applyQuaternion(this._camera.quaternion).multiplyScalar(this.rightSpeed);this._camera.position.add(e),this._target.position.add(e)}this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_rotate(e){if(this.canRotate){if("PerspectiveCamera"===this._camera.type){const t=this._camera.position,n=this._target.position,s=t.distanceTo(n),i=(new x).subVectors(t,n).normalize(),o=this.rotateSpeed;switch(this._mode){case Kt.FirstPerson:{const s=e.x,i=e.y,r=new x(-s,i,0).applyQuaternion(this._camera.quaternion).multiplyScalar(o).add(n),a=(new x).subVectors(r,t).normalize(),h=Vt.clone().dot(a),l=$t.clone().dot(a),c=.97;if(h<-c||h>c||l<-2||l>2)return;const d=a.multiplyScalar(1).add(t);this.setTargetPosition(d)}break;case Kt.Orbit:{const t=(new L).setFromVector3(i),r=t.theta+mt(-e.x)*o,a=t.phi+mt(-e.y)*o;t.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,r)),t.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,a));const h=(new x).setFromSpherical(t).multiplyScalar(s).add(n);this.setCameraPosition(h)}break;default:throw new RangeError(`Unamanaged rotation for camera mode ${this._mode}`)}}this.dispatchEvent({type:"rotate"}),this.dispatchEvent({type:"change"})}}_pan(e){if(this.canPan){if("PerspectiveCamera"===this._camera.type){const t=this._camera.position,n=this._target.position,s=t.distanceTo(n),i=new x(-e.x,e.y,0).applyQuaternion(this._camera.quaternion).multiplyScalar(this.panSpeed*s);this._camera.position.add(i),this._target.position.add(i)}this.dispatchEvent({type:"pan"}),this.dispatchEvent({type:"change"})}}_roll(e){if(this.canRoll){if("PerspectiveCamera"===this._camera.type){const t=this._camera.position,n=this._target.position,s=(new x).subVectors(t,n).normalize(),i=e*this.rollSpeed;this._camera.up.applyAxisAngle(s,i),this._camera.lookAt(n)}this.dispatchEvent({type:"roll"}),this.dispatchEvent({type:"change"})}}_zoom(e){if(this.canZoom){if("PerspectiveCamera"===this._camera.type)switch(this._mode){case Kt.FirstPerson:e>0?this._camera.fov--:this._camera.fov++,this._camera.updateProjectionMatrix();break;case Kt.Orbit:{const t=this._camera.position,n=this._target.position,s=t.distanceTo(n),i=Zt.clone().applyQuaternion(this._camera.quaternion).multiplyScalar(e*this.zoomSpeed*s);let o=t.clone().add(i);const r=(new x).subVectors(o,t).normalize(),a=(new x).subVectors(t,n).normalize(),h=(new x).subVectors(o,n).normalize(),l=r.dot(a),c=r.dot(h),d=o.distanceToSquared(n);l<0&&(d<this.zoomMinimum*this.zoomMinimum||c>0)&&(o=a.clone().multiplyScalar(this.zoomMinimum).add(n)),this._camera.position.copy(o)}break;default:throw new RangeError(`Invalid camera control mode parameter: ${this._mode}`)}this.dispatchEvent({type:"zoom"}),this.dispatchEvent({type:"change"})}}_lookAt(e){if(this.canLookAt){if("PerspectiveCamera"===this._camera.type){const t=e.clone(),n=this._camera.position,s=this._target.position,i=n.distanceTo(s);switch(this.mode){case Kt.FirstPerson:{t.y=-t.y;const e=t.multiplyScalar(i).add(n);this.setTargetPosition(e)}break;case Kt.Orbit:{const e=t.multiplyScalar(i).add(s);this.setCameraPosition(e)}break;default:throw new RangeError(`Invalid camera control mode parameter: ${this._mode}`)}}this.dispatchEvent({type:"lookAt"}),this.dispatchEvent({type:"change"})}}_initPathDisplacement(){if(Et(this._paths))this.logger.warn("Try to init path displacement without any paths");else switch(Mt(this._currentPath)&&(this._currentPathIndex=0,this._currentPathOffset=0,this._currentPath=this._paths[0]),this._currentPathPosition=this._currentPath.getPointAt(this._currentPathOffset),this._mode){case Kt.FirstPerson:if(this._lockedTarget){const e=(new x).subVectors(this._currentPathPosition,this.camera.position);this._camera.position.add(e),this._target.position.add(e)}else this.setCameraPosition(this._currentPathPosition);break;case Kt.Orbit:if(this._lockedTarget){const e=(new x).subVectors(this._currentPathPosition,this.target.position);this._camera.position.add(e),this._target.position.add(e)}else this.setTargetPosition(this._currentPathPosition);break;default:throw new RangeError(`Invalid camera control _mode parameter: ${this._mode}`)}}_getPathDisplacement(e){let t=null;const n=this._currentPathPosition,s=this._currentPathOffset+this._cameraJump,i=s<1?s:1,o=this._currentPath.getPointAt(i),r=(new x).subVectors(o,n),a=r.clone().normalize(),h=e.dot(a),l=this._currentPathOffset-this._cameraJump,c=l>0?l:0,d=this._currentPath.getPointAt(c),u=(new x).subVectors(d,n),p=u.clone().normalize(),m=e.dot(p);if(0===h&&m<0){const n=this._getDirectionsMap();let s=void 0,i=void 0,o=-1,r=void 0;n.forEach(t=>{const n=t.index,a=t.startDisplacement;if(a){const t=a.clone().normalize(),h=e.dot(t);h>o&&(s=n,i=a,o=h,r=!0)}const h=t.endDisplacement;if(h){const t=h.clone().normalize(),a=e.dot(t);a>o&&(s=n,i=h,o=a,r=!1)}}),void 0!==s?(this._currentPathIndex=s,this._currentPath=this._paths[this._currentPathIndex],this._currentPathOffset=r?this._cameraJump:1-this._cameraJump,this._currentPathPosition=this._currentPath.getPointAt(this._currentPathOffset),t=i):(this.logger.warn("Reach path end."),t=new x)}else if(h>0&&m<=0)t=r,this._currentPathOffset=i,this._currentPathPosition=o;else if(h<=0&&m>0)t=u,this._currentPathOffset=c,this._currentPathPosition=d;else if(h<0&&0===m){const n=this._getDirectionsMap();let s=void 0,i=void 0,o=-1,r=void 0;n.forEach(t=>{const n=t.index,a=t.startDisplacement;if(a){const t=a.clone().normalize(),h=e.dot(t);h>o&&(s=n,i=a,o=h,r=!0)}const h=t.endDisplacement;if(h){const t=h.clone().normalize(),a=e.dot(t);a>o&&(s=n,i=h,o=a,r=!1)}}),void 0!==s?(this._currentPathIndex=s,this._currentPath=this._paths[this._currentPathIndex],this._currentPathOffset=r?this._cameraJump:1-this._cameraJump,this._currentPathPosition=this._currentPath.getPointAt(this._currentPathOffset),t=i):(this.logger.warn("Reach path start."),t=new x)}else h<0&&m<0||h>0&&m>0?h>m?(t=r,this._currentPathOffset=i,this._currentPathPosition=o):(t=u,this._currentPathOffset=c,this._currentPathPosition=d):(this.logger.warn("Unable to find correct next path position."),t=new x);return t}_getDirectionsMap(){const e=this._currentPathPosition,t=this._currentPathIndex,n=this._cameraJump,s=this._maxJump;return this._paths.reduce((i,o,r)=>{if(r===t)return i;const a=o.getPointAt(0);let h=void 0;e.distanceToSquared(a)<s&&(h=(new x).subVectors(o.getPointAt(n),a));const l=o.getPointAt(1);let c=void 0;return e.distanceToSquared(l)<s&&(c=(new x).subVectors(o.getPointAt(1-n),l)),(h||c)&&i.push({index:r,startDisplacement:h,endDisplacement:c}),i},[])}}const en=Math.PI/2,tn={NONE:-1,ROTATE:0,ZOOM:1,PAN:2},nn=new x(1,0,0),sn=new x(0,1,0);function on(t={}){const n={camera:null,target:new C,mode:Kt.Orbit,domElement:document,...t},s=this;let o=tn.NONE;this.camera=n.camera,this.cameraJump=0,this.paths=[],this.pathsMap=new Map,this.currentPath=void 0,this.currentPathIndex=-1,this.currentPathPosition=0,this.domElement=n.domElement,this.forwardControl=this.domElement.children[0].children[0].children[0],this.backwardControl=this.domElement.children[0].children[1].children[0],this.timeoutId=void 0,this.enabled=!1,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=.0025,this.enablePan=!0,this.keyPanSpeed=7,this.verticalOffset=1.5,this.keysCodes={forwardKeys:[i.Z,i.UP_ARROW],backwardKeys:[i.S,i.BOTTOM_ARROW]};let r={x:new B,y:new B};function a(){if(s.currentPathPosition+=s.cameraJump,s.currentPathPosition>1){e.log("reachEnd");var t=s.pathsMap.get(s.currentPathIndex).indexOfNextPath;s.pathsMap.get(t).indexOfNextPath===s.currentPathIndex?s.currentPathPosition=1:s.currentPathPosition=0,s.currentPathIndex=t,s.currentPath=s.paths[t]}s.update(),s.dispatchEvent({type:"move"})}function h(){if(s.currentPathPosition-=s.cameraJump,s.currentPathPosition<0){e.log("reachStart");var t=s.pathsMap.get(s.currentPathIndex).indexOfPreviousPath;s.pathsMap.get(t).indexOfPreviousPath===s.currentPathIndex?s.currentPathPosition=0:s.currentPathPosition=1,s.currentPathIndex=t,s.currentPath=s.paths[t]}s.update(),s.dispatchEvent({type:"move"})}function l(t){if(!1!==s.enabled){var n=s.currentPath.getPointAt(s.currentPathPosition),i=void 0;i=s.currentPathPosition+s.cameraJump>1?s.currentPath.getPointAt(s.currentPathPosition-s.cameraJump).sub(n).normalize().negate():s.currentPath.getPointAt(s.currentPathPosition+s.cameraJump).sub(n).normalize();var o=s.camera.getWorldDirection().normalize().dot(i);o>0&&s.keysCodes.forwardKeys.includes(t.keyCode)?(t.preventDefault(),a()):o<0&&s.keysCodes.forwardKeys.includes(t.keyCode)?(t.preventDefault(),h()):o>0&&s.keysCodes.backwardKeys.includes(t.keyCode)?(t.preventDefault(),h()):o<0&&s.keysCodes.backwardKeys.includes(t.keyCode)?(t.preventDefault(),a()):e.warn("The key event is not implemented for key code: "+t.keyCode)}}function c(e){!1!==s.enabled&&(s.keysCodes.forwardKeys.includes(e.keyCode)||s.keysCodes.backwardKeys.includes(e.keyCode))&&(e&&e.preventDefault(),s.dispatchEvent({type:"moveEnd"}))}function d(e){!1!==s.enabled&&(e.preventDefault(),!0===s.enableRotate&&e.button===s.mouseButtons.ORBIT?o=tn.ROTATE:!0===s.enableZoom&&e.button===s.mouseButtons.ZOOM||!0===s.enablePan&&(e.button,s.mouseButtons.PAN))}function u(e){!1!==s.enabled&&(e.preventDefault(),o===tn.ROTATE&&function(e){var t=e.movementX||e.mozMovementX||e.webkitMovementX||0,n=e.movementY||e.mozMovementY||e.webkitMovementY||0,i=s.orientation;i.y+=t*s.rotateSpeed,i.x+=n*s.rotateSpeed,i.x=Math.max(-en,Math.min(en,i.x)),s.update(),s.dispatchEvent({type:"rotate"})}(e))}function p(e){!1!==s.enabled&&(e&&e.preventDefault(),o=tn.NONE,s.dispatchEvent({type:"rotateEnd"}))}this.mouseButtons={ORBIT:j.LEFT,ZOOM:j.MIDDLE,PAN:j.RIGHT},this.orientation={x:0,y:0},this.update=function(){if(!1!==this.enabled){var e=this.currentPath.getPointAt(this.currentPathPosition);this.camera.position.x=e.x,this.camera.position.y=e.y+this.verticalOffset,this.camera.position.z=e.z,r.x.setFromAxisAngle(nn,this.orientation.x),r.y.setFromAxisAngle(sn,this.orientation.y),this.camera.quaternion.copy(r.y).multiply(r.x)}},this.dispose=function(){this.domElement.removeEventListener("mousedown",d,!1),this.domElement.removeEventListener("mousemove",u,!1),this.domElement.removeEventListener("mouseup",p,!1),window.removeEventListener("keydown",l,!1),window.removeEventListener("keyup",c,!1)},this.domElement.addEventListener("mousedown",d,!1),this.domElement.addEventListener("mousemove",u,!1),this.domElement.addEventListener("mouseup",p,!1),window.addEventListener("keydown",l,!1),window.addEventListener("keyup",c,!1),this.forwardControl.addEventListener("click",(function(e){clearTimeout(s.timeoutId),e.keyCode=i.UP_ARROW,l(e),s.timeoutId=setTimeout(c.bind(s),750)}),!1),this.backwardControl.addEventListener("click",(function(e){clearTimeout(s.timeoutId),e.keyCode=i.BOTTOM_ARROW,l(e),s.timeoutId=setTimeout(c.bind(s),750)}),!1)}Object.assign(on.prototype,I.prototype,{get camera(){return this._camera},set camera(e){if(wt(e))throw new Error("Camera cannot be null ! Expect an instance of Camera");if(yt(e))throw new Error("Camera cannot be undefined ! Expect an instance of Camera");if(!(e instanceof F))throw new Error(`Camera cannot be an instance of ${e.constructor.name}. Expect an instance of Camera.`);this._camera=e},setCamera(e){return this.camera=e,this},setPath(e){this.currentPath=e,this.cameraJump=1/e.getLength()},setPaths(e,t){this.paths=e,this.currentPathIndex=0;for(var n=this.paths[this.currentPathIndex],s=this.paths.length,i=void 0,o=void 0,r=void 0,a=void 0,h=void 0,l=void 0,c=0;c<s;c++){o=(i=this.paths[c]).getPointAt(0),r=i.getPointAt(1),t&&i.name===t&&(n=i,this.currentPathIndex=c);for(var d=1/0,u=1/0,p=void 0,m=void 0,f=0;f<s;f++)c!==f&&(h=(a=this.paths[f]).getPointAt(0),l=a.getPointAt(1),o.distanceTo(h)<d&&(d=o.distanceTo(h),p=f),o.distanceTo(l)<d&&(d=o.distanceTo(l),p=f),r.distanceTo(h)<u&&(u=r.distanceTo(h),m=f),r.distanceTo(l)<u&&(u=r.distanceTo(l),m=f));this.pathsMap.set(c,{indexOfPreviousPath:p,indexOfNextPath:m})}this.setPath(n)},setMouseQuat(e){this.orientation.y=2*Math.asin(e.y),this.orientation.x=0},getCurrentPathPosition(){return this.currentPath.getPointAt(this.currentPathPosition)},getNextPathPosition(){return this.currentPathPosition+this.cameraJump>1?this.currentPath.getPointAt(this.currentPathPosition-this.cameraJump).negate():this.currentPath.getPointAt(this.currentPathPosition+this.cameraJump)},getDistanceFromStart(){return this.currentPathPosition*this.currentPath.getLength()},lookAtPath(){var e=this.getNextPathPosition();e.y=this.camera.position.y,this.camera.lookAt(e),this.setMouseQuat(this.camera.quaternion)},goTo(e){for(var t=void 0,n=void 0,s=void 0,i=void 0,o=void 0,r=void 0,a=void 0,h=1/0,l=0,c=this.paths.length;l<c;l++){n=this.paths[l],t=Math.floor(n.getLength()),s=n.getSpacedPoints(t);for(var d=0;d<t;d++)(a=e.distanceTo(s[d]))<h&&(h=a,r=l,o=n,i=d)}this.setPath(o),this.currentPathIndex=r,this.currentPathPosition=this.cameraJump*i,this.lookAtPath(),this.update(),this.dispatchEvent({type:"moveEnd"}),this.dispatchEvent({type:"rotateEnd"})}});class rn extends u{constructor(e=new x(0,0,0),t=new x(1,0,0)){super(),this.type="LineGeometry",this.addAttribute("position",new Z([e.x,e.y,e.z,t.x,t.y,t.z],3))}}class an extends R{constructor(){super(),this.geometry=new G(new H(2,2,2)),this.material=new U({color:16777215}),this.normalPlanes={normalRightSide:new x(-1,0,0),normalLeftSide:new x(1,0,0),normalFrontSide:new x(0,-1,0),normalBackSide:new x(0,1,0),normalTopSide:new x(0,0,-1),normalBottomSide:new x(0,0,1)},this.planes={rightSidePlane:new N(this.normalPlanes.normalRightSide.clone(),0),leftSidePlane:new N(this.normalPlanes.normalLeftSide.clone(),0),frontSidePlane:new N(this.normalPlanes.normalFrontSide.clone(),0),backSidePlane:new N(this.normalPlanes.normalBackSide.clone(),0),topSidePlane:new N(this.normalPlanes.normalTopSide.clone(),0),bottomSidePlane:new N(this.normalPlanes.normalBottomSide.clone(),0)},this._boundingBox=new h}getBoundingSphere(){return this.geometry.computeBoundingSphere(),this.geometry.boundingSphere.applyMatrix4(this.matrixWorld),this.geometry.boundingSphere}setColor(e){this.material.color.set(e)}applyClippingTo(e,t){if(Mt(t))return;let n=[];for(let e in this.planes)n.push(this.planes[e]);t.traverse(t=>{if(Mt(t))return;if(Mt(t.geometry))return;if(Mt(t.material))return;const s=vt(t.material)?t.material:[t.material];for(let t=0,i=s.length;t<i;t++){let i=s[t];i.clippingPlanes||(i.clippingPlanes=[]),i.clippingPlanes=e?n:[]}})}updateSize(e){this.scale.set(e.x,e.y,e.z)}update(){this._boundingBox.setFromObject(this);const e=this._boundingBox.min,t=this._boundingBox.max;this.planes.rightSidePlane.constant=t.x+0,this.planes.leftSidePlane.constant=0-e.x,this.planes.frontSidePlane.constant=t.y+0,this.planes.backSidePlane.constant=0-e.y,this.planes.topSidePlane.constant=t.z+0,this.planes.bottomSidePlane.constant=0-e.z}}class hn extends b{constructor(e){super(e),this.isHighlightableMaterial=!0,this.depthTest=!1,this.depthWrite=!1,this.fog=!1,this.side=w,this.transparent=!0,this.oldColor=this.color.clone()}highlight(e){if(e){const e=.35,t=this.color.r,n=this.color.g,s=this.color.b,i=Math.min(Math.max(0,t+t*e),1),o=Math.min(Math.max(0,n+n*e),1),r=Math.min(Math.max(0,s+s*e),1);this.color.setRGB(i,o,r)}else this.color.copy(this.oldColor)}}class ln extends U{constructor(e){super(e),this.isHighlightableMaterial=!0,this.depthTest=!1,this.depthWrite=!1,this.fog=!1,this.transparent=!0,this.linewidth=1,this.oldColor=this.color.clone()}highlight(e){if(e){const e=.35,t=this.color.r,n=this.color.g,s=this.color.b,i=Math.min(Math.max(0,t+t*e),1),o=Math.min(Math.max(0,n+n*e),1),r=Math.min(Math.max(0,s+s*e),1);this.color.setRGB(i,o,r)}else this.color.copy(this.oldColor)}}class cn extends g{constructor(e={}){const t={geometry:new u,material:new b({visible:!1,depthTest:!1,depthWrite:!1,fog:!1,side:w}),...e};super(t.geometry,t.material),this.isHitbox=!0,this.type="Hitbox"}}class dn extends cn{constructor(e={}){const t=new X(.2,0,1,4,1,!1);t.translate(0,.5,0),super({geometry:t,...e}),this.isCylindricaHitbox=!0,this.type="CylindricaHitbox"}}class un extends cn{constructor(e={}){const t=new u;t.addAttribute("position",new Z([0,0,0,1.1,0,0,1.1,1.1,0,0,1.1,0],3)),t.setIndex([0,1,2,2,3,0]),super({geometry:t,...e}),this.isPlanarHitbox=!0,this.type="PlanarHitbox"}}class pn extends cn{constructor(e={}){const t=new Z([0,0,0,.85,0,0,1.1,1.1,0,0,.85,0],3),n=new u;n.addAttribute("position",t),n.setIndex([0,1,2,2,3,0]),super({geometry:n,...e}),this.isPlanarHitbox=!0,this.type="PlanarHitbox"}}class mn extends cn{constructor(e={}){super({geometry:new Y(1.2,0),...e}),this.isOctahedricalHitbox=!0,this.type="OctahedricalHitbox"}}class fn extends cn{constructor(e={}){super({geometry:new V(1,8,6,0,2*Math.PI,0,Math.PI),...e}),this.isSphericalHitbox=!0,this.type="SphericalHitbox"}}class _n extends cn{constructor(e={}){super({geometry:new W(1,.12,4,12,Math.PI),...e}),this.isTorusHitbox=!0,this.type="TorusHitbox"}}class gn extends C{constructor(e={}){const t={color:16777215,hitbox:null,...e};super(),this.isHandle=!0,this.type="Handle",this.color=t.color,this.hitbox=t.hitbox,this.baseQuaternion=new B}get color(){return this.line.material.color.clone()}set color(e){if(wt(e))throw new Error("Color cannot be null ! Expect an instance of Color.");if(yt(e))throw new Error("Color cannot be undefined ! Expect an instance of Color.");this.traverse(t=>{let n=t.material;n&&n.color.setHex(e)})}get hitbox(){return this._hitbox}set hitbox(e){this._hitbox=e,this.add(e)}setColor(e){return this.color=e,this}setHitbox(e){return this.hitbox=e,this}setScale(e,t,n){return this.scale.set(e,t,n),this}setPosition(e,t,n){return this.position.set(e,t,n),this}highlight(e){for(let t=0,n=this.children.length;t<n;t++){const n=this.children[t];if(n.isHitbox)continue;const s=n.material;!yt(s)&&s.isHighlightableMaterial&&s.highlight(e)}}raycast(e,t){const n=e.intersectObject(this._hitbox,!1);n.length>0&&t.push({distance:n[0].distance,object:this})}setRotationFromAxisAndAngle(e,t){return this.quaternion.setFromAxisAngle(e,t),this.baseQuaternion.copy(this.quaternion),this}update(e){}}class vn extends gn{constructor(e={}){const t={color:16777215,hitbox:new dn,direction:new x(0,1,0),...e};super(t),this.isTranslateHandle=!0,this.type="TranslateHandle";const n=new rn(new x(0,0,0),new x(0,.8,0)),s=new ln({color:t.color}),i=new $(n,s);this.add(i);const o=new q(.05,.2,12,1,!1);o.translate(0,.9,0);const r=new hn({color:t.color}),a=new g(o,r);this.add(a),this.direction=t.direction}get direction(){return this._direction}set direction(e){if(wt(e))throw new Error("Direction cannot be null ! Expect an instance of Color.");if(yt(e))throw new Error("Direction cannot be undefined ! Expect an instance of Color.");if(!(e instanceof x))throw new Error(`Direction cannot be an instance of ${e.constructor.name}. Expect an instance of Vector3.`);if(this._direction=e,e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{const t=new x(e.z,0,-e.x).normalize(),n=Math.acos(e.y);this.quaternion.setFromAxisAngle(t,n)}}update(e){super.update(e),this._direction.dot(e)>=0&&this.flipDirection()}setDirection(e){return this.direction=e,this}flipDirection(){this.direction=this._direction.negate()}}class bn extends gn{constructor(e={}){const t={color:16777215,hitbox:new dn,direction:new x(0,1,0),...e};super(t),this.isScaleHandle=!0,this.type="ScaleHandle";const n=new rn(new x(0,0,0),new x(0,.88,0)),s=new ln({color:t.color}),i=new $(n,s);this.add(i);const o=new H(.12,.12,.12);o.translate(0,.94,0);const r=new hn({color:t.color}),a=new g(o,r);this.add(a),this.direction=t.direction}get direction(){return this._direction}set direction(e){if(wt(e))throw new Error("Direction cannot be null ! Expect an instance of Color.");if(yt(e))throw new Error("Direction cannot be undefined ! Expect an instance of Color.");if(!(e instanceof x))throw new Error(`Direction cannot be an instance of ${e.constructor.name}. Expect an instance of Vector3.`);if(this._direction=e,e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{const t=new x(e.z,0,-e.x).normalize(),n=Math.acos(e.y);this.quaternion.setFromAxisAngle(t,n)}}update(e){super.update(e),this._direction.dot(e)>=0&&this.flipDirection()}setDirection(e){return this.direction=e,this}flipDirection(){this.direction=this._direction.negate()}}class wn extends gn{constructor(e={}){super({...e}),this.isRotateHandle=!0,this.type="RotateHandle"}update(e){super.update(e)}}class yn extends gn{constructor(e={}){const t={color:16777215,hitbox:new un,direction:new x(0,1,0),...e};super(t),this.isPlaneHandle=!0,this.type="PlaneHandle";const n=new u;n.addAttribute("position",new Z([.75,1,0,1,1,0,1,.75,0],3));const s=new ln({color:t.color}),i=new $(n,s);this.add(i);const o=new u;o.addAttribute("position",new Z([.1,.1,0,1,.1,0,1,1,0,.1,1,0],3)),o.setIndex([0,1,2,2,3,0]);const r=new hn({color:t.color,transparent:!0,opacity:.35}),a=new g(o,r);this.add(a),this.xAxis=new x(1,0,0),this.yAxis=new x(0,1,0),this.zAxis=new x(0,0,1),this.xDirection=new x(t.direction.x,0,0),this.yDirection=new x(0,t.direction.y,0),this.zDirection=new x(0,0,t.direction.z),this.direction=t.direction}get direction(){return this._direction}set direction(e){if(wt(e))throw new Error("Direction cannot be null ! Expect an instance of Color.");if(yt(e))throw new Error("Direction cannot be undefined ! Expect an instance of Color.");if(!(e instanceof x))throw new Error(`Direction cannot be an instance of ${e.constructor.name}. Expect an instance of Vector3.`);this._direction=e}update(e){super.update(e);const t=new x(this._direction.x,0,0),n=new x(0,this._direction.y,0),s=new x(0,0,this._direction.z),i=t.dot(e),o=n.dot(e),r=s.dot(e);this.quaternion.copy(this.baseQuaternion),i>0&&o>0&&0===r?(this.rotateOnAxis(this.zAxis,mt(180)),this.xDirection.setX(-1),this.yDirection.setY(-1),this.zDirection.setZ(0)):i>0&&o<0&&0===r?(this.rotateOnAxis(this.zAxis,mt(90)),this.xDirection.setX(-1),this.yDirection.setY(1),this.zDirection.setZ(0)):i<0&&o>0&&0===r?(this.rotateOnAxis(this.zAxis,mt(270)),this.xDirection.setX(1),this.yDirection.setY(-1),this.zDirection.setZ(0)):i<0&&o<0&&0===r?(this.rotateOnAxis(this.zAxis,mt(0)),this.xDirection.setX(1),this.yDirection.setY(1),this.zDirection.setZ(0)):i>0&&0===o&&r>0?(this.rotateOnAxis(this.zAxis,mt(180)),this.xDirection.setX(-1),this.yDirection.setY(0),this.zDirection.setZ(-1)):i>0&&0===o&&r<0?(this.rotateOnAxis(this.zAxis,mt(90)),this.xDirection.setX(-1),this.yDirection.setY(0),this.zDirection.setZ(1)):i<0&&0===o&&r>0?(this.rotateOnAxis(this.zAxis,mt(270)),this.xDirection.setX(1),this.yDirection.setY(0),this.zDirection.setZ(-1)):i<0&&0===o&&r<0?(this.rotateOnAxis(this.zAxis,mt(0)),this.xDirection.setX(1),this.yDirection.setY(0),this.zDirection.setZ(1)):0===i&&o>0&&r>0?(this.rotateOnAxis(this.zAxis,mt(180)),this.xDirection.setX(0),this.yDirection.setY(-1),this.zDirection.setZ(-1)):0===i&&o>0&&r<0?(this.rotateOnAxis(this.zAxis,mt(270)),this.xDirection.setX(0),this.yDirection.setY(-1),this.zDirection.setZ(1)):0===i&&o<0&&r>0?(this.rotateOnAxis(this.zAxis,mt(90)),this.xDirection.setX(0),this.yDirection.setY(1),this.zDirection.setZ(-1)):0===i&&o<0&&r<0&&(this.rotateOnAxis(this.zAxis,mt(0)),this.xDirection.setX(0),this.yDirection.setY(1),this.zDirection.setZ(1))}setDirection(e){return this.direction=e,this}flipXDirection(){this.xDirection.setX(-this.xDirection.x)}flipYDirection(){this.yDirection.setY(-this.yDirection.y)}flipZDirection(){this.zDirection.setZ(-this.zDirection.z)}}class xn extends gn{constructor(e={}){const t={color:16777215,hitbox:new pn,direction:new x(1,1,0),...e};super(t),this.isPlaneHandle=!0,this.type="PlaneHandle";const n=new u;n.addAttribute("position",new Z([.1,.75,0,1,1,0,.75,.1,0],3));const s=new ln({color:t.color}),i=new $(n,s);this.add(i);const o=new u;o.addAttribute("position",new Z([.1,.1,0,.75,.1,0,1,1,0,.1,.75,0],3)),o.setIndex([0,1,2,2,3,0]);const r=new hn({color:t.color,transparent:!0,opacity:.35}),a=new g(o,r);this.add(a),this.direction=t.direction,this.xDirection=new x(t.direction.x,0,0),this.yDirection=new x(0,t.direction.y,0),this.zDirection=new x(0,0,t.direction.z),this.xAxis=new x(1,0,0),this.yAxis=new x(0,1,0),this.zAxis=new x(0,0,1)}get direction(){return this._direction}set direction(e){if(wt(e))throw new Error("Direction cannot be null ! Expect an instance of Color.");if(yt(e))throw new Error("Direction cannot be undefined ! Expect an instance of Color.");if(!(e instanceof x))throw new Error(`Direction cannot be an instance of ${e.constructor.name}. Expect an instance of Vector3.`);this._direction=e}update(e){super.update(e);const t=this.xDirection.dot(e),n=this.yDirection.dot(e),s=this.zDirection.dot(e);this.quaternion.copy(this.baseQuaternion),t>0&&n>0&&0===s?this.rotateOnAxis(this.zAxis,mt(180)):t>0&&n<0&&0===s?this.rotateOnAxis(this.zAxis,mt(90)):t<0&&n>0&&0===s?this.rotateOnAxis(this.zAxis,mt(270)):t<0&&n<0&&0===s?this.rotateOnAxis(this.zAxis,mt(0)):t>0&&0===n&&s>0?this.rotateOnAxis(this.zAxis,mt(180)):t>0&&0===n&&s<0?this.rotateOnAxis(this.zAxis,mt(90)):t<0&&0===n&&s>0?this.rotateOnAxis(this.zAxis,mt(270)):t<0&&0===n&&s<0?this.rotateOnAxis(this.zAxis,mt(0)):0===t&&n>0&&s>0?this.rotateOnAxis(this.zAxis,mt(180)):0===t&&n>0&&s<0?this.rotateOnAxis(this.zAxis,mt(270)):0===t&&n<0&&s>0?this.rotateOnAxis(this.zAxis,mt(90)):0===t&&n<0&&s<0&&this.rotateOnAxis(this.zAxis,mt(0))}setDirection(e){return this.direction=e,this}flipXAxis(){const e=this._direction.clone();e.x=-e.x,this.direction=e}flipYAxis(){const e=this._direction.clone();e.y=-e.y,this.direction=e}flipZAxis(){const e=this._direction.clone();e.z=-e.z,this.direction=e}}class En extends gn{constructor(e={}){const t={color:16777215,hitbox:new mn,...e};super(t),this.isOmnidirectionalHandle=!0,this.type="OmnidirectionalHandle";const n=new Y(1,0),s=new hn({color:t.color,transparent:!0,opacity:.55}),i=new g(n,s);this.add(i);const o=new G(n),r=new ln({color:t.color,linewidth:4}),a=new R(o,r);this.add(a)}update(e){super.update(e)}}class Mn extends C{constructor(){super(),this.isGizmo=!0,this.type="AbstractGizmo"}init(){this.handles=new C,this.add(this.handles);const e=new J(50,50,2,2),t=new b({side:w,visible:!1});this.intersectPlane=new g(e,t),this.add(this.intersectPlane);((e,t)=>{for(let n in e){const s=e[n];if(At(s))s.name=n,s.renderOrder=1/0,t.add(s);else for(let i=s.length;i--;){const s=e[n][i][0],o=e[n][i][1],r=e[n][i][2],a=e[n][i][3],h=e[n][i][4];s.name=n,s.tag=h,s.renderOrder=1/0,o&&s.position.set(o[0],o[1],o[2]),r&&s.rotation.set(r[0],r[1],r[2]),a&&s.scale.set(a[0],a[1],a[2]),s.updateMatrix();const l=s.geometry.clone();l.applyMatrix(s.matrix),s.geometry=l,s.position.set(0,0,0),s.rotation.set(0,0,0),s.scale.set(1,1,1),t.add(s)}}})(this.handleGizmos,this.handles)}highlight(e){for(let e in this.handleGizmos)this.handleGizmos[e].highlight(!1);const t=this.handleGizmos[e];t&&t.highlight(!0)}update(e,t){this.traverse(e=>{e.isHandle&&e.update(t)}),this.updateIntersectPlane(e)}updateIntersectPlane(e){this.intersectPlane.lookAt(e)}}class Pn extends Mn{constructor(){super(),this.isTranslateGizmo=!0,this.type="TranslateGizmo",this.handleGizmos={X:new vn({color:11141120,direction:new x(1,0,0)}),Y:new vn({color:43520,direction:new x(0,1,0)}),Z:new vn({color:170,direction:new x(0,0,1)}),XY:new xn({color:11184640,direction:new x(1,1,0)}).setScale(.33,.33,1),YZ:new xn({color:43690,direction:new x(0,1,1)}).setScale(.33,.33,1).setRotationFromAxisAndAngle(new x(0,1,0),mt(-90)),XZ:new xn({color:11141290,direction:new x(1,0,1)}).setScale(.33,.33,1).setRotationFromAxisAndAngle(new x(1,0,0),mt(90)),XYZ:new En({color:11184810}).setScale(.15,.15,.15)},this.init()}}class An extends Mn{constructor(){super(),this.isRotateGizmo=!0,this.type="RotateGizmo";const e=(e,t,n)=>{const s=new u;let i=[];n=n||1;for(let s=0;s<=64*n;++s)"x"===t&&i.push(0,Math.cos(s/32*Math.PI)*e,Math.sin(s/32*Math.PI)*e),"y"===t&&i.push(Math.cos(s/32*Math.PI)*e,0,Math.sin(s/32*Math.PI)*e),"z"===t&&i.push(Math.sin(s/32*Math.PI)*e,Math.cos(s/32*Math.PI)*e,0);return s.addAttribute("position",new Z(i,3)),s};this.handleGizmos={X:[[new $(new e(1,"x",.5),new ln({color:16711680}))],[new g(new Y(.04,0),new hn({color:16711680})),[0,0,.99],null,[3,1,1]]],Y:[[new $(new e(1,"y",.5),new ln({color:65280}))],[new g(new Y(.04,0),new hn({color:65280})),[0,0,.99],null,[3,1,1]]],Z:[[new $(new e(1,"z",.5),new ln({color:255}))],[new g(new Y(.04,0),new hn({color:255})),[.99,0,0],null,[1,3,1]]],E:[[new $(new e(1.25,"z",1),new ln({color:13421568}))]],XYZ:[[new $(new e(1,"z",1),new ln({color:7895160}))]]},this.pickerGizmos={X:[[new _n,[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new _n,[0,0,0],[Math.PI/2,0,0]]],Z:[[new _n,[0,0,0],[0,0,-Math.PI/2]]],E:[[new _n({radius:1.25,tube:.12,radialSegments:2,tubularSegments:24})]],XYZ:[[new _n]]},this.init()}}class Tn extends Mn{constructor(){super(),this.isScaleGizmo=!0,this.type="ScaleGizmo",this.handleGizmos={XYZ:new En({color:11184810}).setScale(.15,.15,.15),XY:new yn({color:11184640,direction:new x(1,1,0)}).setScale(.33,.33,1),YZ:new yn({color:43690,direction:new x(0,1,1)}).setScale(.33,.33,1).setRotationFromAxisAndAngle(new x(0,1,0),mt(-90)),XZ:new yn({color:11141290,direction:new x(1,0,1)}).setScale(.33,.33,1).setRotationFromAxisAndAngle(new x(1,0,0),mt(90)),X:new bn({color:11141120,direction:new x(1,0,0)}),Y:new bn({color:43520,direction:new x(0,1,0)}),Z:new bn({color:170,direction:new x(0,0,1)})},this.init()}}const Sn=ft({None:"None",Translate:"Translate",Rotate:"Rotate",Scale:"Scale"});class Dn extends C{constructor(e={}){const t={camera:null,domElement:window,mode:Sn.None,objectsToClip:new C,...e};super(),this._handlers={onMouseEnter:this._onMouseEnter.bind(this),onMouseLeave:this._onMouseLeave.bind(this),onMouseDown:this._onMouseDown.bind(this),onMouseMove:this._onMouseMove.bind(this),onMouseWheel:this._onMouseWheel.bind(this),onMouseUp:this._onMouseUp.bind(this),onDblClick:this._onDblClick.bind(this),onTouchStart:this._onTouchStart.bind(this),onTouchEnd:this._onTouchEnd.bind(this),onTouchCancel:this._onTouchCancel.bind(this),onTouchLeave:this._onTouchLeave.bind(this),onTouchMove:this._onTouchMove.bind(this),onKeyDown:this._onKeyDown.bind(this),onKeyUp:this._onKeyUp.bind(this)},this._objectsToClipBoundingBox=new h,this._clippingBox=new an,this.add(this._clippingBox),this.camera=t.camera,this.domElement=t.domElement,this.mode=t.mode,this.objectsToClip=t.objectsToClip,this.translationSnap=.1,this.scaleSnap=.1,this.rotationSnap=.1,this.enabled=!1,this.size=1,this._dragging=!1,this._firstPoint=new x,this._secondPoint=new x,this._mouseDisplacement=new x,this._offset=new x,this._raycaster=new K,this._pointerVector=new z,this._directionToMouse=new x,this._cameraPosition=new x,this._cameraDirection=new x,this._worldPosition=new x,this._worldRotation=new Q,this._gizmos={Translate:new Pn,Scale:new Tn};for(let e in this._gizmos)this.add(this._gizmos[e]);this._currentGizmo=null,this._currentHandle=null,this._events={change:{type:"change"},mouseEnter:{type:"mouseEnter"},mouseLeave:{type:"mouseLeave"},mouseDown:{type:"mouseDown"},mouseUp:{type:"mouseUp"},objectChange:{type:"objectChange"}},this.actionsMap={setMode:{translate:[i.T.value],rotate:[i.R.value],scale:[i.S.value]},translate:{front:[i.Z.value,i.UP_ARROW.value],back:[i.S.value,i.DOWN_ARROW.value],up:[i.A.value,i.PAGE_UP.value],down:[i.E.value,i.PAGE_DOWN.value],left:[i.Q.value,i.LEFT_ARROW.value],right:[i.D.value,i.RIGHT_ARROW.value]},scale:{widthPlus:[i.LEFT_ARROW.value],widthMinus:[i.RIGHT_ARROW.value],heightPlus:[i.PAGE_UP.value],heightMinus:[i.PAGE_DOWN.value],depthPlus:[i.UP_ARROW.value],depthMinus:[i.DOWN_ARROW.value]},rotate:{xAxis:[i.X.value],yAxis:[i.Y.value],zAxis:[i.Z.value]}}}get objectsToClip(){return this._objectsToClip}set objectsToClip(e){if(wt(e))throw new Error("Objects to clip cannot be null ! Expect an instance of Object3D");if(yt(e))throw new Error("Objects to clip cannot be undefined ! Expect an instance of Object3D");if(!(e instanceof C))throw new Error(`Objects to clip cannot be an instance of ${e.constructor.name}. Expect an instance of Object3D.`);this._objectsToClip=e;const t=new x;this._objectsToClipBoundingBox.makeEmpty().expandByObject(e).getSize(t);const n=Math.round(t.x)||50,s=Math.round(t.y)||22,i=Math.round(t.z)||70;this.scale.set(n,s,i),this._clippingBox.update()}get camera(){return this._camera}set camera(e){if(wt(e))throw new Error("Camera cannot be null ! Expect an instance of Camera");if(yt(e))throw new Error("Camera cannot be undefined ! Expect an instance of Camera");if(!(e instanceof F))throw new Error(`Camera cannot be an instance of ${e.constructor.name}. Expect an instance of Camera.`);this._camera=e}get domElement(){return this._domElement}set domElement(e){if(wt(e))throw new Error("DomElement cannot be null ! Expect an instance of Window, HTMLDocument, HTMLDivElement or HTMLCanvasElement.");if(yt(e))throw new Error("DomElement cannot be undefined ! Expect an instance of Window, HTMLDocument, HTMLDivElement or HTMLCanvasElement.");if(!(e instanceof Window||e instanceof HTMLDocument||e instanceof HTMLDivElement||e instanceof HTMLCanvasElement))throw new Error(`Target cannot be an instance of ${e.constructor.name}. Expect an instance of Window, HTMLDocument, HTMLDivElement or HTMLCanvasElement.`);this._domElement&&(this._domElement.removeEventListener("mouseenter",this._handlers.onMouseEnter,!1),this._domElement.removeEventListener("mouseleave",this._handlers.onMouseLeave,!1),this.dispose()),this._domElement=e,this._domElement.addEventListener("mouseenter",this._handlers.onMouseEnter,!1),this._domElement.addEventListener("mouseleave",this._handlers.onMouseLeave,!1),this.impose()}get mode(){return this._mode}set mode(e){if(wt(e))throw new Error("Mode cannot be null ! Expect a value from ClippingModes enum.");if(yt(e))throw new Error("Mode cannot be undefined ! Expect a value from ClippingModes enum.");this._mode=e;for(let e in this._gizmos)this._gizmos[e].visible=!1;this._mode===Sn.None?this._currentGizmo=null:(this._currentGizmo=this._gizmos[this._mode],this._currentGizmo.visible=!0)}setCamera(e){return this.camera=e,this}setDomElement(e){return this.domElement=e,this}setMode(e){return this.mode=e,this}setObjectsToClip(e){return this.objectsToClip=e,this}impose(){this._domElement.addEventListener("keydown",this._handlers.onKeyDown,!1),this._domElement.addEventListener("keyup",this._handlers.onKeyUp,!1),this._domElement.addEventListener("dblclick",this._handlers.onDblClick,!1),this._domElement.addEventListener("mousedown",this._handlers.onMouseDown,!1),this._domElement.addEventListener("mousemove",this._handlers.onMouseMove,!1),this._domElement.addEventListener("mouseup",this._handlers.onMouseUp,!1),this._domElement.addEventListener("wheel",this._handlers.onMouseWheel,{capture:!0,once:!1,passive:!1}),this._domElement.addEventListener("touchcancel",this._handlers.onTouchCancel,!1),this._domElement.addEventListener("touchend",this._handlers.onTouchEnd,!1),this._domElement.addEventListener("touchleave",this._handlers.onTouchLeave,!1),this._domElement.addEventListener("touchmove",this._handlers.onTouchMove,{capture:!0,once:!1,passive:!1}),this._domElement.addEventListener("touchstart",this._handlers.onTouchStart,{capture:!0,once:!1,passive:!1}),this.dispatchEvent({type:"impose"})}dispose(){this._domElement.removeEventListener("keydown",this._handlers.onKeyDown,!1),this._domElement.removeEventListener("keyup",this._handlers.onKeyUp,!1),this._domElement.removeEventListener("dblclick",this._handlers.onDblClick,!1),this._domElement.removeEventListener("mousedown",this._handlers.onMouseDown,!1),this._domElement.removeEventListener("mousemove",this._handlers.onMouseMove,!1),this._domElement.removeEventListener("mouseup",this._handlers.onMouseUp,!1),this._domElement.removeEventListener("wheel",this._handlers.onMouseWheel,{capture:!0,once:!1,passive:!1}),this._domElement.removeEventListener("touchcancel",this._handlers.onTouchCancel,!1),this._domElement.removeEventListener("touchend",this._handlers.onTouchEnd,!1),this._domElement.removeEventListener("touchleave",this._handlers.onTouchLeave,!1),this._domElement.removeEventListener("touchmove",this._handlers.onTouchMove,{capture:!0,once:!1,passive:!1}),this._domElement.removeEventListener("touchstart",this._handlers.onTouchStart,{capture:!0,once:!1,passive:!1}),this.dispatchEvent({type:"dispose"})}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}enable(){this.visible=!0,this.enabled=!0,this.updateClipping()}disable(){this.visible=!1,this.enabled=!1,this.updateClipping()}updateClipping(){Mt(this._objectsToClip)||(this._clippingBox.update(),this._clippingBox.applyClippingTo(this.enabled,this._objectsToClip))}update(){this.enabled&&this._mode!==Sn.None&&(Mt(this._currentGizmo)||(this._camera.getWorldPosition(this._cameraPosition),this._camera.getWorldDirection(this._cameraDirection),this._currentGizmo.update(this._cameraPosition,this._cameraDirection)))}_consumeEvent(e){e.cancelable&&e.stopImmediatePropagation()}_onKeyDown(e){if(!this.enabled)return;e.preventDefault();const t=this.actionsMap,n=e.keyCode;if(e.ctrlKey)switch(this._mode){case Sn.Translate:t.translate.front.includes(n)?(this._translateZ(this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.objectChange)):t.translate.back.includes(n)?(this._translateZ(-this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.objectChange)):t.translate.right.includes(n)?(this._translateX(this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.objectChange)):t.translate.left.includes(n)?(this._translateX(-this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.objectChange)):t.translate.up.includes(n)?(this._translateY(this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.objectChange)):t.translate.down.includes(n)&&(this._translateY(-this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.objectChange));break;case Sn.Rotate:break;case Sn.Scale:t.scale.depthPlus.includes(n)?(this._scaleZ(this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.objectChange)):t.scale.depthMinus.includes(n)?(this._scaleZ(-this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.objectChange)):t.scale.widthPlus.includes(n)?(this._scaleX(this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.objectChange)):t.scale.widthMinus.includes(n)?(this._scaleX(-this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.objectChange)):t.scale.heightPlus.includes(n)?(this._scaleY(this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.objectChange)):t.scale.heightMinus.includes(n)&&(this._scaleY(-this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.objectChange))}else t.setMode.translate.includes(n)?(this.setMode(Sn.Translate),this.updateClipping(),this._consumeEvent(e)):t.setMode.rotate.includes(n)?(this.setMode(Sn.Rotate),this.updateClipping(),this._consumeEvent(e)):t.setMode.scale.includes(n)&&(this.setMode(Sn.Scale),this.updateClipping(),this._consumeEvent(e))}_onKeyUp(e){this.enabled&&!e.defaultPrevented&&e.preventDefault()}_onDblClick(e){this.enabled&&this._mode!==Sn.None&&e.preventDefault()}_onMouseDown(e){if(!this.enabled)return;if(this._mode===Sn.None)return;if(e.button!==o.LEFT.value)return;if(Mt(this._currentHandle))return;e.preventDefault(),this._dragging=!0;const t=this.intersectObjects(e,[this._currentGizmo.intersectPlane]);t&&(this._firstPoint=t.point),this._consumeEvent(e),this.dispatchEvent(this._events.mouseDown)}_onMouseEnter(e){this.enabled&&this._mode!==Sn.None&&(e.preventDefault(),this.impose(),e.target.constructor!==HTMLDocument&&this._domElement.focus())}_onMouseLeave(e){this.enabled&&this._mode!==Sn.None&&(e.preventDefault(),this._dragging=!1,e.target.constructor!==HTMLDocument&&this._domElement.blur(),this.dispose())}_onMouseMove(e){if(this.enabled&&this._mode!==Sn.None)if(e.preventDefault(),!1===this._dragging){const t=this.intersectObjects(e,this._currentGizmo.handles.children);if(t){const n=t.object;this._currentHandle&&n!==this._currentHandle&&(this._currentHandle.highlight(!1),this.dispatchEvent(this._events.mouseLeave)),this._currentHandle=n,this._currentHandle.highlight(!0),this.dispatchEvent(this._events.mouseEnter),this._consumeEvent(e)}else Pt(this._currentHandle)&&(this._currentHandle.highlight(!1),this._currentHandle=null,this.dispatchEvent(this._events.mouseLeave))}else{const t=this._currentHandle,n=t.name,s=this.intersectObjects(e,[this._currentGizmo.intersectPlane]);switch(s&&(this._secondPoint=s.point),this._mouseDisplacement.subVectors(this._secondPoint,this._firstPoint),this._firstPoint.copy(this._secondPoint),this._mode){case Sn.Translate:"X"===n?this._offset.set(1,0,0):"Y"===n?this._offset.set(0,1,0):"Z"===n?this._offset.set(0,0,1):"XY"===n?this._offset.set(1,1,0):"YZ"===n?this._offset.set(0,1,1):"XZ"===n?this._offset.set(1,0,1):"XYZ"===n&&this._offset.set(1,1,1),this._offset.multiply(this._mouseDisplacement),this._translate(this._offset);break;case Sn.Rotate:break;case Sn.Scale:if(t.isScaleHandle)this._offset.copy(this._currentHandle.direction).multiply(this._mouseDisplacement);else if(t.isPlaneHandle){const e=this._currentHandle.xDirection.dot(this._mouseDisplacement);e>0?this._offset.setX(Math.abs(this._mouseDisplacement.x)):e<0?this._offset.setX(-Math.abs(this._mouseDisplacement.x)):this._offset.setX(0);const t=this._currentHandle.yDirection.dot(this._mouseDisplacement);t>0?this._offset.setY(Math.abs(this._mouseDisplacement.y)):t<0?this._offset.setY(-Math.abs(this._mouseDisplacement.y)):this._offset.setY(0);const n=this._currentHandle.zDirection.dot(this._mouseDisplacement);n>0?this._offset.setZ(Math.abs(this._mouseDisplacement.z)):n<0?this._offset.setZ(-Math.abs(this._mouseDisplacement.z)):this._offset.setZ(0)}else if(t.isOmnidirectionalHandle){this.getWorldPosition(this._worldPosition),this._directionToMouse.subVectors(this._firstPoint,this._worldPosition);const e=this._directionToMouse.dot(this._mouseDisplacement)>0?this._mouseDisplacement.length():-this._mouseDisplacement.length();this._offset.set(e,e,e)}this._scale(this._offset);break;default:throw new RangeError(`Invalid switch parameter: ${this._mode}`)}this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.objectChange)}}_onMouseUp(e){if(!this.enabled)return;if(this._mode===Sn.None)return;if(event.button!==o.LEFT.value)return;e.preventDefault(),this._consumeEvent(e),this._dragging=!1,this.dispatchEvent(this._events.mouseUp);const t=this.intersectObjects(e,this._currentGizmo.handles.children);if(t){const n=t.object;this._currentHandle=n,this._currentHandle.highlight(!0),this._consumeEvent(e),this.dispatchEvent(this._events.mouseEnter)}else Pt(this._currentHandle)&&(this._currentHandle.highlight(!1),this._currentHandle=null,this.dispatchEvent(this._events.mouseLeave))}_onMouseWheel(e){this.enabled&&e.preventDefault()}_onTouchCancel(e){this.enabled&&e.preventDefault()}_onTouchEnd(e){this.enabled&&e.preventDefault()}_onTouchLeave(e){this.enabled&&e.preventDefault()}_onTouchMove(e){this.enabled&&e.preventDefault()}_onTouchStart(e){this.enabled&&e.preventDefault()}getActiveHandle(e){}intersectObjects(e,t){const n=this._domElement.getBoundingClientRect(),s=(e.clientX-n.left)/n.width*2-1,i=-(e.clientY-n.top)/n.height*2+1;this._pointerVector.set(s,i),this._raycaster.setFromCamera(this._pointerVector,this._camera);const o=this._raycaster.intersectObjects(t,!1);return o[0]?o[0]:null}_translate(e){this.position.add(e)}_translateX(e){this.position.setX(this.position.x+e)}_translateY(e){this.position.setY(this.position.y+e)}_translateZ(e){this.position.setZ(this.position.z+e)}_translateXY(e,t){this.position.setX(this.position.x+e),this.position.setY(this.position.y+t)}_translateXZ(e,t){this.position.setX(this.position.x+e),this.position.setZ(this.position.z+t)}_translateYZ(e,t){this.position.setY(this.position.y+e),this.position.setZ(this.position.z+t)}_translateXYZ(e,t,n){this.position.set(this.position.x+e,this.position.y+t,this.position.z+n)}_rotateX(e){}_rotateY(e){}_rotateZ(e){}_rotateXY(e){}_rotateXZ(e){}_rotateYZ(e){}_rotateXYZ(e){}_scale(e){this.scale.add(e)}_scaleX(e){this.scale.setX(this.scale.x+e)}_scaleY(e){this.scale.setY(this.scale.y+e)}_scaleZ(e){this.scale.setZ(this.scale.z+e)}_scaleXY(e,t){this.scale.setX(this.scale.x+e),this.scale.setY(this.scale.y+t)}_scaleXZ(e,t){this.scale.setX(this.scale.x+e),this.scale.setZ(this.scale.z+t)}_scaleYZ(e,t){this.scale.setY(this.scale.y+e),this.scale.setZ(this.scale.z+t)}_scaleXYZ(e,t,n){this.scale.set(this.scale.x+e,this.scale.y+t,this.scale.z+n)}}function On(){r.call(this),this.basePath="/buffergeometries"}function kn(){r.call(this),this.basePath="/curves"}On.prototype=Object.assign(Object.create(r.prototype),{constructor:On,convert(e){let t=null;switch(e.type){case"Scene":t=new ee;break;default:t=new C}return t}}),Object.defineProperties(On.prototype,{_onJson:{value:function(e,t,n,s){const i=_t(e)?[e]:e,o={};let r=void 0;for(let e=0,t=i.length,a=void 0;e<t;e++)a=i[e],(r=this.convert(a,s))&&(o[a._id]=r),n(e/t);t(o)}}}),kn.prototype=Object.assign(Object.create(r.prototype),{constructor:kn,convert(e){if(!e)throw new Error("CurvesManager: Unable to convert null or undefined data !");const t=e.type;let n=void 0;switch(t){case"ArcCurve":n=new te;break;case"CatmullRomCurve3":n=new ne;break;case"CubicBezierCurve":n=new se;break;case"CubicBezierCurve3":n=new ie;break;case"Curve":n=new oe;break;case"CurvePath":n=new re;break;case"EllipseCurve":n=new ae;break;case"LineCurve":n=new he;break;case"LineCurve3":n=new le;break;case"Path":n=new ce;break;case"QuadraticBezierCurve":n=new de;break;case"QuadraticBezierCurve3":n=new ue;break;case"SplineCurve":n=new pe;break;case"Shape":n=new E;break;default:throw new Error(`TCurvesManager: Unknown curve of type: ${t}`)}return n.fromJSON(e),n}}),Object.defineProperties(kn.prototype,{_onJson:{value:function(e,t,n,s){const i=_t(e)?[e]:e,o={};for(let e=0,t=i.length,r=void 0;e<t;e++){r=i[e];try{o[r._id]=this.convert(r)}catch(e){s(e)}n(e/t)}t(o)}}});class In extends r{constructor(t={}){super({basePath:"/",responseType:a.Json,bunchSize:500,requestAggregationTime:200,requestsConcurrency:6,logger:e,...t})}_onJson(e,t,n,s){const i=_t(e)?[e]:e,o={};for(let e=0,t=i.length,r=void 0;e<t;e++){r=i[e];try{o[r.id]=this.convert(r)}catch(e){s(e)}n(new ProgressEvent("FilairesManager",{lengthComputable:!0,loaded:e+1,total:t}))}t(o)}convert(e){if(!e)throw new Error("FilairesManager: Unable to convert null or undefined data !");const t=e.type;let n=null;if(Mt(t))throw new Error("TFilaireManager.convert() : data type must be defined !!!");switch(t){case"NaissanceVoute":n=this._parseFilaire(e,8868096);break;case"Radier":n=this._parseFilaire(e,35247);break;case"Intrados":n=this._parseFilaire(e,12648628);break;case"Br":case"Bp":case"Src":n=this._parsePoint(e,65280);break;default:throw new Error(`TFilaireManager: Unknown object of type: ${t}`)}return n}_parseFilaire(e,t){const n=JSON.parse(e.geojson).coordinates.reduce((e,t)=>e.concat(t),[]);if(Mt(n))throw new Error(`TFilaireManager._parseFilaire() : ${e.type} geometry doesn't contains coordinates !!!`);const s=new U({color:t}),i=new u;i.addAttribute("position",new Z(n,3));let o=new $(i,s);return Mt(e.type)?o.name="".concat(e.id):o.name="".concat(e.type,"_").concat(e.numero_bloc,"_").concat(e.id),o}_parsePoint(e,t){const n=JSON.parse(e.geojson).coordinates.reduce((e,t)=>e.concat(t),[]);if(Mt(n))throw new Error("FilairesManager._parsePoint() : ".concat(e.type," geometry doesn't contains coordinates !!!"));let s=new V(parseFloat(e.attribut),50,50,0,2*Math.PI,0,2*Math.PI);s.computeVertexNormals();let i=new D({color:t}),o=new g(s,i);return o.position.set(n[0],n[1],n[2]),Mt(e.type)?o.name="".concat(e.id):o.name="".concat(e.type,"_").concat(e.numero_bloc,"_").concat(e.id),o}}const Cn={Int8Array:0,Uint8Array:1,Uint8ClampedArray:2,Int16Array:3,Uint16Array:4,Int32Array:5,Uint32Array:6,Float32Array:7,Float64Array:8};class Fn extends r{constructor(e={}){const t={basePath:"/geometries",projectionSystem:"zBack",globalScale:1,computeNormals:!0,computeBoundingBox:!0,computeBoundingSphere:!0,...e};super(t),this.projectionSystem=t.projectionSystem,this.globalScale=t.globalScale,this.computeNormals=t.computeNormals,this.computeBoundingBox=t.computeBoundingBox,this.computeBoundingSphere=t.computeBoundingSphere}get computeBoundingBox(){return this._computeBoundingBox}set computeBoundingBox(e){if(wt(e))throw new TypeError("Compute bounding box cannot be null ! Expect a boolean.");if(yt(e))throw new TypeError("Compute bounding box cannot be undefined ! Expect a boolean.");if(xt(e))throw new TypeError(`Compute bounding box cannot be an instance of ${e.constructor.name} ! Expect a boolean.`);this._computeBoundingBox=e}get computeBoundingSphere(){return this._computeBoundingSphere}set computeBoundingSphere(e){if(wt(e))throw new TypeError("Compute bounding sphere cannot be null ! Expect a boolean.");if(yt(e))throw new TypeError("Compute bounding sphere cannot be undefined ! Expect a boolean.");if(xt(e))throw new TypeError(`Compute bounding sphere cannot be an instance of ${e.constructor.name} ! Expect a boolean.`);this._computeBoundingSphere=e}get computeNormals(){return this._computeNormals}set computeNormals(e){if(wt(e))throw new TypeError("Compute normals cannot be null ! Expect a boolean.");if(yt(e))throw new TypeError("Compute normals cannot be undefined ! Expect a boolean.");if(xt(e))throw new TypeError(`Compute normals cannot be an instance of ${e.constructor.name} ! Expect a boolean.`);this._computeNormals=e}get projectionSystem(){return this._projectionSystem}set projectionSystem(e){if(wt(e))throw new TypeError("Projection system cannot be null ! Expect a positive number.");if(yt(e))throw new TypeError("Projection system cannot be undefined ! Expect a positive number.");this._projectionSystem=e}get globalScale(){return this._globalScale}set globalScale(e){if(wt(e))throw new TypeError("Global scale cannot be null ! Expect a positive number.");if(yt(e))throw new TypeError("Global scale cannot be undefined ! Expect a positive number.");this._globalScale=e}setComputeBoundingBox(e){return this.computeBoundingBox=e,this}setComputeBoundingShpere(e){return this.computeBoundingSphere=e,this}setComputeNormals(e){return this.computeNormals=e,this}setProjectionSystem(e){return this.projectionSystem=e,this}setGlobalScale(e){return this.globalScale=e,this}_onJson(e,t,n,s){const i=_t(e)?[e]:e,o={};for(let e=0,t=i.length,r=void 0;e<t;e++){r=i[e];try{o[r._id]=this.convert(r)}catch(e){s(e)}n(new ProgressEvent("GeometriesManager",{lengthComputable:!0,loaded:e+1,total:t}))}t(o)}convert(e){if(!e)throw new Error("GeometriesManager: Unable to convert null or undefined data !");const t=e.type;if(!t)throw new Error("GeometriesManager: Unable to convert untyped data !");let n=null;if(e.isBufferGeometry||t.includes("BufferGeometry"))n=this._convertJsonToBufferGeometry(e),this._computeNormals&&n.computeVertexNormals();else{if(!e.isGeometry&&!t.includes("Geometry"))throw new Error(`TGeometriesManager: Unable to retrieve geometry of type ${t} !`);n=this._convertJsonToGeometry(e),this._computeNormals&&n.computeFaceNormals()}return this.computeBoundingBox&&(n.boundingBox=null,n.computeBoundingBox()),this.computeBoundingSphere&&(n.boundingSphere=null,n.computeBoundingSphere()),n}_convertJsonToGeometry(e){const t=e.types;let n=null;switch(t){case"BoxGeometry":n=new me;break;case"CircleGeometry":n=new fe;break;case"CylinderGeometry":n=new _e;break;case"ConeGeometry":n=new ge;break;case"EdgesGeometry":n=new G;break;case"DodecahedronGeometry":n=new ve;break;case"ExtrudeGeometry":n=new be;break;case"Geometry":n=new we;break;case"IcosahedronGeometry":n=new ye;break;case"LatheGeometry":n=new xe;break;case"OctahedronGeometry":n=new Ee;break;case"ParametricGeometry":n=new Me;break;case"PlaneGeometry":n=new v;break;case"PolyhedronGeometry":n=new Pe;break;case"RingGeometry":n=new Ae;break;case"ShapeGeometry":n=new Te;break;case"TetrahedronGeometry":n=new Se;break;case"TextGeometry":n=new De;break;case"TorusGeometry":n=new Oe;break;case"TorusKnotGeometry":n=new ke;break;case"TubeGeometry":n=new Ie;break;case"SphereGeometry":n=new Ce;break;case"WireframeGeometry":n=new Fe;break;default:throw new Error(`TGeometriesManager: Unknown geometry of type: ${t}`)}n.uuid=e.uuid,n.name=e.name,n.type=e.type;for(var s=[],i=void 0,o=0,r=e.vertices.length;o<r;++o)i=e.vertices[o],s.push(new x(i.x,i.y,i.z));n.vertices=s;for(var a=[],h=void 0,l=0,c=e.faces.length;l<c;l++)h=e.faces[l],a.push(new ze(h.a,h.b,h.c,h.normal,h.color,h.materialIndex));n.faces=a,n.morphTargets=[],n.morphNormals=[],n.skinWeights=[],n.skinIndices=[],n.lineDistances=[],n.elementsNeedUpdate=!0,n.verticesNeedUpdate=!0,n.uvsNeedUpdate=!0,n.normalsNeedUpdate=!0,n.colorsNeedUpdate=!0,n.lineDistancesNeedUpdate=!0,n.groupsNeedUpdate=!0}_convertJsonToBufferGeometry(e){const t=e.type;let n=null;switch(t){case"BoxBufferGeometry":n=new H;break;case"BufferGeometry":n=new u;break;case"CircleBufferGeometry":n=new Le;break;case"CylinderBufferGeometry":n=new X;break;case"ConeBufferGeometry":n=new q;break;case"DodecahedronBufferGeometry":n=new Be;break;case"ExtrudeBufferGeometry":n=new je;break;case"IcosahedronBufferGeometry":n=new Re;break;case"LatheBufferGeometry":n=new Ge;break;case"OctahedronBufferGeometry":n=new Y;break;case"ParametricBufferGeometry":n=new He;break;case"PlaneBufferGeometry":n=new J;break;case"PolyhedronBufferGeometry":n=new Ue;break;case"RingBufferGeometry":n=new Ne;break;case"ShapeBufferGeometry":n=new u;break;case"TetrahedronBufferGeometry":n=new Xe;break;case"TextBufferGeometry":n=new Ze;break;case"TorusBufferGeometry":n=new W;break;case"TorusKnotBufferGeometry":n=new Ye;break;case"TubeBufferGeometry":n=new Ve;break;case"SphereBufferGeometry":n=new V;break;case"InstancedBufferGeometry":n=new We;break;default:throw new Error(`TGeometriesManager: Unknown buffer geometry of type: ${t}`)}n._id=e._id,n.uuid=e.uuid,n.name=e.name;const s=e.index;if(s&&s.array&&s.array.length>0){const e=this.__convertBase64ToArrayBuffer(s.array),t=this.__convertArrayBufferToTypedArray(e);n.index=new p(t,s.itemSize,s.normalized)}const i=e.attributes;if(i){let e={};const t=i.position;if(t){const n=this.__convertBase64ToArrayBuffer(t.array),s=this.__convertArrayBufferToTypedArray(n),i=this.globalScale,o=new Float32Array(s);if("zBack"===this._projectionSystem){let e=null,t=null,n=null;for(let s=0,r=o.length;s<r;s+=3)e=o[s]/i,t=o[s+2]/i,n=-o[s+1]/i,o[s]=e,o[s+1]=t,o[s+2]=n}else for(let e=0,t=o.length;e<t;e++)o[e]/=i;e.position=new p(o,t.itemSize,t.normalized)}const s=i.normal;if(s){const t=this.__convertBase64ToArrayBuffer(s.array),n=this.__convertArrayBufferToTypedArray(t);e.normal=new p(n,s.itemSize,s.normalized)}const o=i.uv;if(o){const t=this.__convertBase64ToArrayBuffer(o.array),n=this.__convertArrayBufferToTypedArray(t);e.uv=new p(n,o.itemSize,o.normalized)}n.attributes=e}return Pt(e.groups)&&(n.groups=e.groups),Pt(e.boundingBox)&&(n.boundingBox=e.boundingBox),Pt(e.boundingSphere)&&(n.boundingSphere=e.boundingSphere),"ShapeBufferGeometry"===t&&(n.shapes=e.shapes.map(e=>(new E).fromJSON(e)),n.curveSegments=e.curveSegments),n}__convertArrayBufferToTypedArray(e){const t=new DataView(e),n=e.byteLength-1,s=t.getUint8(0);let i=null;switch(s){case Cn.Int8Array:i=new Int8Array(n/1);for(let e=0,s=1;s<n;e++,s+=1)i[e]=t.getInt8(s);break;case Cn.Uint8Array:i=new Uint8Array(n/1);for(let e=0,s=1;s<n;e++,s+=1)i[e]=t.getUint8(s);break;case Cn.Uint8ClampedArray:i=new Uint8ClampedArray(n/1);for(let e=0,s=1;s<n;e++,s+=1)i[e]=t.getUint8(s);break;case Cn.Int16Array:i=new Int16Array(n/2);for(let e=0,s=1;s<n;e++,s+=2)i[e]=t.getInt16(s);break;case Cn.Uint16Array:i=new Uint16Array(n/2);for(let e=0,s=1;s<n;e++,s+=2)i[e]=t.getUint16(s);break;case Cn.Int32Array:i=new Int32Array(n/4);for(let e=0,s=1;s<n;e++,s+=4)i[e]=t.getInt32(s);break;case Cn.Uint32Array:i=new Uint32Array(n/4);for(let e=0,s=1;s<n;e++,s+=4)i[e]=t.getUint32(s);break;case Cn.Float32Array:i=new Float32Array(n/4);for(let e=0,s=1;s<n;e++,s+=4)i[e]=t.getFloat32(s);break;case Cn.Float64Array:i=new Float64Array(n/8);for(let e=0,s=1;s<n;e++,s+=8)i[e]=t.getFloat64(s);break;default:throw new RangeError(`Invalid switch parameter: ${s}`)}return i}__convertBase64ToArrayBuffer(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256);for(let e=0;e<t.length;e++)n[t.charCodeAt(e)]=e;const s=e.length;let i=.75*s;"="===e[s-1]&&(i--,"="===e[s-2]&&i--);let o=new ArrayBuffer(i),r=new Uint8Array(o),a=void 0,h=void 0,l=void 0,c=void 0;for(let t=0,i=0;t<s;t+=4)a=n[e.charCodeAt(t)],h=n[e.charCodeAt(t+1)],l=n[e.charCodeAt(t+2)],c=n[e.charCodeAt(t+3)],r[i++]=a<<2|h>>4,r[i++]=(15&h)<<4|l>>2,r[i++]=(3&l)<<6|63&c;return o}}function zn(){r.call(this),this.basePath="/textures"}zn.prototype=Object.assign(Object.create(r.prototype),{constructor:zn,convert(e){if(!e)throw new Error("TexturesManager: Unable to convert null or undefined data !");const t=e.type;throw new Error(`TTexturesManager: Unknown texture of type: ${t}`)}}),Object.defineProperties(zn.prototype,{_onJson:{value:function(e,t,n,s){const i=_t(e)?[e]:e,o={};for(let e=0,t=i.length,r=void 0;e<t;e++){r=i[e];try{o[r._id]=this.convert(r)}catch(e){s(e)}n(e/t)}t(o)}}});const Ln=(new $e).load("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH4gkKDRoGpGNegQAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAAMSURBVAjXY/j//z8ABf4C/tzMWecAAAAASUVORK5CYII=");class Bn extends r{constructor(e={}){const t={basePath:"/materials",texturesPath:"/textures",texturesProvider:new _,generateMipmap:!1,autoFillTextures:!0,...e};super(t),this.texturesPath=t.texturesPath,this.texturesProvider=t.texturesProvider,this.generateMipmap=t.generateMipmap,this.autoFillTextures=t.autoFillTextures}get texturesPath(){return this._texturesPath}set texturesPath(e){if(wt(e))throw new TypeError("Textures path cannot be null ! Expect a non empty string.");if(yt(e))throw new TypeError("Textures path cannot be undefined ! Expect a non empty string.");if(Tt(e))throw new TypeError(`Textures path cannot be an instance of ${e.constructor.name} ! Expect a non empty string.`);if(St(e))throw new TypeError("Textures path cannot be empty ! Expect a non empty string.");if(Dt(e))throw new TypeError("Textures path cannot contain only whitespace ! Expect a non empty string.");this._texturesPath=e}get texturesProvider(){return this._texturesProvider}set texturesProvider(e){if(wt(e))throw new TypeError("Textures provider cannot be null ! Expect an instance of TextureLoader.");if(yt(e))throw new TypeError("Textures provider cannot be undefined ! Expect an instance of TextureLoader.");if(!(e instanceof zn||e instanceof _))throw new TypeError(`Textures provider cannot be an instance of ${e.constructor.name} ! Expect an instance of TTexturesManager.`);this._texturesProvider=e}get generateMipmap(){return this._generateMipmap}set generateMipmap(e){if(wt(e))throw new TypeError("Generate mipmap cannot be null ! Expect a boolean.");if(yt(e))throw new TypeError("Generate mipmap cannot be undefined ! Expect a boolean.");if(xt(e))throw new TypeError(`Generate mipmap cannot be an instance of ${e.constructor.name} ! Expect a boolean.`);this._generateMipmap=e}get autoFillTextures(){return this._autoFillTextures}set autoFillTextures(e){if(wt(e))throw new TypeError("Global scale cannot be null ! Expect a boolean.");if(yt(e))throw new TypeError("Global scale cannot be undefined ! Expect a positive number.");if(xt(e))throw new TypeError("Global scale cannot be null ! Expect a boolean.");this._autoFillTextures=e}setTexturesPath(e){return this.texturesPath=e,this}setTexturesProvider(e){return this.texturesProvider=e,this}setGenerateMipmap(e){return this.generateMipmap=e,this}setAutoFillTextures(e){return this.autoFillTextures=e,this}_onJson(e,t,n,s){const i=_t(e)?[e]:e,o={};for(let e=0,t=i.length,r=void 0;e<t;e++){r=i[e];try{o[r._id]=this.convert(r)}catch(e){s(e)}n(new ProgressEvent("MaterialsManager",{lengthComputable:!0,loaded:e+1,total:t}))}this._autoFillTextures?this.fillTextures(o,t,n,s):t(o)}convert(e){if(!e)throw new Error("MaterialsManager: Unable to convert null or undefined data !");const t=e.type;let n=null;switch(t){case"MeshPhongMaterial":{n=new D,this._fillBaseMaterialData(n,e);const t=e.color;Pt(t)&&(n.color=this._setColor(t));const s=e.specular;Pt(s)&&(n.specular=this._setColor(s));const i=e.shininess;Pt(i)&&(n.shininess=i);const o=e.map;Pt(o)&&(n.map=o);const r=e.lightMap;Pt(r)&&(n.lightMap=r);const a=e.lightMapIntensity;Pt(a)&&(n.lightMapIntensity=a);const h=e.aoMap;Pt(h)&&(n.aoMap=h);const l=e.aoMapIntensity;Pt(l)&&(n.aoMapIntensity=l);const c=e.emissive;Pt(c)&&(n.emissive=this._setColor(c));const d=e.emissiveIntensity;Pt(d)&&(n.emissiveIntensity=d);const u=e.emissiveMap;Pt(u)&&(n.emissiveMap=u);const p=e.bumpMap;Pt(p)&&(n.bumpMap=p);const m=e.bumpScale;Pt(m)&&(n.bumpScale=m);const f=e.normalMap;Pt(f)&&(n.normalMap=f);const _=e.normalScale;Pt(_)&&(n.normalScale=this._setVector2(_));const g=e.displacementMap;Pt(g)&&(n.displacementMap=g);const v=e.displacementScale;Pt(v)&&(n.displacementScale=v);const b=e.displacementBias;Pt(b)&&(n.displacementBias=b);const w=e.specularMap;Pt(w)&&(n.specularMap=w);const y=e.alphaMap;Pt(y)&&(n.alphaMap=y);const x=e.envMap;Pt(x)&&(n.envMap=x);const E=e.combine;Pt(E)&&(n.combine=E);const M=e.reflectivity;Pt(M)&&(n.reflectivity=M);const P=e.refractionRatio;Pt(P)&&(n.refractionRatio=P);const A=e.wireframe;Pt(A)&&(n.wireframe=A);const T=e.wireframeLinewidth;Pt(T)&&(n.wireframeLinewidth=T);const S=e.wireframeLinecap;Pt(S)&&(n.wireframeLinecap=S);const O=e.wireframeLinejoin;Pt(O)&&(n.wireframeLinejoin=O);const k=e.skinning;Pt(k)&&(n.skinning=k);const I=e.morphTargets;Pt(I)&&(n.morphTargets=I);const C=e.morphNormals;Pt(C)&&(n.morphNormals=C)}break;case"MeshLambertMaterial":{n=new qe,this._fillBaseMaterialData(n,e);const t=e.color;Pt(t)&&(n.color=this._setColor(t));const s=e.map;Pt(s)&&(n.map=s);const i=e.lightMap;Pt(i)&&(n.lightMap=i);const o=e.lightMapIntensity;Pt(o)&&(n.lightMapIntensity=o);const r=e.aoMap;Pt(r)&&(n.aoMap=r);const a=e.aoMapIntensity;Pt(a)&&(n.aoMapIntensity=a);const h=e.emissive;Pt(h)&&(n.emissive=this._setColor(h));const l=e.emissiveIntensity;Pt(l)&&(n.emissiveIntensity=l);const c=e.emissiveMap;Pt(c)&&(n.emissiveMap=c);const d=e.specularMap;Pt(d)&&(n.specularMap=d);const u=e.alphaMap;Pt(u)&&(n.alphaMap=u);const p=e.envMap;Pt(p)&&(n.envMap=p);const m=e.combine;Pt(m)&&(n.combine=m);const f=e.reflectivity;Pt(f)&&(n.reflectivity=f);const _=e.refractionRatio;Pt(_)&&(n.refractionRatio=_);const g=e.wireframe;Pt(g)&&(n.wireframe=g);const v=e.wireframeLinewidth;Pt(v)&&(n.wireframeLinewidth=v);const b=e.wireframeLinecap;Pt(b)&&(n.wireframeLinecap=b);const w=e.wireframeLinejoin;Pt(w)&&(n.wireframeLinejoin=w);const y=e.skinning;Pt(y)&&(n.skinning=y);const x=e.morphTargets;Pt(x)&&(n.morphTargets=x);const E=e.morphNormals;Pt(E)&&(n.morphNormals=E)}break;case"LineBasicMaterial":{n=new U,this._fillBaseMaterialData(n,e);const t=e.color;Pt(t)&&(n.color=this._setColor(t))}break;case"PointsMaterial":{n=new m,this._fillBaseMaterialData(n,e);const t=e.color;Pt(t)&&(n.color=this._setColor(t));const s=e.map;Pt(s)&&(n.map=s);const i=e.morphTargets;Pt(i)&&(n.morphTargets=i);const o=e.size;Pt(o)&&(n.size=o);const r=e.sizeAttenuation;Pt(r)&&(n.sizeAttenuation=r)}break;default:throw new Error(`TMaterialsManager: Unmanaged material of type: ${t}`)}return n}_fillBaseMaterialData(e,t){const n=t._id;Pt(n)&&bt(n)&&(e._id=n);const s=t.uuid;Pt(s)&&bt(s)&&(e.uuid=s);const i=t.name;Pt(i)&&bt(i)&&(e.name=i);const o=t.fog;Pt(o)&&(e.fog=o);const r=t.lights;Pt(r)&&(e.lights=r);const a=t.blending;Pt(a)&&(e.blending=a);const h=t.side;Pt(h)&&(e.side=h);const l=t.flatShading;Pt(l)&&(e.flatShading=l);const c=t.vertexColors;Pt(c)&&(e.vertexColors=c);const d=t.opacity;Pt(d)&&(e.opacity=d);const u=t.transparent;Pt(u)&&(e.transparent=u);const p=t.blendSrc;Pt(p)&&(e.blendSrc=p);const m=t.blendDst;Pt(m)&&(e.blendDst=m);const f=t.blendEquation;Pt(f)&&(e.blendEquation=f);const _=t.blendSrcAlpha;Pt(_)&&(e.blendSrcAlpha=_);const g=t.blendDstAlpha;Pt(g)&&(e.blendDstAlpha=g);const v=t.blendEquationAlpha;Pt(v)&&(e.blendEquationAlpha=v);const b=t.depthFunc;Pt(b)&&(e.depthFunc=b);const w=t.depthTest;Pt(w)&&(e.depthTest=w);const y=t.depthWrite;Pt(y)&&(e.depthWrite=y);const x=t.clippingPlanes;Pt(x)&&(e.clippingPlanes=x);const E=t.clipIntersection;Pt(E)&&(e.clipIntersection=E);const M=t.clipShadows;Pt(M)&&(e.clipShadows=M);const P=t.colorWrite;Pt(P)&&(e.colorWrite=P);const A=t.precision;Pt(A)&&(e.precision=A);const T=t.polygonOffset;Pt(T)&&(e.polygonOffset=T);const S=t.polygonOffsetFactor;Pt(S)&&(e.polygonOffsetFactor=S);const D=t.polygonOffsetUnits;Pt(D)&&(e.polygonOffsetUnits=D);const O=t.dithering;Pt(O)&&(e.dithering=O);const k=t.alphaTest;Pt(k)&&(e.alphaTest=k);const I=t.premultipliedAlpha;Pt(I)&&(e.premultipliedAlpha=I);const C=t.overdraw;Pt(C)&&(e.overdraw=C);const F=t.visible;Pt(F)&&(e.visible=F);const z=t.userData;Pt(z)&&(e.userData=z);const L=t.needsUpdate;Pt(L)&&(e.needsUpdate=L)}_setVector2(e){const t=e.x,n=e.y;if(Mt(t)||Mt(n))throw new Error("MaterialsManager: Unable to convert null or undefined vector 2 !");return new z(t,n)}_setColor(e){const t=e.r,n=e.g,s=e.b;if(Mt(t)||Mt(n)||Mt(s))throw new Error("MaterialsManager: Unable to convert null or undefined color !");return new Je(t,n,s)}fillTextures(e,t){const n=this._retrieveTexturesOf(e);for(let t in e){const s=e[t],i=n[t];for(let e in i)s[e]=i[e]}t(e)}_retrieveTexturesOf(e){const t=["map","lightMap","aoMap","emissiveMap","bumpMap","normalMap","displacementMap","specularMap","alphaMap","envMap"],n={},s={};for(let i in e){const o=e[i];let r={};for(let e=0,n=t.length;e<n;e++){let n=t[e];const i=o[n];if(Pt(i)&&bt(i)&&Ot(i)){const e=`${this._texturesPath}/${i}`,t=s[e];if(Pt(t))r[n]=t;else{const t=this._texturesProvider.load(e,()=>{},()=>{},()=>{t.image||(t.image=Ln,t.needsUpdate=!0)});t.name=i,this._generateMipmap||(t.generateMipmaps=!1,t.magFilter=Ke,t.minFilter=Ke),s[e]=t,r[n]=t}}}n[i]=r}return n}}class jn extends r{constructor(e={}){const t={basePath:"/objects",geometriesProvider:new Fn,materialsProvider:new Bn,projectionSystem:"zBack",globalScale:1,autoFillObjects3D:!0,...e};super(t),this.geometriesProvider=t.geometriesProvider,this.materialsProvider=t.materialsProvider,this.projectionSystem=t.projectionSystem,this.globalScale=t.globalScale,this.autoFillObjects3D=t.autoFillObjects3D}get geometriesProvider(){return this._geometriesProvider}set geometriesProvider(e){if(wt(e))throw new TypeError("Geometries provider cannot be null ! Expect an instance of GeometriesManager.");if(yt(e))throw new TypeError("Geometries provider cannot be undefined ! Expect an instance of GeometriesManager.");if(!(e instanceof Fn))throw new TypeError(`Geometries provider cannot be an instance of ${e.constructor.name} ! Expect an instance of TGeometriesManager.`);this._geometriesProvider=e}get materialsProvider(){return this._materialsProvider}set materialsProvider(e){if(wt(e))throw new TypeError("Materials provider cannot be null ! Expect an instance of MaterialsManager.");if(yt(e))throw new TypeError("Materials provider cannot be undefined ! Expect an instance of MaterialsManager.");if(!(e instanceof Bn))throw new TypeError(`Materials provider cannot be an instance of ${e.constructor.name} ! Expect an instance of TMaterialsManager.`);this._materialsProvider=e}get projectionSystem(){return this._projectionSystem}set projectionSystem(e){if(wt(e))throw new TypeError("Projection system cannot be null ! Expect a positive number.");if(yt(e))throw new TypeError("Projection system cannot be undefined ! Expect a positive number.");this._projectionSystem=e}get globalScale(){return this._globalScale}set globalScale(e){if(wt(e))throw new TypeError("Global scale cannot be null ! Expect a positive number.");if(yt(e))throw new TypeError("Global scale cannot be undefined ! Expect a positive number.");this._globalScale=e}get autoFillObjects3D(){return this._autoFillObjects3D}set autoFillObjects3D(e){if(wt(e))throw new TypeError("Global scale cannot be null ! Expect a boolean.");if(yt(e))throw new TypeError("Global scale cannot be undefined ! Expect a positive number.");if(xt(e))throw new TypeError("Global scale cannot be null ! Expect a boolean.");this._autoFillObjects3D=e}setGeometriesProvider(e){return this.geometriesProvider=e,this}setMaterialsProvider(e){return this.materialsProvider=e,this}setProjectionSystem(e){return this.projectionSystem=e,this}setGlobalScale(e){return this.globalScale=e,this}setAutoFillObjects3D(e){return this.autoFillObjects3D=e,this}_onJson(e,t,n,s){const i={};for(let t=0,o=e.length,r=void 0;t<o;t++){r=e[t];try{i[r._id]=this.convert(r)}catch(e){s(e)}n(new ProgressEvent("ObjectsManager",{lengthComputable:!0,loaded:t+1,total:o}))}this._autoFillObjects3D?this.fillObjects3D(i,t,n,s):t(i)}_onArrayBuffer(e,t,n,s){}_onBlob(e,t,n,s){}_onText(e,t,n,s){}convert(e){if(!e)throw new Error("ObjectsManager: Unable to convert null or undefined data !");const t=e.type;let n=null;switch(t){case"Object3D":n=new C,this._fillBaseObjectsData(n,e);break;case"Scene":n=new ee,this._fillBaseObjectsData(n,e),Pt(e.background)&&Number.isInteger(e.background)&&(n.background=new Je(e.background)),Pt(e.fog)&&("Fog"===e.fog.type?n.fog=new Qe(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(n.fog=new et(e.fog.color,e.fog.density))),n.overrideMaterial=e.overrideMaterial,n.autoUpdate=e.autoUpdate;break;case"PerspectiveCamera":n=new tt,this._fillBaseObjectsData(n,e),n.fov=e.fov,n.aspect=e.aspect,n.near=e.near,n.far=e.far,Pt(e.focus)&&(n.focus=e.focus),Pt(e.zoom)&&(n.zoom=e.zoom),Pt(e.filmGauge)&&(n.filmGauge=e.filmGauge),Pt(e.filmOffset)&&(n.filmOffset=e.filmOffset),Pt(e.view)&&(n.view=Object.assign({},e.view));break;case"OrthographicCamera":n=new nt(e.left,e.right,e.top,e.bottom,e.near,e.far),this._fillBaseObjectsData(n,e);break;case"AmbientLight":n=new st(e.color,e.intensity),this._fillBaseObjectsData(n,e);break;case"DirectionalLight":n=new it(e.color,e.intensity),this._fillBaseObjectsData(n,e);break;case"PointLight":n=new ot(e.color,e.intensity,e.distance,e.decay),this._fillBaseObjectsData(n,e);break;case"RectAreaLight":n=new rt(e.color,e.intensity,e.width,e.height),this._fillBaseObjectsData(n,e);break;case"SpotLight":n=new at(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),this._fillBaseObjectsData(n,e);break;case"HemisphereLight":n=new ht(e.color,e.groundColor,e.intensity),this._fillBaseObjectsData(n,e);break;case"SkinnedMesh":n=new lt,this._fillBaseObjectsData(n,e),n.geometry=e.geometry,n.material=e.material,n.drawMode=e.drawMode,n.bindMode=e.bindMode,n.bindMatrix=e.bindMatrix,n.bindMatrixInverse=e.bindMatrixInverse;break;case"Mesh":n=new g,this._fillBaseObjectsData(n,e),n.geometry=e.geometry,n.material=e.material,n.drawMode=e.drawMode;break;case"LOD":n=new ct,this._fillBaseObjectsData(n,e),n.levels=e.levels;break;case"Line":n=new $,this._fillBaseObjectsData(n,e),n.geometry=e.geometry,n.material=e.material,n.drawMode=e.drawMode;break;case"LineLoop":n=new dt,this._fillBaseObjectsData(n,e),n.geometry=e.geometry,n.material=e.material,n.drawMode=e.drawMode;break;case"LineSegments":n=new R,this._fillBaseObjectsData(n,e),n.geometry=e.geometry,n.material=e.material,n.drawMode=e.drawMode;break;case"Points":n=new f,this._fillBaseObjectsData(n,e),n.geometry=e.geometry,n.material=e.material,n.drawMode=e.drawMode;break;case"Sprite":n=new ut,this._fillBaseObjectsData(n,e),n.material=e.material;break;case"Group":n=new d,this._fillBaseObjectsData(n,e);break;default:throw new Error(`TObjectsManager: Unknown object of type: ${t}`)}return n}_fillBaseObjectsData(e,t){e._id=t._id,Pt(t.uuid)&&(e.uuid=t.uuid),Pt(t.name)&&(e.name=t.name),Pt(t.parent)&&(e.parent=t.parent),kt(t.children)&&(e.children=t.children),Pt(t.up)&&(e.up.x=t.up.x,e.up.y=t.up.y,e.up.z=t.up.z),Pt(t.position)&&("zBack"===this._projectionSystem?(e.position.x=t.position.x/this._globalScale,e.position.y=t.position.z/this._globalScale,e.position.z=-t.position.y/this._globalScale):(e.position.x=t.position.x/this._globalScale,e.position.y=t.position.y/this._globalScale,e.position.z=t.position.z/this._globalScale)),Pt(t.rotation)&&("zBack"===this._projectionSystem?(e.rotation.x=t.rotation.x,e.rotation.y=t.rotation.z,e.rotation.z=-t.rotation.y,e.rotation.order=t.rotation.order):(e.rotation.x=t.rotation.x,e.rotation.y=t.rotation.y,e.rotation.z=t.rotation.z,e.rotation.order=t.rotation.order)),Pt(t.quaternion)&&("zBack"===this._projectionSystem?(e.quaternion.x=t.quaternion.x,e.quaternion.y=t.quaternion.z,e.quaternion.z=-t.quaternion.y,e.quaternion.w=t.quaternion.w):(e.quaternion.x=t.quaternion.x,e.quaternion.y=t.quaternion.y,e.quaternion.z=t.quaternion.z,e.quaternion.w=t.quaternion.w)),Pt(t.scale)&&(0!==t.scale.x&&0!==t.scale.y&&0!==t.scale.z?(e.scale.x=t.scale.x,e.scale.y=t.scale.y,e.scale.z=t.scale.z):console.warn("Try to assign null scale !")),Pt(t.modelViewMatrix)&&kt(t.modelViewMatrix)&&e.modelViewMatrix.fromArray(t.modelViewMatrix),Pt(t.normalMatrix)&&kt(t.normalMatrix)&&e.normalMatrix.fromArray(t.normalMatrix),Pt(t.matrix)&&kt(t.matrix)&&e.matrix.fromArray(t.matrix),Pt(t.matrixWorld)&&kt(t.matrixWorld)&&e.matrixWorld.fromArray(t.matrixWorld),Pt(t.matrixAutoUpdate)&&(e.matrixAutoUpdate=t.matrixAutoUpdate),Pt(t.matrixWorldNeedsUpdate)&&(e.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate),Pt(t.layers)&&(e.layers.mask=t.layers),Pt(t.visible)&&(e.visible=t.visible),Pt(t.castShadow)&&(e.castShadow=t.castShadow),Pt(t.receiveShadow)&&(e.receiveShadow=t.receiveShadow),Pt(t.frustumCulled)&&(e.frustumCulled=t.frustumCulled),Pt(t.renderOrder)&&(e.renderOrder=t.renderOrder),Pt(t.userData)&&(e.userData=t.userData)}fillObjects3D(e,t,n,s){const i=this,o=[];for(let t in e){const n=e[t];(n.geometry||n.material)&&o.push(e[t])}if(0===o.length)return void t(e);let r=void 0;this._retrieveGeometriesOf(o,e=>{r=e,h()},n,s);let a=void 0;function h(){if(r&&a){for(let t in e){const n=e[t];i.applyGeometry(n,r),i.applyMaterials(n,a)}t(e)}}this._retrieveMaterialsOf(o,e=>{a=e,h()},n,s)}_retrieveGeometriesOf(e,t,n,s){const i=e.map(e=>e.geometry).filter((e,t,n)=>e&&n.indexOf(e)===t);0!==i.length?this._geometriesProvider.read(i,null,t,n,s):t({})}_retrieveMaterialsOf(e,t,n,s){const i=e.map(e=>e.material),o=[].concat.apply([],i).filter((e,t,n)=>e&&n.indexOf(e)===t);0!==o.length?this._materialsProvider.read(o,null,t,n,s):t({})}applyGeometry(e,t){const n=e.geometry;if(!n)return;const s=t[n];s?e.geometry=s:console.error("Unable to retrieve geometry !!!")}applyMaterials(e,t){const n=e.material;if(n)if(Array.isArray(n))if(1===n.length){const s=t[n[0]];if(!s)return console.error("Unable to retrieve material !!!"),null;e.material=s.clone()}else{e.material=[];for(let s=0,i=n.length;s<i;s++){const i=t[n[s]];if(!i)return console.error("Unable to retrieve material !!!"),null;e.material.push(i.clone())}}else if("string"==typeof n){const s=t[n];if(!s)return void console.error("Unable to retrieve material !!!");e.material=s.clone()}else console.error("Invalid material ids, expected string or array of string")}}class Rn extends R{static _createInternalGeometry(e,t,n,s,i,o){const r=[],a=[];let h,l,c,d,p,m,f;for(d=0;d<=t;d++)c=d/t*(2*Math.PI),h=Math.sin(c)*e,l=Math.cos(c)*e,r.push(0,0,0),r.push(h,0,l),f=1&d?i:o,a.push(f.r,f.g,f.b),a.push(f.r,f.g,f.b);for(d=0;d<=n;d++){for(f=1&d?i:o,m=e-e/n*d,p=0;p<s;p++)c=p/s*(2*Math.PI),h=Math.sin(c)*m,l=Math.cos(c)*m,r.push(h,0,l),a.push(f.r,f.g,f.b),c=(p+1)/s*(2*Math.PI),h=Math.sin(c)*m,l=Math.cos(c)*m,r.push(h,0,l),a.push(f.r,f.g,f.b);r.push(-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1),a.push(1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1)}const _=new Z(r,3);_.name="TOrbitControlsHelperPositionBufferAttribute";const g=new Z(a,3);g.name="TOrbitControlsHelperColorBufferAttribute";const v=new u;return v.addAttribute("position",_),v.addAttribute("color",g),v.name="TOrbitControlsHelperGeometry",v}static _createInternalMaterial(){const e=new U({vertexColors:pt});return e.transparent=!0,e.opacity=0,e.name="TOrbitControlsHelperMaterial",e}constructor(e={}){const t={radius:2,radials:16,circles:2,divisions:64,innerColor:new Je(4473924),outerColor:new Je(8947848),...e};super(Rn._createInternalGeometry(t.radius,t.radials,t.circles,t.divisions,t.innerColor,t.outerColor),Rn._createInternalMaterial()),this._intervalId=void 0}startOpacityAnimation(){void 0!==this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this.material.opacity=1}endOpacityAnimation(){this._intervalId=setInterval(function(){this.material.opacity<=0?(this.material.opacity=0,clearInterval(this._intervalId),this._intervalId=void 0):this.material.opacity-=.1}.bind(this),100)}}export{It as ASCLoader,Mn as AbstractGizmo,gn as AbstractHandle,cn as AbstractHitbox,On as BufferGeometriesManager,Kt as CameraControlMode,Qt as CameraControls,on as CameraPathController,an as ClippingBox,Dn as ClippingControls,Sn as ClippingModes,kn as CurvesManager,dn as CylindricaHitbox,zt as DBFLoader,In as FilairesManager,Fn as GeometriesManager,ln as HighlightableLineMaterial,hn as HighlightableMaterial,xn as LozengeHandle,pn as LozengeHitbox,Bn as MaterialsManager,jn as ObjectsManager,En as OctahedricalHandle,mn as OctahedricalHitbox,Rn as OrbitControlsHelper,un as PlanarHitbox,yn as PlaneHandle,Lt as RZMLLoader,An as RotateGizmo,wn as RotateHandle,Gt as SHPLoader,Tn as ScaleGizmo,bn as ScaleHandle,Bt as ShapeType,fn as SphericalHitbox,zn as TexturesManager,_n as TorusHitbox,Pn as TranslateGizmo,vn as TranslateHandle,Xt as UniversalLoader};
//# sourceMappingURL=itee-plugin-three.esm.min.js.map
