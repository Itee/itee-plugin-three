"use strict";var e=require("@itee/database"),t=require("@itee/mongodb"),r=require("@itee/validators"),n=require("three-full"),i=require("@itee/client"),o=require("@itee/core"),a=require("@itee/utils"),s=require("node:module"),c=require("bson"),u="undefined"!=typeof document?document.currentScript:null;function h(e){return e&&e.__esModule?e:{default:e}}var l=h(r);
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @see [IFC Standard]{@link http://standards.buildingsmart.org/IFC/RELEASE/IFC4_1/FINAL/HTML/}
 *
 */class d extends t.TMongooseController{constructor(e={}){super(e)}async _readOneDocument(e,t){if(r.isNotDefined(e)||r.isNotDefined(t))return null;const n=await this._driver.model(e).findOne(t).exec();return r.isDefined(n)?n._doc:null}async _readManyDocument(e,t,n){if(r.isNotDefined(e)||r.isNotDefined(t))return null;return(await this._driver.model(e).find(t,n).lean().exec()).map(e=>e._doc)}async _updateDocument(e,t,n){if(r.isNotDefined(e))return null;return await this._driver.model(e.type).findByIdAndUpdate(e._id,t,n).exec()}async getAllChildrenIds(e,t=!1){const n={children:[],geometries:[],materials:[]},i=[],o=await this._readManyDocument("Objects3D",{parent:e},{_id:!0,geometry:!0,material:!0,children:!0});for(let e=0,a=o.length;e<a;e++){const a=o[e],s=a._id.toString();r.isDefined(s)&&n.children.push(s);const c=a.geometry;r.isDefined(c)&&n.geometries.push(c.toString());const u=a.material;if(u){const e=r.isArray(u)?u.map(e=>e.toString()):[u.toString()];n.materials.push(...e)}if(a.children){const e=this.getAllChildrenIds(s,t);i.push(e)}}if(i.length>0){const e=await Promise.all(i);for(let t=0,r=e.length;t<r;t++){const r=e[t];n.children.push(...r.children),n.geometries.push(...r.geometries),n.materials.push(...r.materials)}}return n}async _deleteOne(e,r){try{const n="allInOneByParentId";if("oneByOne"===n);else if("allInOneByParentId"===n){const n=await this.getAllChildrenIds(e,!0);n.children.push(e);const i={children:[...new Set(n.children)],geometries:[...new Set(n.geometries)],materials:[...new Set(n.materials)]},[o,a,s]=await Promise.all([this._deleteDocuments("Objects3D",i.children),this._deleteDocuments("Geometries",i.geometries),this._deleteDocuments("Materials",i.materials)]);t.TMongooseController.returnData({deletedObjectsCount:o,deletedGeometriesResult:a,deletedMaterialsResult:s},r)}}catch(e){t.TMongooseController.returnError(e,r)}}async _deleteDocuments(e,t){if(r.isEmptyArray(t))return 0;return(await this._driver.model(e).deleteMany({_id:{$in:t}}).exec()).deletedCount}async _deleteDocument(e){if(r.isNotDefined(e))return null;const t=await this._driver.model(e.type).findByIdAndDelete(e._id).exec();return t&&t._doc?t._doc._id:null}async _removeParentReference(e){const t=e.parent;if(r.isNotDefined(t))return null;const n=await this._readOneDocument("Objects3D",{_id:t}),i=n.children,o=i.indexOf(e._id);i.splice(o,1);return await this._updateDocument(n,{$set:{children:i}})}async _removeChildrenDocuments(e){let t=[];for(let r=e.length-1;r>=0;r--)t.push(this._removeChildDocument(e[r]));return Promise.all(t)}async _removeChildDocument(e){const t=await this._readManyDocument("Objects3D",{parent:e._id}),r=await this._removeChildrenDocuments(t),n=await this._removeOrphanGeometryWithId(e.geometry),i=await this._removeOrphanMaterialsWithIds(e.material||[]);return{object:await this._deleteDocument(e),children:r,geometry:n,materials:i}}async _removeOrphanGeometryWithId(e){if(r.isNotDefined(e))return;if((await this._readManyDocument("Objects3D",{geometry:e})).length>1)return;const t=await this._readOneDocument("Geometries",{_id:e});return await this._deleteDocument(t)}async _removeOrphanMaterialsWithIds(e){if(r.isNotDefined(e))return;if(r.isEmptyArray(e))return;const t=[];for(let r=0,n=e.length;r<n;r++)t.push(this._removeOrphanMaterialWithId(e[r]));return Promise.all(t)}async _removeOrphanMaterialWithId(e){if(r.isNotDefined(e))return;if((await this._readManyDocument("Objects3D",{material:e})).length>1)return;const t=await this._readOneDocument("Materials",{_id:e});return await this._deleteDocument(t)}}
/**
 * @module Converters/ColladaToThree
 * @desc Export JsonToThree converter class about .dae files

 * @requires {@link https://github.com/Itee/@itee/database @itee/database}
 * @requires {@link https://github.com/Itee/three-full three-full}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class m extends e.TAbstractFileConverter{constructor(){super({dumpType:e.TAbstractFileConverter.DumpType.ArrayBuffer})}_convert(e,t,r,i,o){super._convert(e,t,r,i,o);try{const t=new n.ColladaLoader;r(t.parse(e))}catch(e){o(e)}}}
/**
 * @module Loader/DBFLoader
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * From:
 * https://www.clicketyclick.dk/databases/xbase/format/db2_dbf.html#DBII_DBF_STRUCT
 * http://web.archive.org/web/20150323061445/http://ulisse.elettra.trieste.it/services/doc/dbase/DBFstruct.htm
 * http://www.dbase.com/Knowledgebase/INT/db7_file_fmt.htm
 *
 *
 */const f=a.toEnum({FoxPro:48,FoxPro_Autoincrement:49,dBASE_II:2,FoxPro_Var:50,dBASE_III_plus:3,dBASE_III_plus_memo:131,dBASE_IV_SQL_table:67,dBASE_IV_SQL_system:99,dBASE_IV_memo:139,dBASE_IV_memo_SQL_table:203,FoxBase:251,dBase_v_7:4,FoxPro_2_x:245,HiPerSix_memo:229}),g=a.toEnum({Binary:"B",Character:"C",Date:"D",Numeric:"N",Logical:"L",Memo:"M",Timestamp:"@",Long:"I",Autoincrement:"+",Float:"F",Double:"O",OLE:"G"});class p{constructor(e={}){const t={manager:n.DefaultLoadingManager,logger:o.DefaultLogger,reader:new i.TBinaryReader,...e};this.manager=t.manager,this.logger=t.logger,this.reader=t.reader}get manager(){return this._manager}set manager(e){this._manager=e}get logger(){return this._logger}set logger(e){this._logger=e}get reader(){return this._reader}set reader(e){this._reader=e}setManager(e){return this.manager=e,this}setLogger(e){return this.logger=e,this}setReader(e){return this.reader=e,this}load(e,t,r,i){const o=this,a=new n.FileLoader(o.manager);a.setResponseType("arraybuffer"),a.load(e,e=>{t(o.parse(e))},r,i)}parse(e){this.reader.setEndianess(i.Endianness.Big).setBuffer(e);const t=this.reader.getInt8();if(!this._isValidVersion(t))return this.logger.error(`DBFLoader: Invalid version number: ${t}`),null;const r=this._parseHeader(t);return{header:r,datas:this._parseDatas(t,r)}}_isValidVersion(e){return f.includes(e)}_parseHeader(e){let t={};switch(e){case f.FoxPro:case f.FoxPro_Autoincrement:case f.FoxPro_Var:case f.dBASE_II:t=this._parseHeaderV2();break;case f.dBASE_III_plus:case f.dBASE_III_plus_memo:t=this._parseHeaderV2_5();break;case f.dBASE_IV_memo:case f.dBASE_IV_memo_SQL_table:case f.dBASE_IV_SQL_system:case f.dBASE_IV_SQL_table:t=this._parseHeaderV3();break;case f.dBase_v_7:case f.FoxPro_2_x:case f.HiPerSix_memo:t=this._parseHeaderV4();break;default:throw new RangeError(`Invalid version parameter: ${e}`)}return this.reader.getUint8()!==p.Terminator&&this.logger.error("DBFLoader: Invalid terminator after field descriptors !!!"),t}_parseHeaderV2(){const e=this.reader.getInt16(),t=this.reader.getInt8()+p.YearOffset,r=this.reader.getInt8(),n=this.reader.getInt8(),i=this.reader.getInt16();let o,a,s,c,u,h=[];for(let t=0;t<e;t++)o=this.reader.getString(11),a=this.reader.getChar(),s=this.reader.getUint8(),c=this.reader.getInt16(),u=this.reader.getInt8(),h.push({name:o,type:a,length:s,memoryAddress:c,decimalCount:u});return{numberOfRecords:e,year:t,month:r,day:n,lengthOfEachRecords:i,fields:h}}_parseHeaderV2_5(){const e=this.reader.getInt8()+p.YearOffset,t=this.reader.getInt8(),r=this.reader.getInt8();this.reader.setEndianess(i.Endianness.Little);const n=this.reader.getInt32(),o=this.reader.getInt16(),a=this.reader.getInt16();this.reader.setEndianess(i.Endianness.Big),this.reader.skipOffsetOf(20);let s,c,u,h,l,d,m,f=[];for(let e=0;e<n;e++)s=this.reader.getString(11),c=this.reader.getChar(),h=this.reader.getInt32(),u=this.reader.getUint8(),l=this.reader.getUint8(),this.reader.skipOffsetOf(2),d=this.reader.getInt8(),this.reader.skipOffsetOf(2),m=this.reader.getInt8(),this.reader.skipOffsetOf(1),f.push({name:s,type:c,length:u,memoryAddress:h,decimalCount:l,workAreaId:d,MDXFlag:m});return{year:e,month:t,day:r,numberOfRecords:n,numberOfByteInHeader:o,numberOfByteInRecord:a,fields:f}}_parseHeaderV3(){const e=this.reader.getInt8()+p.YearOffset,t=this.reader.getInt8(),r=this.reader.getInt8();this.reader.setEndianess(i.Endianness.Little);const n=this.reader.getInt32(),o=this.reader.getInt16(),a=this.reader.getInt16();this.reader.setEndianess(i.Endianness.Big),this.reader.skipOffsetOf(2);const s=this.reader.getInt8(),c=this.reader.getInt8();this.reader.skipOffsetOf(12);const u=this.reader.getInt8(),h=this.reader.getInt8();this.reader.skipOffsetOf(2);let l,d,m,f,g,_,y=[];for(;this.reader.getOffset()<o-1;)l=this.reader.getString(11),d=this.reader.getChar(),this.reader.skipOffsetOf(4),m=this.reader.getUint8(),f=this.reader.getUint8(),this.reader.skipOffsetOf(2),g=this.reader.getInt8(),this.reader.skipOffsetOf(10),_=this.reader.getInt8(),y.push({name:l,type:d,length:m,decimalCount:f,workAreaId:g,MDXFieldFlag:_});return{year:e,month:t,day:r,numberOfRecords:n,numberOfByteInHeader:o,numberOfByteInRecord:a,incompleteTransactionFlag:s,encryptionFlag:c,MDXFlag:u,languageDriverId:h,fields:y}}_parseHeaderV4(){const e=this.reader.getInt8()+p.YearOffset,t=this.reader.getInt8(),r=this.reader.getInt8();this.reader.setEndianess(i.Endianness.Little);const n=this.reader.getInt32(),o=this.reader.getInt16(),a=this.reader.getInt16();this.reader.setEndianess(i.Endianness.Big),this.reader.skipOffsetOf(2);const s=this.reader.getInt8(),c=this.reader.getInt8();this.reader.skipOffsetOf(12);const u=this.reader.getInt8(),h=this.reader.getInt8();this.reader.skipOffsetOf(2);const l=this.reader.getString(32);this.reader.skipOffsetOf(4);let d,m,f,g,_,y,S=[];for(let e=0;e<n;e++)d=this.reader.getString(32),m=this.reader.getChar(),f=this.reader.getUint8(),g=this.reader.getUint8(),this.reader.skipOffsetOf(2),_=this.reader.getInt8(),this.reader.skipOffsetOf(2),y=this.reader.getInt32(),this.reader.skipOffsetOf(4),S.push({name:d,type:m,length:f,decimalCount:g,MDXFieldFlag:_,nextAutoincrementValue:y});return{year:e,month:t,day:r,numberOfRecords:n,numberOfByteInHeader:o,numberOfByteInRecord:a,incompleteTransactionFlag:s,encryptionFlag:c,MDXFlag:u,languageDriverId:h,languageDriverName:l,fields:S}}_parseDatas(e,t){const r=t.numberOfRecords,n=t.fields;let i=[],o=null,a=null;for(let e=0;e<r;e++){o={},o.deleted=this.reader.getUint8()===p.DeletedRecord;for(let e=0,t=n.length;e<t;e++)switch(a=n[e],a.type){case g.Binary:{const e=this.reader.getString(a.length);o[a.name]=parseInt(e)}break;case g.Numeric:{const e=this.reader.getString(a.length);o[a.name]=parseInt(e)}break;case g.Character:case g.Date:o[a.name]=this.reader.getString(a.length);break;case g.Logical:{const e=this.reader.getChar().toLowerCase();o[a.name]="t"===e||"y"===e||"f"!==e&&"n"!==e&&null}break;case g.Memo:o[a.name]=this.reader.getString(a.length);break;case g.Timestamp:break;case g.Long:case g.Autoincrement:o[a.name]=this.reader.getInt32();break;case g.Float:{const e=this.reader.getString(a.length);o[a.name]=parseInt(e)}break;case g.Double:o[a.name]=this.reader.getFloat64();break;case g.OLE:o[a.name]=this.reader.getString(a.length);break;default:throw new RangeError(`Invalid data type parameter: ${a.type}`)}i.push(o)}return i}_parseFieldProperties(){const e=this.reader.getInt16(),t=this.reader.getInt16(),r=this.reader.getInt16(),n=this.reader.getInt16(),i=this.reader.getInt16(),o=this.reader.getInt16(),a=this.reader.getInt16(),s=this.reader.getInt16();let c=[];for(let t=0;t<e;t++)c.push(this._getStandardProperties());let u=[];for(let e=0;e<r;e++)u.push(this._getCustomProperties());let h=[];for(let e=0;e<i;e++)h.push(this._getReferentialIntegrityProperties());return{numberOfStandardProperties:e,startOfStandardPropertiesDescriptor:t,numberOfCustomProperties:r,startOfCustomPropertiesDescriptor:n,numberOfReferentialIntegrityProperties:i,startOfReferentialIntegrityDescriptor:o,startOfData:a,sizeOfPropertiesStructure:s,standardProperties:c,customProperties:u,referentialIntegrityProperties:h}}_getStandardProperties(){const e=this.reader.getInt16(),t=this.reader.getInt16(),r=this.reader.getInt8(),n=this.reader.getInt8(),i=this.reader.getInt8();this.reader.skipOffsetOf(4);return{generationalNumber:e,tableFieldOffset:t,propertyDescribed:r,type:n,isConstraint:i,offsetFromStart:this.reader.getInt16(),widthOfDatabaseField:this.reader.getInt16()}}_getCustomProperties(){const e=this.reader.getInt16(),t=this.reader.getInt16(),r=this.reader.getInt8();this.reader.skipOffsetOf(1);return{generationalNumber:e,tableFieldOffset:t,type:r,offsetFromStartOfName:this.reader.getInt16(),lengthOfName:this.reader.getInt16(),offsetFromStartOfData:this.reader.getInt16(),lengthOfData:this.reader.getInt16()}}_getReferentialIntegrityProperties(){return{databaseState:this.reader.getInt8(),sequentialNumberRule:this.reader.getInt16(),offsetOfTheRIRuleName:this.reader.getInt16(),sizeOfTheRIRuleName:this.reader.getInt16(),offsetOfNameOfForeignTable:this.reader.getInt16(),sizeOfNameOfForeignTable:this.reader.getInt16(),stateBehaviour:this.reader.getInt8(),numberOfFieldsInLinkingKey:this.reader.getInt16(),offsetOfLocalTableTagName:this.reader.getInt16(),sizeOfTheLocalTableTagName:this.reader.getInt16(),offsetOfForeignTableTagName:this.reader.getInt16(),sizeOfTheForeignTableTagName:this.reader.getInt16()}}}p.Terminator=13,p.DeletedRecord=26,p.YearOffset=1900;
/**
 * @module Converters/DbfToThree
 * @desc Export JsonToThree converter class about .dbf files

 * @requires {@link https://github.com/Itee/@itee/database @itee/database}
 * @requires {@link module:Loader/DBFLoader Loader/DBFLoader}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */
class _ extends e.TAbstractFileConverter{constructor(){super({dumpType:e.TAbstractFileConverter.DumpType.ArrayBuffer})}_convert(e,t,r,n,i){super._convert(e,t,r,n,i);try{const t=new p;r(t.parse(e))}catch(e){i(e)}}}
/**
 * @module Converters/FbxToThree
 * @desc Export JsonToThree converter class about .fbx files

 * @requires {@link https://github.com/Itee/@itee/database @itee/database}
 * @requires {@link https://github.com/Itee/three-full three-full}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class y extends e.TAbstractFileConverter{constructor(){super({dumpType:e.TAbstractFileConverter.DumpType.ArrayBuffer})}_convert(e,t,r,i,o){super._convert(e,t,r,i,o);try{const t=new n.FBXLoader;r(t.parse(e))}catch(e){o(e)}}}
/**
 * @module Converters/JsonToThree
 * @desc Export JsonToThree converter class about .json files

 * @requires {@link https://github.com/Itee/@itee/database @itee/database}
 * @requires {@link https://github.com/Itee/three-full three-full}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class S extends e.TAbstractFileConverter{constructor(){super({dumpType:e.TAbstractFileConverter.DumpType.JSON})}_convert(e,t,r,i,o){super._convert(e,t,r,i,o);try{const t=new n.ObjectLoader;r(t.parse(e))}catch(e){o(e)}}}
/**
 * @module Converters/MtlToThree
 * @desc Export JsonToThree converter class about .mtl files

 * @requires {@link https://github.com/Itee/@itee/database @itee/database}
 * @requires {@link https://github.com/Itee/three-full three-full}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class M extends e.TAbstractFileConverter{constructor(){super({dumpType:e.TAbstractFileConverter.DumpType.String})}_convert(e,t,r,i,o){super._convert(e,t,r,i,o);try{const t=new n.MTLLoader;r(t.parse(e))}catch(e){o(e)}}}
/**
 * @module Converters/Obj2ToThree
 * @desc Export JsonToThree converter class about .obj files

 * @requires {@link https://github.com/Itee/@itee/database @itee/database}
 * @requires {@link https://github.com/Itee/three-full three-full}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class b extends e.TAbstractFileConverter{constructor(){super({dumpType:e.TAbstractFileConverter.DumpType.JSON})}_convert(e,t,r,i,o){super._convert(e,t,r,i,o);try{const t=new n.OBJLoader2;r(t.parse(e))}catch(e){o(e)}}}
/**
 * @module Loader/SHPLoader
 * @desc Export SHPLoader to load .shp files
 *
 * @requires {@link https://github.com/Itee/@itee/client @itee/client}
 * @requires {@link https://github.com/Itee/@itee/utils @itee/utils}
 * @requires {@link https://github.com/Itee/three-full three-full}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 * @example Todo...
 *
 */const w=a.toEnum({NullShape:0,Point:1,Polyline:3,Polygon:5,MultiPoint:8,PointZ:11,PolyLineZ:13,PolygonZ:15,MultiPointZ:18,PointM:21,PolylineM:23,PolygonM:25,MultiPointM:28,MultiPatch:31});class F{constructor(e={}){const t={manager:n.DefaultLoadingManager,logger:o.DefaultLogger,reader:new i.TBinaryReader,globalOffset:new n.Vector3(0,0,0),worldAxis:{from:"zUp",to:"zForward"},...e};this.manager=t.manager,this.logger=t.logger,this.reader=t.reader,this.globalOffset=t.globalOffset,this.worldAxis=t.worldAxis}get globalOffset(){return this._globalOffset}set globalOffset(e){this._globalOffset=e}get worldAxis(){return this._worldAxis}set worldAxis(e){this._worldAxis=e}get manager(){return this._manager}set manager(e){this._manager=e}get logger(){return this._logger}set logger(e){this._logger=e}get reader(){return this._reader}set reader(e){this._reader=e}setGlobalOffset(e){return this.globalOffset=e,this}setWorldAxis(e){return this.worldAxis=e,this}setManager(e){return this.manager=e,this}setLogger(e){return this.logger=e,this}setReader(e){return this.reader=e,this}load(e,t,r,i){const o=this,a=new n.FileLoader(o.manager);a.setResponseType("arraybuffer"),a.load(e,e=>{t(o.parse(e))},r,i)}parse(e){this._reader.setEndianess(i.Endianness.Big).setBuffer(e);const t=this._parseHeader();if(t.fileCode!==F.FileCode)return this.logger.error("SHPLoader: Invalide Shape file code !"),null;if(t.fileLength<F.MinFileLength)return this.logger.error("SHPLoader: Shape file have an incorrect length !"),null;if(!Object.values(w).includes(t.shapeType))return this.logger.error("SHPLoader: Shape file have an incorrect shape type !"),null;t.version<F.MinVersion&&this.logger.warn("SHPLoader: Version of shape file below than 1000 could be incorrectly parsed !");const r=this._parseDatas(t);return this._convertToObjects(r)}_parseHeader(){const e=this._reader.getInt32();this._reader.skipOffsetOf(20);const t=this._reader.getInt32();this._reader.setEndianess(i.Endianness.Little);const r=this._reader.getInt32(),n=this._reader.getInt32(),o=this._reader.getInt32(),a=this._reader.getInt32();return{fileCode:e,fileLength:t,version:r,shapeType:n,boundingBox:{xMin:o,xMax:this._reader.getInt32(),yMin:a,yMax:this._reader.getInt32(),zMin:this._reader.getInt32(),zMax:this._reader.getInt32(),mMin:this._reader.getInt32(),mMax:this._reader.getInt32()}}}_parseDatas(e){this._reader.skipOffsetTo(100);let t,r,n,o=[];for(;!this._reader.isEndOfFile();)switch(t=this._parseRecordHeader(),r=this._reader.getOffset()+2*t.contentLength,this._reader.setEndianess(i.Endianness.Little),e.shapeType){case w.NullShape:this._reader.skipOffsetTo(r);break;case w.Point:case w.PointZ:case w.PointM:for(;this._reader.getOffset()<r;)n=this._parsePoint(),n&&o.push(n);break;case w.Polyline:case w.PolyLineZ:case w.PolylineM:for(;this._reader.getOffset()<r;)n=this._parsePolyLine(),n&&o.push(n);break;case w.Polygon:case w.PolygonZ:case w.PolygonM:for(;this._reader.getOffset()<r;)n=this._parsePolyLine(),n&&o.push(n);break;case w.MultiPoint:case w.MultiPointZ:case w.MultiPointM:for(;this._reader.getOffset()<r;)n=this._parseMultiPoint(),n&&o.push(n);break;case w.MultiPatch:for(;this._reader.getOffset()<r;)n=this._parseMultiPatch(),n&&o.push(n);break;default:this.logger.error(`SHPLoader: Invalid switch parameter: ${e.shapeType}`)}return o}_parseRecordHeader(){this._reader.setEndianess(i.Endianness.Big);return{recordNumber:this._reader.getInt32(),contentLength:this._reader.getInt32()}}_parseNull(){return this._reader.getInt32(),null}_parsePoint(){const e=this._reader.getInt32();if(e===w.NullShape)return null;return{shapeType:e,x:this._reader.getFloat64(),y:this._reader.getFloat64()}}_parsePolyLine(){const e=this._reader.getInt32();if(e===w.NullShape)return null;const t={xMin:this._reader.getFloat64(),yMin:this._reader.getFloat64(),xMax:this._reader.getFloat64(),yMax:this._reader.getFloat64()},r=this._reader.getInt32(),n=this._reader.getInt32(),i=new Array(r);for(let e=0;e<r;e++)i[e]=this._reader.getInt32();const o=new Array(n);for(let e=0;e<n;e++)o[e]={x:this._reader.getFloat64(),y:this._reader.getFloat64()};return{shapeType:e,boundingBox:t,numberOfParts:r,numberOfPoints:n,parts:i,points:o}}_parsePolygon(){const e=this._reader.getInt32();if(e===w.NullShape)return null;const t={xMin:this._reader.getFloat64(),yMin:this._reader.getFloat64(),xMax:this._reader.getFloat64(),yMax:this._reader.getFloat64()},r=this._reader.getInt32(),n=this._reader.getInt32();let i=new Array(r);for(let e=0;e<r;e++)i[e]=this._reader.getInt32();let o=new Array(n);for(let e=0;e<n;e++)o[e]={x:this._reader.getFloat64(),y:this._reader.getFloat64()};const s=[],c=[];return i.forEach((e,t)=>{const r=o.slice(e,i[t+1]);a.ringClockwise(r)?s.push(r):c.push(r)}),c.forEach(e=>{s.some(t=>{if(a.ringContainsSome(t[0],e))return t.push(e),!0})||s.push([e])}),{shapeType:e,boundingBox:t,numberOfParts:r,numberOfPoints:n,parts:i,polygons:s}}_parseMultiPoint(){const e=this._reader.getInt32();if(e===w.NullShape)return null;const t={xMin:this._reader.getFloat64(),xMax:this._reader.getFloat64(),yMin:this._reader.getFloat64(),yMax:this._reader.getFloat64()},r=this._reader.getInt32(),n=new Array(r);for(let e=0;e<r;e++)n.push([this._reader.getFloat64(),this._reader.getFloat64()]);return{shapeType:e,boundingBox:t,numberOfPoints:r,points:n}}_parseMultiPatch(){const e=this._reader.getInt32();return e===w.NullShape?null:{shapeType:e}}_convertToObjects(e){let t=[];for(let t=0,n=e.length;t<n;t++){let n=e[t];n.shapeType!==w.Polygon&&n.shapeType!==w.PolygonZ&&n.shapeType!==w.PolygonM||(n.points&&Array.isArray(n.points[0])?r(n.points):i(n.points))}function r(e){for(let t=0,n=e.length;t<n;t++){let n=e[t];n?Array.isArray(n[0])?r(n):i(n):this.logger.log("no array, oups !")}}function i(e){t.push(new n.Shape(e))}return t}}F.FileCode=9994,F.MinFileLength=100,F.MinVersion=1e3;
/**
 * @module Converters/ShpToThree
 * @desc Export JsonToThree converter class about .shp files

 * @requires {@link https://github.com/Itee/@itee/database @itee/database}
 * @requires {@link module:Loader/SHPLoader Loader/SHPLoader}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */
class T extends e.TAbstractFileConverter{constructor(){super({dumpType:e.TAbstractFileConverter.DumpType.ArrayBuffer})}_convert(e,t,r,n,i){super._convert(e,t,r,n,i);try{const t=new F;r(t.parse(e))}catch(e){i(e)}}}
/**
 * @module Converters/StlToThree
 * @desc Export JsonToThree converter class about .stl files

 * @requires {@link https://github.com/Itee/@itee/database @itee/database}
 * @requires {@link https://github.com/Itee/three-full three-full}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class v extends e.TAbstractFileConverter{constructor(){super({dumpType:e.TAbstractFileConverter.DumpType.JSON})}_convert(e,t,r,i,o){super._convert(e,t,r,i,o);try{const t=new n.STLLoader;r(t.parse(e))}catch(e){o(e)}}}
/**
 * @module Converters/TdsToThree
 * @desc Export JsonToThree converter class about .3ds files

 * @requires {@link https://github.com/Itee/@itee/database @itee/database}
 * @requires {@link https://github.com/Itee/three-full three-full}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class B extends e.TAbstractFileConverter{constructor(){super({dumpType:e.TAbstractFileConverter.DumpType.ArrayBuffer})}_convert(e,t,r,i,o){super._convert(e,t,r,i,o);try{const t=new n.TDSLoader;r(t.parse(e))}catch(e){o(e)}}}
/**
 * @module Inserters/ThreeToMongoDB
 * @desc Export ThreeToMongoDB mongodb inserter class.
 *
 * @requires {@link https://github.com/Itee/@itee/client @itee/client}
 * @requires {@link https://github.com/Itee/@itee/database @itee/database}
 * @requires {@link https://github.com/Itee/@itee/validators @itee/validators}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class x extends e.TAbstractDataInserter{constructor(e={}){const t={logger:o.DefaultLogger,...e};super(t),this.logger=t.logger,this.mergeStrategy="add",this._cache={}}static _toLog(e){return JSON.stringify({type:e.type||"undefined",name:e.name||"undefined",uuid:e.uuid||"undefined",id:e._id||"undefined"})}async _save(e,t,n,i,o){const s=a.toArray(e);if(r.isEmptyArray(s))return void o("No data to save in database. Abort insert !");const c=s.map(e=>e.name);this.logger.log(`ThreeToMongoDB: Saving ${c}`),t.mergeStrategy&&(this.mergeStrategy=t.mergeStrategy);try{const e=t.parentId;let i=null,a=null;if(r.isDefined(e)){const n=await this._readDocument("Objects3D",{_id:e});if(r.isNull(n))return void o(`Unable to retrieve parent with id (${t.parentId}). Abort insert !`);if("add"===this.mergeStrategy)i=await this._parseObjects(s,e),a=r.isDefined(i)?i.filter(e=>e).map(e=>e._id):[],await this._updateDocument(n,{$addToSet:{children:a}});else if("replace"===this.mergeStrategy){const t=await this._readDocuments("Objects3D",{parent:e}),o=s.map(e=>e.uuid),c=t.filter(e=>!o.includes(e.uuid));await this._removeChildrenDocuments(c),i=await this._parseObjects(s,e),a=r.isDefined(i)?i.filter(e=>e).map(e=>e._id):[],await this._updateDocument(n,{$set:{children:a}})}}else i=await this._parseObjects(s,null),a=r.isDefined(i)?i.filter(e=>e).map(e=>e._id):[];this.logger.log(`ThreeToMongoDB: Saved ${a}`),n()}catch(e){o(e)}finally{this._cache={}}}async _parseObjects(e=[],t=null){this.logger.debug("_parseObjects(...)");const n=a.toArray(e);if(r.isEmptyArray(n))return null;const i=[];for(let e=0,r=n.length;e<r;e++)i.push(this._parseObject(n[e],t));return Promise.all(i)}async _parseObject(e,t=null){if(this.logger.debug(`_parseObject(${x._toLog(e)}, ${t})`),r.isNotDefined(e))return null;const n=e.type,i=e.name,o=e.geometry,s=a.toArray(e.children),c=a.toArray(e.material);if(r.isDefined(o)&&r.isEmptyArray(s))if(o.isGeometry){const e=o.vertices;if(r.isNotDefined(e)||r.isEmptyArray(e))return this.logger.error(`Leaf object ${i} have a geometry that doesn't contain vertices ! Skip it.`),null}else{if(!o.isBufferGeometry)return this.logger.error(`Object ${i} contain an unknown/unmanaged geometry of type ${o.type} ! Skip it.`),null;{const e=o.attributes;if(r.isNotDefined(e))return this.logger.error(`Buffer geometry of ${i} doesn't contain attributes ! Skip it.`),null;const t=e.position;if(r.isNotDefined(t)||0===t.count)return this.logger.error(`Leaf object ${i} have a buffer geometry that doesn't contain position attribute ! Skip it.`),null}}let u=null;if(x.AvailableLineTypes.includes(n)){if(r.isNotDefined(o))return this.logger.error(`Missing geometry for object ${e.name} of type ${n}. Only Sprite can contains material without geometry ! Skip it.`),null;u=x.AvailableLineMaterialTypes}else if(x.AvailablePointTypes.includes(n)){if(r.isNotDefined(o))return this.logger.error(`Missing geometry for object ${e.name} of type ${n}. Only Sprite can contains material without geometry ! Skip it.`),null;u=x.AvailablePointMaterialTypes}else x.AvailableSpriteTypes.includes(n)&&(u=x.AvailableSpriteMaterialTypes);if(u)for(let e=0,t=c.length;e<t;e++){const t=c[e].type;if(!u.includes(t))return this.logger.error(`Object ${i} of type ${n}, contain an invalid material of type ${t} ! Skip it.`),null}const h=await this._getOrCreateDocuments(o),l=r.isDefined(h)?h.filter(e=>e).map(e=>e._id).pop():null,d=await this._getOrCreateDocuments(c),m=r.isDefined(d)?d.filter(e=>e).map(e=>e._id):[];let f=await this._readDocument(n,{uuid:e.uuid,parent:t});if(r.isDefined(f))if("add"===this.mergeStrategy){const e=await this._parseObjects(s,f._id),t=r.isDefined(e)?e.filter(e=>e).map(e=>e._id):[];await this._updateDocument(f,{$addToSet:{children:t}})}else if("replace"===this.mergeStrategy){const e=await this._readDocuments("Objects3D",{parent:f._id}),t=s.map(e=>e.uuid),n=e.filter(e=>!t.includes(e.uuid));await this._removeChildrenDocuments(n);const i=await this._parseObjects(s,f._id),o=r.isDefined(i)?i.filter(e=>e).map(e=>e._id):[];await this._updateDocument(f,{$set:{children:o,geometry:l,material:m}})}else this.logger.error(`Unknown/Unmanaged merge srategy ${this.mergeStrategy}`);else{e.parent=t,e.children=[],e.geometry=l,e.material=m,f=await this._createDocument(e);const n=await this._parseObjects(s,f._id),i=r.isDefined(n)?n.filter(e=>e).map(e=>e._id):[];await this._updateDocument(f,{$set:{children:i,geometry:l,material:m}})}return f}async _getOrCreateDocuments(e=[]){this.logger.debug("_getOrCreateDocuments(...)");const t=a.toArray(e);if(r.isEmptyArray(t))return null;const n=[];for(let e=0,r=t.length;e<r;e++)n.push(this._getOrCreateDocument(t[e]));return Promise.all(n)}async _getOrCreateDocument(e){if(this.logger.debug(`_getOrCreateDocument(${x._toLog(e)})`),r.isNotDefined(e))return null;let t=await this._readDocument(e.type,{uuid:e.uuid});return t=r.isDefined(t)?await this._updateDocument(t,e):await this._createDocument(e),t}async _createDocuments(e=[]){this.logger.debug("_createDocuments(...)");const t=a.toArray(e);if(r.isEmptyArray(t))return null;const n=[];for(let e=0,r=t.length;e<r;e++)n.push(this._createDocument(t[e]));return Promise.all(n)}async _createDocument(e){if(this.logger.debug(`_createDocument(${x._toLog(e)})`),r.isNotDefined(e))return null;const t=await this._driver.model(e.type)(e).save(),n=r.isDefined(t)?t._doc:null;return n&&(this._cache[n.uuid]=n),n}async _readDocuments(e,t){if(this.logger.debug("_readDocuments(...)"),r.isNotDefined(e)||r.isNotDefined(t))return null;return(await this._driver.model(e).find(t).exec()).map(e=>e._doc)}async _readDocument(e,t){if(this.logger.debug(`_readDocument(${e}, ${JSON.stringify(t)})`),r.isNotDefined(e)||r.isNotDefined(t))return null;const n=this._cache[t.uuid];if(n)return n;const i=await this._driver.model(e).findOne(t).exec(),o=r.isDefined(i)?i._doc:null;return o&&(this._cache[o.uuid]=o),o}async _updateDocuments(e=[],t,n){this.logger.debug("_updateDocuments(...)");const i=a.toArray(e);if(r.isEmptyArray(i))return null;const o=[];for(let e=0,r=i.length;e<r;e++)o.push(this._updateDocument(i[e],t,n));return Promise.all(o)}async _updateDocument(e,t,n={new:!0}){if(this.logger.debug(`_updateDocument(${x._toLog(e)}, ${JSON.stringify(t)}, ${JSON.stringify(n)})`),r.isNotDefined(e))return null;const i=await this._driver.model(e.type).findByIdAndUpdate(e._id,t,n).exec(),o=r.isDefined(i)?i._doc:null;return o&&(this._cache[o.uuid]=o),o}async _deleteDocuments(e=[]){this.logger.debug("_deleteDocuments(...)");const t=a.toArray(e);if(r.isEmptyArray(t))return null;const n=[];for(let e=0,r=t.length;e<r;e++)n.push(this._deleteDocument(t[e]));return Promise.all(n)}async _deleteDocument(e){if(this.logger.debug(`_deleteDocument(${x._toLog(e)})`),r.isNotDefined(e))return null;const t=await this._driver.model(e.type).findByIdAndDelete(e._id).exec(),n=r.isDefined(t)?t._doc:null;return n&&delete this._cache[n.uuid],n}async _removeChildrenDocuments(e){this.logger.debug("_removeChildrenDocuments(...)");let t=[];for(let r=e.length-1;r>=0;r--)t.push(this._removeChildDocument(e[r]));return Promise.all(t)}async _removeChildDocument(e){this.logger.debug(`_removeChildDocument(${x._toLog(e)})`);const t=await this._readDocuments("Objects3D",{parent:e._id});await this._removeChildrenDocuments(t),await this._removeOrphanGeometryWithId(e.geometry),await this._removeOrphanMaterialsWithIds(e.material||[]),await this._deleteDocument(e)}async _removeOrphanGeometryWithId(e){if(this.logger.debug(`_removeOrphanGeometryWithId(${e})`),r.isNotDefined(e))return;if((await this._readDocuments("Objects3D",{geometry:e})).length>1)return;const t=await this._readDocument("Geometries",{_id:e});await this._deleteDocument(t)}async _removeOrphanMaterialsWithIds(e){this.logger.debug("_removeOrphanMaterialsWithIds(...)");const t=[];for(let r=0,n=e.length;r<n;r++)t.push(this._removeOrphanMaterialWithId(e[r]));return Promise.all(t)}async _removeOrphanMaterialWithId(e){this.logger.debug(`_removeOrphanMaterialWithId(${e})`);if((await this._readDocuments("Objects3D",{material:e})).length>1)return;const t=await this._readDocument("Materials",{_id:e});await this._deleteDocument(t)}}function C(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if("function"==typeof t){var r=function e(){var r=!1;try{r=this instanceof e}catch{}return r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}),r}x.AvailableCurveTypes=["Curve","ArcCurve","CatmullRomCurve3","CubicBezierCurve","CubicBezierCurve3","EllipseCurve","LineCurve","LineCurve3","QuadraticBezierCurve","QuadraticBezierCurve3","SplineCurve","CurvePath","Path","Shape"],x.AvailableLineTypes=["Line","LineLoop","LineSegments"],x.AvailableLineMaterialTypes=["LineBasicMaterial","LineDashedMaterial"],x.AvailablePointTypes=["Points"],x.AvailablePointMaterialTypes=["PointsMaterial"],x.AvailableSpriteTypes=["Sprite"],x.AvailableSpriteMaterialTypes=["SpriteMaterial"];var O={};
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @module Schemas/Object3D
 *
 * @description Todo...
 */function D(){}D.getSchemaFrom=e=>(D._schema||D._createSchema(e),D._schema),D._createSchema=e=>{const t=e.Schema,r=t.Types,n=r.ObjectId,i=r.Mixed,o=r.Vector3,a=r.Quaternion,s=r.Matrix4,c=r.Euler;D._schema=new t({uuid:String,name:String,type:String,parent:n,children:[n],up:o,position:o,rotation:c,quaternion:a,scale:{type:o,default:{x:1,y:1,z:1}},modelViewMatrix:s,normalMatrix:s,matrix:s,matrixWorld:s,matrixAutoUpdate:Boolean,matrixWorldNeedsUpdate:Boolean,layers:{type:Number,set:e=>e.mask},visible:Boolean,castShadow:Boolean,receiveShadow:Boolean,frustumCulled:Boolean,renderOrder:Boolean,userData:{type:i,set:e=>function e(t){let r={};for(let n in t){if(!Object.prototype.hasOwnProperty.call(t,n))continue;let i=t[n];i.constructor===Object&&(i=e(i)),r[n.replace(/\./g,"")]=i}return r}(e)}},{collection:"objects",discriminatorKey:"type"})},D.getModelFrom=e=>(D._model||D._createModel(e),D._model),D._createModel=e=>{D._model=e.model("Objects3D",D.getSchemaFrom(e)),D._model.discriminator("Object3D",new e.Schema({}))},D.registerModelTo=e=>(D._model||D._createModel(e),e),D._schema=null,D._model=null;var N,I=C(Object.freeze({__proto__:null,Object3D:D}));var P,G=function(){if(N)return O;N=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("Audio",n(t))}return O.Audio={name:"Audio",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},O}(),L={};var A,R=function(){if(P)return L;P=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("AudioListener",n(t))}return L.AudioListener={name:"AudioListener",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},L}(),z={};var U,E=function(){if(A)return z;A=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("PositionalAudio",n(t))}return z.PositionalAudio={name:"PositionalAudio",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},z}(),k={};var H,V=function(){if(U)return k;U=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("ArrayCamera",n(t))}return k.ArrayCamera={name:"ArrayCamera",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},k}(),j={};var $,Y=function(){if(H)return j;H=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("Camera",n(t))}return j.Camera={name:"Camera",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},j}(),W={};var X,Z=function(){if($)return W;$=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("CubeCamera",n(t))}return W.CubeCamera={name:"CubeCamera",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},W}(),q={};var K,Q=function(){if(X)return q;X=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("OrthographicCamera",n(t))}return q.OrthographicCamera={name:"OrthographicCamera",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},q}(),J={};var ee=function(){if(K)return J;K=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("PerspectiveCamera",n(t))}return J.PerspectiveCamera={name:"PerspectiveCamera",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},J}(),te={};const re=s.createRequire("undefined"==typeof document?require("url").pathToFileURL(__filename).href:u&&"SCRIPT"===u.tagName.toUpperCase()&&u.src||new URL("plugin-three.min.cjs",document.baseURI).href);function ne(){return re("node:buffer")}
/**
 * @module Schemas/Core/BufferAttribute
 * @desc Export the ThreeJs BufferAttribute Model and Schema for Mongoose.
 *
 * @requires {@link https://github.com/Itee/@itee/validators @itee/validators}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */var ie;var oe=function(){if(ie)return te;ie=1;const{isInt8Array:e,isInt16Array:t,isInt32Array:r,isFloat32Array:n,isFloat64Array:i,isUint8Array:o,isUint8ClampedArray:a,isUint16Array:s,isUint32Array:c,isBigInt64Array:u,isBigUint64Array:h}=l.default,{Buffer:d}=ne();let m;return te.BufferAttribute={name:"BufferAttribute",getSchemaFrom:function(l){return m||function(l){const f=l.Schema,g=f.Types.Mixed,p=1,_=2,y=4,S=8,M={Int8Array:0,Uint8Array:1,Uint8ClampedArray:2,Int16Array:3,Uint16Array:4,Int32Array:5,Uint32Array:6,Float32Array:7,Float64Array:8,BigInt64Array:9,BigUint64Array:10};m=new f({array:{type:d,set:l=>{const m=l.length;let f=null,g=0;if(e(l)){f=d.allocUnsafe(p+m*p),g=f.writeUInt8(M.Int8Array,g);for(let e=0;e<m;e++)g=f.writeInt8(l[e],g)}else if(o(l)){f=d.allocUnsafe(p+m*p),g=f.writeUInt8(M.Uint8Array,g);for(let e=0;e<m;e++)g=f.writeUInt8(l[e],g)}else if(a(l)){f=d.allocUnsafe(p+m*p),g=f.writeUInt8(M.Uint8ClampedArray,g);for(let e=0;e<m;e++)g=f.writeUInt8(l[e],g)}else if(t(l)){f=d.allocUnsafe(p+m*_),g=f.writeUInt8(M.Int16Array,g);for(let e=0;e<m;e++)g=f.writeInt16BE(l[e],g)}else if(s(l)){f=d.allocUnsafe(p+m*_),g=f.writeUInt8(M.Uint16Array,g);for(let e=0;e<m;e++)g=f.writeUInt16BE(l[e],g)}else if(r(l)){f=d.allocUnsafe(p+m*y),g=f.writeUInt8(M.Int32Array,g);for(let e=0;e<m;e++)g=f.writeInt32BE(l[e],g)}else if(c(l)){f=d.allocUnsafe(p+m*y),g=f.writeUInt8(M.Uint32Array,g);for(let e=0;e<m;e++)g=f.writeUInt32BE(l[e],g)}else if(n(l)){f=d.allocUnsafe(p+m*y),g=f.writeUInt8(M.Float32Array,g);for(let e=0;e<m;e++)g=f.writeFloatBE(l[e],g)}else if(i(l)){f=d.allocUnsafe(p+m*S),g=f.writeUInt8(M.Float64Array,g);for(let e=0;e<m;e++)g=f.writeDoubleBE(l[e],g)}else if(u(l)){f=d.allocUnsafe(p+m*S),g=f.writeUInt8(M.BigInt64Array,g);for(let e=0;e<m;e++)g=f.writeDoubleBE(l[e],g)}else{if(!h(l))throw new Error("Unable to determine the array type to bufferize.");f=d.allocUnsafe(p+m*S),g=f.writeUInt8(M.BigUint64Array,g);for(let e=0;e<m;e++)g=f.writeDoubleBE(l[e],g)}return f}},count:Number,dynamic:Boolean,itemSize:Number,name:String,needsUpdate:Boolean,normalized:Boolean,updateRange:g,uuid:String,version:Number},{_id:!1,id:!1})}(l),m},getModelFrom:()=>null,registerModelTo:e=>e},te}();
/**
 * @module Schemas/Core/BufferGeometry
 * @desc Export the ThreeJs BufferGeometry Model and Schema for Mongoose.
 *
 * @requires {@link module:Schemas/Core/BufferAttribute Schemas/Core/BufferAttribute}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */let ae,se;function ce(e){return ae||function(e){const t=e.Schema,r=t.Types,n=r.Mixed,i=r.Vector3,o=oe.BufferAttribute.getSchemaFrom(e);ae=new t({uuid:String,name:String,type:String,index:o,attributes:{position:o,normal:o,color:o,uv:o},groups:n,boundingBox:{min:i,max:i},boundingSphere:{center:i,radius:Number},drawRange:n},{collection:"geometries",discriminatorKey:"type"})}(e),ae}function ue(e){se=e.model("BufferGeometries",ce(e)),se.discriminator("BufferGeometry",new e.Schema({}))}const he={getSchemaFrom:ce,getModelFrom:function(e){return se||ue(e),se},registerModelTo:function(e){return se||ue(e),e}};var le,de,me=Object.freeze({__proto__:null,BufferGeometry:he}),fe={},ge={};function pe(){if(le)return ge;let e,t;function r(t){return e||function(t){const r=t.Schema;e=new r({type:{type:String,default:"Curve"},arcLengthDivisions:Number},{collection:"curves",discriminatorKey:"type"})}(t),e}function n(e){t=e.model("Curves",r(e)),t.discriminator("Curve",new e.Schema({}))}return le=1,ge.Curve={name:"Curve",getSchemaFrom:r,getModelFrom:function(e){return t||n(e),t},registerModelTo:function(e){return t||n(e),e}},ge}
/**
 * @module Schemas/Core/CurvePath
 * @desc Export the ThreeJs CurvePath Model and Schema for Mongoose.
 *
 * @requires {@link module:Schemas/Curves/Curve Schemas/Curves/Curve}
 * @augments module:Schemas/Curves/Curve
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */var _e,ye=function(){if(de)return fe;de=1;const{Curve:e}=pe();let t,r;function n(e){return t||function(e){const r=e.Schema,n=new r({type:{type:String,default:"Curve"},arcLengthDivisions:Number},{id:!1,_id:!1});t=new r({curves:[n],autoClose:{type:Boolean,default:!1}})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("CurvePath",n(t))}return fe.CurvePath={name:"CurvePath",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},fe}(),Se={};var Me=function(){if(_e)return Se;let e;return _e=1,Se.Face3={name:"Face3",getSchemaFrom:function(t){return e||function(t){const r=t.Schema,n=r.Types,i=n.Color,o=n.Vector3;e=new r({a:Number,b:Number,c:Number,normal:o,vertexNormals:[Number],color:i,vertexColors:[Number],materialIndex:Number},{_id:!1,id:!1})}(t),e},getModelFrom:()=>null,registerModelTo:e=>e},Se}();
/**
 * @module Schemas/Core/Geometry
 * @desc Export the ThreeJs Geometry Model and Schema for Mongoose.
 *
 * @requires {@link module:Schemas/Core/Face3 Schemas/Core/Face3}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */let be,we;function Fe(e){return be||function(e){const t=Me.Face3.getSchemaFrom(e),r=e.Schema,n=r.Types.Vector3;be=new r({uuid:String,name:String,type:String,vertices:[n],colors:[Number],faces:[t],faceVertexUvs:[[Number]],morphTargets:[Number],morphNormals:[Number],skinWeights:[Number],skinIndices:[Number],lineDistances:[Number],boundingBox:{min:n,max:n},boundingSphere:{center:n,radius:Number},elementsNeedUpdate:Boolean,verticesNeedUpdate:Boolean,uvsNeedUpdate:Boolean,normalsNeedUpdate:Boolean,colorsNeedUpdate:Boolean,lineDistancesNeedUpdate:Boolean,groupsNeedUpdate:Boolean},{collection:"geometries",discriminatorKey:"type"})}(e),be}function Te(e){we=e.model("Geometries",Fe(e)),we.discriminator("Geometry",new e.Schema({}))}const ve={name:"Geometry",getSchemaFrom:Fe,getModelFrom:function(e){return we||Te(e),we},registerModelTo:function(e){return we||Te(e),e}};var Be,xe=Object.freeze({__proto__:null,Geometry:ve}),Ce={};var Oe,De=function(){if(Be)return Ce;Be=1;const{Curve:e}=pe();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Vector2,i=new r({type:{type:String,default:"Curve"},arcLengthDivisions:Number},{id:!1,_id:!1});t=new r({curves:[i],autoClose:{type:Boolean,default:!1},currentPoint:n})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("Path",n(t))}return Ce.Path={name:"Path",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Ce}(),Ne={};var Ie,Pe=function(){if(Oe)return Ne;Oe=1;const{Curve:e}=pe();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Vector2,i=new r({type:{type:String,default:"Curve"},arcLengthDivisions:Number},{id:!1,_id:!1}),o=new r({curves:[i],autoClose:{type:Boolean,default:!1},currentPoint:n},{id:!1,_id:!1});t=new r({curves:[i],autoClose:{type:Boolean,default:!1},currentPoint:n,uuid:String,holes:[o]})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("Shape",n(t))}return Ne.Shape={name:"Shape",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Ne}(),Ge={};var Le,Ae=function(){if(Ie)return Ge;Ie=1;const{Curve:e}=pe();let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({aX:Number,aY:Number,xRadius:Number,yRadius:Number,aStartAngle:Number,aEndAngle:Number,aClockwise:Boolean,aRotation:Number})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("ArcCurve",n(t))}return Ge.ArcCurve={name:"ArcCurve",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Ge}(),Re={};var ze,Ue=function(){if(Le)return Re;Le=1;const{Curve:e}=pe();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Vector3;t=new r({points:[n],closed:Boolean,curveType:String,tension:Number})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("CatmullRomCurve3",n(t))}return Re.CatmullRomCurve3={name:"CatmullRomCurve3",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Re}(),Ee={};var ke,He=function(){if(ze)return Ee;ze=1;const{Curve:e}=pe();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Vector2;t=new r({v0:n,v1:n,v2:n,v3:n})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("CubicBezierCurve",n(t))}return Ee.CubicBezierCurve={name:"CubicBezierCurve",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Ee}(),Ve={};var je,$e=function(){if(ke)return Ve;ke=1;const{Curve:e}=pe();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Vector3;t=new r({v0:n,v1:n,v2:n,v3:n})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("CubicBezierCurve3",n(t))}return Ve.CubicBezierCurve3={name:"CubicBezierCurve3",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Ve}(),Ye=pe(),We={};var Xe,Ze=function(){if(je)return We;je=1;const{Curve:e}=pe();let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("CurveExtras",n(t))}return We.CurveExtras={name:"CurveExtras",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},We}(),qe={};var Ke,Qe=function(){if(Xe)return qe;Xe=1;const{Curve:e}=pe();let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({aX:Number,aY:Number,xRadius:Number,yRadius:Number,aStartAngle:Number,aEndAngle:Number,aClockwise:Boolean,aRotation:Number})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("EllipseCurve",n(t))}return qe.EllipseCurve={name:"EllipseCurve",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},qe}(),Je={};var et,tt=function(){if(Ke)return Je;Ke=1;const{Curve:e}=pe();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Vector2;t=new r({v0:n,v1:n})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("LineCurve",n(t))}return Je.LineCurve={name:"LineCurve",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Je}(),rt={};var nt,it=function(){if(et)return rt;et=1;const{Curve:e}=pe();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Vector3;t=new r({v0:n,v1:n})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("LineCurve3",n(t))}return rt.LineCurve3={name:"LineCurve3",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},rt}(),ot={};var at,st=function(){if(nt)return ot;nt=1;const{Curve:e}=pe();let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("NURBSCurve",n(t))}return ot.NURBSCurve={name:"NURBSCurve",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},ot}(),ct={};var ut,ht=function(){if(at)return ct;at=1;const{Curve:e}=pe();let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("NURBSSurface",n(t))}return ct.NURBSSurface={name:"NURBSSurface",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},ct}(),lt={};var dt,mt=function(){if(ut)return lt;ut=1;const{Curve:e}=pe();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Vector2;t=new r({v0:n,v1:n,v2:n})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("QuadraticBezierCurve",n(t))}return lt.QuadraticBezierCurve={name:"QuadraticBezierCurve",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},lt}(),ft={};var gt,pt=function(){if(dt)return ft;dt=1;const{Curve:e}=pe();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Vector3;t=new r({v0:n,v1:n,v2:n})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("QuadraticBezierCurve3",n(t))}return ft.QuadraticBezierCurve3={name:"QuadraticBezierCurve3",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},ft}(),_t={};var yt,St=function(){if(gt)return _t;gt=1;const{Curve:e}=pe();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Vector3;t=new r({points:[n]})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("SplineCurve",n(t))}return _t.SplineCurve={name:"SplineCurve",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},_t}(),Mt={},bt=C(me);var wt,Ft=function(){if(yt)return Mt;yt=1;const{BufferGeometry:e}=bt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("BoxBufferGeometry",n(t))}return Mt.BoxBufferGeometry={name:"BoxBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Mt}(),Tt={},vt=C(xe);var Bt,xt=function(){if(wt)return Tt;wt=1;const{Geometry:e}=vt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("BoxGeometry",n(t))}return Tt.BoxGeometry={name:"BoxGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Tt}(),Ct={};var Ot,Dt=function(){if(Bt)return Ct;Bt=1;const{BufferGeometry:e}=bt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("CircleBufferGeometry",n(t))}return Ct.CircleBufferGeometry={name:"CircleBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Ct}(),Nt={};var It,Pt=function(){if(Ot)return Nt;Ot=1;const{Geometry:e}=vt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("CircleGeometry",n(t))}return Nt.CircleGeometry={name:"CircleGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Nt}(),Gt={};var Lt,At=function(){if(It)return Gt;It=1;const{BufferGeometry:e}=bt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("ConeBufferGeometry",n(t))}return Gt.ConeBufferGeometry={name:"ConeBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Gt}(),Rt={};var zt,Ut=function(){if(Lt)return Rt;Lt=1;const{Geometry:e}=vt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("ConeGeometry",n(t))}return Rt.ConeGeometry={name:"ConeGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Rt}(),Et={};var kt,Ht=function(){if(zt)return Et;zt=1;const{Geometry:e}=vt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("ConvexGeometry",n(t))}return Et.ConvexGeometry={name:"ConvexGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Et}(),Vt={};var jt,$t=function(){if(kt)return Vt;kt=1;const{BufferGeometry:e}=bt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("CylinderBufferGeometry",n(t))}return Vt.CylinderBufferGeometry={name:"CylinderBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Vt}(),Yt={};var Wt,Xt=function(){if(jt)return Yt;jt=1;const{Geometry:e}=vt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("CylinderGeometry",n(t))}return Yt.CylinderGeometry={name:"CylinderGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Yt}(),Zt={};var qt,Kt=function(){if(Wt)return Zt;Wt=1;const{Geometry:e}=vt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("DecalGeometry",n(t))}return Zt.DecalGeometry={name:"DecalGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Zt}(),Qt={};var Jt,er=function(){if(qt)return Qt;qt=1;const{Geometry:e}=vt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("DodecahedronGeometry",n(t))}return Qt.DodecahedronGeometry={name:"DodecahedronGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Qt}(),tr={};var rr,nr=function(){if(Jt)return tr;Jt=1;const{Geometry:e}=vt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("EdgesGeometry",n(t))}return tr.EdgesGeometry={name:"EdgesGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},tr}(),ir={};var or,ar=function(){if(rr)return ir;rr=1;const{BufferGeometry:e}=bt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("ExtrudeBufferGeometry",n(t))}return ir.ExtrudeBufferGeometry={name:"ExtrudeBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},ir}(),sr={};var cr,ur=function(){if(or)return sr;or=1;const{Geometry:e}=vt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("ExtrudeGeometry",n(t))}return sr.ExtrudeGeometry={name:"ExtrudeGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},sr}(),hr={};var lr,dr=function(){if(cr)return hr;cr=1;const{BufferGeometry:e}=bt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("IcosahedronBufferGeometry",n(t))}return hr.IcosahedronBufferGeometry={name:"IcosahedronBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},hr}(),mr={};var fr,gr=function(){if(lr)return mr;lr=1;const{Geometry:e}=vt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("IcosahedronGeometry",n(t))}return mr.IcosahedronGeometry={name:"IcosahedronGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},mr}(),pr={};var _r,yr=function(){if(fr)return pr;fr=1;const{BufferGeometry:e}=bt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("InstancedBufferGeometry",n(t))}return pr.InstancedBufferGeometry={name:"InstancedBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},pr}(),Sr={};var Mr,br=function(){if(_r)return Sr;_r=1;const{BufferGeometry:e}=bt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("LatheBufferGeometry",n(t))}return Sr.LatheBufferGeometry={name:"LatheBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Sr}(),wr={};var Fr,Tr=function(){if(Mr)return wr;Mr=1;const{Geometry:e}=vt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("LatheGeometry",n(t))}return wr.LatheGeometry={name:"LatheGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},wr}(),vr={};var Br,xr=function(){if(Fr)return vr;Fr=1;const{BufferGeometry:e}=bt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("OctahedronBufferGeometry",n(t))}return vr.OctahedronBufferGeometry={name:"OctahedronBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},vr}(),Cr={};var Or,Dr=function(){if(Br)return Cr;Br=1;const{Geometry:e}=vt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("OctahedronGeometry",n(t))}return Cr.OctahedronGeometry={name:"OctahedronGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Cr}(),Nr={};var Ir,Pr=function(){if(Or)return Nr;Or=1;const{BufferGeometry:e}=bt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("ParametricBufferGeometry",n(t))}return Nr.ParametricBufferGeometry={name:"ParametricBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Nr}(),Gr={};var Lr,Ar=function(){if(Ir)return Gr;Ir=1;const{Geometry:e}=vt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("ParametricGeometry",n(t))}return Gr.ParametricGeometry={name:"ParametricGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Gr}(),Rr={};var zr,Ur=function(){if(Lr)return Rr;Lr=1;const{BufferGeometry:e}=bt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("PlaneBufferGeometry",n(t))}return Rr.PlaneBufferGeometry={name:"PlaneBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Rr}(),Er={};var kr,Hr=function(){if(zr)return Er;zr=1;const{Geometry:e}=vt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("PlaneGeometry",n(t))}return Er.PlaneGeometry={name:"PlaneGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Er}(),Vr={};var jr,$r=function(){if(kr)return Vr;kr=1;const{BufferGeometry:e}=bt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("PolyhedronBufferGeometry",n(t))}return Vr.PolyhedronBufferGeometry={name:"PolyhedronBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Vr}(),Yr={};var Wr,Xr=function(){if(jr)return Yr;jr=1;const{Geometry:e}=vt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("PolyhedronGeometry",n(t))}return Yr.PolyhedronGeometry={name:"PolyhedronGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Yr}(),Zr={};var qr,Kr=function(){if(Wr)return Zr;Wr=1;const{BufferGeometry:e}=bt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("RingBufferGeometry",n(t))}return Zr.RingBufferGeometry={name:"RingBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Zr}(),Qr={};var Jr,en=function(){if(qr)return Qr;qr=1;const{Geometry:e}=vt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("RingGeometry",n(t))}return Qr.RingGeometry={name:"RingGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Qr}(),tn={};var rn,nn=function(){if(Jr)return tn;Jr=1;const{BufferGeometry:e}=bt;let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Vector2,i=new r({type:{type:String,default:"Curve"},arcLengthDivisions:Number},{id:!1,_id:!1}),o=new r({curves:[i],autoClose:{type:Boolean,default:!1},currentPoint:n},{id:!1,_id:!1}),a=new r({curves:[i],autoClose:{type:Boolean,default:!1},currentPoint:n,uuid:String,holes:[o]},{id:!1,_id:!1});t=new r({shapes:[a],curveSegments:Number})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("ShapeBufferGeometry",n(t))}return tn.ShapeBufferGeometry={name:"ShapeBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},tn}(),on={};var an,sn=function(){if(rn)return on;rn=1;const{Geometry:e}=vt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("ShapeGeometry",n(t))}return on.ShapeGeometry={name:"ShapeGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},on}(),cn={};var un,hn=function(){if(an)return cn;an=1;const{BufferGeometry:e}=bt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("SphereBufferGeometry",n(t))}return cn.SphereBufferGeometry={name:"SphereBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},cn}(),ln={};var dn,mn=function(){if(un)return ln;un=1;const{Geometry:e}=vt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("SphereGeometry",n(t))}return ln.SphereGeometry={name:"SphereGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},ln}(),fn={};var gn,pn=function(){if(dn)return fn;dn=1;const{BufferGeometry:e}=bt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("TeapotBufferGeometry",n(t))}return fn.TeapotBufferGeometry={name:"TeapotBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},fn}(),_n={};var yn,Sn=function(){if(gn)return _n;gn=1;const{BufferGeometry:e}=bt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("TetrahedronBufferGeometry",n(t))}return _n.TetrahedronBufferGeometry={name:"TetrahedronBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},_n}(),Mn={};var bn,wn=function(){if(yn)return Mn;yn=1;const{Geometry:e}=vt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("TetrahedronGeometry",n(t))}return Mn.TetrahedronGeometry={name:"TetrahedronGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Mn}(),Fn={};var Tn,vn=function(){if(bn)return Fn;bn=1;const{BufferGeometry:e}=bt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("TextBufferGeometry",n(t))}return Fn.TextBufferGeometry={name:"TextBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Fn}(),Bn={};var xn,Cn=function(){if(Tn)return Bn;Tn=1;const{Geometry:e}=vt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("TextGeometry",n(t))}return Bn.TextGeometry={name:"TextGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Bn}(),On={};var Dn,Nn=function(){if(xn)return On;xn=1;const{BufferGeometry:e}=bt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("TorusBufferGeometry",n(t))}return On.TorusBufferGeometry={name:"TorusBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},On}(),In={};var Pn,Gn=function(){if(Dn)return In;Dn=1;const{Geometry:e}=vt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("TorusGeometry",n(t))}return In.TorusGeometry={name:"TorusGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},In}(),Ln={};var An,Rn=function(){if(Pn)return Ln;Pn=1;const{BufferGeometry:e}=bt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("TorusKnotBufferGeometry",n(t))}return Ln.TorusKnotBufferGeometry={name:"TorusKnotBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Ln}(),zn={};var Un,En=function(){if(An)return zn;An=1;const{Geometry:e}=vt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("TorusKnotGeometry",n(t))}return zn.TorusKnotGeometry={name:"TorusKnotGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},zn}(),kn={};var Hn,Vn=function(){if(Un)return kn;Un=1;const{BufferGeometry:e}=bt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("TubeBufferGeometry",n(t))}return kn.TubeBufferGeometry={name:"TubeBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},kn}(),jn={};var $n,Yn=function(){if(Hn)return jn;Hn=1;const{Geometry:e}=vt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("TubeGeometry",n(t))}return jn.TubeGeometry={name:"TubeGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},jn}(),Wn={};var Xn,Zn=function(){if($n)return Wn;$n=1;const{Geometry:e}=vt;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("WireframeGeometry",n(t))}return Wn.WireframeGeometry={name:"WireframeGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Wn}(),qn={};var Kn,Qn=function(){if(Xn)return qn;Xn=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("ArrowHelper",n(t))}return qn.ArrowHelper={name:"ArrowHelper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},qn}(),Jn={};var ei,ti=function(){if(Kn)return Jn;Kn=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("AxesHelper",n(t))}return Jn.AxesHelper={name:"AxesHelper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Jn}(),ri={};var ni,ii=function(){if(ei)return ri;ei=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("Box3Helper",n(t))}return ri.Box3Helper={name:"Box3Helper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},ri}(),oi={};var ai,si=function(){if(ni)return oi;ni=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("BoxHelper",n(t))}return oi.BoxHelper={name:"BoxHelper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},oi}(),ci={};var ui,hi=function(){if(ai)return ci;ai=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("CameraHelper",n(t))}return ci.CameraHelper={name:"CameraHelper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},ci}(),li={};var di,mi=function(){if(ui)return li;ui=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("DirectionalLightHelper",n(t))}return li.DirectionalLightHelper={name:"DirectionalLightHelper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},li}(),fi={};var gi,pi=function(){if(di)return fi;di=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("FaceNormalsHelper",n(t))}return fi.FaceNormalsHelper={name:"FaceNormalsHelper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},fi}(),_i={};var yi,Si=function(){if(gi)return _i;gi=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("GridHelper",n(t))}return _i.GridHelper={name:"GridHelper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},_i}(),Mi={};var bi,wi=function(){if(yi)return Mi;yi=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("HemisphereLightHelper",n(t))}return Mi.HemisphereLightHelper={name:"HemisphereLightHelper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Mi}(),Fi={};var Ti,vi=function(){if(bi)return Fi;bi=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("PlaneHelper",n(t))}return Fi.PlaneHelper={name:"PlaneHelper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Fi}(),Bi={};var xi,Ci=function(){if(Ti)return Bi;Ti=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("PointLightHelper",n(t))}return Bi.PointLightHelper={name:"PointLightHelper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Bi}(),Oi={};var Di,Ni=function(){if(xi)return Oi;xi=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("PolarGridHelper",n(t))}return Oi.PolarGridHelper={name:"PolarGridHelper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Oi}(),Ii={};var Pi,Gi=function(){if(Di)return Ii;Di=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("RectAreaLightHelper",n(t))}return Ii.RectAreaLightHelper={name:"RectAreaLightHelper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Ii}(),Li={};var Ai,Ri=function(){if(Pi)return Li;Pi=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("SkeletonHelper",n(t))}return Li.SkeletonHelper={name:"SkeletonHelper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Li}(),zi={};var Ui,Ei=function(){if(Ai)return zi;Ai=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("SpotLightHelper",n(t))}return zi.SpotLightHelper={name:"SpotLightHelper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},zi}(),ki={};var Hi,Vi=function(){if(Ui)return ki;Ui=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("VertexNormalsHelper",n(t))}return ki.VertexNormalsHelper={name:"VertexNormalsHelper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},ki}(),ji={};var $i,Yi=function(){if(Hi)return ji;Hi=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("AmbientLight",n(t))}return ji.AmbientLight={name:"AmbientLight",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},ji}(),Wi={};var Xi,Zi=function(){if($i)return Wi;$i=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("DirectionalLight",n(t))}return Wi.DirectionalLight={name:"DirectionalLight",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Wi}(),qi={};var Ki,Qi=function(){if(Xi)return qi;Xi=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("HemisphereLight",n(t))}return qi.HemisphereLight={name:"HemisphereLight",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},qi}(),Ji={};var eo,to=function(){if(Ki)return Ji;Ki=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("Light",n(t))}return Ji.Light={name:"Light",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Ji}(),ro={};var no,io=function(){if(eo)return ro;eo=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("PointLight",n(t))}return ro.PointLight={name:"PointLight",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},ro}(),oo={};var ao,so=function(){if(no)return oo;no=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("RectAreaLight",n(t))}return oo.RectAreaLight={name:"RectAreaLight",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},oo}(),co={};var uo,ho,lo=function(){if(ao)return co;ao=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("SpotLight",n(t))}return co.SpotLight={name:"SpotLight",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},co}(),mo={},fo={};function go(){if(uo)return fo;let e,t;function r(t){return e||function(t){const r=t.Schema,n=r.Types.Mixed;e=new r({uuid:String,name:String,type:String,fog:Boolean,lights:Boolean,blending:Number,side:Number,flatShading:Boolean,vertexColors:Number,opacity:Number,transparent:Boolean,blendSrc:Number,blendDst:Number,blendEquation:Number,blendSrcAlpha:String,blendDstAlpha:String,blendEquationAlpha:String,depthFunc:Number,depthTest:Boolean,depthWrite:Boolean,clippingPlanes:n,clipIntersection:Boolean,clipShadows:Boolean,colorWrite:Boolean,precision:Number,polygonOffset:Boolean,polygonOffsetFactor:Number,polygonOffsetUnits:Number,dithering:Boolean,alphaTest:Number,premultipliedAlpha:Boolean,overdraw:Number,visible:Boolean,userData:n,needsUpdate:Boolean},{collection:"materials",discriminatorKey:"type"})}(t),e}function n(e){t=e.model("Materials",r(e)),t.discriminator("Material",new e.Schema({}))}return uo=1,fo.Material={name:"Material",getSchemaFrom:r,getModelFrom:function(e){return t||n(e),t},registerModelTo:function(e){return t||n(e),e}},fo}
/**
 * @module Schemas/Materials/LineBasicMaterial
 * @desc Export the ThreeJs LineBasicMaterial Model and Schema for Mongoose.
 *
 * @requires {@link module:Schemas/Materials/Material Schemas/Materials/Material}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */var po,_o=function(){if(ho)return mo;ho=1;const{Material:e}=go();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Color;t=new r({color:n,light:Boolean,lineWidth:Number,linecap:String,linejoin:String})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("LineBasicMaterial",n(t))}return mo.LineBasicMaterial={name:"LineBasicMaterial",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},mo}(),yo={};var So,Mo=function(){if(po)return yo;po=1;const{Material:e}=go();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Color;t=new r({color:n,light:Boolean,lineWidth:Number,linecap:String,linejoin:String,dashSize:Number,gapSize:Number,scale:Number})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("LineDashedMaterial",n(t))}return yo.LineDashedMaterial={name:"LineDashedMaterial",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},yo}(),bo=go(),wo={};var Fo,To=function(){if(So)return wo;So=1;const{Material:e}=go();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types,i=n.Mixed,o=n.Color;t=new r({color:o,map:i,lightMap:i,lightMapIntensity:Number,aoMap:i,aoMapIntensity:Number,specularMap:i,alphaMap:i,envMap:i,combine:Number,reflectivity:Number,refractionRatio:Number,wireframe:Boolean,wireframeLinewidth:Number,wireframeLinecap:String,wireframeLinejoin:String,skinning:Boolean,morphTargets:Boolean,light:Boolean})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("MeshBasicMaterial",n(t))}return wo.MeshBasicMaterial={name:"MeshBasicMaterial",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},wo}(),vo={};var Bo,xo=function(){if(Fo)return vo;Fo=1;const{Material:e}=go();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Mixed;t=new r({depthPacking:Number,skinning:Boolean,morphTargets:Boolean,map:n,alphaMap:n,displacementMap:n,displacementScale:Number,displacementBias:Number,wireframe:Boolean,wireframeLinewidth:Number,fog:Boolean,light:Boolean})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("MeshDepthMaterial",n(t))}return vo.MeshDepthMaterial={name:"MeshDepthMaterial",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},vo}(),Co={};var Oo,Do=function(){if(Bo)return Co;Bo=1;const{Material:e}=go();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types,i=n.Color,o=n.Mixed;t=new r({color:i,map:o,lightMap:o,lightMapIntensity:Number,aoMap:o,aoMapIntensity:Number,emissive:i,emissiveIntensity:Number,emissiveMap:o,specularMap:o,alphaMap:o,envMap:o,combine:Number,reflectivity:Number,refractionRatio:Number,wireframe:Boolean,wireframeLinewidth:Number,wireframeLinecap:String,wireframeLinejoin:String,skinning:Boolean,morphTargets:Boolean,morphNormals:Boolean})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("MeshLambertMaterial",n(t))}return Co.MeshLambertMaterial={name:"MeshLambertMaterial",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Co}(),No={};var Io,Po=function(){if(Oo)return No;Oo=1;const{Material:e}=go();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types,i=n.Mixed,o=n.Vector2;t=new r({bumpMap:i,bumpScale:Number,normalMap:i,normalScale:o,displacementMap:i,displacementScale:Number,displacementBias:Number,wireframe:Boolean,wireframeLinewidth:Number,fog:Boolean,light:Boolean,skinning:Boolean,morphTargets:Boolean,morphNormals:Boolean})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("MeshNormalMaterial",n(t))}return No.MeshNormalMaterial={name:"MeshNormalMaterial",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},No}(),Go={};var Lo,Ao=function(){if(Io)return Go;Io=1;const{Material:e}=go();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types,i=n.Mixed,o=n.Color,a=n.Vector2;t=new r({color:o,specular:o,shininess:Number,map:i,lightMap:i,lightMapIntensity:Number,aoMap:i,aoMapIntensity:Number,emissive:o,emissiveIntensity:Number,emissiveMap:i,bumpMap:i,bumpScale:Number,normalMap:i,normalScale:a,displacementMap:i,displacementScale:Number,displacementBias:Number,specularMap:i,alphaMap:i,envMap:i,combine:Number,reflectivity:Number,refractionRatio:Number,wireframe:Boolean,wireframeLinewidth:Number,wireframeLinecap:String,wireframeLinejoin:String,skinning:Boolean,morphTargets:Boolean,morphNormals:Boolean})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("MeshPhongMaterial",n(t))}return Go.MeshPhongMaterial={name:"MeshPhongMaterial",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Go}(),Ro={};var zo,Uo=function(){if(Lo)return Ro;Lo=1;const{Material:e}=go();let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({reflectivity:Number,clearCoat:Number,clearCoatRoughness:Number})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("MeshPhysicalMaterial",n(t))}return Ro.MeshPhysicalMaterial={name:"MeshPhysicalMaterial",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Ro}(),Eo={};var ko,Ho=function(){if(zo)return Eo;zo=1;const{Material:e}=go();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types,i=n.Mixed,o=n.Color,a=n.Vector2;t=new r({color:o,roughness:Number,metalness:Number,map:i,lightMap:i,lightMapIntensity:Number,aoMap:i,aoMapIntensity:Number,emissive:o,emissiveIntensity:Number,emissiveMap:i,bumpMap:i,bumpScale:Number,normalMap:i,normalScale:a,displacementMap:i,displacementScale:Number,displacementBias:Number,roughnessMap:i,metalnessMap:i,alphaMap:i,envMap:i,envMapIntensity:Number,refractionRatio:Number,wireframe:Boolean,wireframeLinewidth:Number,wireframeLinecap:String,wireframeLinejoin:String,skinning:Boolean,morphTargets:Boolean,morphNormals:Boolean})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("MeshStandardMaterial",n(t))}return Eo.MeshStandardMaterial={name:"MeshStandardMaterial",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Eo}(),Vo={};var jo,$o=function(){if(ko)return Vo;ko=1;const{Material:e}=go();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types,i=n.Mixed,o=n.Color,a=n.Vector2;t=new r({color:o,specular:o,shininess:Number,map:i,lightMap:i,lightMapIntensity:Number,aoMap:i,aoMapIntensity:Number,emissive:o,emissiveIntensity:Number,emissiveMap:i,bumpMap:i,bumpScale:Number,normalMap:i,normalScale:a,displacementMap:i,displacementScale:Number,displacementBias:Number,specularMap:i,alphaMap:i,envMap:i,combine:Number,reflectivity:Number,refractionRatio:Number,wireframe:Boolean,wireframeLinewidth:Number,wireframeLinecap:String,wireframeLinejoin:String,skinning:Boolean,morphTargets:Boolean,morphNormals:Boolean,gradientMap:i})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("MeshToonMaterial",n(t))}return Vo.MeshToonMaterial={name:"MeshToonMaterial",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Vo}(),Yo={};var Wo,Xo=function(){if(jo)return Yo;jo=1;const{Material:e}=go();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types,i=n.Color,o=n.Mixed;t=new r({color:i,map:o,size:Number,sizeAttenuation:Boolean,lights:Boolean})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("PointsMaterial",n(t))}return Yo.PointsMaterial={name:"PointsMaterial",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Yo}(),Zo={};var qo,Ko=function(){if(Wo)return Zo;Wo=1;const{Material:e}=go();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Mixed;t=new r({defines:n,uniforms:n,vertexShader:String,fragmentShader:String,linewidth:Number,wireframe:Boolean,wireframeLinewidth:Number,fog:Boolean,light:Boolean,clipping:Boolean,skinning:Boolean,morphTargets:Boolean,morphNormals:Boolean,derivatives:Boolean,fragDepth:Boolean,drawBuffers:Boolean,shaderTextureLOD:Boolean})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("RawShaderMaterial",n(t))}return Zo.RawShaderMaterial={name:"RawShaderMaterial",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Zo}(),Qo={};var Jo,ea=function(){if(qo)return Qo;qo=1;const{Material:e}=go();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Mixed;t=new r({defines:n,uniforms:n,vertexShader:String,fragmentShader:String,linewidth:Number,wireframe:Boolean,wireframeLinewidth:Number,fog:Boolean,light:Boolean,clipping:Boolean,skinning:Boolean,morphTargets:Boolean,morphNormals:Boolean,derivatives:Boolean,fragDepth:Boolean,drawBuffers:Boolean,shaderTextureLOD:Boolean})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("ShaderMaterial",n(t))}return Qo.ShaderMaterial={name:"ShaderMaterial",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Qo}(),ta={};var ra,na=function(){if(Jo)return ta;Jo=1;const{Material:e}=go();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Color;t=new r({color:n,opacity:Number,lights:Boolean,transparent:Boolean})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("ShadowMaterial",n(t))}return ta.ShadowMaterial={name:"ShadowMaterial",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},ta}(),ia={};var oa,aa=function(){if(ra)return ia;ra=1;const{Material:e}=go();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types,i=n.Color,o=n.Mixed;t=new r({color:i,map:o,rotation:Number,fog:Boolean,lights:Boolean})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("SpriteMaterial",n(t))}return ia.SpriteMaterial={name:"SpriteMaterial",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},ia}(),sa={};var ca,ua=function(){if(oa)return sa;let e;return oa=1,sa.Box2={name:"Box2",getSchemaFrom:function(t){return e||function(t){const r=t.Schema,n=r.Types.Vector2;e=new r({min:n,max:n},{_id:!1,id:!1})}(t),e},getModelFrom:()=>null,registerModelTo:e=>e},sa}(),ha={};var la,da=function(){if(ca)return ha;let e;return ca=1,ha.Box3={name:"Box3",getSchemaFrom:function(t){return e||function(t){const r=t.Schema,n=r.Types.Vector3;e=new r({min:n,max:n},{_id:!1,id:!1})}(t),e},getModelFrom:()=>null,registerModelTo:e=>e},ha}(),ma={};var fa,ga=function(){if(la)return ma;let e;return la=1,ma.Line3={name:"Line3",getSchemaFrom:function(t){return e||function(t){const r=t.Schema,n=r.Types.Vector3;e=new r({start:n,end:n},{_id:!1,id:!1})}(t),e},getModelFrom:()=>null,registerModelTo:e=>e},ma}(),pa={};var _a,ya=function(){if(fa)return pa;let e;return fa=1,pa.Plane={name:"Plane",getSchemaFrom:function(t){return e||function(t){const r=t.Schema,n=r.Types.Vector3;e=new r({normal:n,constant:Number},{_id:!1,id:!1})}(t),e},getModelFrom:()=>null,registerModelTo:e=>e},pa}(),Sa={};var Ma,ba=function(){if(_a)return Sa;let e;return _a=1,Sa.Ray={name:"Ray",getSchemaFrom:function(t){return e||function(t){const r=t.Schema,n=r.Types.Vector3;e=new r({origin:n,direction:n},{_id:!1,id:!1})}(t),e},getModelFrom:()=>null,registerModelTo:e=>e},Sa}(),wa={};var Fa,Ta=function(){if(Ma)return wa;let e;return Ma=1,wa.Sphere={name:"Sphere",getSchemaFrom:function(t){return e||function(t){const r=t.Schema,n=r.Types.Vector3;e=new r({center:n,radius:Number},{_id:!1,id:!1})}(t),e},getModelFrom:()=>null,registerModelTo:e=>e},wa}(),va={};var Ba,xa=function(){if(Fa)return va;let e;return Fa=1,va.Spherical={name:"Spherical",getSchemaFrom:function(t){return e||function(t){const r=t.Schema;e=new r({radius:Number,phi:Number,theta:Number},{_id:!1,id:!1})}(t),e},getModelFrom:()=>null,registerModelTo:e=>e},va}(),Ca={};var Oa,Da=function(){if(Ba)return Ca;let e;return Ba=1,Ca.Triangle={name:"Triangle",getSchemaFrom:function(t){return e||function(t){const r=t.Schema,n=r.Types.Vector3;e=new r({a:n,b:n,c:n},{_id:!1,id:!1})}(t),e},getModelFrom:()=>null,registerModelTo:e=>e},Ca}(),Na={};var Ia=function(){if(Oa)return Na;Oa=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("Bone",n(t))}return Na.Bone={name:"Bone",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Na}();
/**
 * @module Schemas/Objects/Group
 * @desc Export the ThreeJs Group Model and Schema for Mongoose.
 *
 * @requires {@link module:Schemas/Core/Object3D Schemas/Core/Object3D}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */let Pa,Ga;function La(e){return Pa||function(e){const t=e.Schema;Pa=new t({})}(e),Pa}function Aa(e){const t=D.getModelFrom(e);Ga=t.discriminator("Group",La(e))}const Ra={name:"Group",getSchemaFrom:La,getModelFrom:function(e){return Ga||Aa(e),Ga},registerModelTo:function(e){return Ga||Aa(e),e}};var za,Ua={};
/**
 * @module Schemas/Objects/ImmediateRenderObject
 * @desc Export the ThreeJs ImmediateRenderObject Model and Schema for Mongoose.
 *
 * @requires {@link module:Schemas/Core/Object3D Schemas/Core/Object3D}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */var Ea,ka=function(){if(za)return Ua;za=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("ImmediateRenderObject",n(t))}return Ua.ImmediateRenderObject={name:"ImmediateRenderObject",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Ua}(),Ha={};var Va,ja=function(){if(Ea)return Ha;Ea=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types,i=n.ObjectId,o=n.Color,a=n.Vector3;t=new r({lensFlares:[{texture:i,size:Number,distance:Number,x:Number,y:Number,z:Number,scale:Number,rotation:Number,opacity:Number,color:o,blending:Number}],positionScreen:a})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("LensFlare",n(t))}return Ha.LensFlare={name:"LensFlare",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Ha}(),$a={};var Ya,Wa=function(){if(Va)return $a;Va=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.ObjectId;t=new r({geometry:{type:n,ref:"Geometry"},material:[{type:n,ref:"LineBasicMaterial"}],drawMode:Number})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("Line",n(t))}return $a.Line={name:"Line",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},$a}(),Xa={};var Za,qa=function(){if(Ya)return Xa;Ya=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.ObjectId;t=new r({geometry:{type:n,ref:"Geometry"},material:[{type:n,ref:"LineBasicMaterial"}],drawMode:Number})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("LineLoop",n(t))}return Xa.LineLoop={name:"LineLoop",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Xa}(),Ka={};var Qa,Ja=function(){if(Za)return Ka;Za=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.ObjectId;t=new r({geometry:{type:n,ref:"Geometry"},material:[{type:n,ref:"LineBasicMaterial"}],drawMode:Number})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("LineSegments",n(t))}return Ka.LineSegments={name:"LineSegments",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Ka}(),es={};var ts,rs=function(){if(Qa)return es;Qa=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Mixed;t=new r({levels:[n]})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("LOD",n(t))}return es.LOD={name:"LOD",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},es}(),ns={};var is,os=function(){if(ts)return ns;ts=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.ObjectId;t=new r({geometry:{type:n,ref:"Geometry"},material:[{type:n,ref:"Material"}],drawMode:Number})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("Mesh",n(t))}return ns.Mesh={name:"Mesh",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},ns}(),as={};var ss,cs=function(){if(is)return as;is=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.ObjectId;t=new r({geometry:{type:n,ref:"Geometry"},material:[{type:n,ref:"PointsMaterial"}],drawMode:Number})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("Points",n(t))}return as.Points={name:"Points",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},as}(),us={};var hs,ls=function(){if(ss)return us;ss=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.ObjectId;t=new r({bones:[n],boneMatrices:[Number]})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("Skeleton",n(t))}return us.Skeleton={name:"Skeleton",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},us}(),ds={};var ms,fs=function(){if(hs)return ds;hs=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.ObjectId;t=new r({geometry:{type:n,ref:"Geometry"},material:[{type:n,ref:"Material"}],drawMode:Number,bindMode:String,bindMatrix:[Number],bindMatrixInverse:[Number]})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("SkinnedMesh",n(t))}return ds.SkinnedMesh={name:"SkinnedMesh",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},ds}(),gs={};var ps,_s=function(){if(ms)return gs;ms=1;const{Object3D:e}=I;let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.ObjectId;t=new r({material:[{type:n,ref:"SpriteMaterial"}]})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("Sprite",n(t))}return gs.Sprite={name:"Sprite",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},gs}(),ys={};function Ss(){if(ps)return ys;ps=1;const{Buffer:e}=ne();let t;return ys.Fog={name:"Fog",getSchemaFrom:function(r){return t||function(r){const n=r.Schema;t=new n({coordinates:{x:Number,y:Number,z:Number},orientation:{x:Number,y:Number,z:Number},thumbnail:e,path:String},{_id:!1,id:!1})}(r),t},getModelFrom:()=>null,registerModelTo:e=>e},ys}var Ms,bs=Ss(),ws={};var Fs,Ts,vs=function(){if(Ms)return ws;Ms=1;const{Object3D:e}=I,{Fog:t}=Ss();let r,n;function i(e){return r||function(e){const n=t.getSchemaFrom(e),i=e.Schema,o=i.Types.Color;r=new i({background:o,fog:n,overrideMaterial:String,autoUpdate:Boolean})}(e),r}function o(t){const r=e.getModelFrom(t);n=r.discriminator("Scene",i(t))}return ws.Scene={name:"Scene",getSchemaFrom:i,getModelFrom:function(e){return n||o(e),n},registerModelTo:function(e){return n||o(e),e}},ws}(),Bs={},xs={};function Cs(){if(Fs)return xs;let e,t;function r(t){return e||function(t){const r=t.Schema,n=r.Types,i=n.ObjectId,o=n.Vector2,a=n.Matrix3;e=new r({uuid:String,name:String,image:i,mipmaps:[],mapping:Number,wrapS:Number,wrapT:Number,magFilter:Number,minFilter:Number,anisotropy:Number,format:Number,type:Number,offset:o,repeat:o,center:o,rotation:Number,matrixAutoUpdate:Boolean,matrix:a,generateMipmaps:Boolean,premultiplyAlpha:Boolean,flipY:Boolean,unpackAlignment:Number,encoding:Number,version:Number},{collection:"textures",discriminatorKey:"type"})}(t),e}function n(e){t=e.model("Textures",r(e)),t.discriminator("Texture",new e.Schema({}))}return Fs=1,xs.Texture={name:"Texture",getSchemaFrom:r,getModelFrom:function(e){return t||n(e),t},registerModelTo:function(e){return t||n(e),e}},xs}
/**
 * @module Schemas/Textures/CanvasTexture
 * @desc Export the ThreeJs CanvasTexture Model and Schema for Mongoose.
 *
 * @requires {@link module:Schemas/Textures/Texture Schemas/Textures/Texture}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */var Os,Ds=function(){if(Ts)return Bs;Ts=1;const{Texture:e}=Cs();let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({needsUpdate:Boolean})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("CanvasTexture",n(t))}return Bs.CanvasTexture={name:"CanvasTexture",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Bs}(),Ns={};var Is,Ps=function(){if(Os)return Ns;Os=1;const{Texture:e}=Cs();let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("CompressedTexture",n(t))}return Ns.CompressedTexture={name:"CompressedTexture",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Ns}(),Gs={};var Ls,As=function(){if(Is)return Gs;Is=1;const{Texture:e}=Cs();let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("CubeTexture",n(t))}return Gs.CubeTexture={name:"CubeTexture",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Gs}(),Rs={};var zs,Us=function(){if(Ls)return Rs;Ls=1;const{Texture:e}=Cs();let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("DataTexture",n(t))}return Rs.DataTexture={name:"DataTexture",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Rs}(),Es={};var ks,Hs=function(){if(zs)return Es;zs=1;const{Texture:e}=Cs();let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("DepthTexture",n(t))}return Es.DepthTexture={name:"DepthTexture",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Es}(),Vs=Cs(),js={};var $s=function(){if(ks)return js;ks=1;const{Texture:e}=Cs();let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("VideoTexture",n(t))}return js.VideoTexture={name:"VideoTexture",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},js}();
/**
 * @module Types/Color
 * @desc Export the three js Color type for Mongoose.
 *
 * @requires {@link module: [@itee/validators]{@link https://github.com/Itee/@itee/validators}}
 * @requires {@link module: [bson]{@link https://github.com/mongodb/js-bson}}
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */function Ys(e){class t extends e.SchemaType{constructor(e,t){super(e,t,"Color")}cast(t){if(r.isNotDefined(t))throw new e.SchemaType.CastError(`Color: ${t} is null or undefined`);if(r.isNotObject(t)&&!t.isColor)throw new e.SchemaType.CastError(`Color: ${t} is not a object or Three.Color instance`);if(!("r"in t))throw new e.SchemaType.CastError(`Color: ${t} does not contain r property`);if(r.isNotNumber(t.r))throw new e.SchemaType.CastError(`Color: ${t} expected to be a number`);if(!("g"in t))throw new e.SchemaType.CastError(`Color: ${t} does not contain g property`);if(r.isNotNumber(t.g))throw new e.SchemaType.CastError(`Color: ${t} expected to be a number`);if(!("b"in t))throw new e.SchemaType.CastError(`Color: ${t} does not contain b property`);if(r.isNotNumber(t.b))throw new e.SchemaType.CastError(`Color: ${t} expected to be a number`);return{r:t.r,g:t.g,b:t.b}}}return t.COLOR_BSON_TYPE=c.BSON_DATA_OBJECT,e.Schema.Types.Color=t,e}
/**
 * @module Types/Euler
 * @desc Export the three js Euler type for Mongoose.
 *
 * @requires {@link module: [@itee/validators]{@link https://github.com/Itee/@itee/validators}}
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */function Ws(e){class t extends e.SchemaType{constructor(e,t){super(e,t,"Euler")}cast(t){if(r.isNotDefined(t))throw new e.SchemaType.CastError(`Euler: ${t} is null or undefined`);if(r.isNotObject(t)&&!t.isEuler)throw new e.SchemaType.CastError(`Euler: ${t} is not a object or Euler instance`);if(!("x"in t))throw new e.SchemaType.CastError(`Euler: ${t} does not contain x property`);if(r.isNotNumber(t.x))throw new e.SchemaType.CastError(`Euler: ${t} expected x to be a number`);if(!("y"in t))throw new e.SchemaType.CastError(`Euler: ${t} does not contain y property`);if(r.isNotNumber(t.y))throw new e.SchemaType.CastError(`Euler: ${t} expected y to be a number`);if(!("z"in t))throw new e.SchemaType.CastError(`Euler: ${t} does not contain z property`);if(r.isNotNumber(t.z))throw new e.SchemaType.CastError(`Euler: ${t} expected z to be a number`);if(!("order"in t))throw new e.SchemaType.CastError(`Euler: ${t} does not contain order property`);if(r.isNotString(t.order))throw new e.SchemaType.CastError(`Euler: ${t} expected order to be a string`);if(!["XYZ","YZX","ZXY","XZY","YXZ","ZYX"].includes(t.order.toUpperCase()))throw new e.SchemaType.CastError(`Euler: ${t} expected order to be a string in ['XYZ', 'YZX', 'ZXY', 'XZY', 'YXZ', 'ZYX']`);return{x:t.x,y:t.y,z:t.z,order:t.order.toUpperCase()}}}return t.EULER_BSON_TYPE=c.BSON_DATA_OBJECT,e.Schema.Types.Euler=t,e}
/**
 * @module Types/Matrix3
 * @desc Export the three js Matrix3 type for Mongoose.
 *
 * @requires {@link module: [@itee/validators]{@link https://github.com/Itee/@itee/validators}}
 * @requires {@link module: [bson]{@link https://github.com/mongodb/js-bson}}
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */function Xs(e){class t extends e.SchemaType{constructor(e,t){super(e,t,"Matrix3")}cast(t){if(r.isNotDefined(t))throw new e.SchemaType.CastError(`Matrix3: ${t} is null or undefined`);if(r.isNotArray(t)&&!t.isMatrix3)throw new e.SchemaType.CastError(`Matrix3: ${t} is not an array or Matrix3 instance`);let n;n=t.isMatrix3?t.toArray():t;const i=n.length;if(9!==i)throw new e.SchemaType.CastError(`Matrix3: ${t} does not contain the right number of values. Expect 9 values and found ${i}`);for(let o,a=0;a<i;a++){if(o=n[a],r.isNotNumber(o))throw new e.SchemaType.CastError(`Matrix3: ${t} does not seem to contain right values. Expect values in range 0 and 1.`);if(r.isNaN(o))throw new e.SchemaType.CastError(`Matrix3: ${t} does not seem to contain right values. Expect values in range 0 and 1.`)}return n}}return t.MATRIX3_BSON_TYPE=c.BSON_DATA_ARRAY,e.Schema.Types.Matrix3=t,e}
/**
 * @module Types/Matrix4
 * @desc Export the three js Matrix4 type for Mongoose.
 *
 * @requires {@link module: [@itee/validators]{@link https://github.com/Itee/@itee/validators}}
 * @requires {@link module: [bson]{@link https://github.com/mongodb/js-bson}}
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */function Zs(e){class t extends e.SchemaType{constructor(e,t){super(e,t,"Matrix4")}cast(t){if(r.isNotDefined(t))throw new e.SchemaType.CastError(`Matrix4: ${t} is null or undefined`);if(r.isNotArray(t)&&!t.isMatrix4)throw new e.SchemaType.CastError(`Matrix4: ${t} is not an array or Matrix4 instance`);let n;n=t.isMatrix4?t.toArray():t;const i=n.length;if(16!==i)throw new e.SchemaType.CastError(`Matrix4: ${t} does not contain the right number of values. Expect 9 values and found ${i}`);for(let o,a=0;a<i;a++){if(o=n[a],r.isNotNumber(o))throw new e.SchemaType.CastError(`Matrix4: ${t} does not seem to contain right values. Expect values in range 0 and 1.`);if(r.isNaN(o))throw new e.SchemaType.CastError(`Matrix4: ${t} does not seem to contain right values. Expect values in range 0 and 1.`)}return n}}return t.MATRIX4_BSON_TYPE=c.BSON_DATA_ARRAY,e.Schema.Types.Matrix4=t,e}
/**
 * @module Types/Quaternion
 * @desc Export the three js Quaternion type for Mongoose.
 *
 * @requires {@link module: [@itee/validators]{@link https://github.com/Itee/@itee/validators}}
 * @requires {@link module: [bson]{@link https://github.com/mongodb/js-bson}}
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */function qs(e){class t extends e.SchemaType{constructor(e,t){super(e,t,"Quaternion")}cast(t){if(r.isNotDefined(t))throw new e.SchemaType.CastError(`Quaternion: ${t} is null or undefined`);if(r.isNotObject(t)&&!t.isQuaternion)throw new e.SchemaType.CastError(`Quaternion: ${t} is not a object or Quaternion instance`);if(!("x"in t))throw new e.SchemaType.CastError(`Quaternion: ${t} does not contain x property`);if(r.isNotNumber(t.x))throw new e.SchemaType.CastError(`Quaternion: ${t} expected to be a number`);if(!("y"in t))throw new e.SchemaType.CastError(`Quaternion: ${t} does not contain y property`);if(r.isNotNumber(t.y))throw new e.SchemaType.CastError(`Quaternion: ${t} expected to be a number`);if(!("z"in t))throw new e.SchemaType.CastError(`Quaternion: ${t} does not contain z property`);if(r.isNotNumber(t.z))throw new e.SchemaType.CastError(`Quaternion: ${t} expected to be a number`);if(!("w"in t))throw new e.SchemaType.CastError(`Quaternion: ${t} does not contain w property`);if(r.isNotNumber(t.w))throw new e.SchemaType.CastError(`Quaternion: ${t} expected to be a number`);return{x:t.x,y:t.y,z:t.z,w:t.w}}}return t.QUATERNION_BSON_TYPE=c.BSON_DATA_OBJECT,e.Schema.Types.Quaternion=t,e}
/**
 * @module Types/Vector2
 * @desc Export the three js Vector2 type for Mongoose.
 *
 * @requires {@link module: [@itee/validators]{@link https://github.com/Itee/@itee/validators}}
 * @requires {@link module: [bson]{@link https://github.com/mongodb/js-bson}}
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */function Ks(e){class t extends e.SchemaType{constructor(e,t){super(e,t,"Vector2")}cast(t){if(r.isNotDefined(t))throw new e.SchemaType.CastError(`Vector2: ${t} is null or undefined`);if(r.isNotObject(t)&&!t.isVector2)throw new e.SchemaType.CastError(`Vector2: ${t} is not a object or Vector2 instance`);if(!("x"in t))throw new e.SchemaType.CastError(`Vector2: ${t} does not contain x property`);if(r.isNotNumber(t.x))throw new e.SchemaType.CastError(`Vector2: ${t} expected to be a number`);if(!("y"in t))throw new e.SchemaType.CastError(`Vector2: ${t} does not contain y property`);if(r.isNotNumber(t.y))throw new e.SchemaType.CastError(`Vector2: ${t} expected to be a number`);return{x:t.x,y:t.y}}}return t.VECTOR2_BSON_TYPE=c.BSON_DATA_OBJECT,e.Schema.Types.Vector2=t,e}
/**
 * @module Types/Vector3
 * @desc Export the three js Vector3 type for Mongoose.
 *
 * @requires {@link module: [@itee/validators]{@link https://github.com/Itee/@itee/validators}}
 * @requires {@link module: [bson]{@link https://github.com/mongodb/js-bson}}
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */function Qs(e){class t extends e.SchemaType{constructor(e,t){super(e,t,"Vector3")}cast(t){if(r.isNotDefined(t))throw new e.SchemaType.CastError(`Vector3: ${t} is null or undefined`);if(r.isNotObject(t)&&!t.isVector3)throw new e.SchemaType.CastError(`Vector3: ${t} is not a object or Vector3 instance`);if(!("x"in t))throw new e.SchemaType.CastError(`Vector3: ${t} does not contain x property`);if(r.isNotNumber(t.x))throw new e.SchemaType.CastError(`Vector3: ${t} expected to be a number`);if(!("y"in t))throw new e.SchemaType.CastError(`Vector3: ${t} does not contain y property`);if(r.isNotNumber(t.y))throw new e.SchemaType.CastError(`Vector3: ${t} expected to be a number`);if(!("z"in t))throw new e.SchemaType.CastError(`Vector3: ${t} does not contain z property`);if(r.isNotNumber(t.z))throw new e.SchemaType.CastError(`Vector3: ${t} expected to be a number`);return{x:t.x,y:t.y,z:t.z}}}return t.VECTOR3_BSON_TYPE=c.BSON_DATA_OBJECT,e.Schema.Types.Vector3=t,e}
/**
 * @module Types/Vector4
 * @desc Export the three js Vector4 type for Mongoose.
 *
 * @requires {@link module: [@itee/validators]{@link https://github.com/Itee/@itee/validators}}
 * @requires {@link module: [bson]{@link https://github.com/mongodb/js-bson}}
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */function Js(e){class t extends e.SchemaType{constructor(e,t){super(e,t,"Vector4")}cast(t){if(r.isNotDefined(t))throw new e.SchemaType.CastError(`Vector4: ${t} is null or undefined`);if(r.isNotObject(t)&&!t.isVector4)throw new e.SchemaType.CastError(`Vector4: ${t} is not a object or Vector4 instance`);if(!("x"in t))throw new e.SchemaType.CastError(`Vector4: ${t} does not contain x property`);if(r.isNotNumber(t.x))throw new e.SchemaType.CastError(`Vector4: ${t} expected to be a number`);if(!("y"in t))throw new e.SchemaType.CastError(`Vector4: ${t} does not contain y property`);if(r.isNotNumber(t.y))throw new e.SchemaType.CastError(`Vector4: ${t} expected to be a number`);if(!("z"in t))throw new e.SchemaType.CastError(`Vector4: ${t} does not contain z property`);if(r.isNotNumber(t.z))throw new e.SchemaType.CastError(`Vector4: ${t} expected to be a number`);if(!("w"in t))throw new e.SchemaType.CastError(`Vector4: ${t} does not contain w property`);if(r.isNotNumber(t.w))throw new e.SchemaType.CastError(`Vector4: ${t} expected to be a number`);return{x:t.x,y:t.y,z:t.z,w:t.w}}}return t.VECTOR4_BSON_TYPE=c.BSON_DATA_OBJECT,e.Schema.Types.Vector4=t,e}
/**
 * @module MongoDBThreePlugin
 * @desc Three way to register Types and Schema
 * using cjs module under types and schemas folder.
 * using FunctionRegistrator for type and add to plugin using .addType( myFunctionRegistrator ), extending class AbstractMongooseRegistrator for Schema and add to plugin using .addSchema(
 * MySchemaRegistrator ) using direct registration importing mongoose in the file (care to the loading order ! An no output about what is registered.)
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [MIT]{@link https://opensource.org/licenses/MIT}
 */
/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
const ec="srgb",tc="srgb-linear";function rc(e,t,r){return Math.max(t,Math.min(r,e))}function nc(e,t,r){return(1-r)*e+r*t}function ic(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function oc(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}const ac={[ec]:{[tc]:ic},[tc]:{[ec]:oc}},sc={legacyMode:!0,get workingColorSpace(){return tc},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,r){if(this.legacyMode||t===r||!t||!r)return e;if(ac[t]&&void 0!==ac[t][r]){const n=ac[t][r];return e.r=n(e.r),e.g=n(e.g),e.b=n(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},cc={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},uc={r:0,g:0,b:0},hc={h:0,s:0,l:0},lc={h:0,s:0,l:0};function dc(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e}function mc(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}class fc{constructor(e,t,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===t&&void 0===r?this.set(e):this.setRGB(e,t,r)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=ec){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,sc.toWorkingColorSpace(this,t),this}setRGB(e,t,r,n=sc.workingColorSpace){return this.r=e,this.g=t,this.b=r,sc.toWorkingColorSpace(this,n),this}setHSL(e,t,r,n=sc.workingColorSpace){var i;if(e=(e%(i=1)+i)%i,t=rc(t,0,1),r=rc(r,0,1),0===t)this.r=this.g=this.b=r;else{const n=r<=.5?r*(1+t):r+t-r*t,i=2*r-n;this.r=dc(i,n,e+1/3),this.g=dc(i,n,e),this.b=dc(i,n,e-1/3)}return sc.toWorkingColorSpace(this,n),this}setStyle(e,t=ec){function r(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const i=n[1],o=n[2];switch(i){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,sc.toWorkingColorSpace(this,t),r(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,sc.toWorkingColorSpace(this,t),r(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){const n=parseFloat(e[1])/360,i=parseFloat(e[2])/100,o=parseFloat(e[3])/100;return r(e[4]),this.setHSL(n,i,o,t)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=n[1],r=e.length;if(3===r)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,sc.toWorkingColorSpace(this,t),this;if(6===r)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,sc.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=ec){const r=cc[e.toLowerCase()];return void 0!==r?this.setHex(r,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=ic(e.r),this.g=ic(e.g),this.b=ic(e.b),this}copyLinearToSRGB(e){return this.r=oc(e.r),this.g=oc(e.g),this.b=oc(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=ec){return sc.fromWorkingColorSpace(mc(this,uc),e),rc(255*uc.r,0,255)<<16^rc(255*uc.g,0,255)<<8^rc(255*uc.b,0,255)}getHexString(e=ec){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=sc.workingColorSpace){sc.fromWorkingColorSpace(mc(this,uc),t);const r=uc.r,n=uc.g,i=uc.b,o=Math.max(r,n,i),a=Math.min(r,n,i);let s,c;const u=(a+o)/2;if(a===o)s=0,c=0;else{const e=o-a;switch(c=u<=.5?e/(o+a):e/(2-o-a),o){case r:s=(n-i)/e+(n<i?6:0);break;case n:s=(i-r)/e+2;break;case i:s=(r-n)/e+4}s/=6}return e.h=s,e.s=c,e.l=u,e}getRGB(e,t=sc.workingColorSpace){return sc.fromWorkingColorSpace(mc(this,uc),t),e.r=uc.r,e.g=uc.g,e.b=uc.b,e}getStyle(e=ec){return sc.fromWorkingColorSpace(mc(this,uc),e),e!==ec?`color(${e} ${uc.r} ${uc.g} ${uc.b})`:`rgb(${255*uc.r|0},${255*uc.g|0},${255*uc.b|0})`}offsetHSL(e,t,r){return this.getHSL(hc),hc.h+=e,hc.s+=t,hc.l+=r,this.setHSL(hc.h,hc.s,hc.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(hc),e.getHSL(lc);const r=nc(hc.h,lc.h,t),n=nc(hc.s,lc.s,t),i=nc(hc.l,lc.l,t);return this.setHSL(r,n,i),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}fc.NAMES=cc;class gc{constructor(e=0,t=0,r=0,n=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=n}static slerpFlat(e,t,r,n,i,o,a){let s=r[n+0],c=r[n+1],u=r[n+2],h=r[n+3];const l=i[o+0],d=i[o+1],m=i[o+2],f=i[o+3];if(0===a)return e[t+0]=s,e[t+1]=c,e[t+2]=u,void(e[t+3]=h);if(1===a)return e[t+0]=l,e[t+1]=d,e[t+2]=m,void(e[t+3]=f);if(h!==f||s!==l||c!==d||u!==m){let e=1-a;const t=s*l+c*d+u*m+h*f,r=t>=0?1:-1,n=1-t*t;if(n>Number.EPSILON){const i=Math.sqrt(n),o=Math.atan2(i,t*r);e=Math.sin(e*o)/i,a=Math.sin(a*o)/i}const i=a*r;if(s=s*e+l*i,c=c*e+d*i,u=u*e+m*i,h=h*e+f*i,e===1-a){const e=1/Math.sqrt(s*s+c*c+u*u+h*h);s*=e,c*=e,u*=e,h*=e}}e[t]=s,e[t+1]=c,e[t+2]=u,e[t+3]=h}static multiplyQuaternionsFlat(e,t,r,n,i,o){const a=r[n],s=r[n+1],c=r[n+2],u=r[n+3],h=i[o],l=i[o+1],d=i[o+2],m=i[o+3];return e[t]=a*m+u*h+s*d-c*l,e[t+1]=s*m+u*l+c*h-a*d,e[t+2]=c*m+u*d+a*l-s*h,e[t+3]=u*m-a*h-s*l-c*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const r=e._x,n=e._y,i=e._z,o=e._order,a=Math.cos,s=Math.sin,c=a(r/2),u=a(n/2),h=a(i/2),l=s(r/2),d=s(n/2),m=s(i/2);switch(o){case"XYZ":this._x=l*u*h+c*d*m,this._y=c*d*h-l*u*m,this._z=c*u*m+l*d*h,this._w=c*u*h-l*d*m;break;case"YXZ":this._x=l*u*h+c*d*m,this._y=c*d*h-l*u*m,this._z=c*u*m-l*d*h,this._w=c*u*h+l*d*m;break;case"ZXY":this._x=l*u*h-c*d*m,this._y=c*d*h+l*u*m,this._z=c*u*m+l*d*h,this._w=c*u*h-l*d*m;break;case"ZYX":this._x=l*u*h-c*d*m,this._y=c*d*h+l*u*m,this._z=c*u*m-l*d*h,this._w=c*u*h+l*d*m;break;case"YZX":this._x=l*u*h+c*d*m,this._y=c*d*h+l*u*m,this._z=c*u*m-l*d*h,this._w=c*u*h-l*d*m;break;case"XZY":this._x=l*u*h-c*d*m,this._y=c*d*h-l*u*m,this._z=c*u*m+l*d*h,this._w=c*u*h+l*d*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,n=Math.sin(r);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],n=t[4],i=t[8],o=t[1],a=t[5],s=t[9],c=t[2],u=t[6],h=t[10],l=r+a+h;if(l>0){const e=.5/Math.sqrt(l+1);this._w=.25/e,this._x=(u-s)*e,this._y=(i-c)*e,this._z=(o-n)*e}else if(r>a&&r>h){const e=2*Math.sqrt(1+r-a-h);this._w=(u-s)/e,this._x=.25*e,this._y=(n+o)/e,this._z=(i+c)/e}else if(a>h){const e=2*Math.sqrt(1+a-r-h);this._w=(i-c)/e,this._x=(n+o)/e,this._y=.25*e,this._z=(s+u)/e}else{const e=2*Math.sqrt(1+h-r-a);this._w=(o-n)/e,this._x=(i+c)/e,this._y=(s+u)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(rc(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(0===r)return this;const n=Math.min(1,t/r);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,n=e._y,i=e._z,o=e._w,a=t._x,s=t._y,c=t._z,u=t._w;return this._x=r*u+o*a+n*c-i*s,this._y=n*u+o*s+i*a-r*c,this._z=i*u+o*c+r*s-n*a,this._w=o*u-r*a-n*s-i*c,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const r=this._x,n=this._y,i=this._z,o=this._w;let a=o*e._w+r*e._x+n*e._y+i*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=r,this._y=n,this._z=i,this;const s=1-a*a;if(s<=Number.EPSILON){const e=1-t;return this._w=e*o+t*this._w,this._x=e*r+t*this._x,this._y=e*n+t*this._y,this._z=e*i+t*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(s),u=Math.atan2(c,a),h=Math.sin((1-t)*u)/c,l=Math.sin(t*u)/c;return this._w=o*h+this._w*l,this._x=r*h+this._x*l,this._y=n*h+this._y*l,this._z=i*h+this._z*l,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){const e=Math.random(),t=Math.sqrt(1-e),r=Math.sqrt(e),n=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(t*Math.cos(n),r*Math.sin(i),r*Math.cos(i),t*Math.sin(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class pc{constructor(e=0,t=0,r=0){pc.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return void 0===r&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(yc.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(yc.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6]*n,this.y=i[1]*t+i[4]*r+i[7]*n,this.z=i[2]*t+i[5]*r+i[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,n=this.z,i=e.elements,o=1/(i[3]*t+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*t+i[4]*r+i[8]*n+i[12])*o,this.y=(i[1]*t+i[5]*r+i[9]*n+i[13])*o,this.z=(i[2]*t+i[6]*r+i[10]*n+i[14])*o,this}applyQuaternion(e){const t=this.x,r=this.y,n=this.z,i=e.x,o=e.y,a=e.z,s=e.w,c=s*t+o*n-a*r,u=s*r+a*t-i*n,h=s*n+i*r-o*t,l=-i*t-o*r-a*n;return this.x=c*s+l*-i+u*-a-h*-o,this.y=u*s+l*-o+h*-i-c*-a,this.z=h*s+l*-a+c*-o-u*-i,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n,this.y=i[1]*t+i[5]*r+i[9]*n,this.z=i[2]*t+i[6]*r+i[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,n=e.y,i=e.z,o=t.x,a=t.y,s=t.z;return this.x=n*s-i*a,this.y=i*o-r*s,this.z=r*a-n*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return _c.copy(this).projectOnVector(e),this.sub(_c)}reflect(e){return this.sub(_c.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(rc(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return t*t+r*r+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const n=Math.sin(t)*e;return this.x=n*Math.sin(r),this.y=Math.cos(t)*e,this.z=n*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,r=Math.sqrt(1-e**2);return this.x=r*Math.cos(t),this.y=r*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const _c=new pc,yc=new gc;"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"149"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="149")
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */;const Sc=a.toEnum({Black:new fc("#000000"),Navy:new fc("#000080"),DarkBlue:new fc("#00008b"),MediumBlue:new fc("#0000cd"),Blue:new fc("#0000ff"),DarkGreen:new fc("#006400"),Green:new fc("#008000"),Teal:new fc("#008080"),DarkCyan:new fc("#008b8b"),DeepSkyBlue:new fc("#00bfff"),DarkTurquoise:new fc("#00ced1"),MediumSpringGreen:new fc("#00fa9a"),Lime:new fc("#00ff00"),SpringGreen:new fc("#00ff7f"),Aqua:new fc("#00ffff"),Cyan:new fc("#00ffff"),MidnightBlue:new fc("#191970"),DodgerBlue:new fc("#1e90ff"),LightSeaGreen:new fc("#20b2aa"),ForestGreen:new fc("#228b22"),SeaGreen:new fc("#2e8b57"),DarkSlateGray:new fc("#2f4f4f"),DarkSlateGrey:new fc("#2f4f4f"),LimeGreen:new fc("#32cd32"),MediumSeaGreen:new fc("#3cb371"),Turquoise:new fc("#40e0d0"),RoyalBlue:new fc("#4169e1"),SteelBlue:new fc("#4682b4"),DarkSlateBlue:new fc("#483d8b"),MediumTurquoise:new fc("#48d1cc"),Indigo:new fc("#4b0082"),DarkOliveGreen:new fc("#556b2f"),CadetBlue:new fc("#5f9ea0"),CornflowerBlue:new fc("#6495ed"),RebeccaPurple:new fc("#663399"),MediumAquaMarine:new fc("#66cdaa"),DimGray:new fc("#696969"),DimGrey:new fc("#696969"),SlateBlue:new fc("#6a5acd"),OliveDrab:new fc("#6b8e23"),SlateGray:new fc("#708090"),SlateGrey:new fc("#708090"),LightSlateGray:new fc("#778899"),LightSlateGrey:new fc("#778899"),MediumSlateBlue:new fc("#7b68ee"),LawnGreen:new fc("#7cfc00"),Chartreuse:new fc("#7fff00"),Aquamarine:new fc("#7fffd4"),Maroon:new fc("#800000"),Purple:new fc("#800080"),Olive:new fc("#808000"),Gray:new fc("#808080"),Grey:new fc("#808080"),SkyBlue:new fc("#87ceeb"),LightSkyBlue:new fc("#87cefa"),BlueViolet:new fc("#8a2be2"),DarkRed:new fc("#8b0000"),DarkMagenta:new fc("#8b008b"),SaddleBrown:new fc("#8b4513"),DarkSeaGreen:new fc("#8fbc8f"),LightGreen:new fc("#90ee90"),MediumPurple:new fc("#9370db"),DarkViolet:new fc("#9400d3"),PaleGreen:new fc("#98fb98"),DarkOrchid:new fc("#9932cc"),YellowGreen:new fc("#9acd32"),Sienna:new fc("#a0522d"),Brown:new fc("#a52a2a"),DarkGray:new fc("#a9a9a9"),DarkGrey:new fc("#a9a9a9"),LightBlue:new fc("#add8e6"),GreenYellow:new fc("#adff2f"),PaleTurquoise:new fc("#afeeee"),LightSteelBlue:new fc("#b0c4de"),PowderBlue:new fc("#b0e0e6"),FireBrick:new fc("#b22222"),DarkGoldenRod:new fc("#b8860b"),MediumOrchid:new fc("#ba55d3"),RosyBrown:new fc("#bc8f8f"),DarkKhaki:new fc("#bdb76b"),Silver:new fc("#c0c0c0"),MediumVioletRed:new fc("#c71585"),IndianRed:new fc("#cd5c5c"),Peru:new fc("#cd853f"),Chocolate:new fc("#d2691e"),Tan:new fc("#d2b48c"),LightGray:new fc("#d3d3d3"),LightGrey:new fc("#d3d3d3"),Thistle:new fc("#d8bfd8"),Orchid:new fc("#da70d6"),GoldenRod:new fc("#daa520"),PaleVioletRed:new fc("#db7093"),Crimson:new fc("#dc143c"),Gainsboro:new fc("#dcdcdc"),Plum:new fc("#dda0dd"),BurlyWood:new fc("#deb887"),LightCyan:new fc("#e0ffff"),Lavender:new fc("#e6e6fa"),DarkSalmon:new fc("#e9967a"),Violet:new fc("#ee82ee"),PaleGoldenRod:new fc("#eee8aa"),LightCoral:new fc("#f08080"),Khaki:new fc("#f0e68c"),AliceBlue:new fc("#f0f8ff"),HoneyDew:new fc("#f0fff0"),Azure:new fc("#f0ffff"),SandyBrown:new fc("#f4a460"),Wheat:new fc("#f5deb3"),Beige:new fc("#f5f5dc"),WhiteSmoke:new fc("#f5f5f5"),MintCream:new fc("#f5fffa"),GhostWhite:new fc("#f8f8ff"),Salmon:new fc("#fa8072"),AntiqueWhite:new fc("#faebd7"),Linen:new fc("#faf0e6"),LightGoldenRodYellow:new fc("#fafad2"),OldLace:new fc("#fdf5e6"),Red:new fc("#ff0000"),Fuchsia:new fc("#ff00ff"),Magenta:new fc("#ff00ff"),DeepPink:new fc("#ff1493"),OrangeRed:new fc("#ff4500"),Tomato:new fc("#ff6347"),HotPink:new fc("#ff69b4"),Coral:new fc("#ff7f50"),DarkOrange:new fc("#ff8c00"),LightSalmon:new fc("#ffa07a"),Orange:new fc("#ffa500"),LightPink:new fc("#ffb6c1"),Pink:new fc("#ffc0cb"),Gold:new fc("#ffd700"),PeachPuff:new fc("#ffdab9"),NavajoWhite:new fc("#ffdead"),Moccasin:new fc("#ffe4b5"),Bisque:new fc("#ffe4c4"),MistyRose:new fc("#ffe4e1"),BlanchedAlmond:new fc("#ffebcd"),PapayaWhip:new fc("#ffefd5"),LavenderBlush:new fc("#fff0f5"),SeaShell:new fc("#fff5ee"),Cornsilk:new fc("#fff8dc"),LemonChiffon:new fc("#fffacd"),FloralWhite:new fc("#fffaf0"),Snow:new fc("#fffafa"),Yellow:new fc("#ffff00"),LightYellow:new fc("#ffffe0"),Ivory:new fc("#fffff0"),White:new fc("#ffffff")});
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */
const Mc=new pc(-1,-1,-1).normalize(),bc=new pc(-1,-1,0).normalize(),wc=new pc(-1,-1,1).normalize(),Fc=new pc(-1,0,-1).normalize(),Tc=new pc(-1,0,0).normalize(),vc=new pc(-1,0,1).normalize(),Bc=new pc(-1,1,-1).normalize(),xc=new pc(-1,1,0).normalize(),Cc=new pc(-1,1,1).normalize(),Oc=new pc(0,-1,-1).normalize(),Dc=new pc(0,-1,0).normalize(),Nc=new pc(0,-1,1).normalize(),Ic=new pc(0,0,-1).normalize(),Pc=new pc(0,0,0).normalize(),Gc=new pc(0,0,1).normalize(),Lc=new pc(0,1,-1).normalize(),Ac=new pc(0,1,0).normalize(),Rc=new pc(0,1,1).normalize(),zc=new pc(1,-1,-1).normalize(),Uc=new pc(1,-1,0).normalize(),Ec=new pc(1,-1,1).normalize(),kc=new pc(1,0,-1).normalize(),Hc=new pc(1,0,0).normalize(),Vc={Left_Down_Back:Mc,Left_Down:bc,Left_Down_Front:wc,Left_Back:Fc,Left:Tc,Left_Front:vc,Left_Up_Back:Bc,Left_Up:xc,Left_Up_Front:Cc,Down_Back:Oc,Down:Dc,Down_Front:Nc,Back:Ic,Null:Pc,Front:Gc,Up_Back:Lc,Up:Ac,Up_Front:Rc,Right_Down_Back:zc,Right_Down:Uc,Right_Down_Front:Ec,Right_Back:kc,Right:Hc,Right_Front:new pc(1,0,1).normalize(),Right_Up_Back:new pc(1,1,-1).normalize(),Right_Up:new pc(1,1,0).normalize(),Right_Up_Front:new pc(1,1,1).normalize(),Cardinales:{North:Ic,North_North_East:new pc(o.OneHalf,0,-o.SquareRootOfThreeOnTwo).normalize(),North_East:new pc(o.SquareRootOfTwoOnTwo,0,-o.SquareRootOfTwoOnTwo).normalize(),East_North_East:new pc(o.SquareRootOfThreeOnTwo,0,-o.OneHalf).normalize(),East:Hc,East_South_East:new pc(o.SquareRootOfThreeOnTwo,0,- -o.OneHalf).normalize(),South_East:new pc(o.SquareRootOfTwoOnTwo,0,- -o.SquareRootOfTwoOnTwo).normalize(),South_South_East:new pc(o.OneHalf,0,- -o.SquareRootOfThreeOnTwo).normalize(),South:Gc,South_South_West:new pc(-o.OneHalf,0,- -o.SquareRootOfThreeOnTwo).normalize(),South_West:new pc(-o.SquareRootOfTwoOnTwo,0,- -o.SquareRootOfTwoOnTwo).normalize(),West_South_West:new pc(-o.SquareRootOfThreeOnTwo,0,- -o.OneHalf).normalize(),West:Tc,West_North_West:new pc(-o.SquareRootOfThreeOnTwo,0,-o.OneHalf).normalize(),North_West:new pc(-o.SquareRootOfTwoOnTwo,0,-o.SquareRootOfTwoOnTwo).normalize(),North_North_West:new pc(-o.OneHalf,0,-o.SquareRootOfThreeOnTwo).normalize()}};
/**
 * @module Loader/LASLoader
 * @desc A loader for ASC cloud point files.
 *
 * @requires {@link https://github.com/Itee/@itee/client @itee/client}
 * @requires {@link https://github.com/Itee/three-full three-full}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 * @example
 *
 * import { LASLoader } from '@itee/plugin-three'
 *
 * const loader = new LASLoader();
 *
 * // If the ASC file need to be offseted, it can be set before loading file.
 * loader.setOffset( {
 *      x: 1.0,
 *      y: 52.0,
 *      z: -5.0
 * } );
 *
 * // Then load the file and get the threejs Point Geometry
 * loader.load('/path/to/file.asc', function (geometry) {
 *
 *      scene.add( new Mesh( geometry ) );
 *
 * } );
 *
 */
const jc=new RegExp("\0","g"),$c=a.toEnum({Created:0,Unclassified:1,Ground:2,LowVegetation:3,MediumVegetation:4,HighVegetation:5,Building:6,LowPoint:7,ModelKeyPoint:8,Water:9,OverlapPoints:12});class Yc{constructor(e,t){if(this.m_bits=new Array,t&&t.length)for(let e=0;e<t.length;e++)this.m_bits.push(t[e]?Yc._ON:Yc._OFF);else isNaN(t)||(this.m_bits=Yc.shred(t).m_bits);if(e&&this.m_bits.length!==e)if(this.m_bits.length<e)for(let t=this.m_bits.length;t<e;t++)this.m_bits.push(Yc._OFF);else for(let t=e;t>this.m_bits.length;t--)this.m_bits.pop()}static _intersect(e,t){return e===Yc._ON&&t===Yc._ON?Yc._ON:Yc._OFF}static _union(e,t){return e===Yc._ON||t===Yc._ON?Yc._ON:Yc._OFF}static _difference(e,t){return e===Yc._ON&&t!==Yc._ON?Yc._ON:Yc._OFF}static _getLen(e,t,r){var n=e.getLength(),i=t.getLength();return r?i:n}static getUnion(e,t){for(var r=Yc._getLen(e,t,!0),n=new Yc(r),i=0;i<r;i++)n.setAt(i,Yc._union(e.getAt(i),t.getAt(i)));return n}static getIntersection(e,t){for(var r=Yc._getLen(e,t,!0),n=new Yc(r),i=0;i<r;i++)n.setAt(i,Yc._intersect(e.getAt(i),t.getAt(i)));return n}static getDifference(e,t){for(var r=Yc._getLen(e,t,!0),n=new Yc(r),i=0;i<r;i++)n.setAt(i,Yc._difference(e.getAt(i),t.getAt(i)));return n}static shred(e){var t=new Array,r=e;do{t.push(r%2),r=Math.floor(r/2)}while(r>0);return new Yc(t.length,t.reverse())}getLength(){return this.m_bits.length}getAt(e){return e<this.m_bits.length?this.m_bits[e]:null}setAt(e,t){e<this.m_bits.length&&(this.m_bits[e]=t?Yc._ON:Yc._OFF)}resize(e){for(var t=new Array,r=0;r<e;r++)r<this.m_bits.length?t.push(this.m_bits[r]):t.push(Yc._OFF);this.m_bits=t}getCompliment(){for(var e=new Yc(this.m_bits.length),t=0;t<this.m_bits.length;t++)e.setAt(t,this.m_bits[t]?Yc._OFF:Yc._ON);return e}toString(){for(var e=new String,t=0;t<this.m_bits.length;t++)e=e.concat(this.m_bits[t]===Yc._ON?"1":"0");return e}toNumber(){for(var e=0,t=0,r=this.m_bits.length-1;r>=0;r--)this.m_bits[r]===Yc._ON&&(t+=Math.pow(2,e)),e++;return t}}Yc._ON=1,Yc._OFF=0;class Wc{static getBit(e,t){return e&1<<t?1:0}static setBit(e,t){return e|1<<t}static clearBit(e,t){return e&~(1<<t)}static updateBit(e,t,r){return e&~(1<<t)|(r?1:0)<<t}static getBits(e,t){let r=0;for(let n of t)Wc.getBit(e,n)&&(r=Wc.setBit(r,n));return r}}exports.ASCLoader=
/**
 * @module Loader/ASCLoader
 * @desc A loader for ASC cloud point files.
 *
 * @requires {@link https://github.com/Itee/@itee/client @itee/client}
 * @requires {@link https://github.com/Itee/three-full three-full}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 * @example
 *
 * import { ASCLoader } from '@itee/plugin-three'
 *
 * const loader = new ASCLoader();
 *
 * // If the ASC file need to be offseted, it can be set before loading file.
 * loader.setOffset( {
 *      x: 1.0,
 *      y: 52.0,
 *      z: -5.0
 * } );
 *
 * // Then load the file and get the threejs Point Geometry
 * loader.load('/path/to/file.asc', function (geometry) {
 *
 *      scene.add( new Mesh( geometry ) );
 *
 * } );
 *
 */
class{constructor(e=n.DefaultLoadingManager,t=o.DefaultLogger){this.manager=e,this.logger=t,this._boundingBox=new n.Box3,this._points=[],this._numberOfPoints=0,this._coloredPoints=!1,this._autoOffset=!1,this._offset={x:0,y:0,z:0},this._positions=null,this._bufferIndex=0,this._positionsC=null,this._bufferIndexC=0,this.wrongPoints=0}load(e,t,r,i,o){const a=new n.FileLoader(this.manager);a.setResponseType("blob"),a.load(e,function(e){const a=new n.Group;this._parse(e,a,t,r,i,o),t(a)}.bind(this),r,i)}setOffset(e){this._offset=e,this._autoOffset=!1}_parse(e,t,r,n,i,o){const a=this,s=o||100,c=new FileReader,u=134217728;let h=0;function l(){if(h>=e.size)return;const t=e.slice(h,h+u,"text/plain");c.readAsText(t)}c.onabort=e=>{this.logger.log("abortEvent:"),this.logger.log(e)},c.onerror=e=>{this.logger.log("errorEvent:"),this.logger.log(e),i&&i(e)},c.onloadstart=e=>{this.logger.log("loadStartEvent:"),this.logger.log(e)},c.onprogress=e=>{this.logger.log("progressEvent:"),this.logger.log(e),n&&n(e)},c.onload=e=>{this.logger.log("loadEvent:"),this.logger.log(e);const t=e.target.result.split("\n"),r=t.length;h-=t[r-1].length;const n=Math.round(100/s);for(let e=0;e<r-1;e++)e%n===0&&a._parseLine(t[e])},c.onloadend=r=>{this.logger.log("loadEndEvent"),this.logger.log(r),(this._points.length>1e6||h+u>=e.size)&&(this._offsetPoints(),this._createSubCloudPoint(t)),h+=u,l()},l()}_parseLine(e){const t=e.split(/\s/g).filter(Boolean),r=t.length;3===r?this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2])}):4===r?(this._pointsHaveIntensity=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3])})):6===r?(this._pointsHaveColor=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),r:parseFloat(t[3]),g:parseFloat(t[4]),b:parseFloat(t[5])})):7===r?(this._pointsHaveIntensity=!0,this._pointsHaveColor=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),r:parseFloat(t[4]),g:parseFloat(t[5]),b:parseFloat(t[6])})):9===r?(this._pointsHaveColor=!0,this._pointsHaveNormals=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),r:parseFloat(t[3]),g:parseFloat(t[4]),b:parseFloat(t[5]),nx:parseFloat(t[6]),ny:parseFloat(t[7]),nz:parseFloat(t[8])})):10===r?(this._pointsHaveIntensity=!0,this._pointsHaveColor=!0,this._pointsHaveNormals=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),r:parseFloat(t[4]),g:parseFloat(t[5]),b:parseFloat(t[6]),nx:parseFloat(t[7]),ny:parseFloat(t[8]),nz:parseFloat(t[9])})):this.logger.error(`Invalid data line: ${e}`)}_parseLines(e){const t=e[0].split(/\s/g).filter(Boolean).length;3===t?this._parseLinesAsXYZ(e):4===t?this._parseLinesAsXYZI(e):6===t?this._parseLinesAsXYZRGB(e):7===t?this._parseLinesAsXYZIRGB(e):9===t?this._parseLinesAsXYZRGBnXnYnZ(e):10===t?this._parseLinesAsXYZIRGBnXnYnZ(e):this.logger.error(`Invalid data line: ${e}`)}_parseLinesAsXYZ(e){let t=[];for(let r=0,n=e.length;r<n;r++)t=e[r].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2])})}_parseLinesAsXYZI(e){this._pointsHaveIntensity=!0;let t=[];for(let r=0,n=e.length;r<n;r++)t=e[r].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3])})}_parseLinesAsXYZRGB(e){this._pointsHaveColor=!0;let t=[];for(let r=0,n=e.length;r<n;r++)t=e[r].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),r:parseFloat(t[3]),g:parseFloat(t[4]),b:parseFloat(t[5])})}_parseLinesAsXYZnXnYnZ(e){let t=[];for(let r=0,n=e.length;r<n;r++)t=e[r].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),nx:parseFloat(t[7]),ny:parseFloat(t[8]),nz:parseFloat(t[9])})}_parseLinesAsXYZIRGB(e){this._pointsHaveIntensity=!0,this._pointsHaveColor=!0;let t=[];for(let r=0,n=e.length;r<n;r++)t=e[r].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),r:parseFloat(t[4]),g:parseFloat(t[5]),b:parseFloat(t[6])})}_parseLinesAsXYZInXnYnZ(e){let t=[];for(let r=0,n=e.length;r<n;r++)t=e[r].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),nx:parseFloat(t[7]),ny:parseFloat(t[8]),nz:parseFloat(t[9])})}_parseLinesAsXYZRGBnXnYnZ(e){this._pointsHaveColor=!0,this._pointsHaveNormals=!0;let t=[];for(let r=0,n=e.length;r<n;r++)t=e[r].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),r:parseFloat(t[3]),g:parseFloat(t[4]),b:parseFloat(t[5]),nx:parseFloat(t[6]),ny:parseFloat(t[7]),nz:parseFloat(t[8])})}_parseLinesAsXYZIRGBnXnYnZ(e){this._pointsHaveIntensity=!0,this._pointsHaveColor=!0,this._pointsHaveNormals=!0;let t=[];for(let r=0,n=e.length;r<n;r++)t=e[r].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),r:parseFloat(t[4]),g:parseFloat(t[5]),b:parseFloat(t[6]),nx:parseFloat(t[7]),ny:parseFloat(t[8]),nz:parseFloat(t[9])})}_parseLineB(e){const t=e.split(/\s/g).filter(Boolean),r=t.length,n=this._bufferIndex;3===r&&(this._positions[n]=parseFloat(t[0]),this._positions[n+1]=parseFloat(t[1]),this._positions[n+2]=parseFloat(t[2]),this._bufferIndex+=3)}_parseLineC(e){const t=e.split(/\s/g).filter(Boolean),r=t.length,n=this._bufferIndexC;3===r&&(this._positionsC[n]=Number.parseFloat(t[0]),this._positionsC[n+1]=Number.parseFloat(t[1]),this._positionsC[n+2]=Number.parseFloat(t[2]),this._bufferIndexC+=3)}_offsetPoints(){this._autoOffset&&(this._boundingBox.setFromPoints(this._points),this.setOffset(this._boundingBox.getCenter()));const e=this._offset.x,t=this._offset.y,r=this._offset.z;let n=null;for(let i=0,o=this._points.length;i<o;++i)n=this._points[i],n.x-=e,n.y-=t,n.z-=r}_createCloudPoint(e){const t=1e6,r=this._points.length,i=Math.ceil(r/t);let o=null,a=0,s=null;for(let r=0;r<i;++r){o=this._points.splice(0,t),a=o.length;const r=new n.BufferGeometry,i=new Float32Array(3*a),c=new Float32Array(3*a);let u=0,h=null;for(let e=0;e<a;++e)h=o[e],i[u]=h.x,i[u+1]=h.y,i[u+2]=h.z,this._pointsHaveColor?(c[u]=h.r/255,c[u+1]=h.g/255,c[u+2]=h.b/255):(c[u]=.1,c[u+1]=.2,c[u+2]=.5),u+=3;r.setAttribute("position",new n.BufferAttribute(i,3)),r.setAttribute("color",new n.BufferAttribute(c,3));const l=new n.PointsMaterial({size:.01,vertexColors:!0});s=new n.Points(r,l),e.children.push(s)}}_createSubCloudPoint(e){const t=this._points.length,r=new n.BufferGeometry,i=new Float32Array(3*t),o=new Float32Array(3*t);let a=0,s=null;for(let e=0;e<t;++e)s=this._points[e],i[a]=s.x,i[a+1]=s.y,i[a+2]=s.z,this._pointsHaveColor?(o[a]=s.r/255,o[a+1]=s.g/255,o[a+2]=s.b/255):(o[a]=.1,o[a+1]=.2,o[a+2]=.5),a+=3;r.setAttribute("position",new n.BufferAttribute(i,3)),r.setAttribute("color",new n.BufferAttribute(o,3));const c=new n.PointsMaterial({size:.005,vertexColors:!0}),u=new n.Points(r,c);u.rotation.x-=Math.PI/2,e.children.push(u),this._points=[]}},exports.BitArray=Yc,exports.BitManager=Wc,exports.ColorPalette=class{constructor(e){e.default?this.default.set(e.default):this.default.set(Sc.Fuchsia),e.intersected?this.intersected.set(e.intersected):this.default.set(Sc.PeachPuff),e.selected?this.selected.set(e.selected):this.default.set(Sc.DarkOrange),e.active?this.active.set(e.active):this.default.set(Sc.YellowGreen),e.inactive?this.inactive.set(e.inactive):this.default.set(Sc.LightCyan),e.enabled?this.enabled.set(e.enabled):this.default.set(Sc.Lavender),e.disabled?this.disabled.set(e.disabled):this.default.set(Sc.Grey)}},exports.Colors=Sc,exports.DBFLoader=p,exports.Directions=Vc,exports.LASLoader=class{constructor(e=n.DefaultLoadingManager,t=o.DefaultLogger){this.manager=e,this.logger=t,this._reader=new i.TBinaryReader,this._fullVersion="",this._boundingBox=new n.Box3,this._points=[],this._numberOfPoints=0,this._coloredPoints=!1,this._autoOffset=!1,this._offset={x:0,y:0,z:0},this.colorForPointClass={Created:{r:255,g:255,b:255},Unclassified:{r:60,g:60,b:60},Ground:{r:125,g:95,b:5},LowVegetation:{r:153,g:212,b:36},MediumVegetation:{r:52,g:148,b:25},HighVegetation:{r:27,g:77,b:13},Building:{r:153,g:138,b:95},LowPoint:{r:200,g:200,b:200},ModelKeyPoint:{r:237,g:31,b:31},Water:{r:31,g:186,b:237},OverlapPoints:{r:0,g:0,b:0}}}load(e,t,r,i,o){const a=new n.FileLoader(this.manager);a.setResponseType("arraybuffer"),a.load(e,e=>{this.parse(e,t,r,i,o)},r,i)}setOffset(e){this._offset=e,this._autoOffset=!1}parse(e,t,r,n){try{this._reader.buffer=e;if("LASF"!==this._reader.getString(4,!1))throw new Error("Invalid las file signature. Abort parsing !");this._reader.skipOffsetOf(24);const i=this._reader.getUint8(),o=this._reader.getUint8();this._reader.skipOffsetTo(0);const a=`${i}.${o}`,s=this._parseHeader(a),c=this._parseVariableLengthRecords(s),u=this._parsePointDataRecords(s,r);this.convert({Header:s,VariableLengthRecords:c,PointDataRecords:u},t,r,n)}catch(e){n(e)}}_parseHeader(e){switch(e){case"1.0":return this._parseHeader_1_0();case"1.1":return this._parseHeader_1_1();case"1.2":return this._parseHeader_1_2();case"1.3":return this._parseHeader_1_3();case"1.4":return this._parseHeader_1_4();default:throw new Error(`Insupported LAS file version: ${e}. Abort parsing !`)}}_parseHeader_1_0(){return{FileSignature:this._reader.getString(4),Reserved:this._reader.skipOffsetOf(i.Byte.Four),GUID_1:this._reader.getUint32(),GUID_2:this._reader.getUint16(),GUID_3:this._reader.getUint16(),GUID_4:this._reader.getUint8Array(8),VersionMajor:this._reader.getUint8(),VersionMinor:this._reader.getUint8(),SystemIdentifier:this._reader.getString(32).replace(jc,""),GeneratingSoftware:this._reader.getString(32).replace(jc,""),FlightDateJulian:this._reader.getUint16(),Year:this._reader.getUint16(),HeaderSize:this._reader.getUint16(),OffsetToPointData:this._reader.getUint32(),NumberOfVariableLengthRecords:this._reader.getUint32(),PointDataFormatID:this._reader.getUint8(),PointDataRecordLength:this._reader.getUint16(),NumberOfPointRecords:this._reader.getUint32(),NumberOfPointsByReturn:this._reader.getUint32Array(5),XScaleFactor:this._reader.getFloat64(),YScaleFactor:this._reader.getFloat64(),ZScaleFactor:this._reader.getFloat64(),XOffset:this._reader.getFloat64(),YOffset:this._reader.getFloat64(),ZOffset:this._reader.getFloat64(),MaxX:this._reader.getFloat64(),MinX:this._reader.getFloat64(),MaxY:this._reader.getFloat64(),MinY:this._reader.getFloat64(),MaxZ:this._reader.getFloat64(),MinZ:this._reader.getFloat64()}}_parseHeader_1_1(){return{FileSignature:this._reader.getString(4),FileSourceId:this._reader.getUint16(),Reserved:this._reader.skipOffsetOf(i.Byte.Two)&&null,GUID_1:this._reader.getUint32(),GUID_2:this._reader.getUint16(),GUID_3:this._reader.getUint16(),GUID_4:this._reader.getUint8Array(8),VersionMajor:this._reader.getUint8(),VersionMinor:this._reader.getUint8(),SystemIdentifier:this._reader.getString(32).replace(jc,""),GeneratingSoftware:this._reader.getString(32).replace(jc,""),FileCreationDayOfYear:this._reader.getUint16(),FileCreationYear:this._reader.getUint16(),HeaderSize:this._reader.getUint16(),OffsetToPointData:this._reader.getUint32(),NumberOfVariableLengthRecords:this._reader.getUint32(),PointDataFormatID:this._reader.getUint8(),PointDataRecordLength:this._reader.getUint16(),NumberOfPointRecords:this._reader.getUint32(),NumberOfPointsByReturn:this._reader.getUint32Array(5),XScaleFactor:this._reader.getFloat64(),YScaleFactor:this._reader.getFloat64(),ZScaleFactor:this._reader.getFloat64(),XOffset:this._reader.getFloat64(),YOffset:this._reader.getFloat64(),ZOffset:this._reader.getFloat64(),MaxX:this._reader.getFloat64(),MinX:this._reader.getFloat64(),MaxY:this._reader.getFloat64(),MinY:this._reader.getFloat64(),MaxZ:this._reader.getFloat64(),MinZ:this._reader.getFloat64()}}_parseHeader_1_2(){return{FileSignature:this._reader.getString(4),FileSourceId:this._reader.getUint16(),GlobalEncoding:{GPSTimeType:this._reader.getBit16()?"AdjustedStandardGPSTime":"GPSWeekTime",Reserved:this._reader.skipBitOffsetOf(15)},GUID_1:this._reader.getUint32(),GUID_2:this._reader.getUint16(),GUID_3:this._reader.getUint16(),GUID_4:this._reader.getUint8Array(8),VersionMajor:this._reader.getUint8(),VersionMinor:this._reader.getUint8(),SystemIdentifier:this._reader.getString(32).replace(jc,""),GeneratingSoftware:this._reader.getString(32).replace(jc,""),FileCreationDayOfYear:this._reader.getUint16(),FileCreationYear:this._reader.getUint16(),HeaderSize:this._reader.getUint16(),OffsetToPointData:this._reader.getUint32(),NumberOfVariableLengthRecords:this._reader.getUint32(),PointDataFormatID:this._reader.getUint8(),PointDataRecordLength:this._reader.getUint16(),NumberOfPointRecords:this._reader.getUint32(),NumberOfPointsByReturn:this._reader.getUint32Array(5),XScaleFactor:this._reader.getFloat64(),YScaleFactor:this._reader.getFloat64(),ZScaleFactor:this._reader.getFloat64(),XOffset:this._reader.getFloat64(),YOffset:this._reader.getFloat64(),ZOffset:this._reader.getFloat64(),MaxX:this._reader.getFloat64(),MinX:this._reader.getFloat64(),MaxY:this._reader.getFloat64(),MinY:this._reader.getFloat64(),MaxZ:this._reader.getFloat64(),MinZ:this._reader.getFloat64()}}_parseHeader_1_3(){return{FileSignature:this._reader.getString(4),FileSourceId:this._reader.getUint16(),GlobalEncoding:{GPSTimeType:this._reader.getBit16()?"AdjustedStandardGPSTime":"GPSWeekTime",WaveformDataPacketsInternal:this._reader.getBit16(),WaveformDataPacketsExternal:this._reader.getBit16(),ReturnNumbersHaveBeenSyntheticallyGenerated:this._reader.getBit16(),Reserved:this._reader.skipBitOffsetOf(12)},GUID_1:this._reader.getUint32(),GUID_2:this._reader.getUint16(),GUID_3:this._reader.getUint16(),GUID_4:this._reader.getUint8Array(8),VersionMajor:this._reader.getUint8(),VersionMinor:this._reader.getUint8(),SystemIdentifier:this._reader.getString(32).replace(jc,""),GeneratingSoftware:this._reader.getString(32).replace(jc,""),FileCreationDayOfYear:this._reader.getUint16(),FileCreationYear:this._reader.getUint16(),HeaderSize:this._reader.getUint16(),OffsetToPointData:this._reader.getUint32(),NumberOfVariableLengthRecords:this._reader.getUint32(),PointDataFormatID:this._reader.getUint8(),PointDataRecordLength:this._reader.getUint16(),NumberOfPointRecords:this._reader.getUint32(),NumberOfPointsByReturn:this._reader.getUint32Array(5),XScaleFactor:this._reader.getFloat64(),YScaleFactor:this._reader.getFloat64(),ZScaleFactor:this._reader.getFloat64(),XOffset:this._reader.getFloat64(),YOffset:this._reader.getFloat64(),ZOffset:this._reader.getFloat64(),MaxX:this._reader.getFloat64(),MinX:this._reader.getFloat64(),MaxY:this._reader.getFloat64(),MinY:this._reader.getFloat64(),MaxZ:this._reader.getFloat64(),MinZ:this._reader.getFloat64(),StartOfWaveformDataPacketRecord:this._reader.getUint64()}}_parseHeader_1_4(){return{FileSignature:this._reader.getString(4),FileSourceId:this._reader.getUint16(),GlobalEncoding:{GPSTimeType:this._reader.getBit16()?"AdjustedStandardGPSTime":"GPSWeekTime",WaveformDataPacketsInternal:this._reader.getBit16(),WaveformDataPacketsExternal:this._reader.getBit16(),ReturnNumbersHaveBeenSyntheticallyGenerated:this._reader.getBit16(),WKT:this._reader.getBit16()?"WKT":"GeoTIFF",Reserved:this._reader.skipBitOffsetOf(11)},GUID_1:this._reader.getUint32(),GUID_2:this._reader.getUint16(),GUID_3:this._reader.getUint16(),GUID_4:this._reader.getUint8Array(8),VersionMajor:this._reader.getUint8(),VersionMinor:this._reader.getUint8(),SystemIdentifier:this._reader.getString(32).replace(jc,""),GeneratingSoftware:this._reader.getString(32).replace(jc,""),FileCreationDayOfYear:this._reader.getUint16(),FileCreationYear:this._reader.getUint16(),HeaderSize:this._reader.getUint16(),OffsetToPointData:this._reader.getUint32(),NumberOfVariableLengthRecords:this._reader.getUint32(),PointDataRecordFormat:this._reader.getUint8(),PointDataRecordLength:this._reader.getUint16(),LegacyNumberOfPointRecords:this._reader.getUint32(),LegacyNumberOfPointsByReturn:this._reader.getUint32Array(5),XScaleFactor:this._reader.getFloat64(),YScaleFactor:this._reader.getFloat64(),ZScaleFactor:this._reader.getFloat64(),XOffset:this._reader.getFloat64(),YOffset:this._reader.getFloat64(),ZOffset:this._reader.getFloat64(),MaxX:this._reader.getFloat64(),MinX:this._reader.getFloat64(),MaxY:this._reader.getFloat64(),MinY:this._reader.getFloat64(),MaxZ:this._reader.getFloat64(),MinZ:this._reader.getFloat64(),StartOfWaveformDataPacketRecord:this._reader.getUint64(),StartOfFirstExtendedVariableLengthRecord:this._reader.getUint64(),NumberOfExtendedVariableLengthRecords:this._reader.getUint32(),NumberOfPointRecords:this._reader.getUint64(),NumberOfPointsByReturn:this._reader.getUint64Array(15)}}_parseVariableLengthRecords(e){const t=`${e.VersionMajor}.${e.VersionMinor}`,r=[];for(let n=0;n<e.NumberOfVariableLengthRecords;n++){const e=this._parseVariableLengthRecordHeader();
//!\ Legacy => RecordSignature = Reserved since las v1.1
if("1.0"===t&&43707!==e.Reserved)throw new Error("Invalid variable length record header signature... Abort parsing !");const n=e.UserID,i=e.RecordID,o=e.RecordLengthAfterHeader,a=this._parseVariableLengthRecordContent(n,i,o);r.push({Header:e,Content:a})}return r}_parseVariableLengthRecordHeader(){return{Reserved:this._reader.getUint16(),UserID:this._reader.getString(16).replace(jc,""),RecordID:this._reader.getUint16(),RecordLengthAfterHeader:this._reader.getUint16(),Description:this._reader.getString(32).replace(jc,"")}}_parseVariableLengthRecordContent(e,t,r){switch(e){case"LASF_Projection":return this._parseProjectionRecord(t,r);case"LASF_Spec":return this._parseSpecRecord();default:return this._parseCustomRecord(r)}}_parseProjectionRecord(e,t){switch(e){case 2111:return this._parseOGCMathTransformWKT();case 2112:return this._parseOGCCoordinateTransformWKT();case 34735:return this._parseGeoKeyDirectoryTag();case 34736:return this._parseGeoDoubleParamsTag(t);case 34737:return this._parseGeoASCIIParamsTag(t);default:console.error("Unable to determine LASF_Projection underlying type ! Skip current record."),this._reader.skipOffsetOf(t)}}_parseOGCMathTransformWKT(){}_parseOGCCoordinateTransformWKT(){}_parseGeoKeyDirectoryTag(){const e={wKeyDirectoryVersion:this._reader.getUint16(),wKeyRevision:this._reader.getUint16(),wMinorRevision:this._reader.getUint16(),wNumberOfKeys:this._reader.getUint16(),sKeyEntry:[]};for(let t=0;t<e.wNumberOfKeys;t++)e.sKeyEntry.push({wKeyID:this._reader.getUint16(),wTIFFTagLocation:this._reader.getUint16(),wCount:this._reader.getUint16(),wValue_Offset:this._reader.getUint16()});return e}_parseGeoDoubleParamsTag(e){const t=e/i.Byte.Height,r=[];for(let e=0;e<t;e++)r[e]=this._reader.getFloat64();return r}_parseGeoASCIIParamsTag(e){return this._reader.getString(e).replace(jc,"")}_parseSpecRecord(e){if(!(e<100)){if(e>=100&&e<355)return this._parseWaveformPacketDesciptor();if(65535===e)return this._parseWaveformDataPacket();throw new RangeError(`Invalid spec record id: ${e}`)}switch(e){case 0:return this._parseClassificationLookupRecord();case 1:return this._parseHeaderLookupForFlightLinesRecord();case 2:return this._parseHistogramRecord();case 3:return this._parseTextAreaDescriptionRecord();case 4:return this._parseExtraBytesRecord();case 7:return this._parseSupersededRecord();default:throw new RangeError(`Invalid spec record id: ${e}`)}}_parseClassificationLookupRecord(){const e=[];for(let t=0;t<256;t++)e.push({ClassNumber:this._reader.getUint8(),Description:this._reader.getString(15).replace(jc,"")});return e}_parseHeaderLookupForFlightLinesRecord(){return{FileMarkerNumber:this._reader.getUint8(),Filename:this._reader.getString(256).replace(jc,"")}}_parseHistogramRecord(){}_parseTextAreaDescriptionRecord(){}_parseExtraBytesRecord(){}_parseSupersededRecord(){}_parseWaveformPacketDesciptor(){}_parseWaveformDataPacket(){}_parseCustomRecord(e){const t=new Uint8Array(e);for(let r=0;r<e;r++)t[r]=this._reader.getUint8();return t}_parsePointDataRecords(e,t){const r=e.OffsetToPointData;this._reader.offset!==r&&(console.error("The current reader offset does not match the header offset to point data ! Defaulting to header value."),this._reader.skipOffsetTo(r));const n=e.VersionMinor<4?e.PointDataFormatID:e.PointDataRecordFormat,i=this._getPointDataRecordFormat(n),o=e.VersionMinor<4?e.NumberOfPointRecords:e.LegacyNumberOfPointRecords,a=new Array(o);for(let e=0;e<o;e++)a[e]=i(),e%1e5==0&&t(new ProgressEvent("ParsePointDataRecords",{lengthComputable:!0,loaded:e,total:o}));return a}_getPointDataRecordFormat(e){switch(e){case 0:return this._parsePointDataRecordFormat_0.bind(this);case 1:return this._parsePointDataRecordFormat_1.bind(this);case 2:return this._parsePointDataRecordFormat_2.bind(this);case 3:return this._parsePointDataRecordFormat_3.bind(this);case 4:return this._parsePointDataRecordFormat_4.bind(this);case 5:return this._parsePointDataRecordFormat_5.bind(this);case 6:return this._parsePointDataRecordFormat_6.bind(this);case 7:return this._parsePointDataRecordFormat_7.bind(this);case 8:return this._parsePointDataRecordFormat_8.bind(this);case 9:return this._parsePointDataRecordFormat_9.bind(this);case 10:return this._parsePointDataRecordFormat_10.bind(this);default:throw new RangeError(`Invalid PointDataRecordFormat parameter: ${e}`)}}_parsePointDataRecordFormat_0(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits8(3),NumberOfReturns:this._reader.getBits8(3),ScanDirectionFlag:this._reader.getBit8(),EdgeOfFlightLine:this._reader.getBit8(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},ScanAngleRank:this._reader.getInt8(),UserData:this._reader.getUint8(),PointSourceId:this._reader.getUint16()}}_parsePointDataRecordFormat_1(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits8(3),NumberOfReturns:this._reader.getBits8(3),ScanDirectionFlag:this._reader.getBit8(),EdgeOfFlightLine:this._reader.getBit8(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},ScanAngleRank:this._reader.getInt8(),UserData:this._reader.getUint8(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64()}}_parsePointDataRecordFormat_2(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits8(3),NumberOfReturns:this._reader.getBits8(3),ScanDirectionFlag:this._reader.getBit8(),EdgeOfFlightLine:this._reader.getBit8(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},ScanAngleRank:this._reader.getInt8(),UserData:this._reader.getUint8(),PointSourceId:this._reader.getUint16(),R:this._reader.getUint16(),G:this._reader.getUint16(),B:this._reader.getUint16()}}_parsePointDataRecordFormat_3(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits8(3),NumberOfReturns:this._reader.getBits8(3),ScanDirectionFlag:this._reader.getBit8(),EdgeOfFlightLine:this._reader.getBit8(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},ScanAngleRank:this._reader.getInt8(),UserData:this._reader.getUint8(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),R:this._reader.getUint16(),G:this._reader.getUint16(),B:this._reader.getUint16()}}_parsePointDataRecordFormat_4(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits8(3),NumberOfReturns:this._reader.getBits8(3),ScanDirectionFlag:this._reader.getBit8(),EdgeOfFlightLine:this._reader.getBit8(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},ScanAngleRank:this._reader.getInt8(),UserData:this._reader.getUint8(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),WavePacketDescriptorIndex:this._reader.getUint8(),ByteOffsetToWaveformData:this._reader.getUint64(),WaveformPacketSizeInBytes:this._reader.getUint32(),ReturnPointWaveformLocation:this._reader.getFloat32(),Xt:this._reader.getFloat32(),Yt:this._reader.getFloat32(),Zt:this._reader.getFloat32()}}_parsePointDataRecordFormat_5(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits8(3),NumberOfReturns:this._reader.getBits8(3),ScanDirectionFlag:this._reader.getBit8(),EdgeOfFlightLine:this._reader.getBit8(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},ScanAngleRank:this._reader.getInt8(),UserData:this._reader.getUint8(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),R:this._reader.getUint16(),G:this._reader.getUint16(),B:this._reader.getUint16(),WavePacketDescriptorIndex:this._reader.getUint8(),ByteOffsetToWaveformData:this._reader.getUint64(),WaveformPacketSizeInBytes:this._reader.getUint32(),ReturnPointWaveformLocation:this._reader.getFloat32(),Xt:this._reader.getFloat32(),Yt:this._reader.getFloat32(),Zt:this._reader.getFloat32()}}_parsePointDataRecordFormat_6(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits16(4),NumberOfReturns:this._reader.getBits16(4),ClassificationFlags:this._reader.getBits16(4),ScannerChannel:this._reader.getBits16(2),ScanDirectionFlag:this._reader.getBit16(),EdgeOfFlightLine:this._reader.getBit16(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},UserData:this._reader.getUint8(),ScanAngle:this._reader.getInt16(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64()}}_parsePointDataRecordFormat_7(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits16(4),NumberOfReturns:this._reader.getBits16(4),ClassificationFlags:this._reader.getBits16(4),ScannerChannel:this._reader.getBits16(2),ScanDirectionFlag:this._reader.getBit16(),EdgeOfFlightLine:this._reader.getBit16(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},UserData:this._reader.getUint8(),ScanAngle:this._reader.getInt16(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),R:this._reader.getUint16(),G:this._reader.getUint16(),B:this._reader.getUint16()}}_parsePointDataRecordFormat_8(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits16(4),NumberOfReturns:this._reader.getBits16(4),ClassificationFlags:this._reader.getBits16(4),ScannerChannel:this._reader.getBits16(2),ScanDirectionFlag:this._reader.getBit16(),EdgeOfFlightLine:this._reader.getBit16(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},UserData:this._reader.getUint8(),ScanAngle:this._reader.getInt16(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),R:this._reader.getUint16(),G:this._reader.getUint16(),B:this._reader.getUint16(),NIR:this._reader.getUint16()}}_parsePointDataRecordFormat_9(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits16(4),NumberOfReturns:this._reader.getBits16(4),ClassificationFlags:this._reader.getBits16(4),ScannerChannel:this._reader.getBits16(2),ScanDirectionFlag:this._reader.getBit16(),EdgeOfFlightLine:this._reader.getBit16(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},UserData:this._reader.getUint8(),ScanAngle:this._reader.getInt16(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),WavePacketDescriptorIndex:this._reader.getUint8(),ByteOffsetToWaveformData:this._reader.getUint64(),WaveformPacketSizeInBytes:this._reader.getUint32(),ReturnPointWaveformLocation:this._reader.getFloat32(),Xt:this._reader.getFloat32(),Yt:this._reader.getFloat32(),Zt:this._reader.getFloat32()}}_parsePointDataRecordFormat_10(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits16(4),NumberOfReturns:this._reader.getBits16(4),ClassificationFlags:this._reader.getBits16(4),ScannerChannel:this._reader.getBits16(2),ScanDirectionFlag:this._reader.getBit16(),EdgeOfFlightLine:this._reader.getBit16(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},UserData:this._reader.getUint8(),ScanAngle:this._reader.getInt16(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),R:this._reader.getUint16(),G:this._reader.getUint16(),B:this._reader.getUint16(),NIR:this._reader.getUint16(),WavePacketDescriptorIndex:this._reader.getUint8(),ByteOffsetToWaveformData:this._reader.getUint64(),WaveformPacketSizeInBytes:this._reader.getUint32(),ReturnPointWaveformLocation:this._reader.getFloat32(),Xt:this._reader.getFloat32(),Yt:this._reader.getFloat32(),Zt:this._reader.getFloat32()}}convert(e,t,r,i){try{const i=new n.Group;i.name="Cloud",i.matrixAutoUpdate=!1,i.position.x=e.Header.XOffset,i.position.y=e.Header.YOffset,i.position.z=e.Header.ZOffset,i.userData={header:e.Header,records:e.VariableLengthRecords},this._createCloudPoints(i,e,r),t(i)}catch(e){i(e)}}_offsetPoints(){this._autoOffset&&(this._boundingBox.setFromPoints(this._points),this.setOffset(this._boundingBox.getCenter()));const e=this._offset.x,t=this._offset.y,r=this._offset.z;let n=null;for(let i=0,o=this._points.length;i<o;++i)n=this._points[i],n.x-=e,n.y-=t,n.z-=r}_createCloudPoints(e,t,i){const o={0:"Created",1:"Unclassified",2:"Ground",3:"LowVegetation",4:"MediumVegetation",5:"HighVegetation",6:"Building",7:"LowPoint",8:"ModelKeyPoint",9:"Water",12:"OverlapPoints"};let a=-1/0;for(let e of t.PointDataRecords){const t=e.Intensity;t>a&&(a=t)}const s=t.Header.XScaleFactor,c=t.Header.YScaleFactor,u=t.Header.ZScaleFactor,h=1e6,l=t.PointDataRecords.length,d=Math.ceil(l/h),m=t.Header.VersionMinor<4?t.Header.PointDataFormatID:t.Header.PointDataRecordFormat,f=![0,1,4,6,9].includes(m),g=new n.PointsMaterial({size:.01,vertexColors:!0});let p=0,_=null,y=null;for(let m=0;m<d;++m){_=t.PointDataRecords.splice(0,h),p=_.length;const d=new n.BufferGeometry,S=new Float32Array(3*p),M=new Float32Array(3*p);let b=0,w=null;for(let e=0;e<p;++e){const t=e+m*h;if(t%1e5==0&&i(new ProgressEvent("ConvertPointDataRecords",{lengthComputable:!0,loaded:t,total:l})),w=_[e],S[b]=w.X*s,S[b+1]=w.Y*c,S[b+2]=w.Z*u,f)M[b]=w.R/65535,M[b+1]=w.G/65535,M[b+2]=w.B/65535;else{const e=this.colorForPointClass[o[w.Classification.Class]];if(r.isDefined(e))M[b]=e.r/255,M[b+1]=e.g/255,M[b+2]=e.b/255;else{const e=w.Intensity;M[b]=e/a,M[b+1]=e/a,M[b+2]=e/a}}b+=3}d.setAttribute("position",new n.BufferAttribute(S,3)),d.setAttribute("color",new n.BufferAttribute(M,3)),y=new n.Points(d,g),e.add(y)}}_createSubCloudPoint(e){const t=this._points.length,r=new n.BufferGeometry,i=new Float32Array(3*t),o=new Float32Array(3*t);let a=0,s=null;for(let e=0;e<t;++e)s=this._points[e],i[a]=s.x,i[a+1]=s.y,i[a+2]=s.z,this._pointsHaveColor?(o[a]=s.r/255,o[a+1]=s.g/255,o[a+2]=s.b/255):(o[a]=.1,o[a+1]=.2,o[a+2]=.5),a+=3;r.setAttribute("position",new n.BufferAttribute(i,3)),r.setAttribute("color",new n.BufferAttribute(o,3));const c=new n.PointsMaterial({size:.005,vertexColors:!0}),u=new n.Points(r,c);u.rotation.x-=Math.PI/2,e.children.push(u),this._points=[]}},exports.PointClasses=$c,exports.SHPLoader=F,exports.ShapeType=w,exports.registerPlugin=function(r){return new t.TMongoDBPlugin(r).addType(Ys).addType(Ws).addType(Xs).addType(Zs).addType(qs).addType(Ks).addType(Qs).addType(Js).addSchema(G.Audio).addSchema(R.AudioListener).addSchema(E.PositionalAudio).addSchema(V.ArrayCamera).addSchema(Y.Camera).addSchema(Z.CubeCamera).addSchema(Q.OrthographicCamera).addSchema(ee.PerspectiveCamera).addSchema(oe.BufferAttribute).addSchema(he).addSchema(ye.CurvePath).addSchema(Me.Face3).addSchema(ve).addSchema(D).addSchema(De.Path).addSchema(Pe.Shape).addSchema(Ae.ArcCurve).addSchema(Ue.CatmullRomCurve3).addSchema(He.CubicBezierCurve).addSchema($e.CubicBezierCurve3).addSchema(Ye.Curve).addSchema(Ze.CurveExtras).addSchema(Qe.EllipseCurve).addSchema(tt.LineCurve).addSchema(it.LineCurve3).addSchema(st.NURBSCurve).addSchema(ht.NURBSSurface).addSchema(mt.QuadraticBezierCurve).addSchema(pt.QuadraticBezierCurve3).addSchema(St.SplineCurve).addSchema(Ft.BoxBufferGeometry).addSchema(xt.BoxGeometry).addSchema(Dt.CircleBufferGeometry).addSchema(Pt.CircleGeometry).addSchema(At.ConeBufferGeometry).addSchema(Ut.ConeGeometry).addSchema(Ht.ConvexGeometry).addSchema($t.CylinderBufferGeometry).addSchema(Xt.CylinderGeometry).addSchema(Kt.DecalGeometry).addSchema(er.DodecahedronGeometry).addSchema(nr.EdgesGeometry).addSchema(ar.ExtrudeBufferGeometry).addSchema(ur.ExtrudeGeometry).addSchema(dr.IcosahedronBufferGeometry).addSchema(gr.IcosahedronGeometry).addSchema(yr.InstancedBufferGeometry).addSchema(br.LatheBufferGeometry).addSchema(Tr.LatheGeometry).addSchema(xr.OctahedronBufferGeometry).addSchema(Dr.OctahedronGeometry).addSchema(Pr.ParametricBufferGeometry).addSchema(Ar.ParametricGeometry).addSchema(Ur.PlaneBufferGeometry).addSchema(Hr.PlaneGeometry).addSchema($r.PolyhedronBufferGeometry).addSchema(Xr.PolyhedronGeometry).addSchema(Kr.RingBufferGeometry).addSchema(en.RingGeometry).addSchema(nn.ShapeBufferGeometry).addSchema(sn.ShapeGeometry).addSchema(hn.SphereBufferGeometry).addSchema(mn.SphereGeometry).addSchema(pn.TeapotBufferGeometry).addSchema(Sn.TetrahedronBufferGeometry).addSchema(wn.TetrahedronGeometry).addSchema(vn.TextBufferGeometry).addSchema(Cn.TextGeometry).addSchema(Nn.TorusBufferGeometry).addSchema(Gn.TorusGeometry).addSchema(Rn.TorusKnotBufferGeometry).addSchema(En.TorusKnotGeometry).addSchema(Vn.TubeBufferGeometry).addSchema(Yn.TubeGeometry).addSchema(Zn.WireframeGeometry).addSchema(Qn.ArrowHelper).addSchema(ti.AxesHelper).addSchema(ii.Box3Helper).addSchema(si.BoxHelper).addSchema(hi.CameraHelper).addSchema(mi.DirectionalLightHelper).addSchema(pi.FaceNormalsHelper).addSchema(Si.GridHelper).addSchema(wi.HemisphereLightHelper).addSchema(vi.PlaneHelper).addSchema(Ci.PointLightHelper).addSchema(Ni.PolarGridHelper).addSchema(Gi.RectAreaLightHelper).addSchema(Ri.SkeletonHelper).addSchema(Ei.SpotLightHelper).addSchema(Vi.VertexNormalsHelper).addSchema(Yi.AmbientLight).addSchema(Zi.DirectionalLight).addSchema(Qi.HemisphereLight).addSchema(to.Light).addSchema(io.PointLight).addSchema(so.RectAreaLight).addSchema(lo.SpotLight).addSchema(Ao.MeshPhongMaterial).addSchema(_o.LineBasicMaterial).addSchema(Mo.LineDashedMaterial).addSchema(bo.Material).addSchema(To.MeshBasicMaterial).addSchema(xo.MeshDepthMaterial).addSchema(Do.MeshLambertMaterial).addSchema(Po.MeshNormalMaterial).addSchema(Uo.MeshPhysicalMaterial).addSchema(Ho.MeshStandardMaterial).addSchema($o.MeshToonMaterial).addSchema(Xo.PointsMaterial).addSchema(Ko.RawShaderMaterial).addSchema(ea.ShaderMaterial).addSchema(na.ShadowMaterial).addSchema(aa.SpriteMaterial).addSchema(ua.Box2).addSchema(da.Box3).addSchema(ga.Line3).addSchema(ya.Plane).addSchema(ba.Ray).addSchema(Ta.Sphere).addSchema(xa.Spherical).addSchema(Da.Triangle).addSchema(Ia.Bone).addSchema(Ra).addSchema(ka.ImmediateRenderObject).addSchema(ja.LensFlare).addSchema(Wa.Line).addSchema(qa.LineLoop).addSchema(Ja.LineSegments).addSchema(rs.LOD).addSchema(os.Mesh).addSchema(cs.Points).addSchema(ls.Skeleton).addSchema(fs.SkinnedMesh).addSchema(_s.Sprite).addSchema(bs.Fog).addSchema(vs.Scene).addSchema(Ds.CanvasTexture).addSchema(Ps.CompressedTexture).addSchema(As.CubeTexture).addSchema(Us.DataTexture).addSchema(Hs.DepthTexture).addSchema(Vs.Texture).addSchema($s.VideoTexture).addController(d).addDescriptor({route:"/objects",controller:{name:"TObjects3DController",options:{schemaName:"Objects3D"},can:{create:{on:"put",over:"/(:id)?"},read:{on:"post",over:"/(:id)?"},update:{on:"patch",over:"/(:id)?"},delete:{on:"delete",over:"/(:id)?"}}}}).addController(t.TMongooseController).addDescriptor({route:"/curves",controller:{name:"TMongooseController",options:{schemaName:"Curves"},can:{create:{on:"put",over:"/(:id)?"},read:{on:"post",over:"/(:id)?"},update:{on:"patch",over:"/(:id)?"},delete:{on:"delete",over:"/(:id)?"}}}}).addDescriptor({route:"/geometries",controller:{name:"TMongooseController",options:{schemaName:"Geometries"},can:{create:{on:"put",over:"/(:id)?"},read:{on:"post",over:"/(:id)?"},update:{on:"patch",over:"/(:id)?"},delete:{on:"delete",over:"/(:id)?"}}}}).addDescriptor({route:"/materials",controller:{name:"TMongooseController",options:{schemaName:"Materials"},can:{create:{on:"put",over:"/(:id)?"},read:{on:"post",over:"/(:id)?"},update:{on:"patch",over:"/(:id)?"},delete:{on:"delete",over:"/(:id)?"}}}}).addDescriptor({route:"/textures",controller:{name:"TMongooseController",options:{schemaName:"Textures"},can:{create:{on:"put",over:"/(:id)?"},read:{on:"post",over:"/(:id)?"},update:{on:"patch",over:"/(:id)?"},delete:{on:"delete",over:"/(:id)?"}}}}).addController(e.TAbstractConverterManager).addDescriptor({route:"/uploads",controller:{name:"TAbstractConverterManager",options:{useNext:!0,converters:{JsonToThree:new S,ShpToThree:new T,DbfToThree:new _,FbxToThree:new y,ColladaToThree:new m,StlToThree:new v,TdsToThree:new B,MtlToThree:new M,ObjToThree:new b},rules:[{on:".json",use:"JsonToThree"},{on:".dae",use:"ColladaToThree"},{on:".fbx",use:"FbxToThree"},{on:".stl",use:"StlToThree"},{on:".3ds",use:"TdsToThree"},{on:".shp",use:"ShpToThree"},{on:".dbf",use:"DbfToThree"},{on:[".shp",".dbf"],use:["ShpToThree","DbfToThree"]},{on:".mtl",use:"MtlToThree"},{on:".obj",use:"ObjToThree"},{on:[".mtl",".obj"],use:["MtlToThree","ObjToThree"]}],inserter:x},can:{processFiles:{on:"post",over:"/"}}}})};
