this.Itee=this.Itee||{},this.Itee["Plugin-three"]=function(e,t,i,r,s,n){"use strict";
/**
	 * @license
	 * Copyright 2010-2023 Three.js Authors
	 * SPDX-License-Identifier: MIT
	 */const a="srgb",o="srgb-linear";function h(e,t,i){return Math.max(t,Math.min(i,e))}function l(e,t,i){return(1-i)*e+i*t}function c(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function d(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}const u={[a]:{[o]:c},[o]:{[a]:d}},p={legacyMode:!0,get workingColorSpace(){return o},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,i){if(this.legacyMode||t===i||!t||!i)return e;if(u[t]&&void 0!==u[t][i]){const r=u[t][i];return e.r=r(e.r),e.g=r(e.g),e.b=r(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},_={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},g={r:0,g:0,b:0},m={h:0,s:0,l:0},f={h:0,s:0,l:0};function y(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}function w(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}class b{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=a){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,p.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=p.workingColorSpace){return this.r=e,this.g=t,this.b=i,p.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=p.workingColorSpace){var s;if(e=(e%(s=1)+s)%s,t=h(t,0,1),i=h(i,0,1),0===t)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+t):i+t-i*t,s=2*i-r;this.r=y(s,r,e+1/3),this.g=y(s,r,e),this.b=y(s,r,e-1/3)}return p.toWorkingColorSpace(this,r),this}setStyle(e,t=a){function i(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const s=r[1],n=r[2];switch(s){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,p.toWorkingColorSpace(this,t),i(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,p.toWorkingColorSpace(this,t),i(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n)){const r=parseFloat(e[1])/360,s=parseFloat(e[2])/100,n=parseFloat(e[3])/100;return i(e[4]),this.setHSL(r,s,n,t)}}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=r[1],i=e.length;if(3===i)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,p.toWorkingColorSpace(this,t),this;if(6===i)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,p.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=a){const i=_[e.toLowerCase()];return void 0!==i?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=c(e.r),this.g=c(e.g),this.b=c(e.b),this}copyLinearToSRGB(e){return this.r=d(e.r),this.g=d(e.g),this.b=d(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=a){return p.fromWorkingColorSpace(w(this,g),e),h(255*g.r,0,255)<<16^h(255*g.g,0,255)<<8^h(255*g.b,0,255)}getHexString(e=a){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=p.workingColorSpace){p.fromWorkingColorSpace(w(this,g),t);const i=g.r,r=g.g,s=g.b,n=Math.max(i,r,s),a=Math.min(i,r,s);let o,h;const l=(a+n)/2;if(a===n)o=0,h=0;else{const e=n-a;switch(h=l<=.5?e/(n+a):e/(2-n-a),n){case i:o=(r-s)/e+(r<s?6:0);break;case r:o=(s-i)/e+2;break;case s:o=(i-r)/e+4}o/=6}return e.h=o,e.s=h,e.l=l,e}getRGB(e,t=p.workingColorSpace){return p.fromWorkingColorSpace(w(this,g),t),e.r=g.r,e.g=g.g,e.b=g.b,e}getStyle(e=a){return p.fromWorkingColorSpace(w(this,g),e),e!==a?`color(${e} ${g.r} ${g.g} ${g.b})`:`rgb(${255*g.r|0},${255*g.g|0},${255*g.b|0})`}offsetHSL(e,t,i){return this.getHSL(m),m.h+=e,m.s+=t,m.l+=i,this.setHSL(m.h,m.s,m.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(m),e.getHSL(f);const i=l(m.h,f.h,t),r=l(m.s,f.s,t),s=l(m.l,f.l,t);return this.setHSL(i,r,s),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}b.NAMES=_;class x{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,s,n,a){let o=i[r+0],h=i[r+1],l=i[r+2],c=i[r+3];const d=s[n+0],u=s[n+1],p=s[n+2],_=s[n+3];if(0===a)return e[t+0]=o,e[t+1]=h,e[t+2]=l,void(e[t+3]=c);if(1===a)return e[t+0]=d,e[t+1]=u,e[t+2]=p,void(e[t+3]=_);if(c!==_||o!==d||h!==u||l!==p){let e=1-a;const t=o*d+h*u+l*p+c*_,i=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){const s=Math.sqrt(r),n=Math.atan2(s,t*i);e=Math.sin(e*n)/s,a=Math.sin(a*n)/s}const s=a*i;if(o=o*e+d*s,h=h*e+u*s,l=l*e+p*s,c=c*e+_*s,e===1-a){const e=1/Math.sqrt(o*o+h*h+l*l+c*c);o*=e,h*=e,l*=e,c*=e}}e[t]=o,e[t+1]=h,e[t+2]=l,e[t+3]=c}static multiplyQuaternionsFlat(e,t,i,r,s,n){const a=i[r],o=i[r+1],h=i[r+2],l=i[r+3],c=s[n],d=s[n+1],u=s[n+2],p=s[n+3];return e[t]=a*p+l*c+o*u-h*d,e[t+1]=o*p+l*d+h*c-a*u,e[t+2]=h*p+l*u+a*d-o*c,e[t+3]=l*p-a*c-o*d-h*u,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const i=e._x,r=e._y,s=e._z,n=e._order,a=Math.cos,o=Math.sin,h=a(i/2),l=a(r/2),c=a(s/2),d=o(i/2),u=o(r/2),p=o(s/2);switch(n){case"XYZ":this._x=d*l*c+h*u*p,this._y=h*u*c-d*l*p,this._z=h*l*p+d*u*c,this._w=h*l*c-d*u*p;break;case"YXZ":this._x=d*l*c+h*u*p,this._y=h*u*c-d*l*p,this._z=h*l*p-d*u*c,this._w=h*l*c+d*u*p;break;case"ZXY":this._x=d*l*c-h*u*p,this._y=h*u*c+d*l*p,this._z=h*l*p+d*u*c,this._w=h*l*c-d*u*p;break;case"ZYX":this._x=d*l*c-h*u*p,this._y=h*u*c+d*l*p,this._z=h*l*p-d*u*c,this._w=h*l*c+d*u*p;break;case"YZX":this._x=d*l*c+h*u*p,this._y=h*u*c+d*l*p,this._z=h*l*p-d*u*c,this._w=h*l*c-d*u*p;break;case"XZY":this._x=d*l*c-h*u*p,this._y=h*u*c-d*l*p,this._z=h*l*p+d*u*c,this._w=h*l*c+d*u*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+n)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],s=t[8],n=t[1],a=t[5],o=t[9],h=t[2],l=t[6],c=t[10],d=i+a+c;if(d>0){const e=.5/Math.sqrt(d+1);this._w=.25/e,this._x=(l-o)*e,this._y=(s-h)*e,this._z=(n-r)*e}else if(i>a&&i>c){const e=2*Math.sqrt(1+i-a-c);this._w=(l-o)/e,this._x=.25*e,this._y=(r+n)/e,this._z=(s+h)/e}else if(a>c){const e=2*Math.sqrt(1+a-i-c);this._w=(s-h)/e,this._x=(r+n)/e,this._y=.25*e,this._z=(o+l)/e}else{const e=2*Math.sqrt(1+c-i-a);this._w=(n-r)/e,this._x=(s+h)/e,this._y=(o+l)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(h(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(0===i)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,s=e._z,n=e._w,a=t._x,o=t._y,h=t._z,l=t._w;return this._x=i*l+n*a+r*h-s*o,this._y=r*l+n*o+s*a-i*h,this._z=s*l+n*h+i*o-r*a,this._w=n*l-i*a-r*o-s*h,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const i=this._x,r=this._y,s=this._z,n=this._w;let a=n*e._w+i*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=n,this._x=i,this._y=r,this._z=s,this;const o=1-a*a;if(o<=Number.EPSILON){const e=1-t;return this._w=e*n+t*this._w,this._x=e*i+t*this._x,this._y=e*r+t*this._y,this._z=e*s+t*this._z,this.normalize(),this._onChangeCallback(),this}const h=Math.sqrt(o),l=Math.atan2(h,a),c=Math.sin((1-t)*l)/h,d=Math.sin(t*l)/h;return this._w=n*c+this._w*d,this._x=i*c+this._x*d,this._y=r*c+this._y*d,this._z=s*c+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(s),i*Math.cos(s),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class v{constructor(e=0,t=0,i=0){v.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(E.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(E.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*r,this.y=s[1]*t+s[4]*i+s[7]*r,this.z=s[2]*t+s[5]*i+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=e.elements,n=1/(s[3]*t+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*r+s[12])*n,this.y=(s[1]*t+s[5]*i+s[9]*r+s[13])*n,this.z=(s[2]*t+s[6]*i+s[10]*r+s[14])*n,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,s=e.x,n=e.y,a=e.z,o=e.w,h=o*t+n*r-a*i,l=o*i+a*t-s*r,c=o*r+s*i-n*t,d=-s*t-n*i-a*r;return this.x=h*o+d*-s+l*-a-c*-n,this.y=l*o+d*-n+c*-s-h*-a,this.z=c*o+d*-a+h*-n-l*-s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r,this.y=s[1]*t+s[5]*i+s[9]*r,this.z=s[2]*t+s[6]*i+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,s=e.z,n=t.x,a=t.y,o=t.z;return this.x=r*o-s*a,this.y=s*n-i*o,this.z=i*a-r*n,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return M.copy(this).projectOnVector(e),this.sub(M)}reflect(e){return this.sub(M.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(h(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const M=new v,E=new x;"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"149"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="149")
/**
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 */;const S=t.toEnum({Black:new b("#000000"),Navy:new b("#000080"),DarkBlue:new b("#00008b"),MediumBlue:new b("#0000cd"),Blue:new b("#0000ff"),DarkGreen:new b("#006400"),Green:new b("#008000"),Teal:new b("#008080"),DarkCyan:new b("#008b8b"),DeepSkyBlue:new b("#00bfff"),DarkTurquoise:new b("#00ced1"),MediumSpringGreen:new b("#00fa9a"),Lime:new b("#00ff00"),SpringGreen:new b("#00ff7f"),Aqua:new b("#00ffff"),Cyan:new b("#00ffff"),MidnightBlue:new b("#191970"),DodgerBlue:new b("#1e90ff"),LightSeaGreen:new b("#20b2aa"),ForestGreen:new b("#228b22"),SeaGreen:new b("#2e8b57"),DarkSlateGray:new b("#2f4f4f"),DarkSlateGrey:new b("#2f4f4f"),LimeGreen:new b("#32cd32"),MediumSeaGreen:new b("#3cb371"),Turquoise:new b("#40e0d0"),RoyalBlue:new b("#4169e1"),SteelBlue:new b("#4682b4"),DarkSlateBlue:new b("#483d8b"),MediumTurquoise:new b("#48d1cc"),Indigo:new b("#4b0082"),DarkOliveGreen:new b("#556b2f"),CadetBlue:new b("#5f9ea0"),CornflowerBlue:new b("#6495ed"),RebeccaPurple:new b("#663399"),MediumAquaMarine:new b("#66cdaa"),DimGray:new b("#696969"),DimGrey:new b("#696969"),SlateBlue:new b("#6a5acd"),OliveDrab:new b("#6b8e23"),SlateGray:new b("#708090"),SlateGrey:new b("#708090"),LightSlateGray:new b("#778899"),LightSlateGrey:new b("#778899"),MediumSlateBlue:new b("#7b68ee"),LawnGreen:new b("#7cfc00"),Chartreuse:new b("#7fff00"),Aquamarine:new b("#7fffd4"),Maroon:new b("#800000"),Purple:new b("#800080"),Olive:new b("#808000"),Gray:new b("#808080"),Grey:new b("#808080"),SkyBlue:new b("#87ceeb"),LightSkyBlue:new b("#87cefa"),BlueViolet:new b("#8a2be2"),DarkRed:new b("#8b0000"),DarkMagenta:new b("#8b008b"),SaddleBrown:new b("#8b4513"),DarkSeaGreen:new b("#8fbc8f"),LightGreen:new b("#90ee90"),MediumPurple:new b("#9370db"),DarkViolet:new b("#9400d3"),PaleGreen:new b("#98fb98"),DarkOrchid:new b("#9932cc"),YellowGreen:new b("#9acd32"),Sienna:new b("#a0522d"),Brown:new b("#a52a2a"),DarkGray:new b("#a9a9a9"),DarkGrey:new b("#a9a9a9"),LightBlue:new b("#add8e6"),GreenYellow:new b("#adff2f"),PaleTurquoise:new b("#afeeee"),LightSteelBlue:new b("#b0c4de"),PowderBlue:new b("#b0e0e6"),FireBrick:new b("#b22222"),DarkGoldenRod:new b("#b8860b"),MediumOrchid:new b("#ba55d3"),RosyBrown:new b("#bc8f8f"),DarkKhaki:new b("#bdb76b"),Silver:new b("#c0c0c0"),MediumVioletRed:new b("#c71585"),IndianRed:new b("#cd5c5c"),Peru:new b("#cd853f"),Chocolate:new b("#d2691e"),Tan:new b("#d2b48c"),LightGray:new b("#d3d3d3"),LightGrey:new b("#d3d3d3"),Thistle:new b("#d8bfd8"),Orchid:new b("#da70d6"),GoldenRod:new b("#daa520"),PaleVioletRed:new b("#db7093"),Crimson:new b("#dc143c"),Gainsboro:new b("#dcdcdc"),Plum:new b("#dda0dd"),BurlyWood:new b("#deb887"),LightCyan:new b("#e0ffff"),Lavender:new b("#e6e6fa"),DarkSalmon:new b("#e9967a"),Violet:new b("#ee82ee"),PaleGoldenRod:new b("#eee8aa"),LightCoral:new b("#f08080"),Khaki:new b("#f0e68c"),AliceBlue:new b("#f0f8ff"),HoneyDew:new b("#f0fff0"),Azure:new b("#f0ffff"),SandyBrown:new b("#f4a460"),Wheat:new b("#f5deb3"),Beige:new b("#f5f5dc"),WhiteSmoke:new b("#f5f5f5"),MintCream:new b("#f5fffa"),GhostWhite:new b("#f8f8ff"),Salmon:new b("#fa8072"),AntiqueWhite:new b("#faebd7"),Linen:new b("#faf0e6"),LightGoldenRodYellow:new b("#fafad2"),OldLace:new b("#fdf5e6"),Red:new b("#ff0000"),Fuchsia:new b("#ff00ff"),Magenta:new b("#ff00ff"),DeepPink:new b("#ff1493"),OrangeRed:new b("#ff4500"),Tomato:new b("#ff6347"),HotPink:new b("#ff69b4"),Coral:new b("#ff7f50"),DarkOrange:new b("#ff8c00"),LightSalmon:new b("#ffa07a"),Orange:new b("#ffa500"),LightPink:new b("#ffb6c1"),Pink:new b("#ffc0cb"),Gold:new b("#ffd700"),PeachPuff:new b("#ffdab9"),NavajoWhite:new b("#ffdead"),Moccasin:new b("#ffe4b5"),Bisque:new b("#ffe4c4"),MistyRose:new b("#ffe4e1"),BlanchedAlmond:new b("#ffebcd"),PapayaWhip:new b("#ffefd5"),LavenderBlush:new b("#fff0f5"),SeaShell:new b("#fff5ee"),Cornsilk:new b("#fff8dc"),LemonChiffon:new b("#fffacd"),FloralWhite:new b("#fffaf0"),Snow:new b("#fffafa"),Yellow:new b("#ffff00"),LightYellow:new b("#ffffe0"),Ivory:new b("#fffff0"),White:new b("#ffffff")});
/**
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 */
const D=new v(-1,-1,-1).normalize(),P=new v(-1,-1,0).normalize(),F=new v(-1,-1,1).normalize(),A=new v(-1,0,-1).normalize(),B=new v(-1,0,0).normalize(),T=new v(-1,0,1).normalize(),O=new v(-1,1,-1).normalize(),C=new v(-1,1,0).normalize(),z=new v(-1,1,1).normalize(),k=new v(0,-1,-1).normalize(),I=new v(0,-1,0).normalize(),R=new v(0,-1,1).normalize(),L=new v(0,0,-1).normalize(),U=new v(0,0,0).normalize(),G=new v(0,0,1).normalize(),N=new v(0,1,-1).normalize(),H=new v(0,1,0).normalize(),V=new v(0,1,1).normalize(),j=new v(1,-1,-1).normalize(),Y=new v(1,-1,0).normalize(),W=new v(1,-1,1).normalize(),X=new v(1,0,-1).normalize(),Z=new v(1,0,0).normalize(),K={Left_Down_Back:D,Left_Down:P,Left_Down_Front:F,Left_Back:A,Left:B,Left_Front:T,Left_Up_Back:O,Left_Up:C,Left_Up_Front:z,Down_Back:k,Down:I,Down_Front:R,Back:L,Null:U,Front:G,Up_Back:N,Up:H,Up_Front:V,Right_Down_Back:j,Right_Down:Y,Right_Down_Front:W,Right_Back:X,Right:Z,Right_Front:new v(1,0,1).normalize(),Right_Up_Back:new v(1,1,-1).normalize(),Right_Up:new v(1,1,0).normalize(),Right_Up_Front:new v(1,1,1).normalize(),Cardinales:{North:L,North_North_East:new v(i.OneHalf,0,-i.SquareRootOfThreeOnTwo).normalize(),North_East:new v(i.SquareRootOfTwoOnTwo,0,-i.SquareRootOfTwoOnTwo).normalize(),East_North_East:new v(i.SquareRootOfThreeOnTwo,0,-i.OneHalf).normalize(),East:Z,East_South_East:new v(i.SquareRootOfThreeOnTwo,0,- -i.OneHalf).normalize(),South_East:new v(i.SquareRootOfTwoOnTwo,0,- -i.SquareRootOfTwoOnTwo).normalize(),South_South_East:new v(i.OneHalf,0,- -i.SquareRootOfThreeOnTwo).normalize(),South:G,South_South_West:new v(-i.OneHalf,0,- -i.SquareRootOfThreeOnTwo).normalize(),South_West:new v(-i.SquareRootOfTwoOnTwo,0,- -i.SquareRootOfTwoOnTwo).normalize(),West_South_West:new v(-i.SquareRootOfThreeOnTwo,0,- -i.OneHalf).normalize(),West:B,West_North_West:new v(-i.SquareRootOfThreeOnTwo,0,-i.OneHalf).normalize(),North_West:new v(-i.SquareRootOfTwoOnTwo,0,-i.SquareRootOfTwoOnTwo).normalize(),North_North_West:new v(-i.OneHalf,0,-i.SquareRootOfThreeOnTwo).normalize()}};
/**
	 * @module Loader/DBFLoader
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 *
	 * From:
	 * https://www.clicketyclick.dk/databases/xbase/format/db2_dbf.html#DBII_DBF_STRUCT
	 * http://web.archive.org/web/20150323061445/http://ulisse.elettra.trieste.it/services/doc/dbase/DBFstruct.htm
	 * http://www.dbase.com/Knowledgebase/INT/db7_file_fmt.htm
	 *
	 *
	 */
const q=t.toEnum({FoxPro:48,FoxPro_Autoincrement:49,dBASE_II:2,FoxPro_Var:50,dBASE_III_plus:3,dBASE_III_plus_memo:131,dBASE_IV_SQL_table:67,dBASE_IV_SQL_system:99,dBASE_IV_memo:139,dBASE_IV_memo_SQL_table:203,FoxBase:251,dBase_v_7:4,FoxPro_2_x:245,HiPerSix_memo:229}),$=t.toEnum({Binary:"B",Character:"C",Date:"D",Numeric:"N",Logical:"L",Memo:"M",Timestamp:"@",Long:"I",Autoincrement:"+",Float:"F",Double:"O",OLE:"G"});class Q{constructor(e={}){const t={manager:r.DefaultLoadingManager,logger:i.DefaultLogger,reader:new s.TBinaryReader,...e};this.manager=t.manager,this.logger=t.logger,this.reader=t.reader}get manager(){return this._manager}set manager(e){this._manager=e}get logger(){return this._logger}set logger(e){this._logger=e}get reader(){return this._reader}set reader(e){this._reader=e}setManager(e){return this.manager=e,this}setLogger(e){return this.logger=e,this}setReader(e){return this.reader=e,this}load(e,t,i,s){const n=this,a=new r.FileLoader(n.manager);a.setResponseType("arraybuffer"),a.load(e,e=>{t(n.parse(e))},i,s)}parse(e){this.reader.setEndianess(s.Endianness.Big).setBuffer(e);const t=this.reader.getInt8();if(!this._isValidVersion(t))return this.logger.error(`DBFLoader: Invalid version number: ${t}`),null;const i=this._parseHeader(t);return{header:i,datas:this._parseDatas(t,i)}}_isValidVersion(e){return q.includes(e)}_parseHeader(e){let t={};switch(e){case q.FoxPro:case q.FoxPro_Autoincrement:case q.FoxPro_Var:case q.dBASE_II:t=this._parseHeaderV2();break;case q.dBASE_III_plus:case q.dBASE_III_plus_memo:t=this._parseHeaderV2_5();break;case q.dBASE_IV_memo:case q.dBASE_IV_memo_SQL_table:case q.dBASE_IV_SQL_system:case q.dBASE_IV_SQL_table:t=this._parseHeaderV3();break;case q.dBase_v_7:case q.FoxPro_2_x:case q.HiPerSix_memo:t=this._parseHeaderV4();break;default:throw new RangeError(`Invalid version parameter: ${e}`)}return this.reader.getUint8()!==Q.Terminator&&this.logger.error("DBFLoader: Invalid terminator after field descriptors !!!"),t}_parseHeaderV2(){const e=this.reader.getInt16(),t=this.reader.getInt8()+Q.YearOffset,i=this.reader.getInt8(),r=this.reader.getInt8(),s=this.reader.getInt16();let n,a,o,h,l,c=[];for(let t=0;t<e;t++)n=this.reader.getString(11),a=this.reader.getChar(),o=this.reader.getUint8(),h=this.reader.getInt16(),l=this.reader.getInt8(),c.push({name:n,type:a,length:o,memoryAddress:h,decimalCount:l});return{numberOfRecords:e,year:t,month:i,day:r,lengthOfEachRecords:s,fields:c}}_parseHeaderV2_5(){const e=this.reader.getInt8()+Q.YearOffset,t=this.reader.getInt8(),i=this.reader.getInt8();this.reader.setEndianess(s.Endianness.Little);const r=this.reader.getInt32(),n=this.reader.getInt16(),a=this.reader.getInt16();this.reader.setEndianess(s.Endianness.Big),this.reader.skipOffsetOf(20);let o,h,l,c,d,u,p,_=[];for(let e=0;e<r;e++)o=this.reader.getString(11),h=this.reader.getChar(),c=this.reader.getInt32(),l=this.reader.getUint8(),d=this.reader.getUint8(),this.reader.skipOffsetOf(2),u=this.reader.getInt8(),this.reader.skipOffsetOf(2),p=this.reader.getInt8(),this.reader.skipOffsetOf(1),_.push({name:o,type:h,length:l,memoryAddress:c,decimalCount:d,workAreaId:u,MDXFlag:p});return{year:e,month:t,day:i,numberOfRecords:r,numberOfByteInHeader:n,numberOfByteInRecord:a,fields:_}}_parseHeaderV3(){const e=this.reader.getInt8()+Q.YearOffset,t=this.reader.getInt8(),i=this.reader.getInt8();this.reader.setEndianess(s.Endianness.Little);const r=this.reader.getInt32(),n=this.reader.getInt16(),a=this.reader.getInt16();this.reader.setEndianess(s.Endianness.Big),this.reader.skipOffsetOf(2);const o=this.reader.getInt8(),h=this.reader.getInt8();this.reader.skipOffsetOf(12);const l=this.reader.getInt8(),c=this.reader.getInt8();this.reader.skipOffsetOf(2);let d,u,p,_,g,m,f=[];for(;this.reader.getOffset()<n-1;)d=this.reader.getString(11),u=this.reader.getChar(),this.reader.skipOffsetOf(4),p=this.reader.getUint8(),_=this.reader.getUint8(),this.reader.skipOffsetOf(2),g=this.reader.getInt8(),this.reader.skipOffsetOf(10),m=this.reader.getInt8(),f.push({name:d,type:u,length:p,decimalCount:_,workAreaId:g,MDXFieldFlag:m});return{year:e,month:t,day:i,numberOfRecords:r,numberOfByteInHeader:n,numberOfByteInRecord:a,incompleteTransactionFlag:o,encryptionFlag:h,MDXFlag:l,languageDriverId:c,fields:f}}_parseHeaderV4(){const e=this.reader.getInt8()+Q.YearOffset,t=this.reader.getInt8(),i=this.reader.getInt8();this.reader.setEndianess(s.Endianness.Little);const r=this.reader.getInt32(),n=this.reader.getInt16(),a=this.reader.getInt16();this.reader.setEndianess(s.Endianness.Big),this.reader.skipOffsetOf(2);const o=this.reader.getInt8(),h=this.reader.getInt8();this.reader.skipOffsetOf(12);const l=this.reader.getInt8(),c=this.reader.getInt8();this.reader.skipOffsetOf(2);const d=this.reader.getString(32);this.reader.skipOffsetOf(4);let u,p,_,g,m,f,y=[];for(let e=0;e<r;e++)u=this.reader.getString(32),p=this.reader.getChar(),_=this.reader.getUint8(),g=this.reader.getUint8(),this.reader.skipOffsetOf(2),m=this.reader.getInt8(),this.reader.skipOffsetOf(2),f=this.reader.getInt32(),this.reader.skipOffsetOf(4),y.push({name:u,type:p,length:_,decimalCount:g,MDXFieldFlag:m,nextAutoincrementValue:f});return{year:e,month:t,day:i,numberOfRecords:r,numberOfByteInHeader:n,numberOfByteInRecord:a,incompleteTransactionFlag:o,encryptionFlag:h,MDXFlag:l,languageDriverId:c,languageDriverName:d,fields:y}}_parseDatas(e,t){const i=t.numberOfRecords,r=t.fields;let s=[],n=null,a=null;for(let e=0;e<i;e++){n={},n.deleted=this.reader.getUint8()===Q.DeletedRecord;for(let e=0,t=r.length;e<t;e++)switch(a=r[e],a.type){case $.Binary:{const e=this.reader.getString(a.length);n[a.name]=parseInt(e)}break;case $.Numeric:{const e=this.reader.getString(a.length);n[a.name]=parseInt(e)}break;case $.Character:case $.Date:n[a.name]=this.reader.getString(a.length);break;case $.Logical:{const e=this.reader.getChar().toLowerCase();n[a.name]="t"===e||"y"===e||"f"!==e&&"n"!==e&&null}break;case $.Memo:n[a.name]=this.reader.getString(a.length);break;case $.Timestamp:break;case $.Long:case $.Autoincrement:n[a.name]=this.reader.getInt32();break;case $.Float:{const e=this.reader.getString(a.length);n[a.name]=parseInt(e)}break;case $.Double:n[a.name]=this.reader.getFloat64();break;case $.OLE:n[a.name]=this.reader.getString(a.length);break;default:throw new RangeError(`Invalid data type parameter: ${a.type}`)}s.push(n)}return s}_parseFieldProperties(){const e=this.reader.getInt16(),t=this.reader.getInt16(),i=this.reader.getInt16(),r=this.reader.getInt16(),s=this.reader.getInt16(),n=this.reader.getInt16(),a=this.reader.getInt16(),o=this.reader.getInt16();let h=[];for(let t=0;t<e;t++)h.push(this._getStandardProperties());let l=[];for(let e=0;e<i;e++)l.push(this._getCustomProperties());let c=[];for(let e=0;e<s;e++)c.push(this._getReferentialIntegrityProperties());return{numberOfStandardProperties:e,startOfStandardPropertiesDescriptor:t,numberOfCustomProperties:i,startOfCustomPropertiesDescriptor:r,numberOfReferentialIntegrityProperties:s,startOfReferentialIntegrityDescriptor:n,startOfData:a,sizeOfPropertiesStructure:o,standardProperties:h,customProperties:l,referentialIntegrityProperties:c}}_getStandardProperties(){const e=this.reader.getInt16(),t=this.reader.getInt16(),i=this.reader.getInt8(),r=this.reader.getInt8(),s=this.reader.getInt8();this.reader.skipOffsetOf(4);return{generationalNumber:e,tableFieldOffset:t,propertyDescribed:i,type:r,isConstraint:s,offsetFromStart:this.reader.getInt16(),widthOfDatabaseField:this.reader.getInt16()}}_getCustomProperties(){const e=this.reader.getInt16(),t=this.reader.getInt16(),i=this.reader.getInt8();this.reader.skipOffsetOf(1);return{generationalNumber:e,tableFieldOffset:t,type:i,offsetFromStartOfName:this.reader.getInt16(),lengthOfName:this.reader.getInt16(),offsetFromStartOfData:this.reader.getInt16(),lengthOfData:this.reader.getInt16()}}_getReferentialIntegrityProperties(){return{databaseState:this.reader.getInt8(),sequentialNumberRule:this.reader.getInt16(),offsetOfTheRIRuleName:this.reader.getInt16(),sizeOfTheRIRuleName:this.reader.getInt16(),offsetOfNameOfForeignTable:this.reader.getInt16(),sizeOfNameOfForeignTable:this.reader.getInt16(),stateBehaviour:this.reader.getInt8(),numberOfFieldsInLinkingKey:this.reader.getInt16(),offsetOfLocalTableTagName:this.reader.getInt16(),sizeOfTheLocalTableTagName:this.reader.getInt16(),offsetOfForeignTableTagName:this.reader.getInt16(),sizeOfTheForeignTableTagName:this.reader.getInt16()}}}Q.Terminator=13,Q.DeletedRecord=26,Q.YearOffset=1900;
/**
	 * @module Loader/LASLoader
	 * @desc A loader for ASC cloud point files.
	 *
	 * @requires {@link https://github.com/Itee/@itee/client @itee/client}
	 * @requires {@link https://github.com/Itee/three-full three-full}
	 *
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 * @example
	 *
	 * import { LASLoader } from '@itee/plugin-three'
	 *
	 * const loader = new LASLoader();
	 *
	 * // If the ASC file need to be offseted, it can be set before loading file.
	 * loader.setOffset( {
	 *      x: 1.0,
	 *      y: 52.0,
	 *      z: -5.0
	 * } );
	 *
	 * // Then load the file and get the threejs Point Geometry
	 * loader.load('/path/to/file.asc', function (geometry) {
	 *
	 *      scene.add( new Mesh( geometry ) );
	 *
	 * } );
	 *
	 */
const J=new RegExp("\0","g"),ee=t.toEnum({Created:0,Unclassified:1,Ground:2,LowVegetation:3,MediumVegetation:4,HighVegetation:5,Building:6,LowPoint:7,ModelKeyPoint:8,Water:9,OverlapPoints:12});
/**
	 * @module Loader/SHPLoader
	 * @desc Export SHPLoader to load .shp files
	 *
	 * @requires {@link https://github.com/Itee/@itee/client @itee/client}
	 * @requires {@link https://github.com/Itee/@itee/utils @itee/utils}
	 * @requires {@link https://github.com/Itee/three-full three-full}
	 *
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 * @example Todo...
	 *
	 */
const te=t.toEnum({NullShape:0,Point:1,Polyline:3,Polygon:5,MultiPoint:8,PointZ:11,PolyLineZ:13,PolygonZ:15,MultiPointZ:18,PointM:21,PolylineM:23,PolygonM:25,MultiPointM:28,MultiPatch:31});class ie{constructor(e={}){const t={manager:r.DefaultLoadingManager,logger:i.DefaultLogger,reader:new s.TBinaryReader,globalOffset:new r.Vector3(0,0,0),worldAxis:{from:"zUp",to:"zForward"},...e};this.manager=t.manager,this.logger=t.logger,this.reader=t.reader,this.globalOffset=t.globalOffset,this.worldAxis=t.worldAxis}get globalOffset(){return this._globalOffset}set globalOffset(e){this._globalOffset=e}get worldAxis(){return this._worldAxis}set worldAxis(e){this._worldAxis=e}get manager(){return this._manager}set manager(e){this._manager=e}get logger(){return this._logger}set logger(e){this._logger=e}get reader(){return this._reader}set reader(e){this._reader=e}setGlobalOffset(e){return this.globalOffset=e,this}setWorldAxis(e){return this.worldAxis=e,this}setManager(e){return this.manager=e,this}setLogger(e){return this.logger=e,this}setReader(e){return this.reader=e,this}load(e,t,i,s){const n=this,a=new r.FileLoader(n.manager);a.setResponseType("arraybuffer"),a.load(e,e=>{t(n.parse(e))},i,s)}parse(e){this._reader.setEndianess(s.Endianness.Big).setBuffer(e);const t=this._parseHeader();if(t.fileCode!==ie.FileCode)return this.logger.error("SHPLoader: Invalide Shape file code !"),null;if(t.fileLength<ie.MinFileLength)return this.logger.error("SHPLoader: Shape file have an incorrect length !"),null;if(!Object.values(te).includes(t.shapeType))return this.logger.error("SHPLoader: Shape file have an incorrect shape type !"),null;t.version<ie.MinVersion&&this.logger.warn("SHPLoader: Version of shape file below than 1000 could be incorrectly parsed !");const i=this._parseDatas(t);return this._convertToObjects(i)}_parseHeader(){const e=this._reader.getInt32();this._reader.skipOffsetOf(20);const t=this._reader.getInt32();this._reader.setEndianess(s.Endianness.Little);const i=this._reader.getInt32(),r=this._reader.getInt32(),n=this._reader.getInt32(),a=this._reader.getInt32();return{fileCode:e,fileLength:t,version:i,shapeType:r,boundingBox:{xMin:n,xMax:this._reader.getInt32(),yMin:a,yMax:this._reader.getInt32(),zMin:this._reader.getInt32(),zMax:this._reader.getInt32(),mMin:this._reader.getInt32(),mMax:this._reader.getInt32()}}}_parseDatas(e){this._reader.skipOffsetTo(100);let t,i,r,n=[];for(;!this._reader.isEndOfFile();)switch(t=this._parseRecordHeader(),i=this._reader.getOffset()+2*t.contentLength,this._reader.setEndianess(s.Endianness.Little),e.shapeType){case te.NullShape:this._reader.skipOffsetTo(i);break;case te.Point:case te.PointZ:case te.PointM:for(;this._reader.getOffset()<i;)r=this._parsePoint(),r&&n.push(r);break;case te.Polyline:case te.PolyLineZ:case te.PolylineM:for(;this._reader.getOffset()<i;)r=this._parsePolyLine(),r&&n.push(r);break;case te.Polygon:case te.PolygonZ:case te.PolygonM:for(;this._reader.getOffset()<i;)r=this._parsePolyLine(),r&&n.push(r);break;case te.MultiPoint:case te.MultiPointZ:case te.MultiPointM:for(;this._reader.getOffset()<i;)r=this._parseMultiPoint(),r&&n.push(r);break;case te.MultiPatch:for(;this._reader.getOffset()<i;)r=this._parseMultiPatch(),r&&n.push(r);break;default:this.logger.error(`SHPLoader: Invalid switch parameter: ${e.shapeType}`)}return n}_parseRecordHeader(){this._reader.setEndianess(s.Endianness.Big);return{recordNumber:this._reader.getInt32(),contentLength:this._reader.getInt32()}}_parseNull(){return this._reader.getInt32(),null}_parsePoint(){const e=this._reader.getInt32();if(e===te.NullShape)return null;return{shapeType:e,x:this._reader.getFloat64(),y:this._reader.getFloat64()}}_parsePolyLine(){const e=this._reader.getInt32();if(e===te.NullShape)return null;const t={xMin:this._reader.getFloat64(),yMin:this._reader.getFloat64(),xMax:this._reader.getFloat64(),yMax:this._reader.getFloat64()},i=this._reader.getInt32(),r=this._reader.getInt32(),s=new Array(i);for(let e=0;e<i;e++)s[e]=this._reader.getInt32();const n=new Array(r);for(let e=0;e<r;e++)n[e]={x:this._reader.getFloat64(),y:this._reader.getFloat64()};return{shapeType:e,boundingBox:t,numberOfParts:i,numberOfPoints:r,parts:s,points:n}}_parsePolygon(){const e=this._reader.getInt32();if(e===te.NullShape)return null;const i={xMin:this._reader.getFloat64(),yMin:this._reader.getFloat64(),xMax:this._reader.getFloat64(),yMax:this._reader.getFloat64()},r=this._reader.getInt32(),s=this._reader.getInt32();let n=new Array(r);for(let e=0;e<r;e++)n[e]=this._reader.getInt32();let a=new Array(s);for(let e=0;e<s;e++)a[e]={x:this._reader.getFloat64(),y:this._reader.getFloat64()};const o=[],h=[];return n.forEach((e,i)=>{const r=a.slice(e,n[i+1]);t.ringClockwise(r)?o.push(r):h.push(r)}),h.forEach(e=>{o.some(i=>{if(t.ringContainsSome(i[0],e))return i.push(e),!0})||o.push([e])}),{shapeType:e,boundingBox:i,numberOfParts:r,numberOfPoints:s,parts:n,polygons:o}}_parseMultiPoint(){const e=this._reader.getInt32();if(e===te.NullShape)return null;const t={xMin:this._reader.getFloat64(),xMax:this._reader.getFloat64(),yMin:this._reader.getFloat64(),yMax:this._reader.getFloat64()},i=this._reader.getInt32(),r=new Array(i);for(let e=0;e<i;e++)r.push([this._reader.getFloat64(),this._reader.getFloat64()]);return{shapeType:e,boundingBox:t,numberOfPoints:i,points:r}}_parseMultiPatch(){const e=this._reader.getInt32();return e===te.NullShape?null:{shapeType:e}}_convertToObjects(e){let t=[];for(let t=0,r=e.length;t<r;t++){let r=e[t];r.shapeType!==te.Polygon&&r.shapeType!==te.PolygonZ&&r.shapeType!==te.PolygonM||(r.points&&Array.isArray(r.points[0])?i(r.points):s(r.points))}function i(e){for(let t=0,r=e.length;t<r;t++){let r=e[t];r?Array.isArray(r[0])?i(r):s(r):this.logger.log("no array, oups !")}}function s(e){t.push(new r.Shape(e))}return t}}ie.FileCode=9994,ie.MinFileLength=100,ie.MinVersion=1e3;class re{constructor(e,t){if(this.m_bits=new Array,t&&t.length)for(let e=0;e<t.length;e++)this.m_bits.push(t[e]?re._ON:re._OFF);else isNaN(t)||(this.m_bits=re.shred(t).m_bits);if(e&&this.m_bits.length!==e)if(this.m_bits.length<e)for(let t=this.m_bits.length;t<e;t++)this.m_bits.push(re._OFF);else for(let t=e;t>this.m_bits.length;t--)this.m_bits.pop()}static _intersect(e,t){return e===re._ON&&t===re._ON?re._ON:re._OFF}static _union(e,t){return e===re._ON||t===re._ON?re._ON:re._OFF}static _difference(e,t){return e===re._ON&&t!==re._ON?re._ON:re._OFF}static _getLen(e,t,i){var r=e.getLength(),s=t.getLength();return i?s:r}static getUnion(e,t){for(var i=re._getLen(e,t,!0),r=new re(i),s=0;s<i;s++)r.setAt(s,re._union(e.getAt(s),t.getAt(s)));return r}static getIntersection(e,t){for(var i=re._getLen(e,t,!0),r=new re(i),s=0;s<i;s++)r.setAt(s,re._intersect(e.getAt(s),t.getAt(s)));return r}static getDifference(e,t){for(var i=re._getLen(e,t,!0),r=new re(i),s=0;s<i;s++)r.setAt(s,re._difference(e.getAt(s),t.getAt(s)));return r}static shred(e){var t=new Array,i=e;do{t.push(i%2),i=Math.floor(i/2)}while(i>0);return new re(t.length,t.reverse())}getLength(){return this.m_bits.length}getAt(e){return e<this.m_bits.length?this.m_bits[e]:null}setAt(e,t){e<this.m_bits.length&&(this.m_bits[e]=t?re._ON:re._OFF)}resize(e){for(var t=new Array,i=0;i<e;i++)i<this.m_bits.length?t.push(this.m_bits[i]):t.push(re._OFF);this.m_bits=t}getCompliment(){for(var e=new re(this.m_bits.length),t=0;t<this.m_bits.length;t++)e.setAt(t,this.m_bits[t]?re._OFF:re._ON);return e}toString(){for(var e=new String,t=0;t<this.m_bits.length;t++)e=e.concat(this.m_bits[t]===re._ON?"1":"0");return e}toNumber(){for(var e=0,t=0,i=this.m_bits.length-1;i>=0;i--)this.m_bits[i]===re._ON&&(t+=Math.pow(2,e)),e++;return t}}re._ON=1,re._OFF=0;class se{static getBit(e,t){return e&1<<t?1:0}static setBit(e,t){return e|1<<t}static clearBit(e,t){return e&~(1<<t)}static updateBit(e,t,i){return e&~(1<<t)|(i?1:0)<<t}static getBits(e,t){let i=0;for(let r of t)se.getBit(e,r)&&(i=se.setBit(i,r));return i}}
/**
	 * @module Controllers/CameraControls
	 * @desc This module export CameraControls class and CameraControlMode enum values.
	 *
	 * @requires {@link module: [@itee/client]{@link https://github.com/Itee/@itee/client}}
	 * @requires {@link module: [@itee/utils]{@link https://github.com/Itee/@itee/utils}}
	 * @requires {@link module: [@itee/validators]{@link https://github.com/Itee/@itee/validators}}
	 * @requires {@link module: [three-full]{@link https://github.com/Itee/three-full}}
	 *
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 *
	 * @example
	 *
	 * import { CameraControls, CameraControlMode } from '@itee/plugin-three'
	 *
	 */const ne=new r.Vector3(0,0,-1),ae=new r.Vector3(0,0,1),oe=new r.Vector3(0,1,0),he=new r.Vector3(0,-1,0),le=new r.Vector3(1,0,0),ce=new r.Vector3(-1,0,0),de=t.toEnum({None:0,Rotating:1,Panning:2,Rolling:3,Zooming:4,Moving:5}),ue=t.toEnum({FirstPerson:1,Orbit:2,Fly:3,Path:4});class pe extends r.EventDispatcher{constructor(e={}){const t={logger:i.DefaultLogger,camera:null,target:new r.Object3D,mode:ue.Orbit,domElement:"function"==typeof importScripts?null:window,...e};super(),this._handlers={onMouseEnter:this._onMouseEnter.bind(this),onMouseLeave:this._onMouseLeave.bind(this),onMouseDown:this._onMouseDown.bind(this),onMouseMove:this._onMouseMove.bind(this),onMouseWheel:this._onMouseWheel.bind(this),onMouseUp:this._onMouseUp.bind(this),onDblClick:this._onDblClick.bind(this),onTouchStart:this._onTouchStart.bind(this),onTouchEnd:this._onTouchEnd.bind(this),onTouchCancel:this._onTouchCancel.bind(this),onTouchLeave:this._onTouchLeave.bind(this),onTouchMove:this._onTouchMove.bind(this),onKeyDown:this._onKeyDown.bind(this),onKeyUp:this._onKeyUp.bind(this)},this.logger=t.logger,this.camera=t.camera,this.target=t.target,this.mode=t.mode,this.domElement=t.domElement,this.enabled=!0,this._paths=[],this._trackPath=!1,this._cameraJump=.1,this._currentPathPosition=null,this._currentPathOffset=0,this._currentPathIndex=0,this._currentPath=null,this._maxJump=1,this._lockedTarget=!0,this.previousTouches=[],this.canMove=!0,this.moveSpeed=1,this.canFront=!0,this.frontMinimum=-1/0,this.frontMaximum=-1/0,this.frontMinSpeed=0,this.frontSpeed=1,this.frontMaxSpeed=1/0,this.frontAcceleration=1,this.canBack=!0,this.backMinimum=-1/0,this.backMaximum=-1/0,this.backMinSpeed=0,this.backSpeed=1,this.backMaxSpeed=1/0,this.backAcceleration=1,this.canUp=!0,this.upMinimum=-1/0,this.upMaximum=-1/0,this.upMinSpeed=0,this.upSpeed=1,this.upMaxSpeed=1/0,this.upAcceleration=1,this.canDown=!0,this.downMinimum=-1/0,this.downMaximum=-1/0,this.downMinSpeed=0,this.downSpeed=1,this.downMaxSpeed=1/0,this.downAcceleration=1,this.canLeft=!0,this.leftMinimum=-1/0,this.leftMaximum=-1/0,this.leftMinSpeed=0,this.leftSpeed=1,this.leftMaxSpeed=1/0,this.leftAcceleration=1,this.canRight=!0,this.rightMinimum=-1/0,this.rightMaximum=-1/0,this.rightMinSpeed=0,this.rightSpeed=1,this.rightMaxSpeed=1/0,this.rightAcceleration=1,this.canRotate=!0,this.minPolarAngle=.001,this.maxPolarAngle=Math.PI-.001,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.rotateMinSpeed=0,this.rotateSpeed=1,this.rotateMaxSpeed=1/0,this.rotateAcceleration=1,this.canPan=!0,this.panMinimum=-1/0,this.panMaximum=-1/0,this.panMinSpeed=0,this.panSpeed=.001,this.panMaxSpeed=1/0,this.panAcceleration=1,this.canRoll=!0,this.rollMinimum=-1/0,this.rollMaximum=-1/0,this.rollMinSpeed=0,this.rollSpeed=.1,this.rollMaxSpeed=1/0,this.rollAcceleration=1,this.canZoom=!0,this.zoomMinimum=0,this.zoomMaximum=1/0,this.zoomMinSpeed=0,this.zoomSpeed=.001,this.zoomMaxSpeed=1/0,this.zoomAcceleration=1,this.canLookAt=!0,this.actionsMap={front:[s.Keys.Z.value,s.Keys.UP_ARROW.value],back:[s.Keys.S.value,s.Keys.DOWN_ARROW.value],up:[s.Keys.A.value,s.Keys.PAGE_UP.value],down:[s.Keys.E.value,s.Keys.PAGE_DOWN.value],left:[s.Keys.Q.value,s.Keys.LEFT_ARROW.value],right:[s.Keys.D.value,s.Keys.RIGHT_ARROW.value],rotate:[s.Mouse.Left.value],pan:[s.Mouse.Middle.value],roll:{left:[s.Keys.R.value],right:[s.Keys.T.value]},zoom:[s.Mouse.Wheel.value],lookAtFront:[s.Keys.NUMPAD_2.value],lookAtFrontLeft:[s.Keys.NUMPAD_3.value],lookAtFrontRight:[s.Keys.NUMPAD_1.value],lookAtBack:[s.Keys.NUMPAD_8.value],lookAtBackLeft:[s.Keys.NUMPAD_9.value],lookAtBackRight:[s.Keys.NUMPAD_7.value],lookAtUp:[s.Keys.NUMPAD_5.value],lookAtDown:[s.Keys.NUMPAD_0.value],lookAtLeft:[s.Keys.NUMPAD_6.value],lookAtRight:[s.Keys.NUMPAD_4.value]},this._state=de.None}get camera(){return this._camera}set camera(e){if(n.isNull(e))throw new Error("Camera cannot be null ! Expect an instance of Camera");if(n.isUndefined(e))throw new Error("Camera cannot be undefined ! Expect an instance of Camera");if(!e.isCamera)throw new Error(`Camera cannot be an instance of ${e.constructor.name}. Expect an instance of Camera.`);this._camera=e}get target(){return this._target}set target(e){if(n.isNull(e))throw new Error("Target cannot be null ! Expect an instance of Object3D.");if(n.isUndefined(e))throw new Error("Target cannot be undefined ! Expect an instance of Object3D.");if(!e.isObject3D)throw new Error(`Target cannot be an instance of ${e.constructor.name}. Expect an instance of Object3D.`);this._target=e}get mode(){return this._mode}set mode(e){if(n.isNull(e))throw new Error("Mode cannot be null ! Expect a value from CameraControlMode enum.");if(n.isUndefined(e))throw new Error("Mode cannot be undefined ! Expect a value from CameraControlMode enum.");if(!ue.includes(e))throw new Error(`Mode cannot be an instance of ${e.constructor.name}. Expect a value from TCameraControlMode enum.`);this._mode=e,this._trackPath&&this._initPathDisplacement()}get paths(){return this._paths}set paths(e){this._paths=e}get trackPath(){return this._trackPath}set trackPath(e){if(n.isNotBoolean(e))throw new Error(`Track path cannot be an instance of ${e.constructor.name}. Expect a boolean.`);this._trackPath=e,this._trackPath&&this._initPathDisplacement()}get domElement(){return this._domElement}set domElement(e){if(n.isNull(e))throw new Error("DomElement cannot be null ! Expect an instance of HTMLDocument.");if(n.isUndefined(e))throw new Error("DomElement cannot be undefined ! Expect an instance of HTMLDocument.");if(!["Window","HTMLDocument","HTMLDivElement","HTMLCanvasElement","OffscreenCanvas"].includes(e.constructor.name))throw new Error(`DomElement cannot be an instance of ${e.constructor.name}. Expect an instance of Window, HTMLDocument or HTMLDivElement.`);this._domElement&&(this._domElement.removeEventListener("mouseenter",this._handlers.onMouseEnter,!1),this._domElement.removeEventListener("mouseleave",this._handlers.onMouseLeave,!1),this.dispose()),this._domElement=e,this._domElement.addEventListener("mouseenter",this._handlers.onMouseEnter,!1),this._domElement.addEventListener("mouseleave",this._handlers.onMouseLeave,!1),this.impose()}get handlers(){return this._handlers}setCamera(e){return this.camera=e,this}setTarget(e){return this.target=e,this}setMode(e){return this.mode=e,this}setPaths(e){return this.paths=e,this}addPath(e){return this._paths.push(e),this}setTrackPath(e){return this.trackPath=e,this}setDomElement(e){return this.domElement=e,this}impose(){this._domElement.addEventListener("keydown",this._handlers.onKeyDown,!1),this._domElement.addEventListener("keyup",this._handlers.onKeyUp,!1),this._domElement.addEventListener("dblclick",this._handlers.onDblClick,!1),this._domElement.addEventListener("mousedown",this._handlers.onMouseDown,!1),this._domElement.addEventListener("mousemove",this._handlers.onMouseMove,!1),this._domElement.addEventListener("mouseup",this._handlers.onMouseUp,!1),this._domElement.addEventListener("wheel",this._handlers.onMouseWheel,{capture:!0,once:!1,passive:!1}),this._domElement.addEventListener("touchcancel",this._handlers.onTouchCancel,!1),this._domElement.addEventListener("touchend",this._handlers.onTouchEnd,!1),this._domElement.addEventListener("touchleave",this._handlers.onTouchLeave,!1),this._domElement.addEventListener("touchmove",this._handlers.onTouchMove,{capture:!0,once:!1,passive:!1}),this._domElement.addEventListener("touchstart",this._handlers.onTouchStart,{capture:!0,once:!1,passive:!1}),this.dispatchEvent({type:"impose"})}dispose(){this._domElement.removeEventListener("keydown",this._handlers.onKeyDown,!1),this._domElement.removeEventListener("keyup",this._handlers.onKeyUp,!1),this._domElement.removeEventListener("dblclick",this._handlers.onDblClick,!1),this._domElement.removeEventListener("mousedown",this._handlers.onMouseDown,!1),this._domElement.removeEventListener("mousemove",this._handlers.onMouseMove,!1),this._domElement.removeEventListener("mouseup",this._handlers.onMouseUp,!1),this._domElement.removeEventListener("wheel",this._handlers.onMouseWheel,{capture:!0,once:!1,passive:!1}),this._domElement.removeEventListener("touchcancel",this._handlers.onTouchCancel,!1),this._domElement.removeEventListener("touchend",this._handlers.onTouchEnd,!1),this._domElement.removeEventListener("touchleave",this._handlers.onTouchLeave,!1),this._domElement.removeEventListener("touchmove",this._handlers.onTouchMove,{capture:!0,once:!1,passive:!1}),this._domElement.removeEventListener("touchstart",this._handlers.onTouchStart,{capture:!0,once:!1,passive:!1}),this.dispatchEvent({type:"dispose"})}update(){}setCameraPosition(e){return this._camera.position.copy(e),this._camera.lookAt(this._target.position),this}setTargetPosition(e){return this._target.position.copy(e),this._camera.lookAt(this._target.position),this}_preventEvent(e){e.preventDefault&&e.preventDefault()}_consumeEvent(e){e.cancelable&&e.stopImmediatePropagation&&e.stopImmediatePropagation()}_onKeyDown(e){if(!this.enabled)return;this._preventEvent(e);const t=this.actionsMap,i=e.keyCode;t.front.includes(i)?(this._front(),this._consumeEvent(e)):t.back.includes(i)?(this._back(),this._consumeEvent(e)):t.up.includes(i)?(this._up(),this._consumeEvent(e)):t.down.includes(i)?(this._down(),this._consumeEvent(e)):t.left.includes(i)?(this._left(),this._consumeEvent(e)):t.right.includes(i)?(this._right(),this._consumeEvent(e)):t.rotate.includes(i)?this._rotate(1):t.pan.includes(i)?(this._pan(1),this._consumeEvent(e)):t.roll.left.includes(i)?(this._roll(1),this._consumeEvent(e)):t.roll.right.includes(i)?(this._roll(-1),this._consumeEvent(e)):t.zoom.includes(i)?(this._zoom(1),this._consumeEvent(e)):t.lookAtFront.includes(i)?(this._lookAt(ne),this._consumeEvent(e)):t.lookAtFrontLeft.includes(i)?(this._lookAt(new r.Vector3(-1,0,-1).normalize()),this._consumeEvent(e)):t.lookAtFrontRight.includes(i)?(this._lookAt(new r.Vector3(1,0,-1).normalize()),this._consumeEvent(e)):t.lookAtBack.includes(i)?(this._lookAt(ae),this._consumeEvent(e)):t.lookAtBackLeft.includes(i)?(this._lookAt(new r.Vector3(-1,0,1).normalize()),this._consumeEvent(e)):t.lookAtBackRight.includes(i)?(this._lookAt(new r.Vector3(1,0,1).normalize()),this._consumeEvent(e)):t.lookAtUp.includes(i)?(this._lookAt(oe),this._consumeEvent(e)):t.lookAtDown.includes(i)?(this._lookAt(he),this._consumeEvent(e)):t.lookAtLeft.includes(i)?(this._lookAt(ce),this._consumeEvent(e)):t.lookAtRight.includes(i)&&(this._lookAt(le),this._consumeEvent(e))}_onKeyUp(e){this.enabled&&this._preventEvent(e)}_onTouchStart(e){this.enabled&&(this._preventEvent(e),this.previousTouches=e.touches)}_onTouchEnd(e){this.enabled&&(this._preventEvent(e),this.previousTouches=[],this._state=de.None)}_onTouchCancel(e){this.enabled&&(this._preventEvent(e),this.previousTouches=[],this._state=de.None)}_onTouchLeave(e){this.enabled&&(this._preventEvent(e),this.previousTouches=[],this._state=de.None)}_onTouchMove(e){if(!this.enabled)return;this._preventEvent(e);const t=this.previousTouches,i=e.changedTouches,s=t.length,n=i.length;if(2===s&&2===n){const s=new r.Vector2(t[0].clientX,t[0].clientY),n=new r.Vector2(t[1].clientX,t[1].clientY),a=s.distanceTo(n),o=(new r.Vector2).addVectors(s,n).divideScalar(2),h=(new r.Vector2).subVectors(s,n).normalize(),l=new r.Vector2(i[0].clientX,i[0].clientY),c=new r.Vector2(i[1].clientX,i[1].clientY),d=l.distanceTo(c),u=(new r.Vector2).addVectors(l,c).divideScalar(2),p=(new r.Vector2).subVectors(s,n).normalize(),_=(new r.Vector2).subVectors(u,o),g=d-a,m=p.dot(h);this._pan(_),this._zoom(g),this._roll(m),this._consumeEvent(e)}else if(1===s&&1===n){const s=new r.Vector2(i[0].clientX-t[0].clientX,i[0].clientY-t[0].clientY).divideScalar(10);this._rotate(s),this._consumeEvent(e)}else this.logger.warn("Ignoring inconsistent touches event.");this.previousTouches=i}_onMouseEnter(e){this.enabled&&(this._preventEvent(e),this.impose(),e.target.constructor!==HTMLDocument&&this._domElement.focus())}_onMouseLeave(e){this.enabled&&(this._preventEvent(e),e.target.constructor!==HTMLDocument&&this._domElement.blur(),this.dispose(),this._state=de.None)}_onMouseDown(e){if(!this.enabled)return;this._preventEvent(e);const t=this.actionsMap,i=e.button;t.front.includes(i)?(this._state=de.Moving,this._front(),this._consumeEvent(e)):t.back.includes(i)?(this._state=de.Moving,this._back(),this._consumeEvent(e)):t.up.includes(i)?(this._state=de.Moving,this._up(),this._consumeEvent(e)):t.down.includes(i)?(this._state=de.Moving,this._down(),this._consumeEvent(e)):t.left.includes(i)?(this._state=de.Moving,this._left(),this._consumeEvent(e)):t.right.includes(i)?(this._state=de.Moving,this._right(),this._consumeEvent(e)):t.rotate.includes(i)?(this._state=de.Rotating,this._consumeEvent(e)):t.pan.includes(i)?(this._state=de.Panning,this._consumeEvent(e)):t.roll.left.includes(i)||t.roll.right.includes(i)?(this._state=de.Rolling,this._consumeEvent(e)):t.zoom.includes(i)?(this._state=de.Zooming,this._consumeEvent(e)):this._state=de.None}_onMouseMove(e){if(!this.enabled||this._state===de.None)return;this._preventEvent(e);const t=this._state,i={x:e.movementX||e.mozMovementX||e.webkitMovementX||0,y:e.movementY||e.mozMovementY||e.webkitMovementY||0};switch(t){case de.Moving:break;case de.Rotating:this._rotate(i),this._consumeEvent(e);break;case de.Panning:this._pan(i),this._consumeEvent(e);break;case de.Rolling:this._roll(i),this._consumeEvent(e);break;case de.Zooming:this._zoom(i),this._consumeEvent(e);break;default:throw new RangeError(`Unknown state: ${t}`)}}_onMouseWheel(e){if(!this.enabled)return;this._preventEvent(e);const t=e.wheelDelta||e.deltaY;this._zoom(t),this._consumeEvent(e)}_onMouseUp(e){this.enabled&&(this._preventEvent(e),this._state=de.None,this._consumeEvent(e))}_onDblClick(e){this.enabled&&(this._preventEvent(e),this.logger.warn("CameraControls: Double click events is not implemented yet, sorry for the disagreement."))}_front(){if(this.canMove&&this.canFront){if(this._camera.isPerspectiveCamera){const e=ne.clone().applyQuaternion(this._camera.quaternion),t=this._trackPath?this._getPathDisplacement(e):e.multiplyScalar(this.frontSpeed);this._camera.position.add(t),this._target.position.add(t)}else if(this._camera.isOrthographicCamera){const e=ne.clone().applyQuaternion(this._camera.quaternion),t=this._trackPath?this._getPathDisplacement(e):e.multiplyScalar(this.frontSpeed);this._camera.position.add(t),this._target.position.add(t);const i=this.frontSpeed*this.zoomSpeed;this._camera.zoom+=i,this._camera.updateProjectionMatrix()}else this.logger.error(`Unmanaged displacement for camera of type ${this._camera.type}`);this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_back(){if(this.canMove&&this.canBack){if(this._camera.isPerspectiveCamera){const e=ae.clone().applyQuaternion(this._camera.quaternion),t=this._trackPath?this._getPathDisplacement(e):e.multiplyScalar(this.backSpeed);this._camera.position.add(t),this._target.position.add(t)}else if(this._camera.isOrthographicCamera){const e=ae.clone().applyQuaternion(this._camera.quaternion),t=this._trackPath?this._getPathDisplacement(e):e.multiplyScalar(this.backSpeed);this._camera.position.add(t),this._target.position.add(t);const i=this.backSpeed*this.zoomSpeed;this._camera.zoom-i<=0?this._camera.zoom=.01:this._camera.zoom-=i,this._camera.updateProjectionMatrix()}else this.logger.error(`Unmanaged displacement for camera of type ${this._camera.type}`);this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_up(){if(this.canMove&&this.canUp){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const e=oe.clone().applyQuaternion(this._camera.quaternion).multiplyScalar(this.upSpeed);this._camera.position.add(e),this._target.position.add(e)}else this.logger.error(`Unmanaged displacement for camera of type ${this._camera.type}`);this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_down(){if(this.canMove&&this.canDown){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const e=he.clone().applyQuaternion(this._camera.quaternion).multiplyScalar(this.downSpeed);this._camera.position.add(e),this._target.position.add(e)}else this.logger.error(`Unmanaged displacement for camera of type ${this._camera.type}`);this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_left(){if(this.canMove&&this.canLeft){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const e=ce.clone().applyQuaternion(this._camera.quaternion).multiplyScalar(this.leftSpeed);this._camera.position.add(e),this._target.position.add(e)}else this.logger.error(`Unmanaged displacement for camera of type ${this._camera.type}`);this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_right(){if(this.canMove&&this.canRight){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const e=le.clone().applyQuaternion(this._camera.quaternion).multiplyScalar(this.rightSpeed);this._camera.position.add(e),this._target.position.add(e)}this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_rotate(e){if(this.canRotate){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const i=this._camera.position,s=this._target.position,n=i.distanceTo(s),a=(new r.Vector3).subVectors(i,s).normalize(),o=this.rotateSpeed;switch(this._mode){case ue.FirstPerson:{const t=e.x,n=e.y,a=new r.Vector3(-t,n,0).applyQuaternion(this._camera.quaternion).multiplyScalar(o).add(s),h=(new r.Vector3).subVectors(a,i).normalize(),l=oe.clone().dot(h),c=le.clone().dot(h),d=.97;if(l<-d||l>d||c<-2||c>2)return;const u=h.multiplyScalar(1).add(i);this.setTargetPosition(u)}break;case ue.Orbit:{const i=(new r.Spherical).setFromVector3(a),h=i.theta+t.degreesToRadians(-e.x)*o,l=i.phi+t.degreesToRadians(-e.y)*o;i.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,h)),i.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,l));const c=(new r.Vector3).setFromSpherical(i).multiplyScalar(n).add(s);this.setCameraPosition(c)}break;default:throw new RangeError(`Unamanaged rotation for camera mode ${this._mode}`)}}this.dispatchEvent({type:"rotate"}),this.dispatchEvent({type:"change"})}}_pan(e){if(this.canPan){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const t=this._camera.position,i=this._target.position,s=t.distanceTo(i),n=new r.Vector3(-e.x,e.y,0).applyQuaternion(this._camera.quaternion).multiplyScalar(this.panSpeed*s);this._camera.position.add(n),this._target.position.add(n)}this.dispatchEvent({type:"pan"}),this.dispatchEvent({type:"change"})}}_roll(e){if(this.canRoll){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const t=this._camera.position,i=this._target.position,s=(new r.Vector3).subVectors(t,i).normalize(),n=e*this.rollSpeed;this._camera.up.applyAxisAngle(s,n),this._camera.lookAt(i)}this.dispatchEvent({type:"roll"}),this.dispatchEvent({type:"change"})}}_zoom(e){if(this.canZoom){if(this._camera.isPerspectiveCamera)switch(this._mode){case ue.FirstPerson:e>0?this._camera.fov--:this._camera.fov++,this._camera.updateProjectionMatrix();break;case ue.Orbit:{const t=this._camera.position,i=this._target.position,s=t.distanceTo(i),n=ne.clone().applyQuaternion(this._camera.quaternion).multiplyScalar(e*this.zoomSpeed*s);let a=t.clone().add(n);const o=(new r.Vector3).subVectors(a,t).normalize(),h=(new r.Vector3).subVectors(t,i).normalize(),l=(new r.Vector3).subVectors(a,i).normalize(),c=o.dot(h),d=o.dot(l),u=a.distanceToSquared(i);c<0&&(u<this.zoomMinimum*this.zoomMinimum||d>0)&&(a=h.clone().multiplyScalar(this.zoomMinimum).add(i)),this._camera.position.copy(a)}break;default:throw new RangeError(`Invalid camera control mode parameter: ${this._mode}`)}else if(this._camera.isOrthographicCamera){const t=this.domElement.offsetWidth/this.domElement.offsetHeight,i=this._camera.position,r=this._target.position,s=i.distanceTo(r),n=(e>0?ne.clone():ae.clone()).applyQuaternion(this._camera.quaternion).normalize().multiplyScalar(this.zoomSpeed*s);i.add(n);const a=i.distanceTo(r),o=a/2,h=a*t/2;this._camera.top=o,this._camera.bottom=-o,this._camera.right=h,this._camera.left=-h,this._camera.updateProjectionMatrix()}this.dispatchEvent({type:"zoom"}),this.dispatchEvent({type:"change"})}}_lookAt(e){if(this.canLookAt){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const t=e.clone(),i=this._camera.position,r=this._target.position,s=i.distanceTo(r);switch(this.mode){case ue.FirstPerson:{t.y=-t.y;const e=t.multiplyScalar(s).add(i);this.setTargetPosition(e)}break;case ue.Orbit:{const e=t.multiplyScalar(s).add(r);this.setCameraPosition(e)}break;default:throw new RangeError(`Invalid camera control mode parameter: ${this._mode}`)}}this.dispatchEvent({type:"lookAt"}),this.dispatchEvent({type:"change"})}}_initPathDisplacement(){if(n.isEmptyArray(this._paths))this.logger.warn("Try to init path displacement without any paths");else switch(n.isNotDefined(this._currentPath)&&(this._currentPathIndex=0,this._currentPathOffset=0,this._currentPath=this._paths[0]),this._currentPathPosition=this._currentPath.getPointAt(this._currentPathOffset),this._mode){case ue.FirstPerson:if(this._lockedTarget){const e=(new r.Vector3).subVectors(this._currentPathPosition,this.camera.position);this._camera.position.add(e),this._target.position.add(e)}else this.setCameraPosition(this._currentPathPosition);break;case ue.Orbit:if(this._lockedTarget){const e=(new r.Vector3).subVectors(this._currentPathPosition,this.target.position);this._camera.position.add(e),this._target.position.add(e)}else this.setTargetPosition(this._currentPathPosition);break;default:throw new RangeError(`Invalid camera control _mode parameter: ${this._mode}`)}}_getPathDisplacement(e){let t=null;const i=this._currentPathPosition,s=this._currentPathOffset+this._cameraJump,n=s<1?s:1,a=this._currentPath.getPointAt(n),o=(new r.Vector3).subVectors(a,i),h=o.clone().normalize(),l=e.dot(h),c=this._currentPathOffset-this._cameraJump,d=c>0?c:0,u=this._currentPath.getPointAt(d),p=(new r.Vector3).subVectors(u,i),_=p.clone().normalize(),g=e.dot(_);if(0===l&&g<0){const i=this._getDirectionsMap();let s,n,a,o=-1;i.forEach(t=>{const i=t.index,r=t.startDisplacement;if(r){const t=r.clone().normalize(),h=e.dot(t);h>o&&(s=i,n=r,o=h,a=!0)}const h=t.endDisplacement;if(h){const t=h.clone().normalize(),r=e.dot(t);r>o&&(s=i,n=h,o=r,a=!1)}}),void 0!==s?(this._currentPathIndex=s,this._currentPath=this._paths[this._currentPathIndex],this._currentPathOffset=a?this._cameraJump:1-this._cameraJump,this._currentPathPosition=this._currentPath.getPointAt(this._currentPathOffset),t=n):(this.logger.warn("Reach path end."),t=new r.Vector3)}else if(l>0&&g<=0)t=o,this._currentPathOffset=n,this._currentPathPosition=a;else if(l<=0&&g>0)t=p,this._currentPathOffset=d,this._currentPathPosition=u;else if(l<0&&0===g){const i=this._getDirectionsMap();let s,n,a,o=-1;i.forEach(t=>{const i=t.index,r=t.startDisplacement;if(r){const t=r.clone().normalize(),h=e.dot(t);h>o&&(s=i,n=r,o=h,a=!0)}const h=t.endDisplacement;if(h){const t=h.clone().normalize(),r=e.dot(t);r>o&&(s=i,n=h,o=r,a=!1)}}),void 0!==s?(this._currentPathIndex=s,this._currentPath=this._paths[this._currentPathIndex],this._currentPathOffset=a?this._cameraJump:1-this._cameraJump,this._currentPathPosition=this._currentPath.getPointAt(this._currentPathOffset),t=n):(this.logger.warn("Reach path start."),t=new r.Vector3)}else l<0&&g<0||l>0&&g>0?l>g?(t=o,this._currentPathOffset=n,this._currentPathPosition=a):(t=p,this._currentPathOffset=d,this._currentPathPosition=u):(this.logger.warn("Unable to find correct next path position."),t=new r.Vector3);return t}_getDirectionsMap(){const e=this._currentPathPosition,t=this._currentPathIndex,i=this._cameraJump,s=this._maxJump;return this._paths.reduce((n,a,o)=>{if(o===t)return n;const h=a.getPointAt(0);let l;e.distanceToSquared(h)<s&&(l=(new r.Vector3).subVectors(a.getPointAt(i),h));const c=a.getPointAt(1);let d;return e.distanceToSquared(c)<s&&(d=(new r.Vector3).subVectors(a.getPointAt(1-i),c)),(l||d)&&n.push({index:o,startDisplacement:l,endDisplacement:d}),n},[])}}
/**
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 */class _e extends r.LineBasicMaterial{constructor(e){super(e),this.isHighlightableMaterial=!0,this.depthTest=!1,this.depthWrite=!1,this.fog=!1,this.transparent=!0,this.linewidth=1,this.oldColor=this.color.clone()}highlight(e){if(e){const e=.35,t=this.color.r,i=this.color.g,r=this.color.b,s=Math.min(Math.max(0,t+t*e),1),n=Math.min(Math.max(0,i+i*e),1),a=Math.min(Math.max(0,r+r*e),1);this.color.setRGB(s,n,a)}else this.color.copy(this.oldColor)}}
/**
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 */class ge extends r.MeshBasicMaterial{constructor(e){super(e),this.isHighlightableMaterial=!0,this.depthTest=!1,this.depthWrite=!1,this.fog=!1,this.side=r.DoubleSide,this.transparent=!0,this.oldColor=this.color.clone()}highlight(e){if(e){const e=.35,t=this.color.r,i=this.color.g,r=this.color.b,s=Math.min(Math.max(0,t+t*e),1),n=Math.min(Math.max(0,i+i*e),1),a=Math.min(Math.max(0,r+r*e),1);this.color.setRGB(s,n,a)}else this.color.copy(this.oldColor)}}
/**
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 */class me extends r.Mesh{constructor(e={}){const t={geometry:new r.BufferGeometry,material:new r.MeshBasicMaterial({visible:!1,depthTest:!1,depthWrite:!1,fog:!1,side:r.DoubleSide,color:6636321}),...e};super(t.geometry,t.material),this.isHitbox=!0,this.type="Hitbox",this.matrixAutoUpdate=!1}}
/**
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 */class fe extends me{constructor(e={}){super({geometry:new r.OctahedronBufferGeometry(1.2,0),...e}),this.isOctahedricalHitbox=!0,this.type="OctahedricalHitbox"}}
/**
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 */class ye extends r.Object3D{constructor(e={}){const t={debug:!1,color:16777215,hitbox:null,...e};super(t),this.isHandle=!0,this.type="Handle",this.matrixAutoUpdate=!0,this.debug=t.debug,this.color=t.color,this.hitbox=t.hitbox,this.baseQuaternion=new r.Quaternion}get color(){return this.line.material.color.clone()}set color(e){if(n.isNull(e))throw new Error("Color cannot be null ! Expect an instance of Color.");if(n.isUndefined(e))throw new Error("Color cannot be undefined ! Expect an instance of Color.");this.traverse(t=>{let i=t.material;i&&i.color.setHex(e)})}get hitbox(){return this._hitbox}set hitbox(e){this._hitbox=e,this.add(e)}setColor(e){return this.color=e,this}setHitbox(e){return this.hitbox=e,this}setScale(e,t,i){return this.scale.set(e,t,i),this}setPosition(e,t,i){return this.position.set(e,t,i),this}highlight(e){for(let t=0,i=this.children.length;t<i;t++){const i=this.children[t];if(i.isHitbox)continue;const r=i.material;!n.isUndefined(r)&&r.isHighlightableMaterial&&r.highlight(e)}}raycast(e,t){const i=e.intersectObject(this._hitbox,!1);i.length>0&&t.push({distance:i[0].distance,object:this})}setRotationFromAxisAndAngle(e,t){return this.quaternion.setFromAxisAngle(e,t),this.baseQuaternion.copy(this.quaternion),this}update(e){}}
/**
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 */class we extends ye{constructor(e={}){const t={color:16777215,hitbox:new fe,...e};super(t),this.isOmnidirectionalHandle=!0,this.type="OmnidirectionalHandle";const i=new r.OctahedronBufferGeometry(.1,0),s=new ge({color:t.color,transparent:!0,opacity:.55}),n=new r.Mesh(i,s);n.matrixAutoUpdate=!1,this.add(n);const a=new r.EdgesGeometry(i),o=new _e({color:t.color,linewidth:4}),h=new r.LineSegments(a,o);h.matrixAutoUpdate=!1,this.add(h)}update(e){super.update(e),this.updateMatrix(),this.hitbox.updateMatrix()}}
/**
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 */class be extends me{constructor(e={}){const t=e.centered?[-.6,-.6,0,.6,-.6,0,.6,.6,0,-.6,.6,0]:[0,0,0,1.1,0,0,1.1,1.1,0,0,1.1,0],i=new r.BufferGeometry;i.setAttribute("position",new r.Float32BufferAttribute(t,3)),i.setIndex([0,1,2,2,3,0]);super({geometry:i,...e}),this.isPlanarHitbox=!0,this.type="PlanarHitbox"}}
/**
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 */class xe extends ye{constructor(e={}){const t={showEdges:!1,centered:!1,color:16777215,hitbox:new be({centered:e.centered||!1}),direction:new r.Vector3(0,1,0),...e};if(super(t),this.isPlaneHandle=!0,this.type="PlaneHandle",t.showEdges){const e=new r.BufferGeometry;e.setAttribute("position",new r.Float32BufferAttribute([.75,1,0,1,1,0,1,.75,0],3));const i=new _e({color:t.color}),s=new r.Line(e,i);s.matrixAutoUpdate=!1,this.add(s)}const i=t.centered?[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]:[.1,.1,0,1,.1,0,1,1,0,.1,1,0],s=new r.BufferGeometry;s.setAttribute("position",new r.Float32BufferAttribute(i,3)),s.setIndex([0,1,2,2,3,0]);const n=new ge({color:t.color,transparent:!0,opacity:.35}),a=new r.Mesh(s,n);if(a.matrixAutoUpdate=!1,this.add(a),this.xAxis=new r.Vector3(1,0,0),this.yAxis=new r.Vector3(0,1,0),this.zAxis=new r.Vector3(0,0,1),this.xDirection=new r.Vector3(t.direction.x,0,0),this.yDirection=new r.Vector3(0,t.direction.y,0),this.zDirection=new r.Vector3(0,0,t.direction.z),this.direction=t.direction,this.debug){const e=new r.Vector3(0,0,0),i=t.direction,s=new r.ArrowHelper(i,e,1,1193046);this.add(s)}}get direction(){return this._direction}set direction(e){if(n.isNull(e))throw new Error("Direction cannot be null ! Expect an instance of Color.");if(n.isUndefined(e))throw new Error("Direction cannot be undefined ! Expect an instance of Color.");if(!(e instanceof r.Vector3))throw new Error(`Direction cannot be an instance of ${e.constructor.name}. Expect an instance of Vector3.`);this._direction=e}update(e){super.update(e);const i=new r.Vector3(this._direction.x,0,0),s=new r.Vector3(0,this._direction.y,0),n=new r.Vector3(0,0,this._direction.z),a=i.dot(e),o=s.dot(e),h=n.dot(e);this.quaternion.copy(this.baseQuaternion),a>0&&o>0&&0===h?(this.rotateOnAxis(this.zAxis,t.degreesToRadians(180)),this.xDirection.setX(-1),this.yDirection.setY(-1),this.zDirection.setZ(0)):a>0&&o<0&&0===h?(this.rotateOnAxis(this.zAxis,t.degreesToRadians(90)),this.xDirection.setX(-1),this.yDirection.setY(1),this.zDirection.setZ(0)):a<0&&o>0&&0===h?(this.rotateOnAxis(this.zAxis,t.degreesToRadians(270)),this.xDirection.setX(1),this.yDirection.setY(-1),this.zDirection.setZ(0)):a<0&&o<0&&0===h?(this.rotateOnAxis(this.zAxis,t.degreesToRadians(0)),this.xDirection.setX(1),this.yDirection.setY(1),this.zDirection.setZ(0)):a>0&&0===o&&h>0?(this.rotateOnAxis(this.zAxis,t.degreesToRadians(180)),this.xDirection.setX(-1),this.yDirection.setY(0),this.zDirection.setZ(-1)):a>0&&0===o&&h<0?(this.rotateOnAxis(this.zAxis,t.degreesToRadians(90)),this.xDirection.setX(-1),this.yDirection.setY(0),this.zDirection.setZ(1)):a<0&&0===o&&h>0?(this.rotateOnAxis(this.zAxis,t.degreesToRadians(270)),this.xDirection.setX(1),this.yDirection.setY(0),this.zDirection.setZ(-1)):a<0&&0===o&&h<0?(this.rotateOnAxis(this.zAxis,t.degreesToRadians(0)),this.xDirection.setX(1),this.yDirection.setY(0),this.zDirection.setZ(1)):0===a&&o>0&&h>0?(this.rotateOnAxis(this.zAxis,t.degreesToRadians(180)),this.xDirection.setX(0),this.yDirection.setY(-1),this.zDirection.setZ(-1)):0===a&&o>0&&h<0?(this.rotateOnAxis(this.zAxis,t.degreesToRadians(270)),this.xDirection.setX(0),this.yDirection.setY(-1),this.zDirection.setZ(1)):0===a&&o<0&&h>0?(this.rotateOnAxis(this.zAxis,t.degreesToRadians(90)),this.xDirection.setX(0),this.yDirection.setY(1),this.zDirection.setZ(-1)):0===a&&o<0&&h<0&&(this.rotateOnAxis(this.zAxis,t.degreesToRadians(0)),this.xDirection.setX(0),this.yDirection.setY(1),this.zDirection.setZ(1)),this.updateMatrix(),this.hitbox.updateMatrix()}setDirection(e){return this.direction=e,this}flipXDirection(){this.xDirection.setX(-this.xDirection.x)}flipYDirection(){this.yDirection.setY(-this.yDirection.y)}flipZDirection(){this.zDirection.setZ(-this.zDirection.z)}}
/**
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 */class ve extends r.BufferGeometry{constructor(e=new r.Vector3(0,0,0),t=new r.Vector3(1,0,0)){super(),this.type="LineGeometry",this.setAttribute("position",new r.Float32BufferAttribute([e.x,e.y,e.z,t.x,t.y,t.z],3))}}
/**
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 */class Me extends me{constructor(e={}){const t=new r.CylinderBufferGeometry(.2,0,1,4,1,!1);t.translate(0,.5,0);super({geometry:t,...e}),this.isCylindricaHitbox=!0,this.type="CylindricaHitbox"}}
/**
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 */class Ee extends ye{constructor(e={}){const t={color:16777215,hitbox:new Me,direction:new r.Vector3(0,1,0),...e};super(t),this.isScaleHandle=!0,this.type="ScaleHandle";const i=new ve(new r.Vector3(0,0,0),new r.Vector3(0,.88,0)),s=new _e({color:t.color}),n=new r.Line(i,s);n.matrixAutoUpdate=!1,this.add(n);const a=new r.BoxBufferGeometry(.12,.12,.12);a.translate(0,.94,0);const o=new ge({color:t.color}),h=new r.Mesh(a,o);h.matrixAutoUpdate=!1,this.add(h),this.direction=t.direction}get direction(){return this._direction}set direction(e){if(n.isNull(e))throw new Error("Direction cannot be null ! Expect an instance of Color.");if(n.isUndefined(e))throw new Error("Direction cannot be undefined ! Expect an instance of Color.");if(!(e instanceof r.Vector3))throw new Error(`Direction cannot be an instance of ${e.constructor.name}. Expect an instance of Vector3.`);if(this._direction=e,e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{const t=new r.Vector3(e.z,0,-e.x).normalize(),i=Math.acos(e.y);this.quaternion.setFromAxisAngle(t,i)}}update(e){super.update(e);this._direction.dot(e)>=0&&this.flipDirection(),this.updateMatrix(),this.hitbox.updateMatrix()}setDirection(e){return this.direction=e,this}flipDirection(){this.direction=this._direction.negate()}}
/**
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 */class Se extends r.Object3D{constructor(e={}){const t={debug:!1,planeSize:50,...e};super(t),this.isGizmo=!0,this.type="AbstractGizmo",this.matrixAutoUpdate=!0,this.debug=t.debug;const i=new r.PlaneBufferGeometry(t.planeSize,t.planeSize,2,2),s=new r.MeshBasicMaterial({side:r.DoubleSide,visible:this.debug,transparent:!0,opacity:.33,color:1193046});this.intersectPlane=new r.Mesh(i,s),this.intersectPlane.name="IntersectPlane",this.intersectPlane.matrixAutoUpdate=!0,this.intersectPlane.visible=!0,this.add(this.intersectPlane)}_setupHandles(e){const t=this;for(let i in e){const r=e[i];if(n.isNotArray(r))r.name=i,r.renderOrder=1/0,r.updateMatrix(),t.add(r);else for(let s=r.length;s--;){const r=e[i][s][0],n=e[i][s][1],a=e[i][s][2],o=e[i][s][3],h=e[i][s][4];r.name=i,r.tag=h,r.renderOrder=1/0,n&&r.position.set(n[0],n[1],n[2]),a&&r.rotation.set(a[0],a[1],a[2]),o&&r.scale.set(o[0],o[1],o[2]),r.updateMatrix();const l=r.geometry.clone();l.applyMatrix4(r.matrix),r.geometry=l,r.position.set(0,0,0),r.rotation.set(0,0,0),r.scale.set(1,1,1),t.add(r)}}}highlight(e){for(let e in this.handleGizmos)this.handleGizmos[e].highlight(!1);const t=this.handleGizmos[e];t&&t.highlight(!0)}update(e,t){this.traverse(e=>{e.isHandle&&e.update(t)}),this.updateIntersectPlane(e)}updateIntersectPlane(e){this.intersectPlane.lookAt(e),this.intersectPlane.updateMatrix()}}
/**
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 */class De extends Se{constructor(){super(),this.isScaleGizmo=!0,this.type="ScaleGizmo",this.handleGizmos={XYZ:new we({color:11184810}).setScale(.15,.15,.15),XY:new xe({color:11184640,direction:new r.Vector3(1,1,0)}).setScale(.33,.33,1),YZ:new xe({color:43690,direction:new r.Vector3(0,1,1)}).setScale(.33,.33,1).setRotationFromAxisAndAngle(new r.Vector3(0,1,0),t.degreesToRadians(-90)),XZ:new xe({color:11141290,direction:new r.Vector3(1,0,1)}).setScale(.33,.33,1).setRotationFromAxisAndAngle(new r.Vector3(1,0,0),t.degreesToRadians(90)),X:new Ee({color:11141120,direction:new r.Vector3(1,0,0)}),Y:new Ee({color:43520,direction:new r.Vector3(0,1,0)}),Z:new Ee({color:170,direction:new r.Vector3(0,0,1)})},this._setupHandles(this.handleGizmos)}raycast(e,t){if(e.intersectObject(this.intersectPlane,!0).length>0)for(let i of this.children)i.name!==this.intersectPlane.name&&i.raycast(e,t)}}
/**
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 */class Pe extends me{constructor(e={}){const t=new r.Float32BufferAttribute([0,0,0,.85,0,0,1.1,1.1,0,0,.85,0],3),i=new r.BufferGeometry;i.setAttribute("position",t),i.setIndex([0,1,2,2,3,0]);super({geometry:i,...e}),this.isPlanarHitbox=!0,this.type="PlanarHitbox"}}
/**
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 */class Fe extends ye{constructor(e={}){const t={color:16777215,hitbox:new Pe,direction:new r.Vector3(1,1,0),...e};super(t),this.isPlaneHandle=!0,this.type="PlaneHandle";const i=new r.BufferGeometry;i.setAttribute("position",new r.Float32BufferAttribute([.1,.75,0,1,1,0,.75,.1,0],3));const s=new _e({color:t.color}),n=new r.Line(i,s);n.matrixAutoUpdate=!1,this.add(n);const a=new r.BufferGeometry;a.setAttribute("position",new r.Float32BufferAttribute([.1,.1,0,.75,.1,0,1,1,0,.1,.75,0],3)),a.setIndex([0,1,2,2,3,0]);const o=new ge({color:t.color,transparent:!0,opacity:.35}),h=new r.Mesh(a,o);h.matrixAutoUpdate=!1,this.add(h),this.direction=t.direction,this.xDirection=new r.Vector3(t.direction.x,0,0),this.yDirection=new r.Vector3(0,t.direction.y,0),this.zDirection=new r.Vector3(0,0,t.direction.z),this.xAxis=new r.Vector3(1,0,0),this.yAxis=new r.Vector3(0,1,0),this.zAxis=new r.Vector3(0,0,1)}get direction(){return this._direction}set direction(e){if(n.isNull(e))throw new Error("Direction cannot be null ! Expect an instance of Color.");if(n.isUndefined(e))throw new Error("Direction cannot be undefined ! Expect an instance of Color.");if(!(e instanceof r.Vector3))throw new Error(`Direction cannot be an instance of ${e.constructor.name}. Expect an instance of Vector3.`);this._direction=e}update(e){super.update(e);const i=this.xDirection.dot(e),r=this.yDirection.dot(e),s=this.zDirection.dot(e);this.quaternion.copy(this.baseQuaternion),i>0&&r>0&&0===s?this.rotateOnAxis(this.zAxis,t.degreesToRadians(180)):i>0&&r<0&&0===s?this.rotateOnAxis(this.zAxis,t.degreesToRadians(90)):i<0&&r>0&&0===s?this.rotateOnAxis(this.zAxis,t.degreesToRadians(270)):i<0&&r<0&&0===s?this.rotateOnAxis(this.zAxis,t.degreesToRadians(0)):i>0&&0===r&&s>0?this.rotateOnAxis(this.zAxis,t.degreesToRadians(180)):i>0&&0===r&&s<0?this.rotateOnAxis(this.zAxis,t.degreesToRadians(90)):i<0&&0===r&&s>0?this.rotateOnAxis(this.zAxis,t.degreesToRadians(270)):i<0&&0===r&&s<0?this.rotateOnAxis(this.zAxis,t.degreesToRadians(0)):0===i&&r>0&&s>0?this.rotateOnAxis(this.zAxis,t.degreesToRadians(180)):0===i&&r>0&&s<0?this.rotateOnAxis(this.zAxis,t.degreesToRadians(270)):0===i&&r<0&&s>0?this.rotateOnAxis(this.zAxis,t.degreesToRadians(90)):0===i&&r<0&&s<0&&this.rotateOnAxis(this.zAxis,t.degreesToRadians(0)),this.updateMatrix(),this.hitbox.updateMatrix()}setDirection(e){return this.direction=e,this}flipXAxis(){const e=this._direction.clone();e.x=-e.x,this.direction=e}flipYAxis(){const e=this._direction.clone();e.y=-e.y,this.direction=e}flipZAxis(){const e=this._direction.clone();e.z=-e.z,this.direction=e}}
/**
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 */class Ae extends ye{constructor(e={}){const t={color:16777215,hitbox:new Me,direction:new r.Vector3(0,1,0),...e};super(t),this.isTranslateHandle=!0,this.type="TranslateHandle";const i=new ve(new r.Vector3(0,0,0),new r.Vector3(0,.8,0)),s=new _e({color:t.color}),n=new r.Line(i,s);n.matrixAutoUpdate=!1,this.add(n);const a=new r.ConeBufferGeometry(.05,.2,12,1,!1);a.translate(0,.9,0);const o=new ge({color:t.color}),h=new r.Mesh(a,o);h.matrixAutoUpdate=!1,this.add(h),this.direction=t.direction}get direction(){return this._direction}set direction(e){if(n.isNull(e))throw new Error("Direction cannot be null ! Expect an instance of Color.");if(n.isUndefined(e))throw new Error("Direction cannot be undefined ! Expect an instance of Color.");if(!(e instanceof r.Vector3))throw new Error(`Direction cannot be an instance of ${e.constructor.name}. Expect an instance of Vector3.`);if(this._direction=e,e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{const t=new r.Vector3(e.z,0,-e.x).normalize(),i=Math.acos(e.y);this.quaternion.setFromAxisAngle(t,i)}}update(e){super.update(e);this._direction.dot(e)>=0&&this.flipDirection(),this.updateMatrix(),this.hitbox.updateMatrix()}setDirection(e){return this.direction=e,this}flipDirection(){this.direction=this._direction.negate()}}
/**
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 */class Be extends Se{constructor(){super(),this.isTranslateGizmo=!0,this.type="TranslateGizmo",this.handleGizmos={X:new Ae({color:11141120,direction:new r.Vector3(1,0,0)}),Y:new Ae({color:43520,direction:new r.Vector3(0,1,0)}),Z:new Ae({color:170,direction:new r.Vector3(0,0,1)}),XY:new Fe({color:11184640,direction:new r.Vector3(1,1,0)}).setScale(.33,.33,1),YZ:new Fe({color:43690,direction:new r.Vector3(0,1,1)}).setScale(.33,.33,1).setRotationFromAxisAndAngle(new r.Vector3(0,1,0),t.degreesToRadians(-90)),XZ:new Fe({color:11141290,direction:new r.Vector3(1,0,1)}).setScale(.33,.33,1).setRotationFromAxisAndAngle(new r.Vector3(1,0,0),t.degreesToRadians(90)),XYZ:new we({color:11184810}).setScale(.15,.15,.15)},this._setupHandles(this.handleGizmos)}raycast(e,t){if(e.intersectObject(this.intersectPlane,!0).length>0)for(let i of this.children)i.name!==this.intersectPlane.name&&i.raycast(e,t)}}
/**
	 * @module Controllers/ClippingController
	 *
	 * @author [Ahmed DCHAR]{@link https://github.com/Dragoneel}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 *
	 * @example Todo
	 *
	 */class Te extends r.LineSegments{constructor(){super(),this.margin=.01,this.geometry=new r.EdgesGeometry(new r.BoxBufferGeometry(2,2,2)),this.material=new r.LineBasicMaterial({color:16777215}),this.matrixAutoUpdate=!1,this.normalPlanes={normalRightSide:new r.Vector3(-1,0,0),normalLeftSide:new r.Vector3(1,0,0),normalFrontSide:new r.Vector3(0,-1,0),normalBackSide:new r.Vector3(0,1,0),normalTopSide:new r.Vector3(0,0,-1),normalBottomSide:new r.Vector3(0,0,1)},this.planes={rightSidePlane:new r.Plane(this.normalPlanes.normalRightSide.clone(),0),leftSidePlane:new r.Plane(this.normalPlanes.normalLeftSide.clone(),0),frontSidePlane:new r.Plane(this.normalPlanes.normalFrontSide.clone(),0),backSidePlane:new r.Plane(this.normalPlanes.normalBackSide.clone(),0),topSidePlane:new r.Plane(this.normalPlanes.normalTopSide.clone(),0),bottomSidePlane:new r.Plane(this.normalPlanes.normalBottomSide.clone(),0)},this._boundingBox=new r.Box3}getBoundingSphere(){return this.geometry.computeBoundingSphere(),this.geometry.boundingSphere.applyMatrix4(this.matrixWorld),this.geometry.boundingSphere}setColor(e){this.material.color.set(e)}applyClippingTo(e,t){if(n.isNotDefined(t))return;let i=[];for(let e in this.planes)i.push(this.planes[e]);t.traverse(t=>{if(n.isNotDefined(t))return;if(n.isNotDefined(t.geometry))return;if(n.isNotDefined(t.material))return;const r=n.isArray(t.material)?t.material:[t.material];for(let t=0,s=r.length;t<s;t++){let s=r[t];s.clippingPlanes||(s.clippingPlanes=[]),s.clippingPlanes=e?i:[]}})}updateSize(e){this.scale.set(e.x,e.y,e.z)}update(){this._boundingBox.setFromObject(this);const e=this.margin,t=this._boundingBox.min,i=this._boundingBox.max;this.planes.rightSidePlane.constant=i.x+e,this.planes.leftSidePlane.constant=-t.x+e,this.planes.frontSidePlane.constant=i.y+e,this.planes.backSidePlane.constant=-t.y+e,this.planes.topSidePlane.constant=i.z+e,this.planes.bottomSidePlane.constant=-t.z+e}}const Oe=t.toEnum({None:"None",Translate:"Translate",Rotate:"Rotate",Scale:"Scale"});class Ce extends r.Object3D{constructor(e={}){const t={camera:null,domElement:window,mode:Oe.None,objectsToClip:new r.Object3D,...e};super(),this._handlers={onMouseEnter:this._onMouseEnter.bind(this),onMouseLeave:this._onMouseLeave.bind(this),onMouseDown:this._onMouseDown.bind(this),onMouseMove:this._onMouseMove.bind(this),onMouseWheel:this._onMouseWheel.bind(this),onMouseUp:this._onMouseUp.bind(this),onDblClick:this._onDblClick.bind(this),onTouchStart:this._onTouchStart.bind(this),onTouchEnd:this._onTouchEnd.bind(this),onTouchCancel:this._onTouchCancel.bind(this),onTouchLeave:this._onTouchLeave.bind(this),onTouchMove:this._onTouchMove.bind(this),onKeyDown:this._onKeyDown.bind(this),onKeyUp:this._onKeyUp.bind(this)},this._events={impose:{type:"impose"},dispose:{type:"dispose"},change:{type:"change"},translate:{type:"translate"},rotate:{type:"rotate"},scale:{type:"scale"},mouseEnter:{type:"mouseEnter"},mouseLeave:{type:"mouseLeave"},mouseDown:{type:"mouseDown"},mouseUp:{type:"mouseUp"}},this._objectsToClipBoundingBox=new r.Box3,this._objectsToClipSize=new r.Vector3,this._objectsToClipCenter=new r.Vector3,this._clippingBox=new Te,this.add(this._clippingBox),this.camera=t.camera,this.domElement=t.domElement,this.mode=t.mode,this.objectsToClip=t.objectsToClip,this.translationSnap=.1,this.scaleSnap=.1,this.rotationSnap=.1,this.matrixAutoUpdate=!1,this.enabled=!1,this.size=1,this._dragging=!1,this._firstPoint=new r.Vector3,this._secondPoint=new r.Vector3,this._mouseDisplacement=new r.Vector3,this._offset=new r.Vector3,this._raycaster=new r.Raycaster,this._pointerVector=new r.Vector2,this._directionToMouse=new r.Vector3,this._cameraPosition=new r.Vector3,this._cameraDirection=new r.Vector3,this._worldPosition=new r.Vector3,this._worldRotation=new r.Euler,this._gizmos={Translate:new Be,Scale:new De};for(let e in this._gizmos)this.add(this._gizmos[e]);this._currentGizmo=null,this._currentHandle=null,this.actionsMap={setMode:{translate:[s.Keys.T.value],rotate:[s.Keys.R.value],scale:[s.Keys.S.value]},translate:{front:[s.Keys.Z.value,s.Keys.UP_ARROW.value],back:[s.Keys.S.value,s.Keys.DOWN_ARROW.value],up:[s.Keys.A.value,s.Keys.PAGE_UP.value],down:[s.Keys.E.value,s.Keys.PAGE_DOWN.value],left:[s.Keys.Q.value,s.Keys.LEFT_ARROW.value],right:[s.Keys.D.value,s.Keys.RIGHT_ARROW.value]},scale:{widthPlus:[s.Keys.LEFT_ARROW.value],widthMinus:[s.Keys.RIGHT_ARROW.value],heightPlus:[s.Keys.PAGE_UP.value],heightMinus:[s.Keys.PAGE_DOWN.value],depthPlus:[s.Keys.UP_ARROW.value],depthMinus:[s.Keys.DOWN_ARROW.value]},rotate:{xAxis:[s.Keys.X.value],yAxis:[s.Keys.Y.value],zAxis:[s.Keys.Z.value]}}}get objectsToClip(){return this._objectsToClip}set objectsToClip(e){if(n.isNull(e))throw new Error("Objects to clip cannot be null ! Expect an instance of Object3D");if(n.isUndefined(e))throw new Error("Objects to clip cannot be undefined ! Expect an instance of Object3D");if(!(e instanceof r.Object3D))throw new Error(`Objects to clip cannot be an instance of ${e.constructor.name}. Expect an instance of Object3D.`);this._objectsToClip=e,this.updateClipping()}get camera(){return this._camera}set camera(e){if(n.isNull(e))throw new Error("Camera cannot be null ! Expect an instance of Camera");if(n.isUndefined(e))throw new Error("Camera cannot be undefined ! Expect an instance of Camera");if(!e.isCamera&&!e.isPerspectiveCamera&&!e.isOrthographicCamera)throw new Error(`Camera cannot be an instance of ${e.constructor.name}. Expect an instance of Camera, PerspectiveCamera, or OrthographicCamera.`);this._camera=e}get domElement(){return this._domElement}set domElement(e){if(n.isNull(e))throw new Error("DomElement cannot be null ! Expect an instance of Window, HTMLDocument, HTMLDivElement or HTMLCanvasElement.");if(n.isUndefined(e))throw new Error("DomElement cannot be undefined ! Expect an instance of Window, HTMLDocument, HTMLDivElement or HTMLCanvasElement.");if(!(e instanceof Window||e instanceof HTMLDocument||e instanceof HTMLDivElement||e instanceof HTMLCanvasElement))throw new Error(`Target cannot be an instance of ${e.constructor.name}. Expect an instance of Window, HTMLDocument, HTMLDivElement or HTMLCanvasElement.`);this._domElement&&(this._domElement.removeEventListener("mouseenter",this._handlers.onMouseEnter,!1),this._domElement.removeEventListener("mouseleave",this._handlers.onMouseLeave,!1),this.dispose()),this._domElement=e,this._domElement.addEventListener("mouseenter",this._handlers.onMouseEnter,!1),this._domElement.addEventListener("mouseleave",this._handlers.onMouseLeave,!1),this.impose()}get mode(){return this._mode}set mode(e){if(n.isNull(e))throw new Error("Mode cannot be null ! Expect a value from ClippingModes enum.");if(n.isUndefined(e))throw new Error("Mode cannot be undefined ! Expect a value from ClippingModes enum.");this._mode=e;for(let e in this._gizmos)this._gizmos[e].visible=!1;this._mode===Oe.None?this._currentGizmo=null:(this._currentGizmo=this._gizmos[this._mode],this._currentGizmo.visible=!0),this.updateGizmo()}setCamera(e){return this.camera=e,this}setDomElement(e){return this.domElement=e,this}setMode(e){return this.mode=e,this}setObjectsToClip(e){return this.objectsToClip=e,this}impose(){this._domElement.addEventListener("keydown",this._handlers.onKeyDown,!1),this._domElement.addEventListener("keyup",this._handlers.onKeyUp,!1),this._domElement.addEventListener("dblclick",this._handlers.onDblClick,!1),this._domElement.addEventListener("mousedown",this._handlers.onMouseDown,!1),this._domElement.addEventListener("mousemove",this._handlers.onMouseMove,!1),this._domElement.addEventListener("mouseup",this._handlers.onMouseUp,!1),this._domElement.addEventListener("wheel",this._handlers.onMouseWheel,{capture:!0,once:!1,passive:!1}),this._domElement.addEventListener("touchcancel",this._handlers.onTouchCancel,!1),this._domElement.addEventListener("touchend",this._handlers.onTouchEnd,!1),this._domElement.addEventListener("touchleave",this._handlers.onTouchLeave,!1),this._domElement.addEventListener("touchmove",this._handlers.onTouchMove,{capture:!0,once:!1,passive:!1}),this._domElement.addEventListener("touchstart",this._handlers.onTouchStart,{capture:!0,once:!1,passive:!1}),this.dispatchEvent(this._events.impose)}dispose(){this._domElement.removeEventListener("keydown",this._handlers.onKeyDown,!1),this._domElement.removeEventListener("keyup",this._handlers.onKeyUp,!1),this._domElement.removeEventListener("dblclick",this._handlers.onDblClick,!1),this._domElement.removeEventListener("mousedown",this._handlers.onMouseDown,!1),this._domElement.removeEventListener("mousemove",this._handlers.onMouseMove,!1),this._domElement.removeEventListener("mouseup",this._handlers.onMouseUp,!1),this._domElement.removeEventListener("wheel",this._handlers.onMouseWheel,{capture:!0,once:!1,passive:!1}),this._domElement.removeEventListener("touchcancel",this._handlers.onTouchCancel,!1),this._domElement.removeEventListener("touchend",this._handlers.onTouchEnd,!1),this._domElement.removeEventListener("touchleave",this._handlers.onTouchLeave,!1),this._domElement.removeEventListener("touchmove",this._handlers.onTouchMove,{capture:!0,once:!1,passive:!1}),this._domElement.removeEventListener("touchstart",this._handlers.onTouchStart,{capture:!0,once:!1,passive:!1}),this.dispatchEvent(this._events.dispose)}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}enable(){this.visible=!0,this.enabled=!0,n.isDefined(this._objectsToClip)&&(this._objectsToClipBoundingBox.setFromObject(this._objectsToClip),this._objectsToClipBoundingBox.getSize(this._objectsToClipSize),this._objectsToClipSize.divideScalar(2),this.scale.set(this._objectsToClipSize.x,this._objectsToClipSize.y,this._objectsToClipSize.z),this._objectsToClipBoundingBox.getCenter(this._objectsToClipCenter),this.position.set(this._objectsToClipCenter.x,this._objectsToClipCenter.y,this._objectsToClipCenter.z),this.updateMatrix(),this.updateMatrixWorld()),this.updateClipping(),this.updateGizmo()}disable(){this.visible=!1,this.enabled=!1,this.updateClipping()}updateClipping(){n.isNotDefined(this._objectsToClip)||(this._clippingBox.update(),this._clippingBox.applyClippingTo(this.enabled,this._objectsToClip))}updateGizmo(){this.enabled&&this._mode!==Oe.None&&(n.isNotDefined(this._currentGizmo)||(this._camera.getWorldPosition(this._cameraPosition),this._camera.getWorldDirection(this._cameraDirection),this._currentGizmo.update(this._cameraPosition,this._cameraDirection)))}_consumeEvent(e){e.cancelable&&e.stopImmediatePropagation()}_onKeyDown(e){if(!this.enabled)return;e.preventDefault();const t=this.actionsMap,i=e.keyCode;if(e.ctrlKey)switch(this._mode){case Oe.Translate:t.translate.front.includes(i)?(this._translateZ(this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.translate.back.includes(i)?(this._translateZ(-this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.translate.right.includes(i)?(this._translateX(this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.translate.left.includes(i)?(this._translateX(-this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.translate.up.includes(i)?(this._translateY(this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.translate.down.includes(i)&&(this._translateY(-this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change));break;case Oe.Rotate:break;case Oe.Scale:t.scale.depthPlus.includes(i)?(this._scaleZ(this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.scale.depthMinus.includes(i)?(this._scaleZ(-this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.scale.widthPlus.includes(i)?(this._scaleX(this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.scale.widthMinus.includes(i)?(this._scaleX(-this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.scale.heightPlus.includes(i)?(this._scaleY(this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.scale.heightMinus.includes(i)&&(this._scaleY(-this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change))}else t.setMode.translate.includes(i)?(this.setMode(Oe.Translate),this.updateClipping(),this._consumeEvent(e)):t.setMode.rotate.includes(i)?(this.setMode(Oe.Rotate),this.updateClipping(),this._consumeEvent(e)):t.setMode.scale.includes(i)&&(this.setMode(Oe.Scale),this.updateClipping(),this._consumeEvent(e))}_onKeyUp(e){this.enabled&&!e.defaultPrevented&&e.preventDefault()}_onDblClick(e){this.enabled&&this._mode!==Oe.None&&e.preventDefault()}_onMouseDown(e){if(!this.enabled)return;if(this._mode===Oe.None)return;if(e.button!==s.Mouse.Left.value)return;if(n.isNotDefined(this._currentHandle))return;e.preventDefault(),this._dragging=!0;const t=this.intersectObjects(e,[this._currentGizmo.intersectPlane]);t&&(this._firstPoint=t.point),this._consumeEvent(e),this.dispatchEvent(this._events.mouseDown)}_onMouseEnter(e){this.enabled&&this._mode!==Oe.None&&(e.preventDefault(),this.impose(),e.target.constructor!==HTMLDocument&&this._domElement.focus())}_onMouseLeave(e){this.enabled&&this._mode!==Oe.None&&(e.preventDefault(),this._dragging=!1,e.target.constructor!==HTMLDocument&&this._domElement.blur(),this.dispose())}_onMouseMove(e){if(this.enabled&&this._mode!==Oe.None)if(e.preventDefault(),!1===this._dragging){const t=this.intersectObjects(e,[this._currentGizmo]);if(t){const i=t.object;this._currentHandle&&i!==this._currentHandle&&(this._currentHandle.highlight(!1),this.dispatchEvent(this._events.mouseLeave)),this._currentHandle=i,this._currentHandle.highlight(!0),this.dispatchEvent(this._events.mouseEnter),this._consumeEvent(e)}else n.isDefined(this._currentHandle)&&(this._currentHandle.highlight(!1),this._currentHandle=null,this.dispatchEvent(this._events.mouseLeave))}else{const t=this._currentHandle,i=t.name,r=this.intersectObjects(e,[this._currentGizmo.intersectPlane]);switch(r&&(this._secondPoint=r.point),this._mouseDisplacement.subVectors(this._secondPoint,this._firstPoint),this._firstPoint.copy(this._secondPoint),this._mode){case Oe.Translate:"X"===i?this._offset.set(1,0,0):"Y"===i?this._offset.set(0,1,0):"Z"===i?this._offset.set(0,0,1):"XY"===i?this._offset.set(1,1,0):"YZ"===i?this._offset.set(0,1,1):"XZ"===i?this._offset.set(1,0,1):"XYZ"===i&&this._offset.set(1,1,1),this._offset.multiply(this._mouseDisplacement),this._translate(this._offset);break;case Oe.Rotate:break;case Oe.Scale:if(t.isScaleHandle)this._offset.copy(this._currentHandle.direction).multiply(this._mouseDisplacement);else if(t.isPlaneHandle){const e=this._currentHandle.xDirection.dot(this._mouseDisplacement);e>0?this._offset.setX(Math.abs(this._mouseDisplacement.x)):e<0?this._offset.setX(-Math.abs(this._mouseDisplacement.x)):this._offset.setX(0);const t=this._currentHandle.yDirection.dot(this._mouseDisplacement);t>0?this._offset.setY(Math.abs(this._mouseDisplacement.y)):t<0?this._offset.setY(-Math.abs(this._mouseDisplacement.y)):this._offset.setY(0);const i=this._currentHandle.zDirection.dot(this._mouseDisplacement);i>0?this._offset.setZ(Math.abs(this._mouseDisplacement.z)):i<0?this._offset.setZ(-Math.abs(this._mouseDisplacement.z)):this._offset.setZ(0)}else if(t.isOmnidirectionalHandle){this.getWorldPosition(this._worldPosition),this._directionToMouse.subVectors(this._firstPoint,this._worldPosition);const e=this._directionToMouse.dot(this._mouseDisplacement)>0?this._mouseDisplacement.length():-this._mouseDisplacement.length();this._offset.set(e,e,e)}this._scale(this._offset);break;default:throw new RangeError(`Invalid switch parameter: ${this._mode}`)}this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)}}_onMouseUp(e){if(!this.enabled)return;if(this._mode===Oe.None)return;if(e.button!==s.Mouse.Left.value)return;e.preventDefault(),this._dragging=!1,this.dispatchEvent(this._events.mouseUp);const t=this.intersectObjects(e,[this._currentGizmo]);t?(this._currentHandle=t.object,this._currentHandle.highlight(!0),this._consumeEvent(e),this.dispatchEvent(this._events.mouseEnter)):n.isDefined(this._currentHandle)&&(this._currentHandle.highlight(!1),this._currentHandle=null,this.dispatchEvent(this._events.mouseLeave)),this.updateGizmo()}_onMouseWheel(e){this.enabled&&e.preventDefault()}_onTouchCancel(e){this.enabled&&e.preventDefault()}_onTouchEnd(e){this.enabled&&e.preventDefault()}_onTouchLeave(e){this.enabled&&e.preventDefault()}_onTouchMove(e){this.enabled&&e.preventDefault()}_onTouchStart(e){this.enabled&&e.preventDefault()}getActiveHandle(e){}intersectObjects(e,t){const i=this._domElement.getBoundingClientRect(),r=(e.clientX-i.left)/i.width*2-1,s=-(e.clientY-i.top)/i.height*2+1;this._pointerVector.set(r,s),this._raycaster.setFromCamera(this._pointerVector,this._camera);const n=this._raycaster.intersectObjects(t,!1);return n[0]?n[0]:null}_translate(e){this.position.add(e),this.updateMatrix()}_translateX(e){this.position.setX(this.position.x+e),this.updateMatrix()}_translateY(e){this.position.setY(this.position.y+e),this.updateMatrix()}_translateZ(e){this.position.setZ(this.position.z+e),this.updateMatrix()}_translateXY(e,t){this.position.setX(this.position.x+e),this.position.setY(this.position.y+t),this.updateMatrix()}_translateXZ(e,t){this.position.setX(this.position.x+e),this.position.setZ(this.position.z+t),this.updateMatrix()}_translateYZ(e,t){this.position.setY(this.position.y+e),this.position.setZ(this.position.z+t),this.updateMatrix()}_translateXYZ(e,t,i){this.position.set(this.position.x+e,this.position.y+t,this.position.z+i),this.updateMatrix()}_rotateX(e){}_rotateY(e){}_rotateZ(e){}_rotateXY(e){}_rotateXZ(e){}_rotateYZ(e){}_rotateXYZ(e){}_scale(e){this.scale.add(e),this.updateMatrix()}_scaleX(e){this.scale.setX(this.scale.x+e),this.updateMatrix()}_scaleY(e){this.scale.setY(this.scale.y+e),this.updateMatrix()}_scaleZ(e){this.scale.setZ(this.scale.z+e),this.updateMatrix()}_scaleXY(e,t){this.scale.setX(this.scale.x+e),this.scale.setY(this.scale.y+t),this.updateMatrix()}_scaleXZ(e,t){this.scale.setX(this.scale.x+e),this.scale.setZ(this.scale.z+t),this.updateMatrix()}_scaleYZ(e,t){this.scale.setY(this.scale.y+e),this.scale.setZ(this.scale.z+t),this.updateMatrix()}_scaleXYZ(e,t,i){this.scale.set(this.scale.x+e,this.scale.y+t,this.scale.z+i),this.updateMatrix()}}
/**
	 * @module Managers/CurvesManager
	 *
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 *
	 * @example Todo
	 *
	 */class ze extends s.TDataBaseManager{constructor(e={}){super({basePath:"/curves",...e})}convert(e){if(!e)throw new Error("CurvesManager: Unable to convert null or undefined data !");const t=e.type;let i;switch(t){case"ArcCurve":i=new r.ArcCurve;break;case"CatmullRomCurve3":i=new r.CatmullRomCurve3;break;case"CubicBezierCurve":i=new r.CubicBezierCurve;break;case"CubicBezierCurve3":i=new r.CubicBezierCurve3;break;case"Curve":i=new r.Curve;break;case"CurvePath":i=new r.CurvePath;break;case"EllipseCurve":i=new r.EllipseCurve;break;case"LineCurve":i=new r.LineCurve;break;case"LineCurve3":i=new r.LineCurve3;break;case"Path":i=new r.Path;break;case"QuadraticBezierCurve":i=new r.QuadraticBezierCurve;break;case"QuadraticBezierCurve3":i=new r.QuadraticBezierCurve3;break;case"SplineCurve":i=new r.SplineCurve;break;case"Shape":i=new r.Shape;break;default:throw new Error(`TCurvesManager: Unknown curve of type: ${t}`)}return i.fromJSON(e),i}_onJson(e,t,i,r){const s=n.isObject(e)?[e]:e,a={};for(let e,t=0,n=s.length;t<n;t++){e=s[t];try{a[e._id]=this.convert(e)}catch(e){r(e)}i(t/n)}t(a)}}
/**
	 * @module Managers/GeometriesManager
	 *
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 *
	 * @requires {@link TDataBaseManager}
	 * @requires '../../../node_modules/three/src/core/Geometry'
	 * @requires { BufferGeometry } from 'three'
	 * @requires '../../../node_modules/three/src/core/BufferAttribute'
	 *
	 */const ke=t.toEnum({Int8Array:0,Uint8Array:1,Uint8ClampedArray:2,Int16Array:3,Uint16Array:4,Int32Array:5,Uint32Array:6,Float32Array:7,Float64Array:8});class Ie extends s.TDataBaseManager{constructor(e={}){const t={basePath:"/geometries",projectionSystem:"zBack",globalScale:1,computeNormals:!0,computeBoundingBox:!0,computeBoundingSphere:!0,...e};super(t),this.projectionSystem=t.projectionSystem,this.globalScale=t.globalScale,this.computeNormals=t.computeNormals,this.computeBoundingBox=t.computeBoundingBox,this.computeBoundingSphere=t.computeBoundingSphere}get computeBoundingBox(){return this._computeBoundingBox}set computeBoundingBox(e){if(n.isNull(e))throw new TypeError("Compute bounding box cannot be null ! Expect a boolean.");if(n.isUndefined(e))throw new TypeError("Compute bounding box cannot be undefined ! Expect a boolean.");if(n.isNotBoolean(e))throw new TypeError(`Compute bounding box cannot be an instance of ${e.constructor.name} ! Expect a boolean.`);this._computeBoundingBox=e}get computeBoundingSphere(){return this._computeBoundingSphere}set computeBoundingSphere(e){if(n.isNull(e))throw new TypeError("Compute bounding sphere cannot be null ! Expect a boolean.");if(n.isUndefined(e))throw new TypeError("Compute bounding sphere cannot be undefined ! Expect a boolean.");if(n.isNotBoolean(e))throw new TypeError(`Compute bounding sphere cannot be an instance of ${e.constructor.name} ! Expect a boolean.`);this._computeBoundingSphere=e}get computeNormals(){return this._computeNormals}set computeNormals(e){if(n.isNull(e))throw new TypeError("Compute normals cannot be null ! Expect a boolean.");if(n.isUndefined(e))throw new TypeError("Compute normals cannot be undefined ! Expect a boolean.");if(n.isNotBoolean(e))throw new TypeError(`Compute normals cannot be an instance of ${e.constructor.name} ! Expect a boolean.`);this._computeNormals=e}get projectionSystem(){return this._projectionSystem}set projectionSystem(e){if(n.isNull(e))throw new TypeError("Projection system cannot be null ! Expect a positive number.");if(n.isUndefined(e))throw new TypeError("Projection system cannot be undefined ! Expect a positive number.");this._projectionSystem=e}get globalScale(){return this._globalScale}set globalScale(e){if(n.isNull(e))throw new TypeError("Global scale cannot be null ! Expect a positive number.");if(n.isUndefined(e))throw new TypeError("Global scale cannot be undefined ! Expect a positive number.");this._globalScale=e}setComputeBoundingBox(e){return this.computeBoundingBox=e,this}setComputeBoundingShpere(e){return this.computeBoundingSphere=e,this}setComputeNormals(e){return this.computeNormals=e,this}setProjectionSystem(e){return this.projectionSystem=e,this}setGlobalScale(e){return this.globalScale=e,this}_onJson(e,t,i,r){const s=n.isObject(e)?[e]:e,a={};for(let e,t=0,n=s.length;t<n;t++){e=s[t];try{a[e._id]=this.convert(e)}catch(e){r(e)}i(new ProgressEvent("GeometriesManager",{lengthComputable:!0,loaded:t+1,total:n}))}t(a)}convert(e){if(!e)throw new Error("GeometriesManager: Unable to convert null or undefined data !");const t=e.type;if(!t)throw new Error("GeometriesManager: Unable to convert untyped data !");let i=null;if(e.isBufferGeometry||t.includes("BufferGeometry"))i=this._convertJsonToBufferGeometry(e),this._computeNormals&&i.computeVertexNormals();else{if(!e.isGeometry&&!t.includes("Geometry"))throw new Error(`TGeometriesManager: Unable to retrieve geometry of type ${t} !`);i=this._convertJsonToGeometry(e),this._computeNormals&&i.computeFaceNormals()}return this.computeBoundingBox&&(i.boundingBox=null,i.computeBoundingBox()),this.computeBoundingSphere&&(i.boundingSphere=null,i.computeBoundingSphere()),i}_convertJsonToGeometry(e){const t=e.types;let i=null;switch(t){case"BoxGeometry":i=new r.BoxGeometry;break;case"CircleGeometry":i=new r.CircleGeometry;break;case"CylinderGeometry":i=new r.CylinderGeometry;break;case"ConeGeometry":i=new r.ConeGeometry;break;case"EdgesGeometry":i=new r.EdgesGeometry;break;case"DodecahedronGeometry":i=new r.DodecahedronGeometry;break;case"ExtrudeGeometry":i=new r.ExtrudeGeometry;break;case"Geometry":i=new r.Geometry;break;case"IcosahedronGeometry":i=new r.IcosahedronGeometry;break;case"LatheGeometry":i=new r.LatheGeometry;break;case"OctahedronGeometry":i=new r.OctahedronGeometry;break;case"ParametricGeometry":i=new r.ParametricGeometry;break;case"PlaneGeometry":i=new r.PlaneGeometry;break;case"PolyhedronGeometry":i=new r.PolyhedronGeometry;break;case"RingGeometry":i=new r.RingGeometry;break;case"ShapeGeometry":i=new r.ShapeGeometry;break;case"TetrahedronGeometry":i=new r.TetrahedronGeometry;break;case"TextGeometry":i=new r.TextGeometry;break;case"TorusGeometry":i=new r.TorusGeometry;break;case"TorusKnotGeometry":i=new r.TorusKnotGeometry;break;case"TubeGeometry":i=new r.TubeGeometry;break;case"SphereGeometry":i=new r.SphereGeometry;break;case"WireframeGeometry":i=new r.WireframeGeometry;break;default:throw new Error(`TGeometriesManager: Unknown geometry of type: ${t}`)}i.uuid=e.uuid,i.name=e.name,i.type=e.type;for(var s=[],n=void 0,a=0,o=e.vertices.length;a<o;++a)n=e.vertices[a],s.push(new r.Vector3(n.x,n.y,n.z));i.vertices=s;for(var h=[],l=void 0,c=0,d=e.faces.length;c<d;c++)l=e.faces[c],h.push(new r.Face3(l.a,l.b,l.c,l.normal,l.color,l.materialIndex));i.faces=h,i.morphTargets=[],i.morphNormals=[],i.skinWeights=[],i.skinIndices=[],i.lineDistances=[],i.elementsNeedUpdate=!0,i.verticesNeedUpdate=!0,i.uvsNeedUpdate=!0,i.normalsNeedUpdate=!0,i.colorsNeedUpdate=!0,i.lineDistancesNeedUpdate=!0,i.groupsNeedUpdate=!0}_convertJsonToBufferGeometry(e){const t=e.type;let i=null;switch(t){case"BoxBufferGeometry":i=new r.BoxBufferGeometry;break;case"BufferGeometry":case"ShapeBufferGeometry":i=new r.BufferGeometry;break;case"CircleBufferGeometry":i=new r.CircleBufferGeometry;break;case"CylinderBufferGeometry":i=new r.CylinderBufferGeometry;break;case"ConeBufferGeometry":i=new r.ConeBufferGeometry;break;case"DodecahedronBufferGeometry":i=new r.DodecahedronBufferGeometry;break;case"ExtrudeBufferGeometry":i=new r.ExtrudeBufferGeometry;break;case"IcosahedronBufferGeometry":i=new r.IcosahedronBufferGeometry;break;case"LatheBufferGeometry":i=new r.LatheBufferGeometry;break;case"OctahedronBufferGeometry":i=new r.OctahedronBufferGeometry;break;case"ParametricBufferGeometry":i=new r.ParametricBufferGeometry;break;case"PlaneBufferGeometry":i=new r.PlaneBufferGeometry;break;case"PolyhedronBufferGeometry":i=new r.PolyhedronBufferGeometry;break;case"RingBufferGeometry":i=new r.RingBufferGeometry;break;case"TetrahedronBufferGeometry":i=new r.TetrahedronBufferGeometry;break;case"TextBufferGeometry":i=new r.TextBufferGeometry;break;case"TorusBufferGeometry":i=new r.TorusBufferGeometry;break;case"TorusKnotBufferGeometry":i=new r.TorusKnotBufferGeometry;break;case"TubeBufferGeometry":i=new r.TubeBufferGeometry;break;case"SphereBufferGeometry":i=new r.SphereBufferGeometry;break;case"InstancedBufferGeometry":i=new r.InstancedBufferGeometry;break;default:throw new Error(`TGeometriesManager: Unknown buffer geometry of type: ${t}`)}i._id=e._id,i.uuid=e.uuid,i.name=e.name;const s=e.index;if(s&&s.array&&s.array.length>0){const e=this.__convertBase64ToArrayBuffer(s.array),t=this.__convertArrayBufferToTypedArray(e);i.index=new r.BufferAttribute(t,s.itemSize,s.normalized)}const a=e.attributes;if(a){let e={};const t=a.position;if(t){const i=this.__convertBase64ToArrayBuffer(t.array),s=this.__convertArrayBufferToTypedArray(i),n=this.globalScale,a=new Float32Array(s);if("zBack"===this._projectionSystem){let e=null,t=null,i=null;for(let r=0,s=a.length;r<s;r+=3)e=a[r]/n,t=a[r+2]/n,i=-a[r+1]/n,a[r]=e,a[r+1]=t,a[r+2]=i}else for(let e=0,t=a.length;e<t;e++)a[e]/=n;e.position=new r.BufferAttribute(a,t.itemSize,t.normalized)}const s=a.normal;if(s){const t=this.__convertBase64ToArrayBuffer(s.array),i=this.__convertArrayBufferToTypedArray(t);e.normal=new r.BufferAttribute(i,s.itemSize,s.normalized)}const n=a.uv;if(n){const t=this.__convertBase64ToArrayBuffer(n.array),i=this.__convertArrayBufferToTypedArray(t);e.uv=new r.BufferAttribute(i,n.itemSize,n.normalized)}i.attributes=e}return n.isDefined(e.groups)&&(i.groups=e.groups),n.isDefined(e.boundingBox)&&(i.boundingBox=e.boundingBox),n.isDefined(e.boundingSphere)&&(i.boundingSphere=e.boundingSphere),"ShapeBufferGeometry"===t&&(i.shapes=e.shapes.map(e=>(new r.Shape).fromJSON(e)),i.curveSegments=e.curveSegments),i}__convertArrayBufferToTypedArray(e){const t=new DataView(e),i=e.byteLength-1,r=t.getUint8(0);let s=null;switch(r){case ke.Int8Array:s=new Int8Array(i/1);for(let e=0,r=1;r<i;e++,r+=1)s[e]=t.getInt8(r);break;case ke.Uint8Array:s=new Uint8Array(i/1);for(let e=0,r=1;r<i;e++,r+=1)s[e]=t.getUint8(r);break;case ke.Uint8ClampedArray:s=new Uint8ClampedArray(i/1);for(let e=0,r=1;r<i;e++,r+=1)s[e]=t.getUint8(r);break;case ke.Int16Array:s=new Int16Array(i/2);for(let e=0,r=1;r<i;e++,r+=2)s[e]=t.getInt16(r);break;case ke.Uint16Array:s=new Uint16Array(i/2);for(let e=0,r=1;r<i;e++,r+=2)s[e]=t.getUint16(r);break;case ke.Int32Array:s=new Int32Array(i/4);for(let e=0,r=1;r<i;e++,r+=4)s[e]=t.getInt32(r);break;case ke.Uint32Array:s=new Uint32Array(i/4);for(let e=0,r=1;r<i;e++,r+=4)s[e]=t.getUint32(r);break;case ke.Float32Array:s=new Float32Array(i/4);for(let e=0,r=1;r<i;e++,r+=4)s[e]=t.getFloat32(r);break;case ke.Float64Array:s=new Float64Array(i/8);for(let e=0,r=1;r<i;e++,r+=8)s[e]=t.getFloat64(r);break;default:throw new RangeError(`Invalid switch parameter: ${r}`)}return s}__convertBase64ToArrayBuffer(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=new Uint8Array(256);for(let e=0;e<64;e++)i[t.charCodeAt(e)]=e;const r=e.length;let s=.75*r;"="===e[r-1]&&(s--,"="===e[r-2]&&s--);let n,a,o,h,l=new ArrayBuffer(s),c=new Uint8Array(l);for(let t=0,s=0;t<r;t+=4)n=i[e.charCodeAt(t)],a=i[e.charCodeAt(t+1)],o=i[e.charCodeAt(t+2)],h=i[e.charCodeAt(t+3)],c[s++]=n<<2|a>>4,c[s++]=(15&a)<<4|o>>2,c[s++]=(3&o)<<6|63&h;return l}}
/**
	 * @module Managers/TexturesManager
	 *
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 */class Re extends s.TDataBaseManager{constructor(e={}){super({basePath:"/textures",...e})}convert(e){if(!e)throw new Error("TexturesManager: Unable to convert null or undefined data !");const t=e.type;throw new Error(`TTexturesManager: Unknown texture of type: ${t}`)}_onJson(e,t,i,r){const s=n.isObject(e)?[e]:e,a={};for(let e,t=0,n=s.length;t<n;t++){e=s[t];try{a[e._id]=this.convert(e)}catch(e){r(e)}i(t/n)}t(a)}}
/**
	 * @module Managers/MaterialsManager
	 *
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 *
	 * @requires TDataBaseManager
	 *
	 */const Le=(new r.ImageLoader).load("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH4gkKDRoGpGNegQAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAAMSURBVAjXY/j//z8ABf4C/tzMWecAAAAASUVORK5CYII=");class Ue extends s.TDataBaseManager{constructor(e={}){const t={basePath:"/materials",texturesPath:"/textures",texturesProviderOptions:{},generateMipmap:!1,autoFillTextures:!0,...e};super(t),this.texturesPath=t.texturesPath,this.generateMipmap=t.generateMipmap,this.autoFillTextures=t.autoFillTextures,this.texturesProvider=new r.TextureLoader(t.texturesProviderOptions)}get texturesPath(){return this._texturesPath}set texturesPath(e){if(n.isNull(e))throw new TypeError("Textures path cannot be null ! Expect a non empty string.");if(n.isUndefined(e))throw new TypeError("Textures path cannot be undefined ! Expect a non empty string.");if(n.isNotString(e))throw new TypeError(`Textures path cannot be an instance of ${e.constructor.name} ! Expect a non empty string.`);if(n.isEmptyString(e))throw new TypeError("Textures path cannot be empty ! Expect a non empty string.");if(n.isBlankString(e))throw new TypeError("Textures path cannot contain only whitespace ! Expect a non empty string.");this._texturesPath=e}get texturesProvider(){return this._texturesProvider}set texturesProvider(e){if(n.isNull(e))throw new TypeError("Textures provider cannot be null ! Expect an instance of TextureLoader.");if(n.isUndefined(e))throw new TypeError("Textures provider cannot be undefined ! Expect an instance of TextureLoader.");if(!(e instanceof Re||e instanceof r.TextureLoader))throw new TypeError(`Textures provider cannot be an instance of ${e.constructor.name} ! Expect an instance of TTexturesManager.`);this._texturesProvider=e}get generateMipmap(){return this._generateMipmap}set generateMipmap(e){if(n.isNull(e))throw new TypeError("Generate mipmap cannot be null ! Expect a boolean.");if(n.isUndefined(e))throw new TypeError("Generate mipmap cannot be undefined ! Expect a boolean.");if(n.isNotBoolean(e))throw new TypeError(`Generate mipmap cannot be an instance of ${e.constructor.name} ! Expect a boolean.`);this._generateMipmap=e}get autoFillTextures(){return this._autoFillTextures}set autoFillTextures(e){if(n.isNull(e))throw new TypeError("Global scale cannot be null ! Expect a boolean.");if(n.isUndefined(e))throw new TypeError("Global scale cannot be undefined ! Expect a positive number.");if(n.isNotBoolean(e))throw new TypeError("Global scale cannot be null ! Expect a boolean.");this._autoFillTextures=e}setTexturesPath(e){return this.texturesPath=e,this}setTexturesProvider(e){return this.texturesProvider=e,this}setGenerateMipmap(e){return this.generateMipmap=e,this}setAutoFillTextures(e){return this.autoFillTextures=e,this}_onJson(e,t,i,r){const s=n.isObject(e)?[e]:e,a={};for(let e,t=0,n=s.length;t<n;t++){e=s[t];try{a[e._id]=this.convert(e)}catch(e){r(e)}i(new ProgressEvent("MaterialsManager",{lengthComputable:!0,loaded:t+1,total:n}))}this._autoFillTextures?this.fillTextures(a,t,i,r):t(a)}convert(e){if(!e)throw new Error("MaterialsManager: Unable to convert null or undefined data !");const t=e.type;let i=null;switch(t){case"MeshPhongMaterial":{i=new r.MeshPhongMaterial,this._fillBaseMaterialData(i,e);const t=e.color;n.isDefined(t)&&(i.color=this._setColor(t));const s=e.specular;n.isDefined(s)&&(i.specular=this._setColor(s));const a=e.shininess;n.isDefined(a)&&(i.shininess=a);const o=e.map;n.isDefined(o)&&(i.map=o);const h=e.lightMap;n.isDefined(h)&&(i.lightMap=h);const l=e.lightMapIntensity;n.isDefined(l)&&(i.lightMapIntensity=l);const c=e.aoMap;n.isDefined(c)&&(i.aoMap=c);const d=e.aoMapIntensity;n.isDefined(d)&&(i.aoMapIntensity=d);const u=e.emissive;n.isDefined(u)&&(i.emissive=this._setColor(u));const p=e.emissiveIntensity;n.isDefined(p)&&(i.emissiveIntensity=p);const _=e.emissiveMap;n.isDefined(_)&&(i.emissiveMap=_);const g=e.bumpMap;n.isDefined(g)&&(i.bumpMap=g);const m=e.bumpScale;n.isDefined(m)&&(i.bumpScale=m);const f=e.normalMap;n.isDefined(f)&&(i.normalMap=f);const y=e.normalScale;n.isDefined(y)&&(i.normalScale=this._setVector2(y));const w=e.displacementMap;n.isDefined(w)&&(i.displacementMap=w);const b=e.displacementScale;n.isDefined(b)&&(i.displacementScale=b);const x=e.displacementBias;n.isDefined(x)&&(i.displacementBias=x);const v=e.specularMap;n.isDefined(v)&&(i.specularMap=v);const M=e.alphaMap;n.isDefined(M)&&(i.alphaMap=M);const E=e.envMap;n.isDefined(E)&&(i.envMap=E);const S=e.combine;n.isDefined(S)&&(i.combine=S);const D=e.reflectivity;n.isDefined(D)&&(i.reflectivity=D);const P=e.refractionRatio;n.isDefined(P)&&(i.refractionRatio=P);const F=e.wireframe;n.isDefined(F)&&(i.wireframe=F);const A=e.wireframeLinewidth;n.isDefined(A)&&(i.wireframeLinewidth=A);const B=e.wireframeLinecap;n.isDefined(B)&&(i.wireframeLinecap=B);const T=e.wireframeLinejoin;n.isDefined(T)&&(i.wireframeLinejoin=T);const O=e.skinning;n.isDefined(O)&&(i.skinning=O);const C=e.morphTargets;n.isDefined(C)&&(i.morphTargets=C);const z=e.morphNormals;n.isDefined(z)&&(i.morphNormals=z)}break;case"MeshLambertMaterial":{i=new r.MeshLambertMaterial,this._fillBaseMaterialData(i,e);const t=e.color;n.isDefined(t)&&(i.color=this._setColor(t));const s=e.map;n.isDefined(s)&&(i.map=s);const a=e.lightMap;n.isDefined(a)&&(i.lightMap=a);const o=e.lightMapIntensity;n.isDefined(o)&&(i.lightMapIntensity=o);const h=e.aoMap;n.isDefined(h)&&(i.aoMap=h);const l=e.aoMapIntensity;n.isDefined(l)&&(i.aoMapIntensity=l);const c=e.emissive;n.isDefined(c)&&(i.emissive=this._setColor(c));const d=e.emissiveIntensity;n.isDefined(d)&&(i.emissiveIntensity=d);const u=e.emissiveMap;n.isDefined(u)&&(i.emissiveMap=u);const p=e.specularMap;n.isDefined(p)&&(i.specularMap=p);const _=e.alphaMap;n.isDefined(_)&&(i.alphaMap=_);const g=e.envMap;n.isDefined(g)&&(i.envMap=g);const m=e.combine;n.isDefined(m)&&(i.combine=m);const f=e.reflectivity;n.isDefined(f)&&(i.reflectivity=f);const y=e.refractionRatio;n.isDefined(y)&&(i.refractionRatio=y);const w=e.wireframe;n.isDefined(w)&&(i.wireframe=w);const b=e.wireframeLinewidth;n.isDefined(b)&&(i.wireframeLinewidth=b);const x=e.wireframeLinecap;n.isDefined(x)&&(i.wireframeLinecap=x);const v=e.wireframeLinejoin;n.isDefined(v)&&(i.wireframeLinejoin=v);const M=e.skinning;n.isDefined(M)&&(i.skinning=M);const E=e.morphTargets;n.isDefined(E)&&(i.morphTargets=E);const S=e.morphNormals;n.isDefined(S)&&(i.morphNormals=S)}break;case"LineBasicMaterial":{i=new r.LineBasicMaterial,this._fillBaseMaterialData(i,e);const t=e.color;n.isDefined(t)&&(i.color=this._setColor(t))}break;case"PointsMaterial":{i=new r.PointsMaterial,this._fillBaseMaterialData(i,e);const t=e.color;n.isDefined(t)&&(i.color=this._setColor(t));const s=e.map;n.isDefined(s)&&(i.map=s);const a=e.morphTargets;n.isDefined(a)&&(i.morphTargets=a);const o=e.size;n.isDefined(o)&&(i.size=o);const h=e.sizeAttenuation;n.isDefined(h)&&(i.sizeAttenuation=h)}break;default:throw new Error(`TMaterialsManager: Unmanaged material of type: ${t}`)}return i}_fillBaseMaterialData(e,t){const i=t._id;n.isDefined(i)&&n.isString(i)&&(e._id=i);const r=t.uuid;n.isDefined(r)&&n.isString(r)&&(e.uuid=r);const s=t.name;n.isDefined(s)&&n.isString(s)&&(e.name=s);const a=t.fog;n.isDefined(a)&&(e.fog=a);const o=t.lights;n.isDefined(o)&&(e.lights=o);const h=t.blending;n.isDefined(h)&&(e.blending=h);const l=t.side;n.isDefined(l)&&(e.side=l);const c=t.flatShading;n.isDefined(c)&&(e.flatShading=c);const d=t.vertexColors;n.isDefined(d)&&(e.vertexColors=d);const u=t.opacity;n.isDefined(u)&&(e.opacity=u);const p=t.transparent;n.isDefined(p)&&(e.transparent=p);const _=t.blendSrc;n.isDefined(_)&&(e.blendSrc=_);const g=t.blendDst;n.isDefined(g)&&(e.blendDst=g);const m=t.blendEquation;n.isDefined(m)&&(e.blendEquation=m);const f=t.blendSrcAlpha;n.isDefined(f)&&(e.blendSrcAlpha=f);const y=t.blendDstAlpha;n.isDefined(y)&&(e.blendDstAlpha=y);const w=t.blendEquationAlpha;n.isDefined(w)&&(e.blendEquationAlpha=w);const b=t.depthFunc;n.isDefined(b)&&(e.depthFunc=b);const x=t.depthTest;n.isDefined(x)&&(e.depthTest=x);const v=t.depthWrite;n.isDefined(v)&&(e.depthWrite=v);const M=t.clippingPlanes;n.isDefined(M)&&(e.clippingPlanes=M);const E=t.clipIntersection;n.isDefined(E)&&(e.clipIntersection=E);const S=t.clipShadows;n.isDefined(S)&&(e.clipShadows=S);const D=t.colorWrite;n.isDefined(D)&&(e.colorWrite=D);const P=t.precision;n.isDefined(P)&&(e.precision=P);const F=t.polygonOffset;n.isDefined(F)&&(e.polygonOffset=F);const A=t.polygonOffsetFactor;n.isDefined(A)&&(e.polygonOffsetFactor=A);const B=t.polygonOffsetUnits;n.isDefined(B)&&(e.polygonOffsetUnits=B);const T=t.dithering;n.isDefined(T)&&(e.dithering=T);const O=t.alphaTest;n.isDefined(O)&&(e.alphaTest=O);const C=t.premultipliedAlpha;n.isDefined(C)&&(e.premultipliedAlpha=C);const z=t.overdraw;n.isDefined(z)&&(e.overdraw=z);const k=t.visible;n.isDefined(k)&&(e.visible=k);const I=t.userData;n.isDefined(I)&&(e.userData=I);const R=t.needsUpdate;n.isDefined(R)&&(e.needsUpdate=R)}_setVector2(e){const t=e.x,i=e.y;if(n.isNotDefined(t)||n.isNotDefined(i))throw new Error("MaterialsManager: Unable to convert null or undefined vector 2 !");return new r.Vector2(t,i)}_setColor(e){const t=e.r,i=e.g,s=e.b;if(n.isNotDefined(t)||n.isNotDefined(i)||n.isNotDefined(s))throw new Error("MaterialsManager: Unable to convert null or undefined color !");return new r.Color(t,i,s)}fillTextures(e,t){const i=this._retrieveTexturesOf(e);for(let t in e){const r=e[t],s=i[t];for(let e in s)r[e]=s[e]}t(e)}_retrieveTexturesOf(e){const t=["map","lightMap","aoMap","emissiveMap","bumpMap","normalMap","displacementMap","specularMap","alphaMap","envMap"],i={},s={};for(let a in e){const o=e[a];let h={};for(let e=0,i=t.length;e<i;e++){let i=t[e];const a=o[i];if(n.isDefined(a)&&n.isString(a)&&n.isNotEmptyString(a)){const e=`${this._texturesPath}/${a}`,t=s[e];if(n.isDefined(t))h[i]=t;else{const t=this._texturesProvider.load(e,()=>{},()=>{},()=>{t.image||(t.image=Le,t.needsUpdate=!0)});t.name=a,this._generateMipmap||(t.generateMipmaps=!1,t.magFilter=r.LinearFilter,t.minFilter=r.LinearFilter),s[e]=t,h[i]=t}}}i[a]=h}return i}}
/**
	 * @module Managers/ObjectsManager
	 *
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 *
	 */class Ge extends s.TDataBaseManager{constructor(e={}){const t={basePath:"/objects",geometriesProviderOptions:{},materialsProviderOptions:{},projectionSystem:"zBack",globalScale:1,autoFillObjects3D:!0,...e};super(t),this.projectionSystem=t.projectionSystem,this.globalScale=t.globalScale,this.autoFillObjects3D=t.autoFillObjects3D,this.geometriesProvider=new Ie(t.geometriesProviderOptions),this.materialsProvider=new Ue(t.materialsProviderOptions)}get geometriesProvider(){return this._geometriesProvider}set geometriesProvider(e){if(n.isNull(e))throw new TypeError("Geometries provider cannot be null ! Expect an instance of GeometriesManager.");if(n.isUndefined(e))throw new TypeError("Geometries provider cannot be undefined ! Expect an instance of GeometriesManager.");if(!(e instanceof Ie))throw new TypeError(`Geometries provider cannot be an instance of ${e.constructor.name} ! Expect an instance of TGeometriesManager.`);this._geometriesProvider=e}get materialsProvider(){return this._materialsProvider}set materialsProvider(e){if(n.isNull(e))throw new TypeError("Materials provider cannot be null ! Expect an instance of MaterialsManager.");if(n.isUndefined(e))throw new TypeError("Materials provider cannot be undefined ! Expect an instance of MaterialsManager.");if(!(e instanceof Ue))throw new TypeError(`Materials provider cannot be an instance of ${e.constructor.name} ! Expect an instance of TMaterialsManager.`);this._materialsProvider=e}get projectionSystem(){return this._projectionSystem}set projectionSystem(e){if(n.isNull(e))throw new TypeError("Projection system cannot be null ! Expect a positive number.");if(n.isUndefined(e))throw new TypeError("Projection system cannot be undefined ! Expect a positive number.");this._projectionSystem=e}get globalScale(){return this._globalScale}set globalScale(e){if(n.isNull(e))throw new TypeError("Global scale cannot be null ! Expect a positive number.");if(n.isUndefined(e))throw new TypeError("Global scale cannot be undefined ! Expect a positive number.");this._globalScale=e}get autoFillObjects3D(){return this._autoFillObjects3D}set autoFillObjects3D(e){if(n.isNull(e))throw new TypeError("Global scale cannot be null ! Expect a boolean.");if(n.isUndefined(e))throw new TypeError("Global scale cannot be undefined ! Expect a positive number.");if(n.isNotBoolean(e))throw new TypeError("Global scale cannot be null ! Expect a boolean.");this._autoFillObjects3D=e}setGeometriesProvider(e){return this.geometriesProvider=e,this}setMaterialsProvider(e){return this.materialsProvider=e,this}setProjectionSystem(e){return this.projectionSystem=e,this}setGlobalScale(e){return this.globalScale=e,this}setAutoFillObjects3D(e){return this.autoFillObjects3D=e,this}_onJson(e,t,i,r){const s={};for(let t,n=0,a=e.length;n<a;n++){t=e[n];try{s[t._id]=this.convert(t)}catch(e){r(e)}i(new ProgressEvent("ObjectsManager",{lengthComputable:!0,loaded:n+1,total:a}))}this._autoFillObjects3D?this.fillObjects3D(s,t,i,r):t(s)}_onArrayBuffer(e,t,i,r){}_onBlob(e,t,i,r){}_onText(e,t,i,r){}convert(e){if(!e)throw new Error("ObjectsManager: Unable to convert null or undefined data !");const t=e.type;let i=null;switch(t){case"Object3D":i=new r.Object3D,this._fillBaseObjectsData(i,e);break;case"Scene":i=new r.Scene,this._fillBaseObjectsData(i,e),n.isDefined(e.background)&&Number.isInteger(e.background)&&(i.background=new r.Color(e.background)),n.isDefined(e.fog)&&("Fog"===e.fog.type?i.fog=new r.Fog(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(i.fog=new r.FogExp2(e.fog.color,e.fog.density))),i.overrideMaterial=e.overrideMaterial,i.autoUpdate=e.autoUpdate;break;case"PerspectiveCamera":i=new r.PerspectiveCamera,this._fillBaseObjectsData(i,e),i.fov=e.fov,i.aspect=e.aspect,i.near=e.near,i.far=e.far,n.isDefined(e.focus)&&(i.focus=e.focus),n.isDefined(e.zoom)&&(i.zoom=e.zoom),n.isDefined(e.filmGauge)&&(i.filmGauge=e.filmGauge),n.isDefined(e.filmOffset)&&(i.filmOffset=e.filmOffset),n.isDefined(e.view)&&(i.view=Object.assign({},e.view));break;case"OrthographicCamera":i=new r.OrthographicCamera(e.left,e.right,e.top,e.bottom,e.near,e.far),this._fillBaseObjectsData(i,e);break;case"AmbientLight":i=new r.AmbientLight(e.color,e.intensity),this._fillBaseObjectsData(i,e);break;case"DirectionalLight":i=new r.DirectionalLight(e.color,e.intensity),this._fillBaseObjectsData(i,e);break;case"PointLight":i=new r.PointLight(e.color,e.intensity,e.distance,e.decay),this._fillBaseObjectsData(i,e);break;case"RectAreaLight":i=new r.RectAreaLight(e.color,e.intensity,e.width,e.height),this._fillBaseObjectsData(i,e);break;case"SpotLight":i=new r.SpotLight(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),this._fillBaseObjectsData(i,e);break;case"HemisphereLight":i=new r.HemisphereLight(e.color,e.groundColor,e.intensity),this._fillBaseObjectsData(i,e);break;case"SkinnedMesh":i=new r.SkinnedMesh,this._fillBaseObjectsData(i,e),i.geometry=e.geometry,i.material=e.material,i.drawMode=e.drawMode,i.bindMode=e.bindMode,i.bindMatrix=e.bindMatrix,i.bindMatrixInverse=e.bindMatrixInverse;break;case"Mesh":i=new r.Mesh,this._fillBaseObjectsData(i,e),i.geometry=e.geometry,i.material=e.material,i.drawMode=e.drawMode;break;case"LOD":i=new r.LOD,this._fillBaseObjectsData(i,e),i.levels=e.levels;break;case"Line":i=new r.Line,this._fillBaseObjectsData(i,e),i.geometry=e.geometry,i.material=e.material,i.drawMode=e.drawMode;break;case"LineLoop":i=new r.LineLoop,this._fillBaseObjectsData(i,e),i.geometry=e.geometry,i.material=e.material,i.drawMode=e.drawMode;break;case"LineSegments":i=new r.LineSegments,this._fillBaseObjectsData(i,e),i.geometry=e.geometry,i.material=e.material,i.drawMode=e.drawMode;break;case"Points":i=new r.Points,this._fillBaseObjectsData(i,e),i.geometry=e.geometry,i.material=e.material,i.drawMode=e.drawMode;break;case"Sprite":i=new r.Sprite,this._fillBaseObjectsData(i,e),i.material=e.material;break;case"Group":i=new r.Group,this._fillBaseObjectsData(i,e);break;default:throw new Error(`TObjectsManager: Unknown object of type: ${t}`)}return i}_fillBaseObjectsData(e,t){e._id=t._id,n.isDefined(t.uuid)&&(e.uuid=t.uuid),n.isDefined(t.name)&&(e.name=t.name),n.isDefined(t.parent)&&(e.parent=t.parent),n.isNotEmptyArray(t.children)&&(e.children=t.children),n.isDefined(t.up)&&(e.up.x=t.up.x,e.up.y=t.up.y,e.up.z=t.up.z),n.isDefined(t.position)&&("zBack"===this._projectionSystem?(e.position.x=t.position.x/this._globalScale,e.position.y=t.position.z/this._globalScale,e.position.z=-t.position.y/this._globalScale):(e.position.x=t.position.x/this._globalScale,e.position.y=t.position.y/this._globalScale,e.position.z=t.position.z/this._globalScale)),n.isDefined(t.rotation)&&("zBack"===this._projectionSystem?(e.rotation.x=t.rotation.x,e.rotation.y=t.rotation.z,e.rotation.z=-t.rotation.y,e.rotation.order=t.rotation.order):(e.rotation.x=t.rotation.x,e.rotation.y=t.rotation.y,e.rotation.z=t.rotation.z,e.rotation.order=t.rotation.order)),n.isDefined(t.quaternion)&&("zBack"===this._projectionSystem?(e.quaternion.x=t.quaternion.x,e.quaternion.y=t.quaternion.z,e.quaternion.z=-t.quaternion.y,e.quaternion.w=t.quaternion.w):(e.quaternion.x=t.quaternion.x,e.quaternion.y=t.quaternion.y,e.quaternion.z=t.quaternion.z,e.quaternion.w=t.quaternion.w)),n.isDefined(t.scale)&&(0!==t.scale.x&&0!==t.scale.y&&0!==t.scale.z?(e.scale.x=t.scale.x,e.scale.y=t.scale.y,e.scale.z=t.scale.z):this.logger.warn("Try to assign null scale !")),n.isDefined(t.modelViewMatrix)&&n.isNotEmptyArray(t.modelViewMatrix)&&e.modelViewMatrix.fromArray(t.modelViewMatrix),n.isDefined(t.normalMatrix)&&n.isNotEmptyArray(t.normalMatrix)&&e.normalMatrix.fromArray(t.normalMatrix),n.isDefined(t.matrix)&&n.isNotEmptyArray(t.matrix)&&e.matrix.fromArray(t.matrix),n.isDefined(t.matrixWorld)&&n.isNotEmptyArray(t.matrixWorld)&&e.matrixWorld.fromArray(t.matrixWorld),n.isDefined(t.matrixAutoUpdate)&&(e.matrixAutoUpdate=t.matrixAutoUpdate),n.isDefined(t.matrixWorldNeedsUpdate)&&(e.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate),n.isDefined(t.layers)&&(e.layers.mask=t.layers),n.isDefined(t.visible)&&(e.visible=t.visible),n.isDefined(t.castShadow)&&(e.castShadow=t.castShadow),n.isDefined(t.receiveShadow)&&(e.receiveShadow=t.receiveShadow),n.isDefined(t.frustumCulled)&&(e.frustumCulled=t.frustumCulled),n.isDefined(t.renderOrder)&&(e.renderOrder=t.renderOrder),n.isDefined(t.userData)&&(e.userData=t.userData)}fillObjects3D(e,t,i,r){const s=this,n=[];for(let t in e){const i=e[t];(i.geometry||i.material)&&n.push(e[t])}if(0===n.length)return void t(e);let a,o;function h(){if(a&&o){for(let t in e){const i=e[t];s.applyGeometry(i,a),s.applyMaterials(i,o)}t(e)}}this._retrieveGeometriesOf(n,e=>{a=e,h()},i,r),this._retrieveMaterialsOf(n,e=>{o=e,h()},i,r)}_retrieveGeometriesOf(e,t,i,r){const s=e.map(e=>e.geometry).filter((e,t,i)=>e&&i.indexOf(e)===t);0!==s.length?this._geometriesProvider.read(s,null,t,i,r):t({})}_retrieveMaterialsOf(e,t,i,r){const s=e.map(e=>e.material),n=[].concat.apply([],s).filter((e,t,i)=>e&&i.indexOf(e)===t);0!==n.length?this._materialsProvider.read(n,null,t,i,r):t({})}applyGeometry(e,t){const i=e.geometry;if(!i)return;const r=t[i];r?e.geometry=r:this.logger.error("Unable to retrieve geometry !!!")}applyMaterials(e,t){const i=e.material;if(i)if(Array.isArray(i))if(1===i.length){const r=t[i[0]];if(!r)return this.logger.error("Unable to retrieve material !!!"),null;e.material=r.clone()}else{e.material=[];for(let r=0,s=i.length;r<s;r++){const s=t[i[r]];if(!s)return this.logger.error("Unable to retrieve material !!!"),null;e.material.push(s.clone())}}else if("string"==typeof i){const r=t[i];if(!r)return void this.logger.error("Unable to retrieve material !!!");e.material=r.clone()}else this.logger.error("Invalid material ids, expected string or array of string")}}
/**
	 * @module Objects3D/OrbitControlsHelper
	 *
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 *
	 */class Ne extends r.LineSegments{constructor(e={}){const t={radius:2,radials:16,circles:2,divisions:64,innerColor:new r.Color(4473924),outerColor:new r.Color(8947848),...e};super(Ne._createInternalGeometry(t.radius,t.radials,t.circles,t.divisions,t.innerColor,t.outerColor),Ne._createInternalMaterial()),this.matrixAutoUpdate=!1,this._intervalId=void 0}static _createInternalGeometry(e,t,i,s,n,a){const o=[],h=[];let l,c,d,u,p,_,g;for(u=0;u<=t;u++)d=u/t*(2*Math.PI),l=Math.sin(d)*e,c=Math.cos(d)*e,o.push(0,0,0),o.push(l,0,c),g=1&u?n:a,h.push(g.r,g.g,g.b),h.push(g.r,g.g,g.b);for(u=0;u<=i;u++){for(g=1&u?n:a,_=e-e/i*u,p=0;p<s;p++)d=p/s*(2*Math.PI),l=Math.sin(d)*_,c=Math.cos(d)*_,o.push(l,0,c),h.push(g.r,g.g,g.b),d=(p+1)/s*(2*Math.PI),l=Math.sin(d)*_,c=Math.cos(d)*_,o.push(l,0,c),h.push(g.r,g.g,g.b);o.push(-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1),h.push(0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1)}const m=new r.Float32BufferAttribute(o,3);m.name="TOrbitControlsHelperPositionBufferAttribute";const f=new r.Float32BufferAttribute(h,3);f.name="TOrbitControlsHelperColorBufferAttribute";const y=new r.BufferGeometry;return y.setAttribute("position",m),y.setAttribute("color",f),y.name="TOrbitControlsHelperGeometry",y}static _createInternalMaterial(){const e=new r.LineBasicMaterial({vertexColors:r.VertexColors});return e.transparent=!0,e.opacity=0,e.name="TOrbitControlsHelperMaterial",e}startOpacityAnimation(){void 0!==this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this.material.opacity=1}endOpacityAnimation(){this._intervalId=setInterval(function(){this.material.opacity<=0?(this.material.opacity=0,clearInterval(this._intervalId),this._intervalId=void 0):this.material.opacity-=.1}.bind(this),100)}}
/**
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 */class He extends me{constructor(e={}){super({geometry:new r.TorusBufferGeometry(1,.12,4,12,Math.PI),...e}),this.isTorusHitbox=!0,this.type="TorusHitbox"}}
/**
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 */
/**
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 */
class Ve extends me{constructor(e={}){super({geometry:new r.BoxBufferGeometry(1,1,1,1,1,1),...e}),this.isBoxHitbox=!0,this.type="BoxHitbox"}}
/**
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 */class je extends ye{constructor(e={}){const t={boxColor:1067907,edgesColor:1193046,hitbox:new Ve({geometry:new r.BoxBufferGeometry(1.1,1.1,1.1,1,1,1)}),...e};super(t),this.isOmnidirectionalHandle=!0,this.type="OmnidirectionalHandle";const i=new r.BoxBufferGeometry(1,1,1,1,1,1);i.name="BoxHandle_Box_Geometry";const s=new ge({color:t.boxColor,transparent:!1,opacity:1});s.name="BoxHandle_Box_Material";const n=new r.Mesh(i,s);n.name="BoxHandle_Box",n.matrixAutoUpdate=!1,this.add(n);const a=new r.EdgesGeometry(i);a.name="BoxHandle_Edges_Geometry";const o=new _e({color:t.edgesColor,linewidth:4,transparent:!1,opacity:1});o.name="BoxHandle_Edges_Material";const h=new r.LineSegments(a,o);h.name="BoxHandle_Edges",h.matrixAutoUpdate=!1,this.add(h)}update(e){super.update(e),this.updateMatrix(),this.hitbox.updateMatrix()}}
/**
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 */class Ye extends ye{constructor(e={}){const t={coneColor:1067907,edgesColor:1193046,hitbox:new Ve({geometry:new r.ConeBufferGeometry(1.1,1.1)}),...e};super(t),this.isOmnidirectionalHandle=!0,this.type="OmnidirectionalHandle";const i=new r.ConeBufferGeometry(1,1);i.name="ConeHandle_Cone_Geometry";const s=new ge({color:t.coneColor,transparent:!1,opacity:1});s.name="ConeHandle_Cone_Material";const n=new r.Mesh(i,s);n.name="ConeHandle_Cone",n.matrixAutoUpdate=!0,this.add(n)}update(e){super.update(e),this.updateMatrix(),this.hitbox.updateMatrix()}}
/**
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 */
/**
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 */
class We extends r.Mesh{constructor(e,t={}){super(e,new ge({color:t.color,transparent:!0,opacity:.55})),this.isHighlightableMesh=!0,this.type="HighlightableMesh"}highlight(e){this.material.highlight(e)}}return e.ASCLoader=
/**
	 * @module Loader/ASCLoader
	 * @desc A loader for ASC cloud point files.
	 *
	 * @requires {@link https://github.com/Itee/@itee/client @itee/client}
	 * @requires {@link https://github.com/Itee/three-full three-full}
	 *
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 * @example
	 *
	 * import { ASCLoader } from '@itee/plugin-three'
	 *
	 * const loader = new ASCLoader();
	 *
	 * // If the ASC file need to be offseted, it can be set before loading file.
	 * loader.setOffset( {
	 *      x: 1.0,
	 *      y: 52.0,
	 *      z: -5.0
	 * } );
	 *
	 * // Then load the file and get the threejs Point Geometry
	 * loader.load('/path/to/file.asc', function (geometry) {
	 *
	 *      scene.add( new Mesh( geometry ) );
	 *
	 * } );
	 *
	 */
class{constructor(e=r.DefaultLoadingManager,t=i.DefaultLogger){this.manager=e,this.logger=t,this._boundingBox=new r.Box3,this._points=[],this._numberOfPoints=0,this._coloredPoints=!1,this._autoOffset=!1,this._offset={x:0,y:0,z:0},this._positions=null,this._bufferIndex=0,this._positionsC=null,this._bufferIndexC=0,this.wrongPoints=0}load(e,t,i,s,n){const a=new r.FileLoader(this.manager);a.setResponseType("blob"),a.load(e,function(e){const a=new r.Group;this._parse(e,a,t,i,s,n),t(a)}.bind(this),i,s)}setOffset(e){this._offset=e,this._autoOffset=!1}_parse(e,t,i,r,s,n){const a=this,o=n||100,h=new FileReader,l=134217728;let c=0;function d(){if(c>=e.size)return;const t=e.slice(c,c+l,"text/plain");h.readAsText(t)}h.onabort=e=>{this.logger.log("abortEvent:"),this.logger.log(e)},h.onerror=e=>{this.logger.log("errorEvent:"),this.logger.log(e),s&&s(e)},h.onloadstart=e=>{this.logger.log("loadStartEvent:"),this.logger.log(e)},h.onprogress=e=>{this.logger.log("progressEvent:"),this.logger.log(e),r&&r(e)},h.onload=e=>{this.logger.log("loadEvent:"),this.logger.log(e);const t=e.target.result.split("\n"),i=t.length;c-=t[i-1].length;const r=Math.round(100/o);for(let e=0;e<i-1;e++)e%r===0&&a._parseLine(t[e])},h.onloadend=i=>{this.logger.log("loadEndEvent"),this.logger.log(i),(this._points.length>1e6||c+l>=e.size)&&(this._offsetPoints(),this._createSubCloudPoint(t)),c+=l,d()},d()}_parseLine(e){const t=e.split(/\s/g).filter(Boolean),i=t.length;3===i?this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2])}):4===i?(this._pointsHaveIntensity=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3])})):6===i?(this._pointsHaveColor=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),r:parseFloat(t[3]),g:parseFloat(t[4]),b:parseFloat(t[5])})):7===i?(this._pointsHaveIntensity=!0,this._pointsHaveColor=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),r:parseFloat(t[4]),g:parseFloat(t[5]),b:parseFloat(t[6])})):9===i?(this._pointsHaveColor=!0,this._pointsHaveNormals=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),r:parseFloat(t[3]),g:parseFloat(t[4]),b:parseFloat(t[5]),nx:parseFloat(t[6]),ny:parseFloat(t[7]),nz:parseFloat(t[8])})):10===i?(this._pointsHaveIntensity=!0,this._pointsHaveColor=!0,this._pointsHaveNormals=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),r:parseFloat(t[4]),g:parseFloat(t[5]),b:parseFloat(t[6]),nx:parseFloat(t[7]),ny:parseFloat(t[8]),nz:parseFloat(t[9])})):this.logger.error(`Invalid data line: ${e}`)}_parseLines(e){const t=e[0].split(/\s/g).filter(Boolean).length;3===t?this._parseLinesAsXYZ(e):4===t?this._parseLinesAsXYZI(e):6===t?this._parseLinesAsXYZRGB(e):7===t?this._parseLinesAsXYZIRGB(e):9===t?this._parseLinesAsXYZRGBnXnYnZ(e):10===t?this._parseLinesAsXYZIRGBnXnYnZ(e):this.logger.error(`Invalid data line: ${e}`)}_parseLinesAsXYZ(e){let t=[];for(let i=0,r=e.length;i<r;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2])})}_parseLinesAsXYZI(e){this._pointsHaveIntensity=!0;let t=[];for(let i=0,r=e.length;i<r;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3])})}_parseLinesAsXYZRGB(e){this._pointsHaveColor=!0;let t=[];for(let i=0,r=e.length;i<r;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),r:parseFloat(t[3]),g:parseFloat(t[4]),b:parseFloat(t[5])})}_parseLinesAsXYZnXnYnZ(e){let t=[];for(let i=0,r=e.length;i<r;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),nx:parseFloat(t[7]),ny:parseFloat(t[8]),nz:parseFloat(t[9])})}_parseLinesAsXYZIRGB(e){this._pointsHaveIntensity=!0,this._pointsHaveColor=!0;let t=[];for(let i=0,r=e.length;i<r;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),r:parseFloat(t[4]),g:parseFloat(t[5]),b:parseFloat(t[6])})}_parseLinesAsXYZInXnYnZ(e){let t=[];for(let i=0,r=e.length;i<r;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),nx:parseFloat(t[7]),ny:parseFloat(t[8]),nz:parseFloat(t[9])})}_parseLinesAsXYZRGBnXnYnZ(e){this._pointsHaveColor=!0,this._pointsHaveNormals=!0;let t=[];for(let i=0,r=e.length;i<r;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),r:parseFloat(t[3]),g:parseFloat(t[4]),b:parseFloat(t[5]),nx:parseFloat(t[6]),ny:parseFloat(t[7]),nz:parseFloat(t[8])})}_parseLinesAsXYZIRGBnXnYnZ(e){this._pointsHaveIntensity=!0,this._pointsHaveColor=!0,this._pointsHaveNormals=!0;let t=[];for(let i=0,r=e.length;i<r;i++)t=e[i].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),r:parseFloat(t[4]),g:parseFloat(t[5]),b:parseFloat(t[6]),nx:parseFloat(t[7]),ny:parseFloat(t[8]),nz:parseFloat(t[9])})}_parseLineB(e){const t=e.split(/\s/g).filter(Boolean),i=t.length,r=this._bufferIndex;3===i&&(this._positions[r]=parseFloat(t[0]),this._positions[r+1]=parseFloat(t[1]),this._positions[r+2]=parseFloat(t[2]),this._bufferIndex+=3)}_parseLineC(e){const t=e.split(/\s/g).filter(Boolean),i=t.length,r=this._bufferIndexC;3===i&&(this._positionsC[r]=Number.parseFloat(t[0]),this._positionsC[r+1]=Number.parseFloat(t[1]),this._positionsC[r+2]=Number.parseFloat(t[2]),this._bufferIndexC+=3)}_offsetPoints(){this._autoOffset&&(this._boundingBox.setFromPoints(this._points),this.setOffset(this._boundingBox.getCenter()));const e=this._offset.x,t=this._offset.y,i=this._offset.z;let r=null;for(let s=0,n=this._points.length;s<n;++s)r=this._points[s],r.x-=e,r.y-=t,r.z-=i}_createCloudPoint(e){const t=1e6,i=this._points.length,s=Math.ceil(i/t);let n=null,a=0,o=null;for(let i=0;i<s;++i){n=this._points.splice(0,t),a=n.length;const i=new r.BufferGeometry,s=new Float32Array(3*a),h=new Float32Array(3*a);let l=0,c=null;for(let e=0;e<a;++e)c=n[e],s[l]=c.x,s[l+1]=c.y,s[l+2]=c.z,this._pointsHaveColor?(h[l]=c.r/255,h[l+1]=c.g/255,h[l+2]=c.b/255):(h[l]=.1,h[l+1]=.2,h[l+2]=.5),l+=3;i.setAttribute("position",new r.BufferAttribute(s,3)),i.setAttribute("color",new r.BufferAttribute(h,3));const d=new r.PointsMaterial({size:.01,vertexColors:!0});o=new r.Points(i,d),e.children.push(o)}}_createSubCloudPoint(e){const t=this._points.length,i=new r.BufferGeometry,s=new Float32Array(3*t),n=new Float32Array(3*t);let a=0,o=null;for(let e=0;e<t;++e)o=this._points[e],s[a]=o.x,s[a+1]=o.y,s[a+2]=o.z,this._pointsHaveColor?(n[a]=o.r/255,n[a+1]=o.g/255,n[a+2]=o.b/255):(n[a]=.1,n[a+1]=.2,n[a+2]=.5),a+=3;i.setAttribute("position",new r.BufferAttribute(s,3)),i.setAttribute("color",new r.BufferAttribute(n,3));const h=new r.PointsMaterial({size:.005,vertexColors:!0}),l=new r.Points(i,h);l.rotation.x-=Math.PI/2,e.children.push(l),this._points=[]}},e.AbstractGizmo=Se,e.AbstractHandle=ye,e.AbstractHitbox=me,e.BitArray=re,e.BitManager=se,e.CameraControlMode=ue,e.CameraControls=pe,e.ClippingBox=Te,e.ClippingControls=Ce,e.ClippingModes=Oe,e.ColorPalette=class{constructor(e){e.default?this.default.set(e.default):this.default.set(S.Fuchsia),e.intersected?this.intersected.set(e.intersected):this.default.set(S.PeachPuff),e.selected?this.selected.set(e.selected):this.default.set(S.DarkOrange),e.active?this.active.set(e.active):this.default.set(S.YellowGreen),e.inactive?this.inactive.set(e.inactive):this.default.set(S.LightCyan),e.enabled?this.enabled.set(e.enabled):this.default.set(S.Lavender),e.disabled?this.disabled.set(e.disabled):this.default.set(S.Grey)}},e.Colors=S,e.CurvesManager=ze,e.CylindricaHitbox=Me,e.DBFLoader=Q,e.Directions=K,e.GeometriesManager=Ie,e.HighlightableMesh=We,e.LASLoader=class{constructor(e=r.DefaultLoadingManager,t=i.DefaultLogger){this.manager=e,this.logger=t,this._reader=new s.TBinaryReader,this._fullVersion="",this._boundingBox=new r.Box3,this._points=[],this._numberOfPoints=0,this._coloredPoints=!1,this._autoOffset=!1,this._offset={x:0,y:0,z:0},this.colorForPointClass={Created:{r:255,g:255,b:255},Unclassified:{r:60,g:60,b:60},Ground:{r:125,g:95,b:5},LowVegetation:{r:153,g:212,b:36},MediumVegetation:{r:52,g:148,b:25},HighVegetation:{r:27,g:77,b:13},Building:{r:153,g:138,b:95},LowPoint:{r:200,g:200,b:200},ModelKeyPoint:{r:237,g:31,b:31},Water:{r:31,g:186,b:237},OverlapPoints:{r:0,g:0,b:0}}}load(e,t,i,s,n){const a=new r.FileLoader(this.manager);a.setResponseType("arraybuffer"),a.load(e,e=>{this.parse(e,t,i,s,n)},i,s)}setOffset(e){this._offset=e,this._autoOffset=!1}parse(e,t,i,r){try{this._reader.buffer=e;if("LASF"!==this._reader.getString(4,!1))throw new Error("Invalid las file signature. Abort parsing !");this._reader.skipOffsetOf(24);const s=this._reader.getUint8(),n=this._reader.getUint8();this._reader.skipOffsetTo(0);const a=`${s}.${n}`,o=this._parseHeader(a),h=this._parseVariableLengthRecords(o),l=this._parsePointDataRecords(o,i);this.convert({Header:o,VariableLengthRecords:h,PointDataRecords:l},t,i,r)}catch(e){r(e)}}_parseHeader(e){switch(e){case"1.0":return this._parseHeader_1_0();case"1.1":return this._parseHeader_1_1();case"1.2":return this._parseHeader_1_2();case"1.3":return this._parseHeader_1_3();case"1.4":return this._parseHeader_1_4();default:throw new Error(`Insupported LAS file version: ${e}. Abort parsing !`)}}_parseHeader_1_0(){return{FileSignature:this._reader.getString(4),Reserved:this._reader.skipOffsetOf(s.Byte.Four),GUID_1:this._reader.getUint32(),GUID_2:this._reader.getUint16(),GUID_3:this._reader.getUint16(),GUID_4:this._reader.getUint8Array(8),VersionMajor:this._reader.getUint8(),VersionMinor:this._reader.getUint8(),SystemIdentifier:this._reader.getString(32).replace(J,""),GeneratingSoftware:this._reader.getString(32).replace(J,""),FlightDateJulian:this._reader.getUint16(),Year:this._reader.getUint16(),HeaderSize:this._reader.getUint16(),OffsetToPointData:this._reader.getUint32(),NumberOfVariableLengthRecords:this._reader.getUint32(),PointDataFormatID:this._reader.getUint8(),PointDataRecordLength:this._reader.getUint16(),NumberOfPointRecords:this._reader.getUint32(),NumberOfPointsByReturn:this._reader.getUint32Array(5),XScaleFactor:this._reader.getFloat64(),YScaleFactor:this._reader.getFloat64(),ZScaleFactor:this._reader.getFloat64(),XOffset:this._reader.getFloat64(),YOffset:this._reader.getFloat64(),ZOffset:this._reader.getFloat64(),MaxX:this._reader.getFloat64(),MinX:this._reader.getFloat64(),MaxY:this._reader.getFloat64(),MinY:this._reader.getFloat64(),MaxZ:this._reader.getFloat64(),MinZ:this._reader.getFloat64()}}_parseHeader_1_1(){return{FileSignature:this._reader.getString(4),FileSourceId:this._reader.getUint16(),Reserved:this._reader.skipOffsetOf(s.Byte.Two)&&null,GUID_1:this._reader.getUint32(),GUID_2:this._reader.getUint16(),GUID_3:this._reader.getUint16(),GUID_4:this._reader.getUint8Array(8),VersionMajor:this._reader.getUint8(),VersionMinor:this._reader.getUint8(),SystemIdentifier:this._reader.getString(32).replace(J,""),GeneratingSoftware:this._reader.getString(32).replace(J,""),FileCreationDayOfYear:this._reader.getUint16(),FileCreationYear:this._reader.getUint16(),HeaderSize:this._reader.getUint16(),OffsetToPointData:this._reader.getUint32(),NumberOfVariableLengthRecords:this._reader.getUint32(),PointDataFormatID:this._reader.getUint8(),PointDataRecordLength:this._reader.getUint16(),NumberOfPointRecords:this._reader.getUint32(),NumberOfPointsByReturn:this._reader.getUint32Array(5),XScaleFactor:this._reader.getFloat64(),YScaleFactor:this._reader.getFloat64(),ZScaleFactor:this._reader.getFloat64(),XOffset:this._reader.getFloat64(),YOffset:this._reader.getFloat64(),ZOffset:this._reader.getFloat64(),MaxX:this._reader.getFloat64(),MinX:this._reader.getFloat64(),MaxY:this._reader.getFloat64(),MinY:this._reader.getFloat64(),MaxZ:this._reader.getFloat64(),MinZ:this._reader.getFloat64()}}_parseHeader_1_2(){return{FileSignature:this._reader.getString(4),FileSourceId:this._reader.getUint16(),GlobalEncoding:{GPSTimeType:this._reader.getBit16()?"AdjustedStandardGPSTime":"GPSWeekTime",Reserved:this._reader.skipBitOffsetOf(15)},GUID_1:this._reader.getUint32(),GUID_2:this._reader.getUint16(),GUID_3:this._reader.getUint16(),GUID_4:this._reader.getUint8Array(8),VersionMajor:this._reader.getUint8(),VersionMinor:this._reader.getUint8(),SystemIdentifier:this._reader.getString(32).replace(J,""),GeneratingSoftware:this._reader.getString(32).replace(J,""),FileCreationDayOfYear:this._reader.getUint16(),FileCreationYear:this._reader.getUint16(),HeaderSize:this._reader.getUint16(),OffsetToPointData:this._reader.getUint32(),NumberOfVariableLengthRecords:this._reader.getUint32(),PointDataFormatID:this._reader.getUint8(),PointDataRecordLength:this._reader.getUint16(),NumberOfPointRecords:this._reader.getUint32(),NumberOfPointsByReturn:this._reader.getUint32Array(5),XScaleFactor:this._reader.getFloat64(),YScaleFactor:this._reader.getFloat64(),ZScaleFactor:this._reader.getFloat64(),XOffset:this._reader.getFloat64(),YOffset:this._reader.getFloat64(),ZOffset:this._reader.getFloat64(),MaxX:this._reader.getFloat64(),MinX:this._reader.getFloat64(),MaxY:this._reader.getFloat64(),MinY:this._reader.getFloat64(),MaxZ:this._reader.getFloat64(),MinZ:this._reader.getFloat64()}}_parseHeader_1_3(){return{FileSignature:this._reader.getString(4),FileSourceId:this._reader.getUint16(),GlobalEncoding:{GPSTimeType:this._reader.getBit16()?"AdjustedStandardGPSTime":"GPSWeekTime",WaveformDataPacketsInternal:this._reader.getBit16(),WaveformDataPacketsExternal:this._reader.getBit16(),ReturnNumbersHaveBeenSyntheticallyGenerated:this._reader.getBit16(),Reserved:this._reader.skipBitOffsetOf(12)},GUID_1:this._reader.getUint32(),GUID_2:this._reader.getUint16(),GUID_3:this._reader.getUint16(),GUID_4:this._reader.getUint8Array(8),VersionMajor:this._reader.getUint8(),VersionMinor:this._reader.getUint8(),SystemIdentifier:this._reader.getString(32).replace(J,""),GeneratingSoftware:this._reader.getString(32).replace(J,""),FileCreationDayOfYear:this._reader.getUint16(),FileCreationYear:this._reader.getUint16(),HeaderSize:this._reader.getUint16(),OffsetToPointData:this._reader.getUint32(),NumberOfVariableLengthRecords:this._reader.getUint32(),PointDataFormatID:this._reader.getUint8(),PointDataRecordLength:this._reader.getUint16(),NumberOfPointRecords:this._reader.getUint32(),NumberOfPointsByReturn:this._reader.getUint32Array(5),XScaleFactor:this._reader.getFloat64(),YScaleFactor:this._reader.getFloat64(),ZScaleFactor:this._reader.getFloat64(),XOffset:this._reader.getFloat64(),YOffset:this._reader.getFloat64(),ZOffset:this._reader.getFloat64(),MaxX:this._reader.getFloat64(),MinX:this._reader.getFloat64(),MaxY:this._reader.getFloat64(),MinY:this._reader.getFloat64(),MaxZ:this._reader.getFloat64(),MinZ:this._reader.getFloat64(),StartOfWaveformDataPacketRecord:this._reader.getUint64()}}_parseHeader_1_4(){return{FileSignature:this._reader.getString(4),FileSourceId:this._reader.getUint16(),GlobalEncoding:{GPSTimeType:this._reader.getBit16()?"AdjustedStandardGPSTime":"GPSWeekTime",WaveformDataPacketsInternal:this._reader.getBit16(),WaveformDataPacketsExternal:this._reader.getBit16(),ReturnNumbersHaveBeenSyntheticallyGenerated:this._reader.getBit16(),WKT:this._reader.getBit16()?"WKT":"GeoTIFF",Reserved:this._reader.skipBitOffsetOf(11)},GUID_1:this._reader.getUint32(),GUID_2:this._reader.getUint16(),GUID_3:this._reader.getUint16(),GUID_4:this._reader.getUint8Array(8),VersionMajor:this._reader.getUint8(),VersionMinor:this._reader.getUint8(),SystemIdentifier:this._reader.getString(32).replace(J,""),GeneratingSoftware:this._reader.getString(32).replace(J,""),FileCreationDayOfYear:this._reader.getUint16(),FileCreationYear:this._reader.getUint16(),HeaderSize:this._reader.getUint16(),OffsetToPointData:this._reader.getUint32(),NumberOfVariableLengthRecords:this._reader.getUint32(),PointDataRecordFormat:this._reader.getUint8(),PointDataRecordLength:this._reader.getUint16(),LegacyNumberOfPointRecords:this._reader.getUint32(),LegacyNumberOfPointsByReturn:this._reader.getUint32Array(5),XScaleFactor:this._reader.getFloat64(),YScaleFactor:this._reader.getFloat64(),ZScaleFactor:this._reader.getFloat64(),XOffset:this._reader.getFloat64(),YOffset:this._reader.getFloat64(),ZOffset:this._reader.getFloat64(),MaxX:this._reader.getFloat64(),MinX:this._reader.getFloat64(),MaxY:this._reader.getFloat64(),MinY:this._reader.getFloat64(),MaxZ:this._reader.getFloat64(),MinZ:this._reader.getFloat64(),StartOfWaveformDataPacketRecord:this._reader.getUint64(),StartOfFirstExtendedVariableLengthRecord:this._reader.getUint64(),NumberOfExtendedVariableLengthRecords:this._reader.getUint32(),NumberOfPointRecords:this._reader.getUint64(),NumberOfPointsByReturn:this._reader.getUint64Array(15)}}_parseVariableLengthRecords(e){const t=`${e.VersionMajor}.${e.VersionMinor}`,i=[];for(let r=0;r<e.NumberOfVariableLengthRecords;r++){const e=this._parseVariableLengthRecordHeader();
//!\ Legacy => RecordSignature = Reserved since las v1.1
if("1.0"===t&&43707!==e.Reserved)throw new Error("Invalid variable length record header signature... Abort parsing !");const r=e.UserID,s=e.RecordID,n=e.RecordLengthAfterHeader,a=this._parseVariableLengthRecordContent(r,s,n);i.push({Header:e,Content:a})}return i}_parseVariableLengthRecordHeader(){return{Reserved:this._reader.getUint16(),UserID:this._reader.getString(16).replace(J,""),RecordID:this._reader.getUint16(),RecordLengthAfterHeader:this._reader.getUint16(),Description:this._reader.getString(32).replace(J,"")}}_parseVariableLengthRecordContent(e,t,i){switch(e){case"LASF_Projection":return this._parseProjectionRecord(t,i);case"LASF_Spec":return this._parseSpecRecord();default:return this._parseCustomRecord(i)}}_parseProjectionRecord(e,t){switch(e){case 2111:return this._parseOGCMathTransformWKT();case 2112:return this._parseOGCCoordinateTransformWKT();case 34735:return this._parseGeoKeyDirectoryTag();case 34736:return this._parseGeoDoubleParamsTag(t);case 34737:return this._parseGeoASCIIParamsTag(t);default:console.error("Unable to determine LASF_Projection underlying type ! Skip current record."),this._reader.skipOffsetOf(t)}}_parseOGCMathTransformWKT(){}_parseOGCCoordinateTransformWKT(){}_parseGeoKeyDirectoryTag(){const e={wKeyDirectoryVersion:this._reader.getUint16(),wKeyRevision:this._reader.getUint16(),wMinorRevision:this._reader.getUint16(),wNumberOfKeys:this._reader.getUint16(),sKeyEntry:[]};for(let t=0;t<e.wNumberOfKeys;t++)e.sKeyEntry.push({wKeyID:this._reader.getUint16(),wTIFFTagLocation:this._reader.getUint16(),wCount:this._reader.getUint16(),wValue_Offset:this._reader.getUint16()});return e}_parseGeoDoubleParamsTag(e){const t=e/s.Byte.Height,i=[];for(let e=0;e<t;e++)i[e]=this._reader.getFloat64();return i}_parseGeoASCIIParamsTag(e){return this._reader.getString(e).replace(J,"")}_parseSpecRecord(e){if(!(e<100)){if(e>=100&&e<355)return this._parseWaveformPacketDesciptor();if(65535===e)return this._parseWaveformDataPacket();throw new RangeError(`Invalid spec record id: ${e}`)}switch(e){case 0:return this._parseClassificationLookupRecord();case 1:return this._parseHeaderLookupForFlightLinesRecord();case 2:return this._parseHistogramRecord();case 3:return this._parseTextAreaDescriptionRecord();case 4:return this._parseExtraBytesRecord();case 7:return this._parseSupersededRecord();default:throw new RangeError(`Invalid spec record id: ${e}`)}}_parseClassificationLookupRecord(){const e=[];for(let t=0;t<256;t++)e.push({ClassNumber:this._reader.getUint8(),Description:this._reader.getString(15).replace(J,"")});return e}_parseHeaderLookupForFlightLinesRecord(){return{FileMarkerNumber:this._reader.getUint8(),Filename:this._reader.getString(256).replace(J,"")}}_parseHistogramRecord(){}_parseTextAreaDescriptionRecord(){}_parseExtraBytesRecord(){}_parseSupersededRecord(){}_parseWaveformPacketDesciptor(){}_parseWaveformDataPacket(){}_parseCustomRecord(e){const t=new Uint8Array(e);for(let i=0;i<e;i++)t[i]=this._reader.getUint8();return t}_parsePointDataRecords(e,t){const i=e.OffsetToPointData;this._reader.offset!==i&&(console.error("The current reader offset does not match the header offset to point data ! Defaulting to header value."),this._reader.skipOffsetTo(i));const r=e.VersionMinor<4?e.PointDataFormatID:e.PointDataRecordFormat,s=this._getPointDataRecordFormat(r),n=e.VersionMinor<4?e.NumberOfPointRecords:e.LegacyNumberOfPointRecords,a=new Array(n);for(let e=0;e<n;e++)a[e]=s(),e%1e5==0&&t(new ProgressEvent("ParsePointDataRecords",{lengthComputable:!0,loaded:e,total:n}));return a}_getPointDataRecordFormat(e){switch(e){case 0:return this._parsePointDataRecordFormat_0.bind(this);case 1:return this._parsePointDataRecordFormat_1.bind(this);case 2:return this._parsePointDataRecordFormat_2.bind(this);case 3:return this._parsePointDataRecordFormat_3.bind(this);case 4:return this._parsePointDataRecordFormat_4.bind(this);case 5:return this._parsePointDataRecordFormat_5.bind(this);case 6:return this._parsePointDataRecordFormat_6.bind(this);case 7:return this._parsePointDataRecordFormat_7.bind(this);case 8:return this._parsePointDataRecordFormat_8.bind(this);case 9:return this._parsePointDataRecordFormat_9.bind(this);case 10:return this._parsePointDataRecordFormat_10.bind(this);default:throw new RangeError(`Invalid PointDataRecordFormat parameter: ${e}`)}}_parsePointDataRecordFormat_0(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits8(3),NumberOfReturns:this._reader.getBits8(3),ScanDirectionFlag:this._reader.getBit8(),EdgeOfFlightLine:this._reader.getBit8(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},ScanAngleRank:this._reader.getInt8(),UserData:this._reader.getUint8(),PointSourceId:this._reader.getUint16()}}_parsePointDataRecordFormat_1(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits8(3),NumberOfReturns:this._reader.getBits8(3),ScanDirectionFlag:this._reader.getBit8(),EdgeOfFlightLine:this._reader.getBit8(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},ScanAngleRank:this._reader.getInt8(),UserData:this._reader.getUint8(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64()}}_parsePointDataRecordFormat_2(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits8(3),NumberOfReturns:this._reader.getBits8(3),ScanDirectionFlag:this._reader.getBit8(),EdgeOfFlightLine:this._reader.getBit8(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},ScanAngleRank:this._reader.getInt8(),UserData:this._reader.getUint8(),PointSourceId:this._reader.getUint16(),R:this._reader.getUint16(),G:this._reader.getUint16(),B:this._reader.getUint16()}}_parsePointDataRecordFormat_3(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits8(3),NumberOfReturns:this._reader.getBits8(3),ScanDirectionFlag:this._reader.getBit8(),EdgeOfFlightLine:this._reader.getBit8(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},ScanAngleRank:this._reader.getInt8(),UserData:this._reader.getUint8(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),R:this._reader.getUint16(),G:this._reader.getUint16(),B:this._reader.getUint16()}}_parsePointDataRecordFormat_4(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits8(3),NumberOfReturns:this._reader.getBits8(3),ScanDirectionFlag:this._reader.getBit8(),EdgeOfFlightLine:this._reader.getBit8(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},ScanAngleRank:this._reader.getInt8(),UserData:this._reader.getUint8(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),WavePacketDescriptorIndex:this._reader.getUint8(),ByteOffsetToWaveformData:this._reader.getUint64(),WaveformPacketSizeInBytes:this._reader.getUint32(),ReturnPointWaveformLocation:this._reader.getFloat32(),Xt:this._reader.getFloat32(),Yt:this._reader.getFloat32(),Zt:this._reader.getFloat32()}}_parsePointDataRecordFormat_5(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits8(3),NumberOfReturns:this._reader.getBits8(3),ScanDirectionFlag:this._reader.getBit8(),EdgeOfFlightLine:this._reader.getBit8(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},ScanAngleRank:this._reader.getInt8(),UserData:this._reader.getUint8(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),R:this._reader.getUint16(),G:this._reader.getUint16(),B:this._reader.getUint16(),WavePacketDescriptorIndex:this._reader.getUint8(),ByteOffsetToWaveformData:this._reader.getUint64(),WaveformPacketSizeInBytes:this._reader.getUint32(),ReturnPointWaveformLocation:this._reader.getFloat32(),Xt:this._reader.getFloat32(),Yt:this._reader.getFloat32(),Zt:this._reader.getFloat32()}}_parsePointDataRecordFormat_6(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits16(4),NumberOfReturns:this._reader.getBits16(4),ClassificationFlags:this._reader.getBits16(4),ScannerChannel:this._reader.getBits16(2),ScanDirectionFlag:this._reader.getBit16(),EdgeOfFlightLine:this._reader.getBit16(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},UserData:this._reader.getUint8(),ScanAngle:this._reader.getInt16(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64()}}_parsePointDataRecordFormat_7(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits16(4),NumberOfReturns:this._reader.getBits16(4),ClassificationFlags:this._reader.getBits16(4),ScannerChannel:this._reader.getBits16(2),ScanDirectionFlag:this._reader.getBit16(),EdgeOfFlightLine:this._reader.getBit16(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},UserData:this._reader.getUint8(),ScanAngle:this._reader.getInt16(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),R:this._reader.getUint16(),G:this._reader.getUint16(),B:this._reader.getUint16()}}_parsePointDataRecordFormat_8(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits16(4),NumberOfReturns:this._reader.getBits16(4),ClassificationFlags:this._reader.getBits16(4),ScannerChannel:this._reader.getBits16(2),ScanDirectionFlag:this._reader.getBit16(),EdgeOfFlightLine:this._reader.getBit16(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},UserData:this._reader.getUint8(),ScanAngle:this._reader.getInt16(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),R:this._reader.getUint16(),G:this._reader.getUint16(),B:this._reader.getUint16(),NIR:this._reader.getUint16()}}_parsePointDataRecordFormat_9(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits16(4),NumberOfReturns:this._reader.getBits16(4),ClassificationFlags:this._reader.getBits16(4),ScannerChannel:this._reader.getBits16(2),ScanDirectionFlag:this._reader.getBit16(),EdgeOfFlightLine:this._reader.getBit16(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},UserData:this._reader.getUint8(),ScanAngle:this._reader.getInt16(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),WavePacketDescriptorIndex:this._reader.getUint8(),ByteOffsetToWaveformData:this._reader.getUint64(),WaveformPacketSizeInBytes:this._reader.getUint32(),ReturnPointWaveformLocation:this._reader.getFloat32(),Xt:this._reader.getFloat32(),Yt:this._reader.getFloat32(),Zt:this._reader.getFloat32()}}_parsePointDataRecordFormat_10(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits16(4),NumberOfReturns:this._reader.getBits16(4),ClassificationFlags:this._reader.getBits16(4),ScannerChannel:this._reader.getBits16(2),ScanDirectionFlag:this._reader.getBit16(),EdgeOfFlightLine:this._reader.getBit16(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},UserData:this._reader.getUint8(),ScanAngle:this._reader.getInt16(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),R:this._reader.getUint16(),G:this._reader.getUint16(),B:this._reader.getUint16(),NIR:this._reader.getUint16(),WavePacketDescriptorIndex:this._reader.getUint8(),ByteOffsetToWaveformData:this._reader.getUint64(),WaveformPacketSizeInBytes:this._reader.getUint32(),ReturnPointWaveformLocation:this._reader.getFloat32(),Xt:this._reader.getFloat32(),Yt:this._reader.getFloat32(),Zt:this._reader.getFloat32()}}convert(e,t,i,s){try{const s=new r.Group;s.name="Cloud",s.matrixAutoUpdate=!1,s.position.x=e.Header.XOffset,s.position.y=e.Header.YOffset,s.position.z=e.Header.ZOffset,s.userData={header:e.Header,records:e.VariableLengthRecords},this._createCloudPoints(s,e,i),t(s)}catch(e){s(e)}}_offsetPoints(){this._autoOffset&&(this._boundingBox.setFromPoints(this._points),this.setOffset(this._boundingBox.getCenter()));const e=this._offset.x,t=this._offset.y,i=this._offset.z;let r=null;for(let s=0,n=this._points.length;s<n;++s)r=this._points[s],r.x-=e,r.y-=t,r.z-=i}_createCloudPoints(e,t,i){const s={0:"Created",1:"Unclassified",2:"Ground",3:"LowVegetation",4:"MediumVegetation",5:"HighVegetation",6:"Building",7:"LowPoint",8:"ModelKeyPoint",9:"Water",12:"OverlapPoints"};let a=-1/0;for(let e of t.PointDataRecords){const t=e.Intensity;t>a&&(a=t)}const o=t.Header.XScaleFactor,h=t.Header.YScaleFactor,l=t.Header.ZScaleFactor,c=1e6,d=t.PointDataRecords.length,u=Math.ceil(d/c),p=t.Header.VersionMinor<4?t.Header.PointDataFormatID:t.Header.PointDataRecordFormat,_=![0,1,4,6,9].includes(p),g=new r.PointsMaterial({size:.01,vertexColors:!0});let m=0,f=null,y=null;for(let p=0;p<u;++p){f=t.PointDataRecords.splice(0,c),m=f.length;const u=new r.BufferGeometry,w=new Float32Array(3*m),b=new Float32Array(3*m);let x=0,v=null;for(let e=0;e<m;++e){const t=e+p*c;if(t%1e5==0&&i(new ProgressEvent("ConvertPointDataRecords",{lengthComputable:!0,loaded:t,total:d})),v=f[e],w[x]=v.X*o,w[x+1]=v.Y*h,w[x+2]=v.Z*l,_)b[x]=v.R/65535,b[x+1]=v.G/65535,b[x+2]=v.B/65535;else{const e=this.colorForPointClass[s[v.Classification.Class]];if(n.isDefined(e))b[x]=e.r/255,b[x+1]=e.g/255,b[x+2]=e.b/255;else{const e=v.Intensity;b[x]=e/a,b[x+1]=e/a,b[x+2]=e/a}}x+=3}u.setAttribute("position",new r.BufferAttribute(w,3)),u.setAttribute("color",new r.BufferAttribute(b,3)),y=new r.Points(u,g),e.add(y)}}_createSubCloudPoint(e){const t=this._points.length,i=new r.BufferGeometry,s=new Float32Array(3*t),n=new Float32Array(3*t);let a=0,o=null;for(let e=0;e<t;++e)o=this._points[e],s[a]=o.x,s[a+1]=o.y,s[a+2]=o.z,this._pointsHaveColor?(n[a]=o.r/255,n[a+1]=o.g/255,n[a+2]=o.b/255):(n[a]=.1,n[a+1]=.2,n[a+2]=.5),a+=3;i.setAttribute("position",new r.BufferAttribute(s,3)),i.setAttribute("color",new r.BufferAttribute(n,3));const h=new r.PointsMaterial({size:.005,vertexColors:!0}),l=new r.Points(i,h);l.rotation.x-=Math.PI/2,e.children.push(l),this._points=[]}},e.LookAtGizmo=class extends Se{constructor(e={}){const i={boxColor:11119017,edgesColor:13882323,...e};super(i),this.isLookAtGizmo=!0,this.type="LookAtGizmo",this.explodeFactor=.25,this.handleGizmos={FACE_RIGHT:new Ye({coneColor:14483456}).setPosition(+(4+this.explodeFactor),0,0).setRotationFromAxisAndAngle(new r.Vector3(0,0,1),t.degreesToRadians(90)).setScale(1,4,1),FACE_LEFT:new Ye({coneColor:5570560}).setPosition(-(4+this.explodeFactor),0,0).setRotationFromAxisAndAngle(new r.Vector3(0,0,1),t.degreesToRadians(-90)).setScale(1,4,1),FACE_TOP:new Ye({coneColor:221}).setPosition(0,+(4+this.explodeFactor),0).setRotationFromAxisAndAngle(new r.Vector3(1,0,0),t.degreesToRadians(180)).setScale(1,4,1),FACE_BOTTOM:new Ye({coneColor:85}).setPosition(0,-(4+this.explodeFactor),0).setScale(1,4,1),FACE_FRONT:new Ye({coneColor:21760}).setPosition(0,0,+(4+this.explodeFactor)).setRotationFromAxisAndAngle(new r.Vector3(1,0,0),t.degreesToRadians(-90)).setScale(1,4,1),FACE_BACK:new Ye({coneColor:56576}).setPosition(0,0,-(4+this.explodeFactor)).setRotationFromAxisAndAngle(new r.Vector3(1,0,0),t.degreesToRadians(90)).setScale(1,4,1),CORNER_TOP_LEFT_FRONT:new je(i).setPosition(-(2+this.explodeFactor),+(2+this.explodeFactor),+(2+this.explodeFactor)),CORNER_TOP_LEFT_BACK:new je(i).setPosition(-(2+this.explodeFactor),+(2+this.explodeFactor),-(2+this.explodeFactor)),CORNER_TOP_RIGHT_FRONT:new je(i).setPosition(+(2+this.explodeFactor),+(2+this.explodeFactor),+(2+this.explodeFactor)),CORNER_TOP_RIGHT_BACK:new je(i).setPosition(+(2+this.explodeFactor),+(2+this.explodeFactor),-(2+this.explodeFactor)),CORNER_BOTTOM_LEFT_FRONT:new je(i).setPosition(-(2+this.explodeFactor),-(2+this.explodeFactor),+(2+this.explodeFactor)),CORNER_BOTTOM_LEFT_BACK:new je(i).setPosition(-(2+this.explodeFactor),-(2+this.explodeFactor),-(2+this.explodeFactor)),CORNER_BOTTOM_RIGHT_FRONT:new je(i).setPosition(+(2+this.explodeFactor),-(2+this.explodeFactor),+(2+this.explodeFactor)),CORNER_BOTTOM_RIGHT_BACK:new je(i).setPosition(+(2+this.explodeFactor),-(2+this.explodeFactor),-(2+this.explodeFactor)),EDGE_TOP_FRONT:new je(i).setPosition(0,+(2+this.explodeFactor),+(2+this.explodeFactor)).setScale(3,1,1),EDGE_TOP_LEFT:new je(i).setPosition(-(2+this.explodeFactor),+(2+this.explodeFactor),0).setScale(1,1,3),EDGE_TOP_BACK:new je(i).setPosition(0,+(2+this.explodeFactor),-(2+this.explodeFactor)).setScale(3,1,1),EDGE_TOP_RIGHT:new je(i).setPosition(+(2+this.explodeFactor),+(2+this.explodeFactor),0).setScale(1,1,3),EDGE_LEFT_FRONT:new je(i).setPosition(-(2+this.explodeFactor),0,+(2+this.explodeFactor)).setScale(1,3,1),EDGE_LEFT_BACK:new je(i).setPosition(-(2+this.explodeFactor),0,-(2+this.explodeFactor)).setScale(1,3,1),EDGE_RIGHT_FRONT:new je(i).setPosition(+(2+this.explodeFactor),0,+(2+this.explodeFactor)).setScale(1,3,1),EDGE_RIGHT_BACK:new je(i).setPosition(+(2+this.explodeFactor),0,-(2+this.explodeFactor)).setScale(1,3,1),EDGE_BOTTOM_FRONT:new je(i).setPosition(0,-(2+this.explodeFactor),+(2+this.explodeFactor)).setScale(3,1,1),EDGE_BOTTOM_LEFT:new je(i).setPosition(-(2+this.explodeFactor),-(2+this.explodeFactor),0).setScale(1,1,3),EDGE_BOTTOM_BACK:new je(i).setPosition(0,-(2+this.explodeFactor),-(2+this.explodeFactor)).setScale(3,1,1),EDGE_BOTTOM_RIGHT:new je(i).setPosition(+(2+this.explodeFactor),-(2+this.explodeFactor),0).setScale(1,1,3)},this._setupHandles(this.handleGizmos)}raycast(e,t){if(e.intersectObject(this.intersectPlane,!0).length>0)for(let i of this.children)i.raycast(e,t)}}
/**
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 */,e.LozengeHandle=Fe,e.LozengeHitbox=Pe,e.MaterialsManager=Ue,e.ObjectsManager=Ge,e.OctahedricalHandle=we,e.OctahedricalHitbox=fe,e.OrbitControlsHelper=Ne,e.PlanarHitbox=be,e.PlaneHandle=xe,e.PointClasses=ee,e.RotateGizmo=class extends Se{constructor(){super(),this.isRotateGizmo=!0,this.type="RotateGizmo";const e=(e,t,i)=>{const s=new r.BufferGeometry;let n=[];i=i||1;for(let r=0;r<=64*i;++r)"x"===t&&n.push(0,Math.cos(r/32*Math.PI)*e,Math.sin(r/32*Math.PI)*e),"y"===t&&n.push(Math.cos(r/32*Math.PI)*e,0,Math.sin(r/32*Math.PI)*e),"z"===t&&n.push(Math.sin(r/32*Math.PI)*e,Math.cos(r/32*Math.PI)*e,0);return s.setAttribute("position",new r.Float32BufferAttribute(n,3)),s};this.handleGizmos={X:[[new r.Line(new e(1,"x",.5),new _e({color:16711680}))],[new r.Mesh(new r.OctahedronBufferGeometry(.04,0),new ge({color:16711680})),[0,0,.99],null,[3,1,1]]],Y:[[new r.Line(new e(1,"y",.5),new _e({color:65280}))],[new r.Mesh(new r.OctahedronBufferGeometry(.04,0),new ge({color:65280})),[0,0,.99],null,[3,1,1]]],Z:[[new r.Line(new e(1,"z",.5),new _e({color:255}))],[new r.Mesh(new r.OctahedronBufferGeometry(.04,0),new ge({color:255})),[.99,0,0],null,[1,3,1]]],E:[[new r.Line(new e(1.25,"z",1),new _e({color:13421568}))]],XYZ:[[new r.Line(new e(1,"z",1),new _e({color:7895160}))]]},this.pickerGizmos={X:[[new He,[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new He,[0,0,0],[Math.PI/2,0,0]]],Z:[[new He,[0,0,0],[0,0,-Math.PI/2]]],E:[[new He({radius:1.25,tube:.12,radialSegments:2,tubularSegments:24})]],XYZ:[[new He]]},this._setupHandles(this.handleGizmos)}raycast(e,t){if(e.intersectObject(this.intersectPlane,!0).length>0)for(let i of this.children)i.name!==this.intersectPlane.name&&i.raycast(e,t)}},e.RotateHandle=class extends ye{constructor(e={}){super({...e}),this.isRotateHandle=!0,this.type="RotateHandle"}update(e){super.update(e),this.updateMatrix(),this.hitbox.updateMatrix()}}
/**
	 * @author [Tristan Valcke]{@link https://github.com/Itee}
	 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
	 */,e.SHPLoader=ie,e.ScaleGizmo=De,e.ScaleHandle=Ee,e.ShapeType=te,e.SphericalHitbox=class extends me{constructor(e={}){super({geometry:new r.SphereBufferGeometry(1,8,6,0,2*Math.PI,0,Math.PI),...e}),this.isSphericalHitbox=!0,this.type="SphericalHitbox"}},e.TexturesManager=Re,e.TorusHitbox=He,e.TranslateGizmo=Be,e.TranslateHandle=Ae,e}({},utils,core,threeFull,client,validators);
