import{TAbstractFileConverter as e,TAbstractDataInserter as t,TAbstractConverterManager as r}from"@itee/database";import{TMongooseController as n,TMongoDBPlugin as i}from"@itee/mongodb";import o,{isNotDefined as a,isDefined as s,isArray as c,isEmptyArray as h,isNull as l,isNotObject as u,isNotNumber as d,isNotString as m,isNotArray as f,isNaN as p,isUndefined as g,isNotBoolean as _,isObject as y,isEmptyString as w,isBlankString as b,isString as M,isNotEmptyString as S,isNotEmptyArray as v}from"@itee/validators";import{ColladaLoader as x,DefaultLoadingManager as F,FileLoader as T,FBXLoader as C,ObjectLoader as B,MTLLoader as E,OBJLoader2 as P,Vector3 as D,Shape as O,STLLoader as A,TDSLoader as G,Box3 as I,Group as z,BufferGeometry as L,BufferAttribute as k,PointsMaterial as N,Points as U,EventDispatcher as R,Object3D as H,Vector2 as j,Spherical as V,LineBasicMaterial as Y,MeshBasicMaterial as W,DoubleSide as $,Mesh as X,OctahedronBufferGeometry as Z,Quaternion as q,EdgesGeometry as K,LineSegments as Q,Float32BufferAttribute as J,Line as ee,ArrowHelper as te,CylinderBufferGeometry as re,BoxBufferGeometry as ne,PlaneBufferGeometry as ie,ConeBufferGeometry as oe,Plane as ae,Raycaster as se,Euler as ce,SplineCurve as he,QuadraticBezierCurve3 as le,QuadraticBezierCurve as ue,Path as de,LineCurve3 as me,LineCurve as fe,EllipseCurve as pe,CurvePath as ge,Curve as _e,CubicBezierCurve3 as ye,CubicBezierCurve as we,CatmullRomCurve3 as be,ArcCurve as Me,WireframeGeometry as Se,SphereGeometry as ve,TubeGeometry as xe,TorusKnotGeometry as Fe,TorusGeometry as Te,TextGeometry as Ce,TetrahedronGeometry as Be,ShapeGeometry as Ee,RingGeometry as Pe,PolyhedronGeometry as De,PlaneGeometry as Oe,ParametricGeometry as Ae,OctahedronGeometry as Ge,LatheGeometry as Ie,IcosahedronGeometry as ze,Geometry as Le,ExtrudeGeometry as ke,DodecahedronGeometry as Ne,ConeGeometry as Ue,CylinderGeometry as Re,CircleGeometry as He,BoxGeometry as je,Face3 as Ve,InstancedBufferGeometry as Ye,SphereBufferGeometry as We,TubeBufferGeometry as $e,TorusKnotBufferGeometry as Xe,TorusBufferGeometry as Ze,TextBufferGeometry as qe,TetrahedronBufferGeometry as Ke,RingBufferGeometry as Qe,PolyhedronBufferGeometry as Je,ParametricBufferGeometry as et,LatheBufferGeometry as tt,IcosahedronBufferGeometry as rt,ExtrudeBufferGeometry as nt,DodecahedronBufferGeometry as it,CircleBufferGeometry as ot,TextureLoader as at,MeshLambertMaterial as st,MeshPhongMaterial as ct,Color as ht,LinearFilter as lt,ImageLoader as ut,Sprite as dt,LineLoop as mt,LOD as ft,SkinnedMesh as pt,HemisphereLight as gt,SpotLight as _t,RectAreaLight as yt,PointLight as wt,DirectionalLight as bt,AmbientLight as Mt,OrthographicCamera as St,PerspectiveCamera as vt,Scene as xt,Fog as Ft,FogExp2 as Tt,VertexColors as Ct}from"three-full";import{TBinaryReader as Bt,Endianness as Et,Byte as Pt,Keys as Dt,Mouse as Ot,TDataBaseManager as At}from"@itee/client";import{DefaultLogger as Gt,OneHalf as It,SquareRootOfThreeOnTwo as zt,SquareRootOfTwoOnTwo as Lt}from"@itee/core";import{toEnum as kt,ringClockwise as Nt,ringContainsSome as Ut,toArray as Rt,degreesToRadians as Ht}from"@itee/utils";import{createRequire as jt}from"node:module";import{BSON_DATA_OBJECT as Vt,BSON_DATA_ARRAY as Yt}from"bson";
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @see [IFC Standard]{@link http://standards.buildingsmart.org/IFC/RELEASE/IFC4_1/FINAL/HTML/}
 *
 */class Wt extends n{constructor(e={}){super(e)}async _readOneDocument(e,t){if(a(e)||a(t))return null;const r=await this._driver.model(e).findOne(t).exec();return s(r)?r._doc:null}async _readManyDocument(e,t,r){if(a(e)||a(t))return null;return(await this._driver.model(e).find(t,r).lean().exec()).map(e=>e._doc)}async _updateDocument(e,t,r){if(a(e))return null;return await this._driver.model(e.type).findByIdAndUpdate(e._id,t,r).exec()}async getAllChildrenIds(e,t=!1){const r={children:[],geometries:[],materials:[]},n=[],i=await this._readManyDocument("Objects3D",{parent:e},{_id:!0,geometry:!0,material:!0,children:!0});for(let e=0,o=i.length;e<o;e++){const o=i[e],a=o._id.toString();s(a)&&r.children.push(a);const h=o.geometry;s(h)&&r.geometries.push(h.toString());const l=o.material;if(l){const e=c(l)?l.map(e=>e.toString()):[l.toString()];r.materials.push(...e)}if(o.children){const e=this.getAllChildrenIds(a,t);n.push(e)}}if(n.length>0){const e=await Promise.all(n);for(let t=0,n=e.length;t<n;t++){const n=e[t];r.children.push(...n.children),r.geometries.push(...n.geometries),r.materials.push(...n.materials)}}return r}async _deleteOne(e,t){try{const r="allInOneByParentId";if("oneByOne"===r);else if("allInOneByParentId"===r){const r=await this.getAllChildrenIds(e,!0);r.children.push(e);const i={children:[...new Set(r.children)],geometries:[...new Set(r.geometries)],materials:[...new Set(r.materials)]},[o,a,s]=await Promise.all([this._deleteDocuments("Objects3D",i.children),this._deleteDocuments("Geometries",i.geometries),this._deleteDocuments("Materials",i.materials)]);n.returnData({deletedObjectsCount:o,deletedGeometriesResult:a,deletedMaterialsResult:s},t)}}catch(e){n.returnError(e,t)}}async _deleteDocuments(e,t){if(h(t))return 0;return(await this._driver.model(e).deleteMany({_id:{$in:t}}).exec()).deletedCount}async _deleteDocument(e){if(a(e))return null;const t=await this._driver.model(e.type).findByIdAndDelete(e._id).exec();return t&&t._doc?t._doc._id:null}async _removeParentReference(e){const t=e.parent;if(a(t))return null;const r=await this._readOneDocument("Objects3D",{_id:t}),n=r.children,i=n.indexOf(e._id);n.splice(i,1);return await this._updateDocument(r,{$set:{children:n}})}async _removeChildrenDocuments(e){let t=[];for(let r=e.length-1;r>=0;r--)t.push(this._removeChildDocument(e[r]));return Promise.all(t)}async _removeChildDocument(e){const t=await this._readManyDocument("Objects3D",{parent:e._id}),r=await this._removeChildrenDocuments(t),n=await this._removeOrphanGeometryWithId(e.geometry),i=await this._removeOrphanMaterialsWithIds(e.material||[]);return{object:await this._deleteDocument(e),children:r,geometry:n,materials:i}}async _removeOrphanGeometryWithId(e){if(a(e))return;if((await this._readManyDocument("Objects3D",{geometry:e})).length>1)return;const t=await this._readOneDocument("Geometries",{_id:e});return await this._deleteDocument(t)}async _removeOrphanMaterialsWithIds(e){if(a(e))return;if(h(e))return;const t=[];for(let r=0,n=e.length;r<n;r++)t.push(this._removeOrphanMaterialWithId(e[r]));return Promise.all(t)}async _removeOrphanMaterialWithId(e){if(a(e))return;if((await this._readManyDocument("Objects3D",{material:e})).length>1)return;const t=await this._readOneDocument("Materials",{_id:e});return await this._deleteDocument(t)}}
/**
 * @module Converters/ColladaToThree
 * @desc Export JsonToThree converter class about .dae files

 * @requires {@link https://github.com/Itee/@itee/database @itee/database}
 * @requires {@link https://github.com/Itee/three-full three-full}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class $t extends e{constructor(){super({dumpType:e.DumpType.ArrayBuffer})}_convert(e,t,r,n,i){super._convert(e,t,r,n,i);try{const t=new x;r(t.parse(e))}catch(e){i(e)}}}
/**
 * @module Loader/DBFLoader
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * From:
 * https://www.clicketyclick.dk/databases/xbase/format/db2_dbf.html#DBII_DBF_STRUCT
 * http://web.archive.org/web/20150323061445/http://ulisse.elettra.trieste.it/services/doc/dbase/DBFstruct.htm
 * http://www.dbase.com/Knowledgebase/INT/db7_file_fmt.htm
 *
 *
 */const Xt=kt({FoxPro:48,FoxPro_Autoincrement:49,dBASE_II:2,FoxPro_Var:50,dBASE_III_plus:3,dBASE_III_plus_memo:131,dBASE_IV_SQL_table:67,dBASE_IV_SQL_system:99,dBASE_IV_memo:139,dBASE_IV_memo_SQL_table:203,FoxBase:251,dBase_v_7:4,FoxPro_2_x:245,HiPerSix_memo:229}),Zt=kt({Binary:"B",Character:"C",Date:"D",Numeric:"N",Logical:"L",Memo:"M",Timestamp:"@",Long:"I",Autoincrement:"+",Float:"F",Double:"O",OLE:"G"});class qt{constructor(e={}){const t={manager:F,logger:Gt,reader:new Bt,...e};this.manager=t.manager,this.logger=t.logger,this.reader=t.reader}get manager(){return this._manager}set manager(e){this._manager=e}get logger(){return this._logger}set logger(e){this._logger=e}get reader(){return this._reader}set reader(e){this._reader=e}setManager(e){return this.manager=e,this}setLogger(e){return this.logger=e,this}setReader(e){return this.reader=e,this}load(e,t,r,n){const i=this,o=new T(i.manager);o.setResponseType("arraybuffer"),o.load(e,e=>{t(i.parse(e))},r,n)}parse(e){this.reader.setEndianess(Et.Big).setBuffer(e);const t=this.reader.getInt8();if(!this._isValidVersion(t))return this.logger.error(`DBFLoader: Invalid version number: ${t}`),null;const r=this._parseHeader(t);return{header:r,datas:this._parseDatas(t,r)}}_isValidVersion(e){return Xt.includes(e)}_parseHeader(e){let t={};switch(e){case Xt.FoxPro:case Xt.FoxPro_Autoincrement:case Xt.FoxPro_Var:case Xt.dBASE_II:t=this._parseHeaderV2();break;case Xt.dBASE_III_plus:case Xt.dBASE_III_plus_memo:t=this._parseHeaderV2_5();break;case Xt.dBASE_IV_memo:case Xt.dBASE_IV_memo_SQL_table:case Xt.dBASE_IV_SQL_system:case Xt.dBASE_IV_SQL_table:t=this._parseHeaderV3();break;case Xt.dBase_v_7:case Xt.FoxPro_2_x:case Xt.HiPerSix_memo:t=this._parseHeaderV4();break;default:throw new RangeError(`Invalid version parameter: ${e}`)}return this.reader.getUint8()!==qt.Terminator&&this.logger.error("DBFLoader: Invalid terminator after field descriptors !!!"),t}_parseHeaderV2(){const e=this.reader.getInt16(),t=this.reader.getInt8()+qt.YearOffset,r=this.reader.getInt8(),n=this.reader.getInt8(),i=this.reader.getInt16();let o,a,s,c,h,l=[];for(let t=0;t<e;t++)o=this.reader.getString(11),a=this.reader.getChar(),s=this.reader.getUint8(),c=this.reader.getInt16(),h=this.reader.getInt8(),l.push({name:o,type:a,length:s,memoryAddress:c,decimalCount:h});return{numberOfRecords:e,year:t,month:r,day:n,lengthOfEachRecords:i,fields:l}}_parseHeaderV2_5(){const e=this.reader.getInt8()+qt.YearOffset,t=this.reader.getInt8(),r=this.reader.getInt8();this.reader.setEndianess(Et.Little);const n=this.reader.getInt32(),i=this.reader.getInt16(),o=this.reader.getInt16();this.reader.setEndianess(Et.Big),this.reader.skipOffsetOf(20);let a,s,c,h,l,u,d,m=[];for(let e=0;e<n;e++)a=this.reader.getString(11),s=this.reader.getChar(),h=this.reader.getInt32(),c=this.reader.getUint8(),l=this.reader.getUint8(),this.reader.skipOffsetOf(2),u=this.reader.getInt8(),this.reader.skipOffsetOf(2),d=this.reader.getInt8(),this.reader.skipOffsetOf(1),m.push({name:a,type:s,length:c,memoryAddress:h,decimalCount:l,workAreaId:u,MDXFlag:d});return{year:e,month:t,day:r,numberOfRecords:n,numberOfByteInHeader:i,numberOfByteInRecord:o,fields:m}}_parseHeaderV3(){const e=this.reader.getInt8()+qt.YearOffset,t=this.reader.getInt8(),r=this.reader.getInt8();this.reader.setEndianess(Et.Little);const n=this.reader.getInt32(),i=this.reader.getInt16(),o=this.reader.getInt16();this.reader.setEndianess(Et.Big),this.reader.skipOffsetOf(2);const a=this.reader.getInt8(),s=this.reader.getInt8();this.reader.skipOffsetOf(12);const c=this.reader.getInt8(),h=this.reader.getInt8();this.reader.skipOffsetOf(2);let l,u,d,m,f,p,g=[];for(;this.reader.getOffset()<i-1;)l=this.reader.getString(11),u=this.reader.getChar(),this.reader.skipOffsetOf(4),d=this.reader.getUint8(),m=this.reader.getUint8(),this.reader.skipOffsetOf(2),f=this.reader.getInt8(),this.reader.skipOffsetOf(10),p=this.reader.getInt8(),g.push({name:l,type:u,length:d,decimalCount:m,workAreaId:f,MDXFieldFlag:p});return{year:e,month:t,day:r,numberOfRecords:n,numberOfByteInHeader:i,numberOfByteInRecord:o,incompleteTransactionFlag:a,encryptionFlag:s,MDXFlag:c,languageDriverId:h,fields:g}}_parseHeaderV4(){const e=this.reader.getInt8()+qt.YearOffset,t=this.reader.getInt8(),r=this.reader.getInt8();this.reader.setEndianess(Et.Little);const n=this.reader.getInt32(),i=this.reader.getInt16(),o=this.reader.getInt16();this.reader.setEndianess(Et.Big),this.reader.skipOffsetOf(2);const a=this.reader.getInt8(),s=this.reader.getInt8();this.reader.skipOffsetOf(12);const c=this.reader.getInt8(),h=this.reader.getInt8();this.reader.skipOffsetOf(2);const l=this.reader.getString(32);this.reader.skipOffsetOf(4);let u,d,m,f,p,g,_=[];for(let e=0;e<n;e++)u=this.reader.getString(32),d=this.reader.getChar(),m=this.reader.getUint8(),f=this.reader.getUint8(),this.reader.skipOffsetOf(2),p=this.reader.getInt8(),this.reader.skipOffsetOf(2),g=this.reader.getInt32(),this.reader.skipOffsetOf(4),_.push({name:u,type:d,length:m,decimalCount:f,MDXFieldFlag:p,nextAutoincrementValue:g});return{year:e,month:t,day:r,numberOfRecords:n,numberOfByteInHeader:i,numberOfByteInRecord:o,incompleteTransactionFlag:a,encryptionFlag:s,MDXFlag:c,languageDriverId:h,languageDriverName:l,fields:_}}_parseDatas(e,t){const r=t.numberOfRecords,n=t.fields;let i=[],o=null,a=null;for(let e=0;e<r;e++){o={},o.deleted=this.reader.getUint8()===qt.DeletedRecord;for(let e=0,t=n.length;e<t;e++)switch(a=n[e],a.type){case Zt.Binary:{const e=this.reader.getString(a.length);o[a.name]=parseInt(e)}break;case Zt.Numeric:{const e=this.reader.getString(a.length);o[a.name]=parseInt(e)}break;case Zt.Character:case Zt.Date:o[a.name]=this.reader.getString(a.length);break;case Zt.Logical:{const e=this.reader.getChar().toLowerCase();o[a.name]="t"===e||"y"===e||"f"!==e&&"n"!==e&&null}break;case Zt.Memo:o[a.name]=this.reader.getString(a.length);break;case Zt.Timestamp:break;case Zt.Long:case Zt.Autoincrement:o[a.name]=this.reader.getInt32();break;case Zt.Float:{const e=this.reader.getString(a.length);o[a.name]=parseInt(e)}break;case Zt.Double:o[a.name]=this.reader.getFloat64();break;case Zt.OLE:o[a.name]=this.reader.getString(a.length);break;default:throw new RangeError(`Invalid data type parameter: ${a.type}`)}i.push(o)}return i}_parseFieldProperties(){const e=this.reader.getInt16(),t=this.reader.getInt16(),r=this.reader.getInt16(),n=this.reader.getInt16(),i=this.reader.getInt16(),o=this.reader.getInt16(),a=this.reader.getInt16(),s=this.reader.getInt16();let c=[];for(let t=0;t<e;t++)c.push(this._getStandardProperties());let h=[];for(let e=0;e<r;e++)h.push(this._getCustomProperties());let l=[];for(let e=0;e<i;e++)l.push(this._getReferentialIntegrityProperties());return{numberOfStandardProperties:e,startOfStandardPropertiesDescriptor:t,numberOfCustomProperties:r,startOfCustomPropertiesDescriptor:n,numberOfReferentialIntegrityProperties:i,startOfReferentialIntegrityDescriptor:o,startOfData:a,sizeOfPropertiesStructure:s,standardProperties:c,customProperties:h,referentialIntegrityProperties:l}}_getStandardProperties(){const e=this.reader.getInt16(),t=this.reader.getInt16(),r=this.reader.getInt8(),n=this.reader.getInt8(),i=this.reader.getInt8();this.reader.skipOffsetOf(4);return{generationalNumber:e,tableFieldOffset:t,propertyDescribed:r,type:n,isConstraint:i,offsetFromStart:this.reader.getInt16(),widthOfDatabaseField:this.reader.getInt16()}}_getCustomProperties(){const e=this.reader.getInt16(),t=this.reader.getInt16(),r=this.reader.getInt8();this.reader.skipOffsetOf(1);return{generationalNumber:e,tableFieldOffset:t,type:r,offsetFromStartOfName:this.reader.getInt16(),lengthOfName:this.reader.getInt16(),offsetFromStartOfData:this.reader.getInt16(),lengthOfData:this.reader.getInt16()}}_getReferentialIntegrityProperties(){return{databaseState:this.reader.getInt8(),sequentialNumberRule:this.reader.getInt16(),offsetOfTheRIRuleName:this.reader.getInt16(),sizeOfTheRIRuleName:this.reader.getInt16(),offsetOfNameOfForeignTable:this.reader.getInt16(),sizeOfNameOfForeignTable:this.reader.getInt16(),stateBehaviour:this.reader.getInt8(),numberOfFieldsInLinkingKey:this.reader.getInt16(),offsetOfLocalTableTagName:this.reader.getInt16(),sizeOfTheLocalTableTagName:this.reader.getInt16(),offsetOfForeignTableTagName:this.reader.getInt16(),sizeOfTheForeignTableTagName:this.reader.getInt16()}}}qt.Terminator=13,qt.DeletedRecord=26,qt.YearOffset=1900;
/**
 * @module Converters/DbfToThree
 * @desc Export JsonToThree converter class about .dbf files

 * @requires {@link https://github.com/Itee/@itee/database @itee/database}
 * @requires {@link module:Loader/DBFLoader Loader/DBFLoader}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */
class Kt extends e{constructor(){super({dumpType:e.DumpType.ArrayBuffer})}_convert(e,t,r,n,i){super._convert(e,t,r,n,i);try{const t=new qt;r(t.parse(e))}catch(e){i(e)}}}
/**
 * @module Converters/FbxToThree
 * @desc Export JsonToThree converter class about .fbx files

 * @requires {@link https://github.com/Itee/@itee/database @itee/database}
 * @requires {@link https://github.com/Itee/three-full three-full}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Qt extends e{constructor(){super({dumpType:e.DumpType.ArrayBuffer})}_convert(e,t,r,n,i){super._convert(e,t,r,n,i);try{const t=new C;r(t.parse(e))}catch(e){i(e)}}}
/**
 * @module Converters/JsonToThree
 * @desc Export JsonToThree converter class about .json files

 * @requires {@link https://github.com/Itee/@itee/database @itee/database}
 * @requires {@link https://github.com/Itee/three-full three-full}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Jt extends e{constructor(){super({dumpType:e.DumpType.JSON})}_convert(e,t,r,n,i){super._convert(e,t,r,n,i);try{const t=new B;r(t.parse(e))}catch(e){i(e)}}}
/**
 * @module Converters/MtlToThree
 * @desc Export JsonToThree converter class about .mtl files

 * @requires {@link https://github.com/Itee/@itee/database @itee/database}
 * @requires {@link https://github.com/Itee/three-full three-full}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class er extends e{constructor(){super({dumpType:e.DumpType.String})}_convert(e,t,r,n,i){super._convert(e,t,r,n,i);try{const t=new E;r(t.parse(e))}catch(e){i(e)}}}
/**
 * @module Converters/Obj2ToThree
 * @desc Export JsonToThree converter class about .obj files

 * @requires {@link https://github.com/Itee/@itee/database @itee/database}
 * @requires {@link https://github.com/Itee/three-full three-full}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class tr extends e{constructor(){super({dumpType:e.DumpType.JSON})}_convert(e,t,r,n,i){super._convert(e,t,r,n,i);try{const t=new P;r(t.parse(e))}catch(e){i(e)}}}
/**
 * @module Loader/SHPLoader
 * @desc Export SHPLoader to load .shp files
 *
 * @requires {@link https://github.com/Itee/@itee/client @itee/client}
 * @requires {@link https://github.com/Itee/@itee/utils @itee/utils}
 * @requires {@link https://github.com/Itee/three-full three-full}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 * @example Todo...
 *
 */const rr=kt({NullShape:0,Point:1,Polyline:3,Polygon:5,MultiPoint:8,PointZ:11,PolyLineZ:13,PolygonZ:15,MultiPointZ:18,PointM:21,PolylineM:23,PolygonM:25,MultiPointM:28,MultiPatch:31});class nr{constructor(e={}){const t={manager:F,logger:Gt,reader:new Bt,globalOffset:new D(0,0,0),worldAxis:{from:"zUp",to:"zForward"},...e};this.manager=t.manager,this.logger=t.logger,this.reader=t.reader,this.globalOffset=t.globalOffset,this.worldAxis=t.worldAxis}get globalOffset(){return this._globalOffset}set globalOffset(e){this._globalOffset=e}get worldAxis(){return this._worldAxis}set worldAxis(e){this._worldAxis=e}get manager(){return this._manager}set manager(e){this._manager=e}get logger(){return this._logger}set logger(e){this._logger=e}get reader(){return this._reader}set reader(e){this._reader=e}setGlobalOffset(e){return this.globalOffset=e,this}setWorldAxis(e){return this.worldAxis=e,this}setManager(e){return this.manager=e,this}setLogger(e){return this.logger=e,this}setReader(e){return this.reader=e,this}load(e,t,r,n){const i=this,o=new T(i.manager);o.setResponseType("arraybuffer"),o.load(e,e=>{t(i.parse(e))},r,n)}parse(e){this._reader.setEndianess(Et.Big).setBuffer(e);const t=this._parseHeader();if(t.fileCode!==nr.FileCode)return this.logger.error("SHPLoader: Invalide Shape file code !"),null;if(t.fileLength<nr.MinFileLength)return this.logger.error("SHPLoader: Shape file have an incorrect length !"),null;if(!Object.values(rr).includes(t.shapeType))return this.logger.error("SHPLoader: Shape file have an incorrect shape type !"),null;t.version<nr.MinVersion&&this.logger.warn("SHPLoader: Version of shape file below than 1000 could be incorrectly parsed !");const r=this._parseDatas(t);return this._convertToObjects(r)}_parseHeader(){const e=this._reader.getInt32();this._reader.skipOffsetOf(20);const t=this._reader.getInt32();this._reader.setEndianess(Et.Little);const r=this._reader.getInt32(),n=this._reader.getInt32(),i=this._reader.getInt32(),o=this._reader.getInt32();return{fileCode:e,fileLength:t,version:r,shapeType:n,boundingBox:{xMin:i,xMax:this._reader.getInt32(),yMin:o,yMax:this._reader.getInt32(),zMin:this._reader.getInt32(),zMax:this._reader.getInt32(),mMin:this._reader.getInt32(),mMax:this._reader.getInt32()}}}_parseDatas(e){this._reader.skipOffsetTo(100);let t,r,n,i=[];for(;!this._reader.isEndOfFile();)switch(t=this._parseRecordHeader(),r=this._reader.getOffset()+2*t.contentLength,this._reader.setEndianess(Et.Little),e.shapeType){case rr.NullShape:this._reader.skipOffsetTo(r);break;case rr.Point:case rr.PointZ:case rr.PointM:for(;this._reader.getOffset()<r;)n=this._parsePoint(),n&&i.push(n);break;case rr.Polyline:case rr.PolyLineZ:case rr.PolylineM:for(;this._reader.getOffset()<r;)n=this._parsePolyLine(),n&&i.push(n);break;case rr.Polygon:case rr.PolygonZ:case rr.PolygonM:for(;this._reader.getOffset()<r;)n=this._parsePolyLine(),n&&i.push(n);break;case rr.MultiPoint:case rr.MultiPointZ:case rr.MultiPointM:for(;this._reader.getOffset()<r;)n=this._parseMultiPoint(),n&&i.push(n);break;case rr.MultiPatch:for(;this._reader.getOffset()<r;)n=this._parseMultiPatch(),n&&i.push(n);break;default:this.logger.error(`SHPLoader: Invalid switch parameter: ${e.shapeType}`)}return i}_parseRecordHeader(){this._reader.setEndianess(Et.Big);return{recordNumber:this._reader.getInt32(),contentLength:this._reader.getInt32()}}_parseNull(){return this._reader.getInt32(),null}_parsePoint(){const e=this._reader.getInt32();if(e===rr.NullShape)return null;return{shapeType:e,x:this._reader.getFloat64(),y:this._reader.getFloat64()}}_parsePolyLine(){const e=this._reader.getInt32();if(e===rr.NullShape)return null;const t={xMin:this._reader.getFloat64(),yMin:this._reader.getFloat64(),xMax:this._reader.getFloat64(),yMax:this._reader.getFloat64()},r=this._reader.getInt32(),n=this._reader.getInt32(),i=new Array(r);for(let e=0;e<r;e++)i[e]=this._reader.getInt32();const o=new Array(n);for(let e=0;e<n;e++)o[e]={x:this._reader.getFloat64(),y:this._reader.getFloat64()};return{shapeType:e,boundingBox:t,numberOfParts:r,numberOfPoints:n,parts:i,points:o}}_parsePolygon(){const e=this._reader.getInt32();if(e===rr.NullShape)return null;const t={xMin:this._reader.getFloat64(),yMin:this._reader.getFloat64(),xMax:this._reader.getFloat64(),yMax:this._reader.getFloat64()},r=this._reader.getInt32(),n=this._reader.getInt32();let i=new Array(r);for(let e=0;e<r;e++)i[e]=this._reader.getInt32();let o=new Array(n);for(let e=0;e<n;e++)o[e]={x:this._reader.getFloat64(),y:this._reader.getFloat64()};const a=[],s=[];return i.forEach((e,t)=>{const r=o.slice(e,i[t+1]);Nt(r)?a.push(r):s.push(r)}),s.forEach(e=>{a.some(t=>{if(Ut(t[0],e))return t.push(e),!0})||a.push([e])}),{shapeType:e,boundingBox:t,numberOfParts:r,numberOfPoints:n,parts:i,polygons:a}}_parseMultiPoint(){const e=this._reader.getInt32();if(e===rr.NullShape)return null;const t={xMin:this._reader.getFloat64(),xMax:this._reader.getFloat64(),yMin:this._reader.getFloat64(),yMax:this._reader.getFloat64()},r=this._reader.getInt32(),n=new Array(r);for(let e=0;e<r;e++)n.push([this._reader.getFloat64(),this._reader.getFloat64()]);return{shapeType:e,boundingBox:t,numberOfPoints:r,points:n}}_parseMultiPatch(){const e=this._reader.getInt32();return e===rr.NullShape?null:{shapeType:e}}_convertToObjects(e){let t=[];for(let t=0,i=e.length;t<i;t++){let i=e[t];i.shapeType!==rr.Polygon&&i.shapeType!==rr.PolygonZ&&i.shapeType!==rr.PolygonM||(i.points&&Array.isArray(i.points[0])?r(i.points):n(i.points))}function r(e){for(let t=0,i=e.length;t<i;t++){let i=e[t];i?Array.isArray(i[0])?r(i):n(i):this.logger.log("no array, oups !")}}function n(e){t.push(new O(e))}return t}}nr.FileCode=9994,nr.MinFileLength=100,nr.MinVersion=1e3;
/**
 * @module Converters/ShpToThree
 * @desc Export JsonToThree converter class about .shp files

 * @requires {@link https://github.com/Itee/@itee/database @itee/database}
 * @requires {@link module:Loader/SHPLoader Loader/SHPLoader}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */
class ir extends e{constructor(){super({dumpType:e.DumpType.ArrayBuffer})}_convert(e,t,r,n,i){super._convert(e,t,r,n,i);try{const t=new nr;r(t.parse(e))}catch(e){i(e)}}}
/**
 * @module Converters/StlToThree
 * @desc Export JsonToThree converter class about .stl files

 * @requires {@link https://github.com/Itee/@itee/database @itee/database}
 * @requires {@link https://github.com/Itee/three-full three-full}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class or extends e{constructor(){super({dumpType:e.DumpType.JSON})}_convert(e,t,r,n,i){super._convert(e,t,r,n,i);try{const t=new A;r(t.parse(e))}catch(e){i(e)}}}
/**
 * @module Converters/TdsToThree
 * @desc Export JsonToThree converter class about .3ds files

 * @requires {@link https://github.com/Itee/@itee/database @itee/database}
 * @requires {@link https://github.com/Itee/three-full three-full}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class ar extends e{constructor(){super({dumpType:e.DumpType.ArrayBuffer})}_convert(e,t,r,n,i){super._convert(e,t,r,n,i);try{const t=new G;r(t.parse(e))}catch(e){i(e)}}}
/**
 * @module Inserters/ThreeToMongoDB
 * @desc Export ThreeToMongoDB mongodb inserter class.
 *
 * @requires {@link https://github.com/Itee/@itee/client @itee/client}
 * @requires {@link https://github.com/Itee/@itee/database @itee/database}
 * @requires {@link https://github.com/Itee/@itee/validators @itee/validators}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class sr extends t{constructor(e={}){const t={logger:Gt,...e};super(t),this.logger=t.logger,this.mergeStrategy="add",this._cache={}}static _toLog(e){return JSON.stringify({type:e.type||"undefined",name:e.name||"undefined",uuid:e.uuid||"undefined",id:e._id||"undefined"})}async _save(e,t,r,n,i){const o=Rt(e);if(h(o))return void i("No data to save in database. Abort insert !");const a=o.map(e=>e.name);this.logger.log(`ThreeToMongoDB: Saving ${a}`),t.mergeStrategy&&(this.mergeStrategy=t.mergeStrategy);try{const e=t.parentId;let n=null,a=null;if(s(e)){const r=await this._readDocument("Objects3D",{_id:e});if(l(r))return void i(`Unable to retrieve parent with id (${t.parentId}). Abort insert !`);if("add"===this.mergeStrategy)n=await this._parseObjects(o,e),a=s(n)?n.filter(e=>e).map(e=>e._id):[],await this._updateDocument(r,{$addToSet:{children:a}});else if("replace"===this.mergeStrategy){const t=await this._readDocuments("Objects3D",{parent:e}),i=o.map(e=>e.uuid),c=t.filter(e=>!i.includes(e.uuid));await this._removeChildrenDocuments(c),n=await this._parseObjects(o,e),a=s(n)?n.filter(e=>e).map(e=>e._id):[],await this._updateDocument(r,{$set:{children:a}})}}else n=await this._parseObjects(o,null),a=s(n)?n.filter(e=>e).map(e=>e._id):[];this.logger.log(`ThreeToMongoDB: Saved ${a}`),r()}catch(e){i(e)}finally{this._cache={}}}async _parseObjects(e=[],t=null){this.logger.debug("_parseObjects(...)");const r=Rt(e);if(h(r))return null;const n=[];for(let e=0,i=r.length;e<i;e++)n.push(this._parseObject(r[e],t));return Promise.all(n)}async _parseObject(e,t=null){if(this.logger.debug(`_parseObject(${sr._toLog(e)}, ${t})`),a(e))return null;const r=e.type,n=e.name,i=e.geometry,o=Rt(e.children),c=Rt(e.material);if(s(i)&&h(o))if(i.isGeometry){const e=i.vertices;if(a(e)||h(e))return this.logger.error(`Leaf object ${n} have a geometry that doesn't contain vertices ! Skip it.`),null}else{if(!i.isBufferGeometry)return this.logger.error(`Object ${n} contain an unknown/unmanaged geometry of type ${i.type} ! Skip it.`),null;{const e=i.attributes;if(a(e))return this.logger.error(`Buffer geometry of ${n} doesn't contain attributes ! Skip it.`),null;const t=e.position;if(a(t)||0===t.count)return this.logger.error(`Leaf object ${n} have a buffer geometry that doesn't contain position attribute ! Skip it.`),null}}let l=null;if(sr.AvailableLineTypes.includes(r)){if(a(i))return this.logger.error(`Missing geometry for object ${e.name} of type ${r}. Only Sprite can contains material without geometry ! Skip it.`),null;l=sr.AvailableLineMaterialTypes}else if(sr.AvailablePointTypes.includes(r)){if(a(i))return this.logger.error(`Missing geometry for object ${e.name} of type ${r}. Only Sprite can contains material without geometry ! Skip it.`),null;l=sr.AvailablePointMaterialTypes}else sr.AvailableSpriteTypes.includes(r)&&(l=sr.AvailableSpriteMaterialTypes);if(l)for(let e=0,t=c.length;e<t;e++){const t=c[e].type;if(!l.includes(t))return this.logger.error(`Object ${n} of type ${r}, contain an invalid material of type ${t} ! Skip it.`),null}const u=await this._getOrCreateDocuments(i),d=s(u)?u.filter(e=>e).map(e=>e._id).pop():null,m=await this._getOrCreateDocuments(c),f=s(m)?m.filter(e=>e).map(e=>e._id):[];let p=await this._readDocument(r,{uuid:e.uuid,parent:t});if(s(p))if("add"===this.mergeStrategy){const e=await this._parseObjects(o,p._id),t=s(e)?e.filter(e=>e).map(e=>e._id):[];await this._updateDocument(p,{$addToSet:{children:t}})}else if("replace"===this.mergeStrategy){const e=await this._readDocuments("Objects3D",{parent:p._id}),t=o.map(e=>e.uuid),r=e.filter(e=>!t.includes(e.uuid));await this._removeChildrenDocuments(r);const n=await this._parseObjects(o,p._id),i=s(n)?n.filter(e=>e).map(e=>e._id):[];await this._updateDocument(p,{$set:{children:i,geometry:d,material:f}})}else this.logger.error(`Unknown/Unmanaged merge srategy ${this.mergeStrategy}`);else{e.parent=t,e.children=[],e.geometry=d,e.material=f,p=await this._createDocument(e);const r=await this._parseObjects(o,p._id),n=s(r)?r.filter(e=>e).map(e=>e._id):[];await this._updateDocument(p,{$set:{children:n,geometry:d,material:f}})}return p}async _getOrCreateDocuments(e=[]){this.logger.debug("_getOrCreateDocuments(...)");const t=Rt(e);if(h(t))return null;const r=[];for(let e=0,n=t.length;e<n;e++)r.push(this._getOrCreateDocument(t[e]));return Promise.all(r)}async _getOrCreateDocument(e){if(this.logger.debug(`_getOrCreateDocument(${sr._toLog(e)})`),a(e))return null;let t=await this._readDocument(e.type,{uuid:e.uuid});return t=s(t)?await this._updateDocument(t,e):await this._createDocument(e),t}async _createDocuments(e=[]){this.logger.debug("_createDocuments(...)");const t=Rt(e);if(h(t))return null;const r=[];for(let e=0,n=t.length;e<n;e++)r.push(this._createDocument(t[e]));return Promise.all(r)}async _createDocument(e){if(this.logger.debug(`_createDocument(${sr._toLog(e)})`),a(e))return null;const t=await this._driver.model(e.type)(e).save(),r=s(t)?t._doc:null;return r&&(this._cache[r.uuid]=r),r}async _readDocuments(e,t){if(this.logger.debug("_readDocuments(...)"),a(e)||a(t))return null;return(await this._driver.model(e).find(t).exec()).map(e=>e._doc)}async _readDocument(e,t){if(this.logger.debug(`_readDocument(${e}, ${JSON.stringify(t)})`),a(e)||a(t))return null;const r=this._cache[t.uuid];if(r)return r;const n=await this._driver.model(e).findOne(t).exec(),i=s(n)?n._doc:null;return i&&(this._cache[i.uuid]=i),i}async _updateDocuments(e=[],t,r){this.logger.debug("_updateDocuments(...)");const n=Rt(e);if(h(n))return null;const i=[];for(let e=0,o=n.length;e<o;e++)i.push(this._updateDocument(n[e],t,r));return Promise.all(i)}async _updateDocument(e,t,r={new:!0}){if(this.logger.debug(`_updateDocument(${sr._toLog(e)}, ${JSON.stringify(t)}, ${JSON.stringify(r)})`),a(e))return null;const n=await this._driver.model(e.type).findByIdAndUpdate(e._id,t,r).exec(),i=s(n)?n._doc:null;return i&&(this._cache[i.uuid]=i),i}async _deleteDocuments(e=[]){this.logger.debug("_deleteDocuments(...)");const t=Rt(e);if(h(t))return null;const r=[];for(let e=0,n=t.length;e<n;e++)r.push(this._deleteDocument(t[e]));return Promise.all(r)}async _deleteDocument(e){if(this.logger.debug(`_deleteDocument(${sr._toLog(e)})`),a(e))return null;const t=await this._driver.model(e.type).findByIdAndDelete(e._id).exec(),r=s(t)?t._doc:null;return r&&delete this._cache[r.uuid],r}async _removeChildrenDocuments(e){this.logger.debug("_removeChildrenDocuments(...)");let t=[];for(let r=e.length-1;r>=0;r--)t.push(this._removeChildDocument(e[r]));return Promise.all(t)}async _removeChildDocument(e){this.logger.debug(`_removeChildDocument(${sr._toLog(e)})`);const t=await this._readDocuments("Objects3D",{parent:e._id});await this._removeChildrenDocuments(t),await this._removeOrphanGeometryWithId(e.geometry),await this._removeOrphanMaterialsWithIds(e.material||[]),await this._deleteDocument(e)}async _removeOrphanGeometryWithId(e){if(this.logger.debug(`_removeOrphanGeometryWithId(${e})`),a(e))return;if((await this._readDocuments("Objects3D",{geometry:e})).length>1)return;const t=await this._readDocument("Geometries",{_id:e});await this._deleteDocument(t)}async _removeOrphanMaterialsWithIds(e){this.logger.debug("_removeOrphanMaterialsWithIds(...)");const t=[];for(let r=0,n=e.length;r<n;r++)t.push(this._removeOrphanMaterialWithId(e[r]));return Promise.all(t)}async _removeOrphanMaterialWithId(e){this.logger.debug(`_removeOrphanMaterialWithId(${e})`);if((await this._readDocuments("Objects3D",{material:e})).length>1)return;const t=await this._readDocument("Materials",{_id:e});await this._deleteDocument(t)}}function cr(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if("function"==typeof t){var r=function e(){var r=!1;try{r=this instanceof e}catch{}return r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}),r}sr.AvailableCurveTypes=["Curve","ArcCurve","CatmullRomCurve3","CubicBezierCurve","CubicBezierCurve3","EllipseCurve","LineCurve","LineCurve3","QuadraticBezierCurve","QuadraticBezierCurve3","SplineCurve","CurvePath","Path","Shape"],sr.AvailableLineTypes=["Line","LineLoop","LineSegments"],sr.AvailableLineMaterialTypes=["LineBasicMaterial","LineDashedMaterial"],sr.AvailablePointTypes=["Points"],sr.AvailablePointMaterialTypes=["PointsMaterial"],sr.AvailableSpriteTypes=["Sprite"],sr.AvailableSpriteMaterialTypes=["SpriteMaterial"];var hr={};
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @module Schemas/Object3D
 *
 * @description Todo...
 */function lr(){}lr.getSchemaFrom=e=>(lr._schema||lr._createSchema(e),lr._schema),lr._createSchema=e=>{const t=e.Schema,r=t.Types,n=r.ObjectId,i=r.Mixed,o=r.Vector3,a=r.Quaternion,s=r.Matrix4,c=r.Euler;lr._schema=new t({uuid:String,name:String,type:String,parent:n,children:[n],up:o,position:o,rotation:c,quaternion:a,scale:{type:o,default:{x:1,y:1,z:1}},modelViewMatrix:s,normalMatrix:s,matrix:s,matrixWorld:s,matrixAutoUpdate:Boolean,matrixWorldNeedsUpdate:Boolean,layers:{type:Number,set:e=>e.mask},visible:Boolean,castShadow:Boolean,receiveShadow:Boolean,frustumCulled:Boolean,renderOrder:Boolean,userData:{type:i,set:e=>function e(t){let r={};for(let n in t){if(!Object.prototype.hasOwnProperty.call(t,n))continue;let i=t[n];i.constructor===Object&&(i=e(i)),r[n.replace(/\./g,"")]=i}return r}(e)}},{collection:"objects",discriminatorKey:"type"})},lr.getModelFrom=e=>(lr._model||lr._createModel(e),lr._model),lr._createModel=e=>{lr._model=e.model("Objects3D",lr.getSchemaFrom(e)),lr._model.discriminator("Object3D",new e.Schema({}))},lr.registerModelTo=e=>(lr._model||lr._createModel(e),e),lr._schema=null,lr._model=null;var ur,dr=cr(Object.freeze({__proto__:null,Object3D:lr}));var mr,fr=function(){if(ur)return hr;ur=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("Audio",n(t))}return hr.Audio={name:"Audio",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},hr}(),pr={};var gr,_r=function(){if(mr)return pr;mr=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("AudioListener",n(t))}return pr.AudioListener={name:"AudioListener",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},pr}(),yr={};var wr,br=function(){if(gr)return yr;gr=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("PositionalAudio",n(t))}return yr.PositionalAudio={name:"PositionalAudio",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},yr}(),Mr={};var Sr,vr=function(){if(wr)return Mr;wr=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("ArrayCamera",n(t))}return Mr.ArrayCamera={name:"ArrayCamera",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Mr}(),xr={};var Fr,Tr=function(){if(Sr)return xr;Sr=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("Camera",n(t))}return xr.Camera={name:"Camera",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},xr}(),Cr={};var Br,Er=function(){if(Fr)return Cr;Fr=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("CubeCamera",n(t))}return Cr.CubeCamera={name:"CubeCamera",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Cr}(),Pr={};var Dr,Or=function(){if(Br)return Pr;Br=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("OrthographicCamera",n(t))}return Pr.OrthographicCamera={name:"OrthographicCamera",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Pr}(),Ar={};var Gr=function(){if(Dr)return Ar;Dr=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("PerspectiveCamera",n(t))}return Ar.PerspectiveCamera={name:"PerspectiveCamera",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Ar}(),Ir={};const zr=jt(import.meta.url);function Lr(){return zr("node:buffer")}
/**
 * @module Schemas/Core/BufferAttribute
 * @desc Export the ThreeJs BufferAttribute Model and Schema for Mongoose.
 *
 * @requires {@link https://github.com/Itee/@itee/validators @itee/validators}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */var kr;var Nr=function(){if(kr)return Ir;kr=1;const{isInt8Array:e,isInt16Array:t,isInt32Array:r,isFloat32Array:n,isFloat64Array:i,isUint8Array:a,isUint8ClampedArray:s,isUint16Array:c,isUint32Array:h,isBigInt64Array:l,isBigUint64Array:u}=o,{Buffer:d}=Lr();let m;return Ir.BufferAttribute={name:"BufferAttribute",getSchemaFrom:function(o){return m||function(o){const f=o.Schema,p=f.Types.Mixed,g=1,_=2,y=4,w=8,b={Int8Array:0,Uint8Array:1,Uint8ClampedArray:2,Int16Array:3,Uint16Array:4,Int32Array:5,Uint32Array:6,Float32Array:7,Float64Array:8,BigInt64Array:9,BigUint64Array:10};m=new f({array:{type:d,set:o=>{const m=o.length;let f=null,p=0;if(e(o)){f=d.allocUnsafe(g+m*g),p=f.writeUInt8(b.Int8Array,p);for(let e=0;e<m;e++)p=f.writeInt8(o[e],p)}else if(a(o)){f=d.allocUnsafe(g+m*g),p=f.writeUInt8(b.Uint8Array,p);for(let e=0;e<m;e++)p=f.writeUInt8(o[e],p)}else if(s(o)){f=d.allocUnsafe(g+m*g),p=f.writeUInt8(b.Uint8ClampedArray,p);for(let e=0;e<m;e++)p=f.writeUInt8(o[e],p)}else if(t(o)){f=d.allocUnsafe(g+m*_),p=f.writeUInt8(b.Int16Array,p);for(let e=0;e<m;e++)p=f.writeInt16BE(o[e],p)}else if(c(o)){f=d.allocUnsafe(g+m*_),p=f.writeUInt8(b.Uint16Array,p);for(let e=0;e<m;e++)p=f.writeUInt16BE(o[e],p)}else if(r(o)){f=d.allocUnsafe(g+m*y),p=f.writeUInt8(b.Int32Array,p);for(let e=0;e<m;e++)p=f.writeInt32BE(o[e],p)}else if(h(o)){f=d.allocUnsafe(g+m*y),p=f.writeUInt8(b.Uint32Array,p);for(let e=0;e<m;e++)p=f.writeUInt32BE(o[e],p)}else if(n(o)){f=d.allocUnsafe(g+m*y),p=f.writeUInt8(b.Float32Array,p);for(let e=0;e<m;e++)p=f.writeFloatBE(o[e],p)}else if(i(o)){f=d.allocUnsafe(g+m*w),p=f.writeUInt8(b.Float64Array,p);for(let e=0;e<m;e++)p=f.writeDoubleBE(o[e],p)}else if(l(o)){f=d.allocUnsafe(g+m*w),p=f.writeUInt8(b.BigInt64Array,p);for(let e=0;e<m;e++)p=f.writeDoubleBE(o[e],p)}else{if(!u(o))throw new Error("Unable to determine the array type to bufferize.");f=d.allocUnsafe(g+m*w),p=f.writeUInt8(b.BigUint64Array,p);for(let e=0;e<m;e++)p=f.writeDoubleBE(o[e],p)}return f}},count:Number,dynamic:Boolean,itemSize:Number,name:String,needsUpdate:Boolean,normalized:Boolean,updateRange:p,uuid:String,version:Number},{_id:!1,id:!1})}(o),m},getModelFrom:()=>null,registerModelTo:e=>e},Ir}();
/**
 * @module Schemas/Core/BufferGeometry
 * @desc Export the ThreeJs BufferGeometry Model and Schema for Mongoose.
 *
 * @requires {@link module:Schemas/Core/BufferAttribute Schemas/Core/BufferAttribute}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */let Ur,Rr;function Hr(e){return Ur||function(e){const t=e.Schema,r=t.Types,n=r.Mixed,i=r.Vector3,o=Nr.BufferAttribute.getSchemaFrom(e);Ur=new t({uuid:String,name:String,type:String,index:o,attributes:{position:o,normal:o,color:o,uv:o},groups:n,boundingBox:{min:i,max:i},boundingSphere:{center:i,radius:Number},drawRange:n},{collection:"geometries",discriminatorKey:"type"})}(e),Ur}function jr(e){Rr=e.model("BufferGeometries",Hr(e)),Rr.discriminator("BufferGeometry",new e.Schema({}))}const Vr={getSchemaFrom:Hr,getModelFrom:function(e){return Rr||jr(e),Rr},registerModelTo:function(e){return Rr||jr(e),e}};var Yr,Wr,$r=Object.freeze({__proto__:null,BufferGeometry:Vr}),Xr={},Zr={};function qr(){if(Yr)return Zr;let e,t;function r(t){return e||function(t){const r=t.Schema;e=new r({type:{type:String,default:"Curve"},arcLengthDivisions:Number},{collection:"curves",discriminatorKey:"type"})}(t),e}function n(e){t=e.model("Curves",r(e)),t.discriminator("Curve",new e.Schema({}))}return Yr=1,Zr.Curve={name:"Curve",getSchemaFrom:r,getModelFrom:function(e){return t||n(e),t},registerModelTo:function(e){return t||n(e),e}},Zr}
/**
 * @module Schemas/Core/CurvePath
 * @desc Export the ThreeJs CurvePath Model and Schema for Mongoose.
 *
 * @requires {@link module:Schemas/Curves/Curve Schemas/Curves/Curve}
 * @augments module:Schemas/Curves/Curve
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */var Kr,Qr=function(){if(Wr)return Xr;Wr=1;const{Curve:e}=qr();let t,r;function n(e){return t||function(e){const r=e.Schema,n=new r({type:{type:String,default:"Curve"},arcLengthDivisions:Number},{id:!1,_id:!1});t=new r({curves:[n],autoClose:{type:Boolean,default:!1}})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("CurvePath",n(t))}return Xr.CurvePath={name:"CurvePath",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Xr}(),Jr={};var en=function(){if(Kr)return Jr;let e;return Kr=1,Jr.Face3={name:"Face3",getSchemaFrom:function(t){return e||function(t){const r=t.Schema,n=r.Types,i=n.Color,o=n.Vector3;e=new r({a:Number,b:Number,c:Number,normal:o,vertexNormals:[Number],color:i,vertexColors:[Number],materialIndex:Number},{_id:!1,id:!1})}(t),e},getModelFrom:()=>null,registerModelTo:e=>e},Jr}();
/**
 * @module Schemas/Core/Geometry
 * @desc Export the ThreeJs Geometry Model and Schema for Mongoose.
 *
 * @requires {@link module:Schemas/Core/Face3 Schemas/Core/Face3}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */let tn,rn;function nn(e){return tn||function(e){const t=en.Face3.getSchemaFrom(e),r=e.Schema,n=r.Types.Vector3;tn=new r({uuid:String,name:String,type:String,vertices:[n],colors:[Number],faces:[t],faceVertexUvs:[[Number]],morphTargets:[Number],morphNormals:[Number],skinWeights:[Number],skinIndices:[Number],lineDistances:[Number],boundingBox:{min:n,max:n},boundingSphere:{center:n,radius:Number},elementsNeedUpdate:Boolean,verticesNeedUpdate:Boolean,uvsNeedUpdate:Boolean,normalsNeedUpdate:Boolean,colorsNeedUpdate:Boolean,lineDistancesNeedUpdate:Boolean,groupsNeedUpdate:Boolean},{collection:"geometries",discriminatorKey:"type"})}(e),tn}function on(e){rn=e.model("Geometries",nn(e)),rn.discriminator("Geometry",new e.Schema({}))}const an={name:"Geometry",getSchemaFrom:nn,getModelFrom:function(e){return rn||on(e),rn},registerModelTo:function(e){return rn||on(e),e}};var sn,cn=Object.freeze({__proto__:null,Geometry:an}),hn={};var ln,un=function(){if(sn)return hn;sn=1;const{Curve:e}=qr();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Vector2,i=new r({type:{type:String,default:"Curve"},arcLengthDivisions:Number},{id:!1,_id:!1});t=new r({curves:[i],autoClose:{type:Boolean,default:!1},currentPoint:n})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("Path",n(t))}return hn.Path={name:"Path",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},hn}(),dn={};var mn,fn=function(){if(ln)return dn;ln=1;const{Curve:e}=qr();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Vector2,i=new r({type:{type:String,default:"Curve"},arcLengthDivisions:Number},{id:!1,_id:!1}),o=new r({curves:[i],autoClose:{type:Boolean,default:!1},currentPoint:n},{id:!1,_id:!1});t=new r({curves:[i],autoClose:{type:Boolean,default:!1},currentPoint:n,uuid:String,holes:[o]})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("Shape",n(t))}return dn.Shape={name:"Shape",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},dn}(),pn={};var gn,_n=function(){if(mn)return pn;mn=1;const{Curve:e}=qr();let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({aX:Number,aY:Number,xRadius:Number,yRadius:Number,aStartAngle:Number,aEndAngle:Number,aClockwise:Boolean,aRotation:Number})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("ArcCurve",n(t))}return pn.ArcCurve={name:"ArcCurve",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},pn}(),yn={};var wn,bn=function(){if(gn)return yn;gn=1;const{Curve:e}=qr();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Vector3;t=new r({points:[n],closed:Boolean,curveType:String,tension:Number})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("CatmullRomCurve3",n(t))}return yn.CatmullRomCurve3={name:"CatmullRomCurve3",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},yn}(),Mn={};var Sn,vn=function(){if(wn)return Mn;wn=1;const{Curve:e}=qr();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Vector2;t=new r({v0:n,v1:n,v2:n,v3:n})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("CubicBezierCurve",n(t))}return Mn.CubicBezierCurve={name:"CubicBezierCurve",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Mn}(),xn={};var Fn,Tn=function(){if(Sn)return xn;Sn=1;const{Curve:e}=qr();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Vector3;t=new r({v0:n,v1:n,v2:n,v3:n})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("CubicBezierCurve3",n(t))}return xn.CubicBezierCurve3={name:"CubicBezierCurve3",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},xn}(),Cn=qr(),Bn={};var En,Pn=function(){if(Fn)return Bn;Fn=1;const{Curve:e}=qr();let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("CurveExtras",n(t))}return Bn.CurveExtras={name:"CurveExtras",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Bn}(),Dn={};var On,An=function(){if(En)return Dn;En=1;const{Curve:e}=qr();let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({aX:Number,aY:Number,xRadius:Number,yRadius:Number,aStartAngle:Number,aEndAngle:Number,aClockwise:Boolean,aRotation:Number})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("EllipseCurve",n(t))}return Dn.EllipseCurve={name:"EllipseCurve",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Dn}(),Gn={};var In,zn=function(){if(On)return Gn;On=1;const{Curve:e}=qr();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Vector2;t=new r({v0:n,v1:n})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("LineCurve",n(t))}return Gn.LineCurve={name:"LineCurve",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Gn}(),Ln={};var kn,Nn=function(){if(In)return Ln;In=1;const{Curve:e}=qr();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Vector3;t=new r({v0:n,v1:n})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("LineCurve3",n(t))}return Ln.LineCurve3={name:"LineCurve3",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Ln}(),Un={};var Rn,Hn=function(){if(kn)return Un;kn=1;const{Curve:e}=qr();let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("NURBSCurve",n(t))}return Un.NURBSCurve={name:"NURBSCurve",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Un}(),jn={};var Vn,Yn=function(){if(Rn)return jn;Rn=1;const{Curve:e}=qr();let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("NURBSSurface",n(t))}return jn.NURBSSurface={name:"NURBSSurface",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},jn}(),Wn={};var $n,Xn=function(){if(Vn)return Wn;Vn=1;const{Curve:e}=qr();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Vector2;t=new r({v0:n,v1:n,v2:n})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("QuadraticBezierCurve",n(t))}return Wn.QuadraticBezierCurve={name:"QuadraticBezierCurve",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Wn}(),Zn={};var qn,Kn=function(){if($n)return Zn;$n=1;const{Curve:e}=qr();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Vector3;t=new r({v0:n,v1:n,v2:n})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("QuadraticBezierCurve3",n(t))}return Zn.QuadraticBezierCurve3={name:"QuadraticBezierCurve3",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Zn}(),Qn={};var Jn,ei=function(){if(qn)return Qn;qn=1;const{Curve:e}=qr();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Vector3;t=new r({points:[n]})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("SplineCurve",n(t))}return Qn.SplineCurve={name:"SplineCurve",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Qn}(),ti={},ri=cr($r);var ni,ii=function(){if(Jn)return ti;Jn=1;const{BufferGeometry:e}=ri;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("BoxBufferGeometry",n(t))}return ti.BoxBufferGeometry={name:"BoxBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},ti}(),oi={},ai=cr(cn);var si,ci=function(){if(ni)return oi;ni=1;const{Geometry:e}=ai;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("BoxGeometry",n(t))}return oi.BoxGeometry={name:"BoxGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},oi}(),hi={};var li,ui=function(){if(si)return hi;si=1;const{BufferGeometry:e}=ri;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("CircleBufferGeometry",n(t))}return hi.CircleBufferGeometry={name:"CircleBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},hi}(),di={};var mi,fi=function(){if(li)return di;li=1;const{Geometry:e}=ai;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("CircleGeometry",n(t))}return di.CircleGeometry={name:"CircleGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},di}(),pi={};var gi,_i=function(){if(mi)return pi;mi=1;const{BufferGeometry:e}=ri;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("ConeBufferGeometry",n(t))}return pi.ConeBufferGeometry={name:"ConeBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},pi}(),yi={};var wi,bi=function(){if(gi)return yi;gi=1;const{Geometry:e}=ai;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("ConeGeometry",n(t))}return yi.ConeGeometry={name:"ConeGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},yi}(),Mi={};var Si,vi=function(){if(wi)return Mi;wi=1;const{Geometry:e}=ai;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("ConvexGeometry",n(t))}return Mi.ConvexGeometry={name:"ConvexGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Mi}(),xi={};var Fi,Ti=function(){if(Si)return xi;Si=1;const{BufferGeometry:e}=ri;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("CylinderBufferGeometry",n(t))}return xi.CylinderBufferGeometry={name:"CylinderBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},xi}(),Ci={};var Bi,Ei=function(){if(Fi)return Ci;Fi=1;const{Geometry:e}=ai;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("CylinderGeometry",n(t))}return Ci.CylinderGeometry={name:"CylinderGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Ci}(),Pi={};var Di,Oi=function(){if(Bi)return Pi;Bi=1;const{Geometry:e}=ai;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("DecalGeometry",n(t))}return Pi.DecalGeometry={name:"DecalGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Pi}(),Ai={};var Gi,Ii=function(){if(Di)return Ai;Di=1;const{Geometry:e}=ai;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("DodecahedronGeometry",n(t))}return Ai.DodecahedronGeometry={name:"DodecahedronGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Ai}(),zi={};var Li,ki=function(){if(Gi)return zi;Gi=1;const{Geometry:e}=ai;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("EdgesGeometry",n(t))}return zi.EdgesGeometry={name:"EdgesGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},zi}(),Ni={};var Ui,Ri=function(){if(Li)return Ni;Li=1;const{BufferGeometry:e}=ri;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("ExtrudeBufferGeometry",n(t))}return Ni.ExtrudeBufferGeometry={name:"ExtrudeBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Ni}(),Hi={};var ji,Vi=function(){if(Ui)return Hi;Ui=1;const{Geometry:e}=ai;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("ExtrudeGeometry",n(t))}return Hi.ExtrudeGeometry={name:"ExtrudeGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Hi}(),Yi={};var Wi,$i=function(){if(ji)return Yi;ji=1;const{BufferGeometry:e}=ri;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("IcosahedronBufferGeometry",n(t))}return Yi.IcosahedronBufferGeometry={name:"IcosahedronBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Yi}(),Xi={};var Zi,qi=function(){if(Wi)return Xi;Wi=1;const{Geometry:e}=ai;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("IcosahedronGeometry",n(t))}return Xi.IcosahedronGeometry={name:"IcosahedronGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Xi}(),Ki={};var Qi,Ji=function(){if(Zi)return Ki;Zi=1;const{BufferGeometry:e}=ri;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("InstancedBufferGeometry",n(t))}return Ki.InstancedBufferGeometry={name:"InstancedBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Ki}(),eo={};var to,ro=function(){if(Qi)return eo;Qi=1;const{BufferGeometry:e}=ri;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("LatheBufferGeometry",n(t))}return eo.LatheBufferGeometry={name:"LatheBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},eo}(),no={};var io,oo=function(){if(to)return no;to=1;const{Geometry:e}=ai;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("LatheGeometry",n(t))}return no.LatheGeometry={name:"LatheGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},no}(),ao={};var so,co=function(){if(io)return ao;io=1;const{BufferGeometry:e}=ri;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("OctahedronBufferGeometry",n(t))}return ao.OctahedronBufferGeometry={name:"OctahedronBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},ao}(),ho={};var lo,uo=function(){if(so)return ho;so=1;const{Geometry:e}=ai;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("OctahedronGeometry",n(t))}return ho.OctahedronGeometry={name:"OctahedronGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},ho}(),mo={};var fo,po=function(){if(lo)return mo;lo=1;const{BufferGeometry:e}=ri;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("ParametricBufferGeometry",n(t))}return mo.ParametricBufferGeometry={name:"ParametricBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},mo}(),go={};var _o,yo=function(){if(fo)return go;fo=1;const{Geometry:e}=ai;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("ParametricGeometry",n(t))}return go.ParametricGeometry={name:"ParametricGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},go}(),wo={};var bo,Mo=function(){if(_o)return wo;_o=1;const{BufferGeometry:e}=ri;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("PlaneBufferGeometry",n(t))}return wo.PlaneBufferGeometry={name:"PlaneBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},wo}(),So={};var vo,xo=function(){if(bo)return So;bo=1;const{Geometry:e}=ai;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("PlaneGeometry",n(t))}return So.PlaneGeometry={name:"PlaneGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},So}(),Fo={};var To,Co=function(){if(vo)return Fo;vo=1;const{BufferGeometry:e}=ri;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("PolyhedronBufferGeometry",n(t))}return Fo.PolyhedronBufferGeometry={name:"PolyhedronBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Fo}(),Bo={};var Eo,Po=function(){if(To)return Bo;To=1;const{Geometry:e}=ai;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("PolyhedronGeometry",n(t))}return Bo.PolyhedronGeometry={name:"PolyhedronGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Bo}(),Do={};var Oo,Ao=function(){if(Eo)return Do;Eo=1;const{BufferGeometry:e}=ri;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("RingBufferGeometry",n(t))}return Do.RingBufferGeometry={name:"RingBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Do}(),Go={};var Io,zo=function(){if(Oo)return Go;Oo=1;const{Geometry:e}=ai;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("RingGeometry",n(t))}return Go.RingGeometry={name:"RingGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Go}(),Lo={};var ko,No=function(){if(Io)return Lo;Io=1;const{BufferGeometry:e}=ri;let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Vector2,i=new r({type:{type:String,default:"Curve"},arcLengthDivisions:Number},{id:!1,_id:!1}),o=new r({curves:[i],autoClose:{type:Boolean,default:!1},currentPoint:n},{id:!1,_id:!1}),a=new r({curves:[i],autoClose:{type:Boolean,default:!1},currentPoint:n,uuid:String,holes:[o]},{id:!1,_id:!1});t=new r({shapes:[a],curveSegments:Number})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("ShapeBufferGeometry",n(t))}return Lo.ShapeBufferGeometry={name:"ShapeBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Lo}(),Uo={};var Ro,Ho=function(){if(ko)return Uo;ko=1;const{Geometry:e}=ai;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("ShapeGeometry",n(t))}return Uo.ShapeGeometry={name:"ShapeGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Uo}(),jo={};var Vo,Yo=function(){if(Ro)return jo;Ro=1;const{BufferGeometry:e}=ri;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("SphereBufferGeometry",n(t))}return jo.SphereBufferGeometry={name:"SphereBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},jo}(),Wo={};var $o,Xo=function(){if(Vo)return Wo;Vo=1;const{Geometry:e}=ai;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("SphereGeometry",n(t))}return Wo.SphereGeometry={name:"SphereGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Wo}(),Zo={};var qo,Ko=function(){if($o)return Zo;$o=1;const{BufferGeometry:e}=ri;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("TeapotBufferGeometry",n(t))}return Zo.TeapotBufferGeometry={name:"TeapotBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Zo}(),Qo={};var Jo,ea=function(){if(qo)return Qo;qo=1;const{BufferGeometry:e}=ri;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("TetrahedronBufferGeometry",n(t))}return Qo.TetrahedronBufferGeometry={name:"TetrahedronBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Qo}(),ta={};var ra,na=function(){if(Jo)return ta;Jo=1;const{Geometry:e}=ai;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("TetrahedronGeometry",n(t))}return ta.TetrahedronGeometry={name:"TetrahedronGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},ta}(),ia={};var oa,aa=function(){if(ra)return ia;ra=1;const{BufferGeometry:e}=ri;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("TextBufferGeometry",n(t))}return ia.TextBufferGeometry={name:"TextBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},ia}(),sa={};var ca,ha=function(){if(oa)return sa;oa=1;const{Geometry:e}=ai;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("TextGeometry",n(t))}return sa.TextGeometry={name:"TextGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},sa}(),la={};var ua,da=function(){if(ca)return la;ca=1;const{BufferGeometry:e}=ri;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("TorusBufferGeometry",n(t))}return la.TorusBufferGeometry={name:"TorusBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},la}(),ma={};var fa,pa=function(){if(ua)return ma;ua=1;const{Geometry:e}=ai;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("TorusGeometry",n(t))}return ma.TorusGeometry={name:"TorusGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},ma}(),ga={};var _a,ya=function(){if(fa)return ga;fa=1;const{BufferGeometry:e}=ri;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("TorusKnotBufferGeometry",n(t))}return ga.TorusKnotBufferGeometry={name:"TorusKnotBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},ga}(),wa={};var ba,Ma=function(){if(_a)return wa;_a=1;const{Geometry:e}=ai;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("TorusKnotGeometry",n(t))}return wa.TorusKnotGeometry={name:"TorusKnotGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},wa}(),Sa={};var va,xa=function(){if(ba)return Sa;ba=1;const{BufferGeometry:e}=ri;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("TubeBufferGeometry",n(t))}return Sa.TubeBufferGeometry={name:"TubeBufferGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Sa}(),Fa={};var Ta,Ca=function(){if(va)return Fa;va=1;const{Geometry:e}=ai;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("TubeGeometry",n(t))}return Fa.TubeGeometry={name:"TubeGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Fa}(),Ba={};var Ea,Pa=function(){if(Ta)return Ba;Ta=1;const{Geometry:e}=ai;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("WireframeGeometry",n(t))}return Ba.WireframeGeometry={name:"WireframeGeometry",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Ba}(),Da={};var Oa,Aa=function(){if(Ea)return Da;Ea=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("ArrowHelper",n(t))}return Da.ArrowHelper={name:"ArrowHelper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Da}(),Ga={};var Ia,za=function(){if(Oa)return Ga;Oa=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("AxesHelper",n(t))}return Ga.AxesHelper={name:"AxesHelper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Ga}(),La={};var ka,Na=function(){if(Ia)return La;Ia=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("Box3Helper",n(t))}return La.Box3Helper={name:"Box3Helper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},La}(),Ua={};var Ra,Ha=function(){if(ka)return Ua;ka=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("BoxHelper",n(t))}return Ua.BoxHelper={name:"BoxHelper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Ua}(),ja={};var Va,Ya=function(){if(Ra)return ja;Ra=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("CameraHelper",n(t))}return ja.CameraHelper={name:"CameraHelper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},ja}(),Wa={};var $a,Xa=function(){if(Va)return Wa;Va=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("DirectionalLightHelper",n(t))}return Wa.DirectionalLightHelper={name:"DirectionalLightHelper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Wa}(),Za={};var qa,Ka=function(){if($a)return Za;$a=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("FaceNormalsHelper",n(t))}return Za.FaceNormalsHelper={name:"FaceNormalsHelper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Za}(),Qa={};var Ja,es=function(){if(qa)return Qa;qa=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("GridHelper",n(t))}return Qa.GridHelper={name:"GridHelper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Qa}(),ts={};var rs,ns=function(){if(Ja)return ts;Ja=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("HemisphereLightHelper",n(t))}return ts.HemisphereLightHelper={name:"HemisphereLightHelper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},ts}(),is={};var os,as=function(){if(rs)return is;rs=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("PlaneHelper",n(t))}return is.PlaneHelper={name:"PlaneHelper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},is}(),ss={};var cs,hs=function(){if(os)return ss;os=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("PointLightHelper",n(t))}return ss.PointLightHelper={name:"PointLightHelper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},ss}(),ls={};var us,ds=function(){if(cs)return ls;cs=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("PolarGridHelper",n(t))}return ls.PolarGridHelper={name:"PolarGridHelper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},ls}(),ms={};var fs,ps=function(){if(us)return ms;us=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("RectAreaLightHelper",n(t))}return ms.RectAreaLightHelper={name:"RectAreaLightHelper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},ms}(),gs={};var _s,ys=function(){if(fs)return gs;fs=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("SkeletonHelper",n(t))}return gs.SkeletonHelper={name:"SkeletonHelper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},gs}(),ws={};var bs,Ms=function(){if(_s)return ws;_s=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("SpotLightHelper",n(t))}return ws.SpotLightHelper={name:"SpotLightHelper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},ws}(),Ss={};var vs,xs=function(){if(bs)return Ss;bs=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("VertexNormalsHelper",n(t))}return Ss.VertexNormalsHelper={name:"VertexNormalsHelper",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Ss}(),Fs={};var Ts,Cs=function(){if(vs)return Fs;vs=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("AmbientLight",n(t))}return Fs.AmbientLight={name:"AmbientLight",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Fs}(),Bs={};var Es,Ps=function(){if(Ts)return Bs;Ts=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("DirectionalLight",n(t))}return Bs.DirectionalLight={name:"DirectionalLight",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Bs}(),Ds={};var Os,As=function(){if(Es)return Ds;Es=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("HemisphereLight",n(t))}return Ds.HemisphereLight={name:"HemisphereLight",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Ds}(),Gs={};var Is,zs=function(){if(Os)return Gs;Os=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("Light",n(t))}return Gs.Light={name:"Light",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Gs}(),Ls={};var ks,Ns=function(){if(Is)return Ls;Is=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("PointLight",n(t))}return Ls.PointLight={name:"PointLight",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Ls}(),Us={};var Rs,Hs=function(){if(ks)return Us;ks=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("RectAreaLight",n(t))}return Us.RectAreaLight={name:"RectAreaLight",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Us}(),js={};var Vs,Ys,Ws=function(){if(Rs)return js;Rs=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("SpotLight",n(t))}return js.SpotLight={name:"SpotLight",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},js}(),$s={},Xs={};function Zs(){if(Vs)return Xs;let e,t;function r(t){return e||function(t){const r=t.Schema,n=r.Types.Mixed;e=new r({uuid:String,name:String,type:String,fog:Boolean,lights:Boolean,blending:Number,side:Number,flatShading:Boolean,vertexColors:Number,opacity:Number,transparent:Boolean,blendSrc:Number,blendDst:Number,blendEquation:Number,blendSrcAlpha:String,blendDstAlpha:String,blendEquationAlpha:String,depthFunc:Number,depthTest:Boolean,depthWrite:Boolean,clippingPlanes:n,clipIntersection:Boolean,clipShadows:Boolean,colorWrite:Boolean,precision:Number,polygonOffset:Boolean,polygonOffsetFactor:Number,polygonOffsetUnits:Number,dithering:Boolean,alphaTest:Number,premultipliedAlpha:Boolean,overdraw:Number,visible:Boolean,userData:n,needsUpdate:Boolean},{collection:"materials",discriminatorKey:"type"})}(t),e}function n(e){t=e.model("Materials",r(e)),t.discriminator("Material",new e.Schema({}))}return Vs=1,Xs.Material={name:"Material",getSchemaFrom:r,getModelFrom:function(e){return t||n(e),t},registerModelTo:function(e){return t||n(e),e}},Xs}
/**
 * @module Schemas/Materials/LineBasicMaterial
 * @desc Export the ThreeJs LineBasicMaterial Model and Schema for Mongoose.
 *
 * @requires {@link module:Schemas/Materials/Material Schemas/Materials/Material}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */var qs,Ks=function(){if(Ys)return $s;Ys=1;const{Material:e}=Zs();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Color;t=new r({color:n,light:Boolean,lineWidth:Number,linecap:String,linejoin:String})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("LineBasicMaterial",n(t))}return $s.LineBasicMaterial={name:"LineBasicMaterial",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},$s}(),Qs={};var Js,ec=function(){if(qs)return Qs;qs=1;const{Material:e}=Zs();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Color;t=new r({color:n,light:Boolean,lineWidth:Number,linecap:String,linejoin:String,dashSize:Number,gapSize:Number,scale:Number})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("LineDashedMaterial",n(t))}return Qs.LineDashedMaterial={name:"LineDashedMaterial",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Qs}(),tc=Zs(),rc={};var nc,ic=function(){if(Js)return rc;Js=1;const{Material:e}=Zs();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types,i=n.Mixed,o=n.Color;t=new r({color:o,map:i,lightMap:i,lightMapIntensity:Number,aoMap:i,aoMapIntensity:Number,specularMap:i,alphaMap:i,envMap:i,combine:Number,reflectivity:Number,refractionRatio:Number,wireframe:Boolean,wireframeLinewidth:Number,wireframeLinecap:String,wireframeLinejoin:String,skinning:Boolean,morphTargets:Boolean,light:Boolean})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("MeshBasicMaterial",n(t))}return rc.MeshBasicMaterial={name:"MeshBasicMaterial",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},rc}(),oc={};var ac,sc=function(){if(nc)return oc;nc=1;const{Material:e}=Zs();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Mixed;t=new r({depthPacking:Number,skinning:Boolean,morphTargets:Boolean,map:n,alphaMap:n,displacementMap:n,displacementScale:Number,displacementBias:Number,wireframe:Boolean,wireframeLinewidth:Number,fog:Boolean,light:Boolean})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("MeshDepthMaterial",n(t))}return oc.MeshDepthMaterial={name:"MeshDepthMaterial",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},oc}(),cc={};var hc,lc=function(){if(ac)return cc;ac=1;const{Material:e}=Zs();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types,i=n.Color,o=n.Mixed;t=new r({color:i,map:o,lightMap:o,lightMapIntensity:Number,aoMap:o,aoMapIntensity:Number,emissive:i,emissiveIntensity:Number,emissiveMap:o,specularMap:o,alphaMap:o,envMap:o,combine:Number,reflectivity:Number,refractionRatio:Number,wireframe:Boolean,wireframeLinewidth:Number,wireframeLinecap:String,wireframeLinejoin:String,skinning:Boolean,morphTargets:Boolean,morphNormals:Boolean})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("MeshLambertMaterial",n(t))}return cc.MeshLambertMaterial={name:"MeshLambertMaterial",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},cc}(),uc={};var dc,mc=function(){if(hc)return uc;hc=1;const{Material:e}=Zs();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types,i=n.Mixed,o=n.Vector2;t=new r({bumpMap:i,bumpScale:Number,normalMap:i,normalScale:o,displacementMap:i,displacementScale:Number,displacementBias:Number,wireframe:Boolean,wireframeLinewidth:Number,fog:Boolean,light:Boolean,skinning:Boolean,morphTargets:Boolean,morphNormals:Boolean})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("MeshNormalMaterial",n(t))}return uc.MeshNormalMaterial={name:"MeshNormalMaterial",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},uc}(),fc={};var pc,gc=function(){if(dc)return fc;dc=1;const{Material:e}=Zs();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types,i=n.Mixed,o=n.Color,a=n.Vector2;t=new r({color:o,specular:o,shininess:Number,map:i,lightMap:i,lightMapIntensity:Number,aoMap:i,aoMapIntensity:Number,emissive:o,emissiveIntensity:Number,emissiveMap:i,bumpMap:i,bumpScale:Number,normalMap:i,normalScale:a,displacementMap:i,displacementScale:Number,displacementBias:Number,specularMap:i,alphaMap:i,envMap:i,combine:Number,reflectivity:Number,refractionRatio:Number,wireframe:Boolean,wireframeLinewidth:Number,wireframeLinecap:String,wireframeLinejoin:String,skinning:Boolean,morphTargets:Boolean,morphNormals:Boolean})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("MeshPhongMaterial",n(t))}return fc.MeshPhongMaterial={name:"MeshPhongMaterial",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},fc}(),_c={};var yc,wc=function(){if(pc)return _c;pc=1;const{Material:e}=Zs();let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({reflectivity:Number,clearCoat:Number,clearCoatRoughness:Number})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("MeshPhysicalMaterial",n(t))}return _c.MeshPhysicalMaterial={name:"MeshPhysicalMaterial",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},_c}(),bc={};var Mc,Sc=function(){if(yc)return bc;yc=1;const{Material:e}=Zs();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types,i=n.Mixed,o=n.Color,a=n.Vector2;t=new r({color:o,roughness:Number,metalness:Number,map:i,lightMap:i,lightMapIntensity:Number,aoMap:i,aoMapIntensity:Number,emissive:o,emissiveIntensity:Number,emissiveMap:i,bumpMap:i,bumpScale:Number,normalMap:i,normalScale:a,displacementMap:i,displacementScale:Number,displacementBias:Number,roughnessMap:i,metalnessMap:i,alphaMap:i,envMap:i,envMapIntensity:Number,refractionRatio:Number,wireframe:Boolean,wireframeLinewidth:Number,wireframeLinecap:String,wireframeLinejoin:String,skinning:Boolean,morphTargets:Boolean,morphNormals:Boolean})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("MeshStandardMaterial",n(t))}return bc.MeshStandardMaterial={name:"MeshStandardMaterial",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},bc}(),vc={};var xc,Fc=function(){if(Mc)return vc;Mc=1;const{Material:e}=Zs();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types,i=n.Mixed,o=n.Color,a=n.Vector2;t=new r({color:o,specular:o,shininess:Number,map:i,lightMap:i,lightMapIntensity:Number,aoMap:i,aoMapIntensity:Number,emissive:o,emissiveIntensity:Number,emissiveMap:i,bumpMap:i,bumpScale:Number,normalMap:i,normalScale:a,displacementMap:i,displacementScale:Number,displacementBias:Number,specularMap:i,alphaMap:i,envMap:i,combine:Number,reflectivity:Number,refractionRatio:Number,wireframe:Boolean,wireframeLinewidth:Number,wireframeLinecap:String,wireframeLinejoin:String,skinning:Boolean,morphTargets:Boolean,morphNormals:Boolean,gradientMap:i})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("MeshToonMaterial",n(t))}return vc.MeshToonMaterial={name:"MeshToonMaterial",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},vc}(),Tc={};var Cc,Bc=function(){if(xc)return Tc;xc=1;const{Material:e}=Zs();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types,i=n.Color,o=n.Mixed;t=new r({color:i,map:o,size:Number,sizeAttenuation:Boolean,lights:Boolean})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("PointsMaterial",n(t))}return Tc.PointsMaterial={name:"PointsMaterial",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Tc}(),Ec={};var Pc,Dc=function(){if(Cc)return Ec;Cc=1;const{Material:e}=Zs();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Mixed;t=new r({defines:n,uniforms:n,vertexShader:String,fragmentShader:String,linewidth:Number,wireframe:Boolean,wireframeLinewidth:Number,fog:Boolean,light:Boolean,clipping:Boolean,skinning:Boolean,morphTargets:Boolean,morphNormals:Boolean,derivatives:Boolean,fragDepth:Boolean,drawBuffers:Boolean,shaderTextureLOD:Boolean})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("RawShaderMaterial",n(t))}return Ec.RawShaderMaterial={name:"RawShaderMaterial",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Ec}(),Oc={};var Ac,Gc=function(){if(Pc)return Oc;Pc=1;const{Material:e}=Zs();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Mixed;t=new r({defines:n,uniforms:n,vertexShader:String,fragmentShader:String,linewidth:Number,wireframe:Boolean,wireframeLinewidth:Number,fog:Boolean,light:Boolean,clipping:Boolean,skinning:Boolean,morphTargets:Boolean,morphNormals:Boolean,derivatives:Boolean,fragDepth:Boolean,drawBuffers:Boolean,shaderTextureLOD:Boolean})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("ShaderMaterial",n(t))}return Oc.ShaderMaterial={name:"ShaderMaterial",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Oc}(),Ic={};var zc,Lc=function(){if(Ac)return Ic;Ac=1;const{Material:e}=Zs();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Color;t=new r({color:n,opacity:Number,lights:Boolean,transparent:Boolean})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("ShadowMaterial",n(t))}return Ic.ShadowMaterial={name:"ShadowMaterial",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Ic}(),kc={};var Nc,Uc=function(){if(zc)return kc;zc=1;const{Material:e}=Zs();let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types,i=n.Color,o=n.Mixed;t=new r({color:i,map:o,rotation:Number,fog:Boolean,lights:Boolean})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("SpriteMaterial",n(t))}return kc.SpriteMaterial={name:"SpriteMaterial",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},kc}(),Rc={};var Hc,jc=function(){if(Nc)return Rc;let e;return Nc=1,Rc.Box2={name:"Box2",getSchemaFrom:function(t){return e||function(t){const r=t.Schema,n=r.Types.Vector2;e=new r({min:n,max:n},{_id:!1,id:!1})}(t),e},getModelFrom:()=>null,registerModelTo:e=>e},Rc}(),Vc={};var Yc,Wc=function(){if(Hc)return Vc;let e;return Hc=1,Vc.Box3={name:"Box3",getSchemaFrom:function(t){return e||function(t){const r=t.Schema,n=r.Types.Vector3;e=new r({min:n,max:n},{_id:!1,id:!1})}(t),e},getModelFrom:()=>null,registerModelTo:e=>e},Vc}(),$c={};var Xc,Zc=function(){if(Yc)return $c;let e;return Yc=1,$c.Line3={name:"Line3",getSchemaFrom:function(t){return e||function(t){const r=t.Schema,n=r.Types.Vector3;e=new r({start:n,end:n},{_id:!1,id:!1})}(t),e},getModelFrom:()=>null,registerModelTo:e=>e},$c}(),qc={};var Kc,Qc=function(){if(Xc)return qc;let e;return Xc=1,qc.Plane={name:"Plane",getSchemaFrom:function(t){return e||function(t){const r=t.Schema,n=r.Types.Vector3;e=new r({normal:n,constant:Number},{_id:!1,id:!1})}(t),e},getModelFrom:()=>null,registerModelTo:e=>e},qc}(),Jc={};var eh,th=function(){if(Kc)return Jc;let e;return Kc=1,Jc.Ray={name:"Ray",getSchemaFrom:function(t){return e||function(t){const r=t.Schema,n=r.Types.Vector3;e=new r({origin:n,direction:n},{_id:!1,id:!1})}(t),e},getModelFrom:()=>null,registerModelTo:e=>e},Jc}(),rh={};var nh,ih=function(){if(eh)return rh;let e;return eh=1,rh.Sphere={name:"Sphere",getSchemaFrom:function(t){return e||function(t){const r=t.Schema,n=r.Types.Vector3;e=new r({center:n,radius:Number},{_id:!1,id:!1})}(t),e},getModelFrom:()=>null,registerModelTo:e=>e},rh}(),oh={};var ah,sh=function(){if(nh)return oh;let e;return nh=1,oh.Spherical={name:"Spherical",getSchemaFrom:function(t){return e||function(t){const r=t.Schema;e=new r({radius:Number,phi:Number,theta:Number},{_id:!1,id:!1})}(t),e},getModelFrom:()=>null,registerModelTo:e=>e},oh}(),ch={};var hh,lh=function(){if(ah)return ch;let e;return ah=1,ch.Triangle={name:"Triangle",getSchemaFrom:function(t){return e||function(t){const r=t.Schema,n=r.Types.Vector3;e=new r({a:n,b:n,c:n},{_id:!1,id:!1})}(t),e},getModelFrom:()=>null,registerModelTo:e=>e},ch}(),uh={};var dh=function(){if(hh)return uh;hh=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("Bone",n(t))}return uh.Bone={name:"Bone",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},uh}();
/**
 * @module Schemas/Objects/Group
 * @desc Export the ThreeJs Group Model and Schema for Mongoose.
 *
 * @requires {@link module:Schemas/Core/Object3D Schemas/Core/Object3D}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */let mh,fh;function ph(e){return mh||function(e){const t=e.Schema;mh=new t({})}(e),mh}function gh(e){const t=lr.getModelFrom(e);fh=t.discriminator("Group",ph(e))}const _h={name:"Group",getSchemaFrom:ph,getModelFrom:function(e){return fh||gh(e),fh},registerModelTo:function(e){return fh||gh(e),e}};var yh,wh={};
/**
 * @module Schemas/Objects/ImmediateRenderObject
 * @desc Export the ThreeJs ImmediateRenderObject Model and Schema for Mongoose.
 *
 * @requires {@link module:Schemas/Core/Object3D Schemas/Core/Object3D}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */var bh,Mh=function(){if(yh)return wh;yh=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("ImmediateRenderObject",n(t))}return wh.ImmediateRenderObject={name:"ImmediateRenderObject",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},wh}(),Sh={};var vh,xh=function(){if(bh)return Sh;bh=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types,i=n.ObjectId,o=n.Color,a=n.Vector3;t=new r({lensFlares:[{texture:i,size:Number,distance:Number,x:Number,y:Number,z:Number,scale:Number,rotation:Number,opacity:Number,color:o,blending:Number}],positionScreen:a})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("LensFlare",n(t))}return Sh.LensFlare={name:"LensFlare",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Sh}(),Fh={};var Th,Ch=function(){if(vh)return Fh;vh=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.ObjectId;t=new r({geometry:{type:n,ref:"Geometry"},material:[{type:n,ref:"LineBasicMaterial"}],drawMode:Number})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("Line",n(t))}return Fh.Line={name:"Line",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Fh}(),Bh={};var Eh,Ph=function(){if(Th)return Bh;Th=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.ObjectId;t=new r({geometry:{type:n,ref:"Geometry"},material:[{type:n,ref:"LineBasicMaterial"}],drawMode:Number})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("LineLoop",n(t))}return Bh.LineLoop={name:"LineLoop",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Bh}(),Dh={};var Oh,Ah=function(){if(Eh)return Dh;Eh=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.ObjectId;t=new r({geometry:{type:n,ref:"Geometry"},material:[{type:n,ref:"LineBasicMaterial"}],drawMode:Number})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("LineSegments",n(t))}return Dh.LineSegments={name:"LineSegments",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Dh}(),Gh={};var Ih,zh=function(){if(Oh)return Gh;Oh=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.Mixed;t=new r({levels:[n]})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("LOD",n(t))}return Gh.LOD={name:"LOD",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Gh}(),Lh={};var kh,Nh=function(){if(Ih)return Lh;Ih=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.ObjectId;t=new r({geometry:{type:n,ref:"Geometry"},material:[{type:n,ref:"Material"}],drawMode:Number})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("Mesh",n(t))}return Lh.Mesh={name:"Mesh",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Lh}(),Uh={};var Rh,Hh=function(){if(kh)return Uh;kh=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.ObjectId;t=new r({geometry:{type:n,ref:"Geometry"},material:[{type:n,ref:"PointsMaterial"}],drawMode:Number})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("Points",n(t))}return Uh.Points={name:"Points",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Uh}(),jh={};var Vh,Yh=function(){if(Rh)return jh;Rh=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.ObjectId;t=new r({bones:[n],boneMatrices:[Number]})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("Skeleton",n(t))}return jh.Skeleton={name:"Skeleton",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},jh}(),Wh={};var $h,Xh=function(){if(Vh)return Wh;Vh=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.ObjectId;t=new r({geometry:{type:n,ref:"Geometry"},material:[{type:n,ref:"Material"}],drawMode:Number,bindMode:String,bindMatrix:[Number],bindMatrixInverse:[Number]})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("SkinnedMesh",n(t))}return Wh.SkinnedMesh={name:"SkinnedMesh",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Wh}(),Zh={};var qh,Kh=function(){if($h)return Zh;$h=1;const{Object3D:e}=dr;let t,r;function n(e){return t||function(e){const r=e.Schema,n=r.Types.ObjectId;t=new r({material:[{type:n,ref:"SpriteMaterial"}]})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("Sprite",n(t))}return Zh.Sprite={name:"Sprite",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},Zh}(),Qh={};function Jh(){if(qh)return Qh;qh=1;const{Buffer:e}=Lr();let t;return Qh.Fog={name:"Fog",getSchemaFrom:function(r){return t||function(r){const n=r.Schema;t=new n({coordinates:{x:Number,y:Number,z:Number},orientation:{x:Number,y:Number,z:Number},thumbnail:e,path:String},{_id:!1,id:!1})}(r),t},getModelFrom:()=>null,registerModelTo:e=>e},Qh}var el,tl=Jh(),rl={};var nl,il,ol=function(){if(el)return rl;el=1;const{Object3D:e}=dr,{Fog:t}=Jh();let r,n;function i(e){return r||function(e){const n=t.getSchemaFrom(e),i=e.Schema,o=i.Types.Color;r=new i({background:o,fog:n,overrideMaterial:String,autoUpdate:Boolean})}(e),r}function o(t){const r=e.getModelFrom(t);n=r.discriminator("Scene",i(t))}return rl.Scene={name:"Scene",getSchemaFrom:i,getModelFrom:function(e){return n||o(e),n},registerModelTo:function(e){return n||o(e),e}},rl}(),al={},sl={};function cl(){if(nl)return sl;let e,t;function r(t){return e||function(t){const r=t.Schema,n=r.Types,i=n.ObjectId,o=n.Vector2,a=n.Matrix3;e=new r({uuid:String,name:String,image:i,mipmaps:[],mapping:Number,wrapS:Number,wrapT:Number,magFilter:Number,minFilter:Number,anisotropy:Number,format:Number,type:Number,offset:o,repeat:o,center:o,rotation:Number,matrixAutoUpdate:Boolean,matrix:a,generateMipmaps:Boolean,premultiplyAlpha:Boolean,flipY:Boolean,unpackAlignment:Number,encoding:Number,version:Number},{collection:"textures",discriminatorKey:"type"})}(t),e}function n(e){t=e.model("Textures",r(e)),t.discriminator("Texture",new e.Schema({}))}return nl=1,sl.Texture={name:"Texture",getSchemaFrom:r,getModelFrom:function(e){return t||n(e),t},registerModelTo:function(e){return t||n(e),e}},sl}
/**
 * @module Schemas/Textures/CanvasTexture
 * @desc Export the ThreeJs CanvasTexture Model and Schema for Mongoose.
 *
 * @requires {@link module:Schemas/Textures/Texture Schemas/Textures/Texture}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */var hl,ll=function(){if(il)return al;il=1;const{Texture:e}=cl();let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({needsUpdate:Boolean})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("CanvasTexture",n(t))}return al.CanvasTexture={name:"CanvasTexture",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},al}(),ul={};var dl,ml=function(){if(hl)return ul;hl=1;const{Texture:e}=cl();let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("CompressedTexture",n(t))}return ul.CompressedTexture={name:"CompressedTexture",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},ul}(),fl={};var pl,gl=function(){if(dl)return fl;dl=1;const{Texture:e}=cl();let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("CubeTexture",n(t))}return fl.CubeTexture={name:"CubeTexture",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},fl}(),_l={};var yl,wl=function(){if(pl)return _l;pl=1;const{Texture:e}=cl();let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("DataTexture",n(t))}return _l.DataTexture={name:"DataTexture",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},_l}(),bl={};var Ml,Sl=function(){if(yl)return bl;yl=1;const{Texture:e}=cl();let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("DepthTexture",n(t))}return bl.DepthTexture={name:"DepthTexture",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},bl}(),vl=cl(),xl={};var Fl=function(){if(Ml)return xl;Ml=1;const{Texture:e}=cl();let t,r;function n(e){return t||function(e){const r=e.Schema;t=new r({})}(e),t}function i(t){const i=e.getModelFrom(t);r=i.discriminator("VideoTexture",n(t))}return xl.VideoTexture={name:"VideoTexture",getSchemaFrom:n,getModelFrom:function(e){return r||i(e),r},registerModelTo:function(e){return r||i(e),e}},xl}();
/**
 * @module Types/Color
 * @desc Export the three js Color type for Mongoose.
 *
 * @requires {@link module: [@itee/validators]{@link https://github.com/Itee/@itee/validators}}
 * @requires {@link module: [bson]{@link https://github.com/mongodb/js-bson}}
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */function Tl(e){class t extends e.SchemaType{constructor(e,t){super(e,t,"Color")}cast(t){if(a(t))throw new e.SchemaType.CastError(`Color: ${t} is null or undefined`);if(u(t)&&!t.isColor)throw new e.SchemaType.CastError(`Color: ${t} is not a object or Three.Color instance`);if(!("r"in t))throw new e.SchemaType.CastError(`Color: ${t} does not contain r property`);if(d(t.r))throw new e.SchemaType.CastError(`Color: ${t} expected to be a number`);if(!("g"in t))throw new e.SchemaType.CastError(`Color: ${t} does not contain g property`);if(d(t.g))throw new e.SchemaType.CastError(`Color: ${t} expected to be a number`);if(!("b"in t))throw new e.SchemaType.CastError(`Color: ${t} does not contain b property`);if(d(t.b))throw new e.SchemaType.CastError(`Color: ${t} expected to be a number`);return{r:t.r,g:t.g,b:t.b}}}return t.COLOR_BSON_TYPE=Vt,e.Schema.Types.Color=t,e}
/**
 * @module Types/Euler
 * @desc Export the three js Euler type for Mongoose.
 *
 * @requires {@link module: [@itee/validators]{@link https://github.com/Itee/@itee/validators}}
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */function Cl(e){class t extends e.SchemaType{constructor(e,t){super(e,t,"Euler")}cast(t){if(a(t))throw new e.SchemaType.CastError(`Euler: ${t} is null or undefined`);if(u(t)&&!t.isEuler)throw new e.SchemaType.CastError(`Euler: ${t} is not a object or Euler instance`);if(!("x"in t))throw new e.SchemaType.CastError(`Euler: ${t} does not contain x property`);if(d(t.x))throw new e.SchemaType.CastError(`Euler: ${t} expected x to be a number`);if(!("y"in t))throw new e.SchemaType.CastError(`Euler: ${t} does not contain y property`);if(d(t.y))throw new e.SchemaType.CastError(`Euler: ${t} expected y to be a number`);if(!("z"in t))throw new e.SchemaType.CastError(`Euler: ${t} does not contain z property`);if(d(t.z))throw new e.SchemaType.CastError(`Euler: ${t} expected z to be a number`);if(!("order"in t))throw new e.SchemaType.CastError(`Euler: ${t} does not contain order property`);if(m(t.order))throw new e.SchemaType.CastError(`Euler: ${t} expected order to be a string`);if(!["XYZ","YZX","ZXY","XZY","YXZ","ZYX"].includes(t.order.toUpperCase()))throw new e.SchemaType.CastError(`Euler: ${t} expected order to be a string in ['XYZ', 'YZX', 'ZXY', 'XZY', 'YXZ', 'ZYX']`);return{x:t.x,y:t.y,z:t.z,order:t.order.toUpperCase()}}}return t.EULER_BSON_TYPE=Vt,e.Schema.Types.Euler=t,e}
/**
 * @module Types/Matrix3
 * @desc Export the three js Matrix3 type for Mongoose.
 *
 * @requires {@link module: [@itee/validators]{@link https://github.com/Itee/@itee/validators}}
 * @requires {@link module: [bson]{@link https://github.com/mongodb/js-bson}}
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */function Bl(e){class t extends e.SchemaType{constructor(e,t){super(e,t,"Matrix3")}cast(t){if(a(t))throw new e.SchemaType.CastError(`Matrix3: ${t} is null or undefined`);if(f(t)&&!t.isMatrix3)throw new e.SchemaType.CastError(`Matrix3: ${t} is not an array or Matrix3 instance`);let r;r=t.isMatrix3?t.toArray():t;const n=r.length;if(9!==n)throw new e.SchemaType.CastError(`Matrix3: ${t} does not contain the right number of values. Expect 9 values and found ${n}`);for(let i,o=0;o<n;o++){if(i=r[o],d(i))throw new e.SchemaType.CastError(`Matrix3: ${t} does not seem to contain right values. Expect values in range 0 and 1.`);if(p(i))throw new e.SchemaType.CastError(`Matrix3: ${t} does not seem to contain right values. Expect values in range 0 and 1.`)}return r}}return t.MATRIX3_BSON_TYPE=Yt,e.Schema.Types.Matrix3=t,e}
/**
 * @module Types/Matrix4
 * @desc Export the three js Matrix4 type for Mongoose.
 *
 * @requires {@link module: [@itee/validators]{@link https://github.com/Itee/@itee/validators}}
 * @requires {@link module: [bson]{@link https://github.com/mongodb/js-bson}}
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */function El(e){class t extends e.SchemaType{constructor(e,t){super(e,t,"Matrix4")}cast(t){if(a(t))throw new e.SchemaType.CastError(`Matrix4: ${t} is null or undefined`);if(f(t)&&!t.isMatrix4)throw new e.SchemaType.CastError(`Matrix4: ${t} is not an array or Matrix4 instance`);let r;r=t.isMatrix4?t.toArray():t;const n=r.length;if(16!==n)throw new e.SchemaType.CastError(`Matrix4: ${t} does not contain the right number of values. Expect 9 values and found ${n}`);for(let i,o=0;o<n;o++){if(i=r[o],d(i))throw new e.SchemaType.CastError(`Matrix4: ${t} does not seem to contain right values. Expect values in range 0 and 1.`);if(p(i))throw new e.SchemaType.CastError(`Matrix4: ${t} does not seem to contain right values. Expect values in range 0 and 1.`)}return r}}return t.MATRIX4_BSON_TYPE=Yt,e.Schema.Types.Matrix4=t,e}
/**
 * @module Types/Quaternion
 * @desc Export the three js Quaternion type for Mongoose.
 *
 * @requires {@link module: [@itee/validators]{@link https://github.com/Itee/@itee/validators}}
 * @requires {@link module: [bson]{@link https://github.com/mongodb/js-bson}}
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */function Pl(e){class t extends e.SchemaType{constructor(e,t){super(e,t,"Quaternion")}cast(t){if(a(t))throw new e.SchemaType.CastError(`Quaternion: ${t} is null or undefined`);if(u(t)&&!t.isQuaternion)throw new e.SchemaType.CastError(`Quaternion: ${t} is not a object or Quaternion instance`);if(!("x"in t))throw new e.SchemaType.CastError(`Quaternion: ${t} does not contain x property`);if(d(t.x))throw new e.SchemaType.CastError(`Quaternion: ${t} expected to be a number`);if(!("y"in t))throw new e.SchemaType.CastError(`Quaternion: ${t} does not contain y property`);if(d(t.y))throw new e.SchemaType.CastError(`Quaternion: ${t} expected to be a number`);if(!("z"in t))throw new e.SchemaType.CastError(`Quaternion: ${t} does not contain z property`);if(d(t.z))throw new e.SchemaType.CastError(`Quaternion: ${t} expected to be a number`);if(!("w"in t))throw new e.SchemaType.CastError(`Quaternion: ${t} does not contain w property`);if(d(t.w))throw new e.SchemaType.CastError(`Quaternion: ${t} expected to be a number`);return{x:t.x,y:t.y,z:t.z,w:t.w}}}return t.QUATERNION_BSON_TYPE=Vt,e.Schema.Types.Quaternion=t,e}
/**
 * @module Types/Vector2
 * @desc Export the three js Vector2 type for Mongoose.
 *
 * @requires {@link module: [@itee/validators]{@link https://github.com/Itee/@itee/validators}}
 * @requires {@link module: [bson]{@link https://github.com/mongodb/js-bson}}
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */function Dl(e){class t extends e.SchemaType{constructor(e,t){super(e,t,"Vector2")}cast(t){if(a(t))throw new e.SchemaType.CastError(`Vector2: ${t} is null or undefined`);if(u(t)&&!t.isVector2)throw new e.SchemaType.CastError(`Vector2: ${t} is not a object or Vector2 instance`);if(!("x"in t))throw new e.SchemaType.CastError(`Vector2: ${t} does not contain x property`);if(d(t.x))throw new e.SchemaType.CastError(`Vector2: ${t} expected to be a number`);if(!("y"in t))throw new e.SchemaType.CastError(`Vector2: ${t} does not contain y property`);if(d(t.y))throw new e.SchemaType.CastError(`Vector2: ${t} expected to be a number`);return{x:t.x,y:t.y}}}return t.VECTOR2_BSON_TYPE=Vt,e.Schema.Types.Vector2=t,e}
/**
 * @module Types/Vector3
 * @desc Export the three js Vector3 type for Mongoose.
 *
 * @requires {@link module: [@itee/validators]{@link https://github.com/Itee/@itee/validators}}
 * @requires {@link module: [bson]{@link https://github.com/mongodb/js-bson}}
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */function Ol(e){class t extends e.SchemaType{constructor(e,t){super(e,t,"Vector3")}cast(t){if(a(t))throw new e.SchemaType.CastError(`Vector3: ${t} is null or undefined`);if(u(t)&&!t.isVector3)throw new e.SchemaType.CastError(`Vector3: ${t} is not a object or Vector3 instance`);if(!("x"in t))throw new e.SchemaType.CastError(`Vector3: ${t} does not contain x property`);if(d(t.x))throw new e.SchemaType.CastError(`Vector3: ${t} expected to be a number`);if(!("y"in t))throw new e.SchemaType.CastError(`Vector3: ${t} does not contain y property`);if(d(t.y))throw new e.SchemaType.CastError(`Vector3: ${t} expected to be a number`);if(!("z"in t))throw new e.SchemaType.CastError(`Vector3: ${t} does not contain z property`);if(d(t.z))throw new e.SchemaType.CastError(`Vector3: ${t} expected to be a number`);return{x:t.x,y:t.y,z:t.z}}}return t.VECTOR3_BSON_TYPE=Vt,e.Schema.Types.Vector3=t,e}
/**
 * @module Types/Vector4
 * @desc Export the three js Vector4 type for Mongoose.
 *
 * @requires {@link module: [@itee/validators]{@link https://github.com/Itee/@itee/validators}}
 * @requires {@link module: [bson]{@link https://github.com/mongodb/js-bson}}
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */function Al(e){class t extends e.SchemaType{constructor(e,t){super(e,t,"Vector4")}cast(t){if(a(t))throw new e.SchemaType.CastError(`Vector4: ${t} is null or undefined`);if(u(t)&&!t.isVector4)throw new e.SchemaType.CastError(`Vector4: ${t} is not a object or Vector4 instance`);if(!("x"in t))throw new e.SchemaType.CastError(`Vector4: ${t} does not contain x property`);if(d(t.x))throw new e.SchemaType.CastError(`Vector4: ${t} expected to be a number`);if(!("y"in t))throw new e.SchemaType.CastError(`Vector4: ${t} does not contain y property`);if(d(t.y))throw new e.SchemaType.CastError(`Vector4: ${t} expected to be a number`);if(!("z"in t))throw new e.SchemaType.CastError(`Vector4: ${t} does not contain z property`);if(d(t.z))throw new e.SchemaType.CastError(`Vector4: ${t} expected to be a number`);if(!("w"in t))throw new e.SchemaType.CastError(`Vector4: ${t} does not contain w property`);if(d(t.w))throw new e.SchemaType.CastError(`Vector4: ${t} expected to be a number`);return{x:t.x,y:t.y,z:t.z,w:t.w}}}return t.VECTOR4_BSON_TYPE=Vt,e.Schema.Types.Vector4=t,e}
/**
 * @module MongoDBThreePlugin
 * @desc Three way to register Types and Schema
 * using cjs module under types and schemas folder.
 * using FunctionRegistrator for type and add to plugin using .addType( myFunctionRegistrator ), extending class AbstractMongooseRegistrator for Schema and add to plugin using .addSchema(
 * MySchemaRegistrator ) using direct registration importing mongoose in the file (care to the loading order ! An no output about what is registered.)
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [MIT]{@link https://opensource.org/licenses/MIT}
 */function Gl(e){return new i(e).addType(Tl).addType(Cl).addType(Bl).addType(El).addType(Pl).addType(Dl).addType(Ol).addType(Al).addSchema(fr.Audio).addSchema(_r.AudioListener).addSchema(br.PositionalAudio).addSchema(vr.ArrayCamera).addSchema(Tr.Camera).addSchema(Er.CubeCamera).addSchema(Or.OrthographicCamera).addSchema(Gr.PerspectiveCamera).addSchema(Nr.BufferAttribute).addSchema(Vr).addSchema(Qr.CurvePath).addSchema(en.Face3).addSchema(an).addSchema(lr).addSchema(un.Path).addSchema(fn.Shape).addSchema(_n.ArcCurve).addSchema(bn.CatmullRomCurve3).addSchema(vn.CubicBezierCurve).addSchema(Tn.CubicBezierCurve3).addSchema(Cn.Curve).addSchema(Pn.CurveExtras).addSchema(An.EllipseCurve).addSchema(zn.LineCurve).addSchema(Nn.LineCurve3).addSchema(Hn.NURBSCurve).addSchema(Yn.NURBSSurface).addSchema(Xn.QuadraticBezierCurve).addSchema(Kn.QuadraticBezierCurve3).addSchema(ei.SplineCurve).addSchema(ii.BoxBufferGeometry).addSchema(ci.BoxGeometry).addSchema(ui.CircleBufferGeometry).addSchema(fi.CircleGeometry).addSchema(_i.ConeBufferGeometry).addSchema(bi.ConeGeometry).addSchema(vi.ConvexGeometry).addSchema(Ti.CylinderBufferGeometry).addSchema(Ei.CylinderGeometry).addSchema(Oi.DecalGeometry).addSchema(Ii.DodecahedronGeometry).addSchema(ki.EdgesGeometry).addSchema(Ri.ExtrudeBufferGeometry).addSchema(Vi.ExtrudeGeometry).addSchema($i.IcosahedronBufferGeometry).addSchema(qi.IcosahedronGeometry).addSchema(Ji.InstancedBufferGeometry).addSchema(ro.LatheBufferGeometry).addSchema(oo.LatheGeometry).addSchema(co.OctahedronBufferGeometry).addSchema(uo.OctahedronGeometry).addSchema(po.ParametricBufferGeometry).addSchema(yo.ParametricGeometry).addSchema(Mo.PlaneBufferGeometry).addSchema(xo.PlaneGeometry).addSchema(Co.PolyhedronBufferGeometry).addSchema(Po.PolyhedronGeometry).addSchema(Ao.RingBufferGeometry).addSchema(zo.RingGeometry).addSchema(No.ShapeBufferGeometry).addSchema(Ho.ShapeGeometry).addSchema(Yo.SphereBufferGeometry).addSchema(Xo.SphereGeometry).addSchema(Ko.TeapotBufferGeometry).addSchema(ea.TetrahedronBufferGeometry).addSchema(na.TetrahedronGeometry).addSchema(aa.TextBufferGeometry).addSchema(ha.TextGeometry).addSchema(da.TorusBufferGeometry).addSchema(pa.TorusGeometry).addSchema(ya.TorusKnotBufferGeometry).addSchema(Ma.TorusKnotGeometry).addSchema(xa.TubeBufferGeometry).addSchema(Ca.TubeGeometry).addSchema(Pa.WireframeGeometry).addSchema(Aa.ArrowHelper).addSchema(za.AxesHelper).addSchema(Na.Box3Helper).addSchema(Ha.BoxHelper).addSchema(Ya.CameraHelper).addSchema(Xa.DirectionalLightHelper).addSchema(Ka.FaceNormalsHelper).addSchema(es.GridHelper).addSchema(ns.HemisphereLightHelper).addSchema(as.PlaneHelper).addSchema(hs.PointLightHelper).addSchema(ds.PolarGridHelper).addSchema(ps.RectAreaLightHelper).addSchema(ys.SkeletonHelper).addSchema(Ms.SpotLightHelper).addSchema(xs.VertexNormalsHelper).addSchema(Cs.AmbientLight).addSchema(Ps.DirectionalLight).addSchema(As.HemisphereLight).addSchema(zs.Light).addSchema(Ns.PointLight).addSchema(Hs.RectAreaLight).addSchema(Ws.SpotLight).addSchema(gc.MeshPhongMaterial).addSchema(Ks.LineBasicMaterial).addSchema(ec.LineDashedMaterial).addSchema(tc.Material).addSchema(ic.MeshBasicMaterial).addSchema(sc.MeshDepthMaterial).addSchema(lc.MeshLambertMaterial).addSchema(mc.MeshNormalMaterial).addSchema(wc.MeshPhysicalMaterial).addSchema(Sc.MeshStandardMaterial).addSchema(Fc.MeshToonMaterial).addSchema(Bc.PointsMaterial).addSchema(Dc.RawShaderMaterial).addSchema(Gc.ShaderMaterial).addSchema(Lc.ShadowMaterial).addSchema(Uc.SpriteMaterial).addSchema(jc.Box2).addSchema(Wc.Box3).addSchema(Zc.Line3).addSchema(Qc.Plane).addSchema(th.Ray).addSchema(ih.Sphere).addSchema(sh.Spherical).addSchema(lh.Triangle).addSchema(dh.Bone).addSchema(_h).addSchema(Mh.ImmediateRenderObject).addSchema(xh.LensFlare).addSchema(Ch.Line).addSchema(Ph.LineLoop).addSchema(Ah.LineSegments).addSchema(zh.LOD).addSchema(Nh.Mesh).addSchema(Hh.Points).addSchema(Yh.Skeleton).addSchema(Xh.SkinnedMesh).addSchema(Kh.Sprite).addSchema(tl.Fog).addSchema(ol.Scene).addSchema(ll.CanvasTexture).addSchema(ml.CompressedTexture).addSchema(gl.CubeTexture).addSchema(wl.DataTexture).addSchema(Sl.DepthTexture).addSchema(vl.Texture).addSchema(Fl.VideoTexture).addController(Wt).addDescriptor({route:"/objects",controller:{name:"TObjects3DController",options:{schemaName:"Objects3D"},can:{create:{on:"put",over:"/(:id)?"},read:{on:"post",over:"/(:id)?"},update:{on:"patch",over:"/(:id)?"},delete:{on:"delete",over:"/(:id)?"}}}}).addController(n).addDescriptor({route:"/curves",controller:{name:"TMongooseController",options:{schemaName:"Curves"},can:{create:{on:"put",over:"/(:id)?"},read:{on:"post",over:"/(:id)?"},update:{on:"patch",over:"/(:id)?"},delete:{on:"delete",over:"/(:id)?"}}}}).addDescriptor({route:"/geometries",controller:{name:"TMongooseController",options:{schemaName:"Geometries"},can:{create:{on:"put",over:"/(:id)?"},read:{on:"post",over:"/(:id)?"},update:{on:"patch",over:"/(:id)?"},delete:{on:"delete",over:"/(:id)?"}}}}).addDescriptor({route:"/materials",controller:{name:"TMongooseController",options:{schemaName:"Materials"},can:{create:{on:"put",over:"/(:id)?"},read:{on:"post",over:"/(:id)?"},update:{on:"patch",over:"/(:id)?"},delete:{on:"delete",over:"/(:id)?"}}}}).addDescriptor({route:"/textures",controller:{name:"TMongooseController",options:{schemaName:"Textures"},can:{create:{on:"put",over:"/(:id)?"},read:{on:"post",over:"/(:id)?"},update:{on:"patch",over:"/(:id)?"},delete:{on:"delete",over:"/(:id)?"}}}}).addController(r).addDescriptor({route:"/uploads",controller:{name:"TAbstractConverterManager",options:{useNext:!0,converters:{JsonToThree:new Jt,ShpToThree:new ir,DbfToThree:new Kt,FbxToThree:new Qt,ColladaToThree:new $t,StlToThree:new or,TdsToThree:new ar,MtlToThree:new er,ObjToThree:new tr},rules:[{on:".json",use:"JsonToThree"},{on:".dae",use:"ColladaToThree"},{on:".fbx",use:"FbxToThree"},{on:".stl",use:"StlToThree"},{on:".3ds",use:"TdsToThree"},{on:".shp",use:"ShpToThree"},{on:".dbf",use:"DbfToThree"},{on:[".shp",".dbf"],use:["ShpToThree","DbfToThree"]},{on:".mtl",use:"MtlToThree"},{on:".obj",use:"ObjToThree"},{on:[".mtl",".obj"],use:["MtlToThree","ObjToThree"]}],inserter:sr},can:{processFiles:{on:"post",over:"/"}}}})}
/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Il="srgb",zl="srgb-linear";function Ll(e,t,r){return Math.max(t,Math.min(r,e))}function kl(e,t,r){return(1-r)*e+r*t}function Nl(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Ul(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}const Rl={[Il]:{[zl]:Nl},[zl]:{[Il]:Ul}},Hl={legacyMode:!0,get workingColorSpace(){return zl},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,r){if(this.legacyMode||t===r||!t||!r)return e;if(Rl[t]&&void 0!==Rl[t][r]){const n=Rl[t][r];return e.r=n(e.r),e.g=n(e.g),e.b=n(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},jl={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Vl={r:0,g:0,b:0},Yl={h:0,s:0,l:0},Wl={h:0,s:0,l:0};function $l(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e}function Xl(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}class Zl{constructor(e,t,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===t&&void 0===r?this.set(e):this.setRGB(e,t,r)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Il){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Hl.toWorkingColorSpace(this,t),this}setRGB(e,t,r,n=Hl.workingColorSpace){return this.r=e,this.g=t,this.b=r,Hl.toWorkingColorSpace(this,n),this}setHSL(e,t,r,n=Hl.workingColorSpace){var i;if(e=(e%(i=1)+i)%i,t=Ll(t,0,1),r=Ll(r,0,1),0===t)this.r=this.g=this.b=r;else{const n=r<=.5?r*(1+t):r+t-r*t,i=2*r-n;this.r=$l(i,n,e+1/3),this.g=$l(i,n,e),this.b=$l(i,n,e-1/3)}return Hl.toWorkingColorSpace(this,n),this}setStyle(e,t=Il){function r(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const i=n[1],o=n[2];switch(i){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,Hl.toWorkingColorSpace(this,t),r(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,Hl.toWorkingColorSpace(this,t),r(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){const n=parseFloat(e[1])/360,i=parseFloat(e[2])/100,o=parseFloat(e[3])/100;return r(e[4]),this.setHSL(n,i,o,t)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=n[1],r=e.length;if(3===r)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,Hl.toWorkingColorSpace(this,t),this;if(6===r)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,Hl.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=Il){const r=jl[e.toLowerCase()];return void 0!==r?this.setHex(r,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Nl(e.r),this.g=Nl(e.g),this.b=Nl(e.b),this}copyLinearToSRGB(e){return this.r=Ul(e.r),this.g=Ul(e.g),this.b=Ul(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Il){return Hl.fromWorkingColorSpace(Xl(this,Vl),e),Ll(255*Vl.r,0,255)<<16^Ll(255*Vl.g,0,255)<<8^Ll(255*Vl.b,0,255)}getHexString(e=Il){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Hl.workingColorSpace){Hl.fromWorkingColorSpace(Xl(this,Vl),t);const r=Vl.r,n=Vl.g,i=Vl.b,o=Math.max(r,n,i),a=Math.min(r,n,i);let s,c;const h=(a+o)/2;if(a===o)s=0,c=0;else{const e=o-a;switch(c=h<=.5?e/(o+a):e/(2-o-a),o){case r:s=(n-i)/e+(n<i?6:0);break;case n:s=(i-r)/e+2;break;case i:s=(r-n)/e+4}s/=6}return e.h=s,e.s=c,e.l=h,e}getRGB(e,t=Hl.workingColorSpace){return Hl.fromWorkingColorSpace(Xl(this,Vl),t),e.r=Vl.r,e.g=Vl.g,e.b=Vl.b,e}getStyle(e=Il){return Hl.fromWorkingColorSpace(Xl(this,Vl),e),e!==Il?`color(${e} ${Vl.r} ${Vl.g} ${Vl.b})`:`rgb(${255*Vl.r|0},${255*Vl.g|0},${255*Vl.b|0})`}offsetHSL(e,t,r){return this.getHSL(Yl),Yl.h+=e,Yl.s+=t,Yl.l+=r,this.setHSL(Yl.h,Yl.s,Yl.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(Yl),e.getHSL(Wl);const r=kl(Yl.h,Wl.h,t),n=kl(Yl.s,Wl.s,t),i=kl(Yl.l,Wl.l,t);return this.setHSL(r,n,i),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}Zl.NAMES=jl;class ql{constructor(e=0,t=0,r=0,n=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=n}static slerpFlat(e,t,r,n,i,o,a){let s=r[n+0],c=r[n+1],h=r[n+2],l=r[n+3];const u=i[o+0],d=i[o+1],m=i[o+2],f=i[o+3];if(0===a)return e[t+0]=s,e[t+1]=c,e[t+2]=h,void(e[t+3]=l);if(1===a)return e[t+0]=u,e[t+1]=d,e[t+2]=m,void(e[t+3]=f);if(l!==f||s!==u||c!==d||h!==m){let e=1-a;const t=s*u+c*d+h*m+l*f,r=t>=0?1:-1,n=1-t*t;if(n>Number.EPSILON){const i=Math.sqrt(n),o=Math.atan2(i,t*r);e=Math.sin(e*o)/i,a=Math.sin(a*o)/i}const i=a*r;if(s=s*e+u*i,c=c*e+d*i,h=h*e+m*i,l=l*e+f*i,e===1-a){const e=1/Math.sqrt(s*s+c*c+h*h+l*l);s*=e,c*=e,h*=e,l*=e}}e[t]=s,e[t+1]=c,e[t+2]=h,e[t+3]=l}static multiplyQuaternionsFlat(e,t,r,n,i,o){const a=r[n],s=r[n+1],c=r[n+2],h=r[n+3],l=i[o],u=i[o+1],d=i[o+2],m=i[o+3];return e[t]=a*m+h*l+s*d-c*u,e[t+1]=s*m+h*u+c*l-a*d,e[t+2]=c*m+h*d+a*u-s*l,e[t+3]=h*m-a*l-s*u-c*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const r=e._x,n=e._y,i=e._z,o=e._order,a=Math.cos,s=Math.sin,c=a(r/2),h=a(n/2),l=a(i/2),u=s(r/2),d=s(n/2),m=s(i/2);switch(o){case"XYZ":this._x=u*h*l+c*d*m,this._y=c*d*l-u*h*m,this._z=c*h*m+u*d*l,this._w=c*h*l-u*d*m;break;case"YXZ":this._x=u*h*l+c*d*m,this._y=c*d*l-u*h*m,this._z=c*h*m-u*d*l,this._w=c*h*l+u*d*m;break;case"ZXY":this._x=u*h*l-c*d*m,this._y=c*d*l+u*h*m,this._z=c*h*m+u*d*l,this._w=c*h*l-u*d*m;break;case"ZYX":this._x=u*h*l-c*d*m,this._y=c*d*l+u*h*m,this._z=c*h*m-u*d*l,this._w=c*h*l+u*d*m;break;case"YZX":this._x=u*h*l+c*d*m,this._y=c*d*l+u*h*m,this._z=c*h*m-u*d*l,this._w=c*h*l-u*d*m;break;case"XZY":this._x=u*h*l-c*d*m,this._y=c*d*l-u*h*m,this._z=c*h*m+u*d*l,this._w=c*h*l+u*d*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,n=Math.sin(r);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],n=t[4],i=t[8],o=t[1],a=t[5],s=t[9],c=t[2],h=t[6],l=t[10],u=r+a+l;if(u>0){const e=.5/Math.sqrt(u+1);this._w=.25/e,this._x=(h-s)*e,this._y=(i-c)*e,this._z=(o-n)*e}else if(r>a&&r>l){const e=2*Math.sqrt(1+r-a-l);this._w=(h-s)/e,this._x=.25*e,this._y=(n+o)/e,this._z=(i+c)/e}else if(a>l){const e=2*Math.sqrt(1+a-r-l);this._w=(i-c)/e,this._x=(n+o)/e,this._y=.25*e,this._z=(s+h)/e}else{const e=2*Math.sqrt(1+l-r-a);this._w=(o-n)/e,this._x=(i+c)/e,this._y=(s+h)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ll(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(0===r)return this;const n=Math.min(1,t/r);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,n=e._y,i=e._z,o=e._w,a=t._x,s=t._y,c=t._z,h=t._w;return this._x=r*h+o*a+n*c-i*s,this._y=n*h+o*s+i*a-r*c,this._z=i*h+o*c+r*s-n*a,this._w=o*h-r*a-n*s-i*c,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const r=this._x,n=this._y,i=this._z,o=this._w;let a=o*e._w+r*e._x+n*e._y+i*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=r,this._y=n,this._z=i,this;const s=1-a*a;if(s<=Number.EPSILON){const e=1-t;return this._w=e*o+t*this._w,this._x=e*r+t*this._x,this._y=e*n+t*this._y,this._z=e*i+t*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(s),h=Math.atan2(c,a),l=Math.sin((1-t)*h)/c,u=Math.sin(t*h)/c;return this._w=o*l+this._w*u,this._x=r*l+this._x*u,this._y=n*l+this._y*u,this._z=i*l+this._z*u,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){const e=Math.random(),t=Math.sqrt(1-e),r=Math.sqrt(e),n=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(t*Math.cos(n),r*Math.sin(i),r*Math.cos(i),t*Math.sin(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Kl{constructor(e=0,t=0,r=0){Kl.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return void 0===r&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Jl.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Jl.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6]*n,this.y=i[1]*t+i[4]*r+i[7]*n,this.z=i[2]*t+i[5]*r+i[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,n=this.z,i=e.elements,o=1/(i[3]*t+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*t+i[4]*r+i[8]*n+i[12])*o,this.y=(i[1]*t+i[5]*r+i[9]*n+i[13])*o,this.z=(i[2]*t+i[6]*r+i[10]*n+i[14])*o,this}applyQuaternion(e){const t=this.x,r=this.y,n=this.z,i=e.x,o=e.y,a=e.z,s=e.w,c=s*t+o*n-a*r,h=s*r+a*t-i*n,l=s*n+i*r-o*t,u=-i*t-o*r-a*n;return this.x=c*s+u*-i+h*-a-l*-o,this.y=h*s+u*-o+l*-i-c*-a,this.z=l*s+u*-a+c*-o-h*-i,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n,this.y=i[1]*t+i[5]*r+i[9]*n,this.z=i[2]*t+i[6]*r+i[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,n=e.y,i=e.z,o=t.x,a=t.y,s=t.z;return this.x=n*s-i*a,this.y=i*o-r*s,this.z=r*a-n*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return Ql.copy(this).projectOnVector(e),this.sub(Ql)}reflect(e){return this.sub(Ql.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(Ll(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return t*t+r*r+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const n=Math.sin(t)*e;return this.x=n*Math.sin(r),this.y=Math.cos(t)*e,this.z=n*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,r=Math.sqrt(1-e**2);return this.x=r*Math.cos(t),this.y=r*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Ql=new Kl,Jl=new ql;"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"149"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="149")
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */;const eu=kt({Black:new Zl("#000000"),Navy:new Zl("#000080"),DarkBlue:new Zl("#00008b"),MediumBlue:new Zl("#0000cd"),Blue:new Zl("#0000ff"),DarkGreen:new Zl("#006400"),Green:new Zl("#008000"),Teal:new Zl("#008080"),DarkCyan:new Zl("#008b8b"),DeepSkyBlue:new Zl("#00bfff"),DarkTurquoise:new Zl("#00ced1"),MediumSpringGreen:new Zl("#00fa9a"),Lime:new Zl("#00ff00"),SpringGreen:new Zl("#00ff7f"),Aqua:new Zl("#00ffff"),Cyan:new Zl("#00ffff"),MidnightBlue:new Zl("#191970"),DodgerBlue:new Zl("#1e90ff"),LightSeaGreen:new Zl("#20b2aa"),ForestGreen:new Zl("#228b22"),SeaGreen:new Zl("#2e8b57"),DarkSlateGray:new Zl("#2f4f4f"),DarkSlateGrey:new Zl("#2f4f4f"),LimeGreen:new Zl("#32cd32"),MediumSeaGreen:new Zl("#3cb371"),Turquoise:new Zl("#40e0d0"),RoyalBlue:new Zl("#4169e1"),SteelBlue:new Zl("#4682b4"),DarkSlateBlue:new Zl("#483d8b"),MediumTurquoise:new Zl("#48d1cc"),Indigo:new Zl("#4b0082"),DarkOliveGreen:new Zl("#556b2f"),CadetBlue:new Zl("#5f9ea0"),CornflowerBlue:new Zl("#6495ed"),RebeccaPurple:new Zl("#663399"),MediumAquaMarine:new Zl("#66cdaa"),DimGray:new Zl("#696969"),DimGrey:new Zl("#696969"),SlateBlue:new Zl("#6a5acd"),OliveDrab:new Zl("#6b8e23"),SlateGray:new Zl("#708090"),SlateGrey:new Zl("#708090"),LightSlateGray:new Zl("#778899"),LightSlateGrey:new Zl("#778899"),MediumSlateBlue:new Zl("#7b68ee"),LawnGreen:new Zl("#7cfc00"),Chartreuse:new Zl("#7fff00"),Aquamarine:new Zl("#7fffd4"),Maroon:new Zl("#800000"),Purple:new Zl("#800080"),Olive:new Zl("#808000"),Gray:new Zl("#808080"),Grey:new Zl("#808080"),SkyBlue:new Zl("#87ceeb"),LightSkyBlue:new Zl("#87cefa"),BlueViolet:new Zl("#8a2be2"),DarkRed:new Zl("#8b0000"),DarkMagenta:new Zl("#8b008b"),SaddleBrown:new Zl("#8b4513"),DarkSeaGreen:new Zl("#8fbc8f"),LightGreen:new Zl("#90ee90"),MediumPurple:new Zl("#9370db"),DarkViolet:new Zl("#9400d3"),PaleGreen:new Zl("#98fb98"),DarkOrchid:new Zl("#9932cc"),YellowGreen:new Zl("#9acd32"),Sienna:new Zl("#a0522d"),Brown:new Zl("#a52a2a"),DarkGray:new Zl("#a9a9a9"),DarkGrey:new Zl("#a9a9a9"),LightBlue:new Zl("#add8e6"),GreenYellow:new Zl("#adff2f"),PaleTurquoise:new Zl("#afeeee"),LightSteelBlue:new Zl("#b0c4de"),PowderBlue:new Zl("#b0e0e6"),FireBrick:new Zl("#b22222"),DarkGoldenRod:new Zl("#b8860b"),MediumOrchid:new Zl("#ba55d3"),RosyBrown:new Zl("#bc8f8f"),DarkKhaki:new Zl("#bdb76b"),Silver:new Zl("#c0c0c0"),MediumVioletRed:new Zl("#c71585"),IndianRed:new Zl("#cd5c5c"),Peru:new Zl("#cd853f"),Chocolate:new Zl("#d2691e"),Tan:new Zl("#d2b48c"),LightGray:new Zl("#d3d3d3"),LightGrey:new Zl("#d3d3d3"),Thistle:new Zl("#d8bfd8"),Orchid:new Zl("#da70d6"),GoldenRod:new Zl("#daa520"),PaleVioletRed:new Zl("#db7093"),Crimson:new Zl("#dc143c"),Gainsboro:new Zl("#dcdcdc"),Plum:new Zl("#dda0dd"),BurlyWood:new Zl("#deb887"),LightCyan:new Zl("#e0ffff"),Lavender:new Zl("#e6e6fa"),DarkSalmon:new Zl("#e9967a"),Violet:new Zl("#ee82ee"),PaleGoldenRod:new Zl("#eee8aa"),LightCoral:new Zl("#f08080"),Khaki:new Zl("#f0e68c"),AliceBlue:new Zl("#f0f8ff"),HoneyDew:new Zl("#f0fff0"),Azure:new Zl("#f0ffff"),SandyBrown:new Zl("#f4a460"),Wheat:new Zl("#f5deb3"),Beige:new Zl("#f5f5dc"),WhiteSmoke:new Zl("#f5f5f5"),MintCream:new Zl("#f5fffa"),GhostWhite:new Zl("#f8f8ff"),Salmon:new Zl("#fa8072"),AntiqueWhite:new Zl("#faebd7"),Linen:new Zl("#faf0e6"),LightGoldenRodYellow:new Zl("#fafad2"),OldLace:new Zl("#fdf5e6"),Red:new Zl("#ff0000"),Fuchsia:new Zl("#ff00ff"),Magenta:new Zl("#ff00ff"),DeepPink:new Zl("#ff1493"),OrangeRed:new Zl("#ff4500"),Tomato:new Zl("#ff6347"),HotPink:new Zl("#ff69b4"),Coral:new Zl("#ff7f50"),DarkOrange:new Zl("#ff8c00"),LightSalmon:new Zl("#ffa07a"),Orange:new Zl("#ffa500"),LightPink:new Zl("#ffb6c1"),Pink:new Zl("#ffc0cb"),Gold:new Zl("#ffd700"),PeachPuff:new Zl("#ffdab9"),NavajoWhite:new Zl("#ffdead"),Moccasin:new Zl("#ffe4b5"),Bisque:new Zl("#ffe4c4"),MistyRose:new Zl("#ffe4e1"),BlanchedAlmond:new Zl("#ffebcd"),PapayaWhip:new Zl("#ffefd5"),LavenderBlush:new Zl("#fff0f5"),SeaShell:new Zl("#fff5ee"),Cornsilk:new Zl("#fff8dc"),LemonChiffon:new Zl("#fffacd"),FloralWhite:new Zl("#fffaf0"),Snow:new Zl("#fffafa"),Yellow:new Zl("#ffff00"),LightYellow:new Zl("#ffffe0"),Ivory:new Zl("#fffff0"),White:new Zl("#ffffff")});class tu{constructor(e){e.default?this.default.set(e.default):this.default.set(eu.Fuchsia),e.intersected?this.intersected.set(e.intersected):this.default.set(eu.PeachPuff),e.selected?this.selected.set(e.selected):this.default.set(eu.DarkOrange),e.active?this.active.set(e.active):this.default.set(eu.YellowGreen),e.inactive?this.inactive.set(e.inactive):this.default.set(eu.LightCyan),e.enabled?this.enabled.set(e.enabled):this.default.set(eu.Lavender),e.disabled?this.disabled.set(e.disabled):this.default.set(eu.Grey)}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */const ru=new Kl(-1,-1,-1).normalize(),nu=new Kl(-1,-1,0).normalize(),iu=new Kl(-1,-1,1).normalize(),ou=new Kl(-1,0,-1).normalize(),au=new Kl(-1,0,0).normalize(),su=new Kl(-1,0,1).normalize(),cu=new Kl(-1,1,-1).normalize(),hu=new Kl(-1,1,0).normalize(),lu=new Kl(-1,1,1).normalize(),uu=new Kl(0,-1,-1).normalize(),du=new Kl(0,-1,0).normalize(),mu=new Kl(0,-1,1).normalize(),fu=new Kl(0,0,-1).normalize(),pu=new Kl(0,0,0).normalize(),gu=new Kl(0,0,1).normalize(),_u=new Kl(0,1,-1).normalize(),yu=new Kl(0,1,0).normalize(),wu=new Kl(0,1,1).normalize(),bu=new Kl(1,-1,-1).normalize(),Mu=new Kl(1,-1,0).normalize(),Su=new Kl(1,-1,1).normalize(),vu=new Kl(1,0,-1).normalize(),xu=new Kl(1,0,0).normalize(),Fu={Left_Down_Back:ru,Left_Down:nu,Left_Down_Front:iu,Left_Back:ou,Left:au,Left_Front:su,Left_Up_Back:cu,Left_Up:hu,Left_Up_Front:lu,Down_Back:uu,Down:du,Down_Front:mu,Back:fu,Null:pu,Front:gu,Up_Back:_u,Up:yu,Up_Front:wu,Right_Down_Back:bu,Right_Down:Mu,Right_Down_Front:Su,Right_Back:vu,Right:xu,Right_Front:new Kl(1,0,1).normalize(),Right_Up_Back:new Kl(1,1,-1).normalize(),Right_Up:new Kl(1,1,0).normalize(),Right_Up_Front:new Kl(1,1,1).normalize(),Cardinales:{North:fu,North_North_East:new Kl(It,0,-zt).normalize(),North_East:new Kl(Lt,0,-Lt).normalize(),East_North_East:new Kl(zt,0,-It).normalize(),East:xu,East_South_East:new Kl(zt,0,- -It).normalize(),South_East:new Kl(Lt,0,- -Lt).normalize(),South_South_East:new Kl(It,0,- -zt).normalize(),South:gu,South_South_West:new Kl(-It,0,- -zt).normalize(),South_West:new Kl(-Lt,0,- -Lt).normalize(),West_South_West:new Kl(-zt,0,- -It).normalize(),West:au,West_North_West:new Kl(-zt,0,-It).normalize(),North_West:new Kl(-Lt,0,-Lt).normalize(),North_North_West:new Kl(-It,0,-zt).normalize()}};
/**
 * @module Loader/ASCLoader
 * @desc A loader for ASC cloud point files.
 *
 * @requires {@link https://github.com/Itee/@itee/client @itee/client}
 * @requires {@link https://github.com/Itee/three-full three-full}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 * @example
 *
 * import { ASCLoader } from '@itee/plugin-three'
 *
 * const loader = new ASCLoader();
 *
 * // If the ASC file need to be offseted, it can be set before loading file.
 * loader.setOffset( {
 *      x: 1.0,
 *      y: 52.0,
 *      z: -5.0
 * } );
 *
 * // Then load the file and get the threejs Point Geometry
 * loader.load('/path/to/file.asc', function (geometry) {
 *
 *      scene.add( new Mesh( geometry ) );
 *
 * } );
 *
 */
class Tu{constructor(e=F,t=Gt){this.manager=e,this.logger=t,this._boundingBox=new I,this._points=[],this._numberOfPoints=0,this._coloredPoints=!1,this._autoOffset=!1,this._offset={x:0,y:0,z:0},this._positions=null,this._bufferIndex=0,this._positionsC=null,this._bufferIndexC=0,this.wrongPoints=0}load(e,t,r,n,i){const o=new T(this.manager);o.setResponseType("blob"),o.load(e,function(e){const o=new z;this._parse(e,o,t,r,n,i),t(o)}.bind(this),r,n)}setOffset(e){this._offset=e,this._autoOffset=!1}_parse(e,t,r,n,i,o){const a=this,s=o||100,c=new FileReader,h=134217728;let l=0;function u(){if(l>=e.size)return;const t=e.slice(l,l+h,"text/plain");c.readAsText(t)}c.onabort=e=>{this.logger.log("abortEvent:"),this.logger.log(e)},c.onerror=e=>{this.logger.log("errorEvent:"),this.logger.log(e),i&&i(e)},c.onloadstart=e=>{this.logger.log("loadStartEvent:"),this.logger.log(e)},c.onprogress=e=>{this.logger.log("progressEvent:"),this.logger.log(e),n&&n(e)},c.onload=e=>{this.logger.log("loadEvent:"),this.logger.log(e);const t=e.target.result.split("\n"),r=t.length;l-=t[r-1].length;const n=Math.round(100/s);for(let e=0;e<r-1;e++)e%n===0&&a._parseLine(t[e])},c.onloadend=r=>{this.logger.log("loadEndEvent"),this.logger.log(r),(this._points.length>1e6||l+h>=e.size)&&(this._offsetPoints(),this._createSubCloudPoint(t)),l+=h,u()},u()}_parseLine(e){const t=e.split(/\s/g).filter(Boolean),r=t.length;3===r?this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2])}):4===r?(this._pointsHaveIntensity=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3])})):6===r?(this._pointsHaveColor=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),r:parseFloat(t[3]),g:parseFloat(t[4]),b:parseFloat(t[5])})):7===r?(this._pointsHaveIntensity=!0,this._pointsHaveColor=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),r:parseFloat(t[4]),g:parseFloat(t[5]),b:parseFloat(t[6])})):9===r?(this._pointsHaveColor=!0,this._pointsHaveNormals=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),r:parseFloat(t[3]),g:parseFloat(t[4]),b:parseFloat(t[5]),nx:parseFloat(t[6]),ny:parseFloat(t[7]),nz:parseFloat(t[8])})):10===r?(this._pointsHaveIntensity=!0,this._pointsHaveColor=!0,this._pointsHaveNormals=!0,this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),r:parseFloat(t[4]),g:parseFloat(t[5]),b:parseFloat(t[6]),nx:parseFloat(t[7]),ny:parseFloat(t[8]),nz:parseFloat(t[9])})):this.logger.error(`Invalid data line: ${e}`)}_parseLines(e){const t=e[0].split(/\s/g).filter(Boolean).length;3===t?this._parseLinesAsXYZ(e):4===t?this._parseLinesAsXYZI(e):6===t?this._parseLinesAsXYZRGB(e):7===t?this._parseLinesAsXYZIRGB(e):9===t?this._parseLinesAsXYZRGBnXnYnZ(e):10===t?this._parseLinesAsXYZIRGBnXnYnZ(e):this.logger.error(`Invalid data line: ${e}`)}_parseLinesAsXYZ(e){let t=[];for(let r=0,n=e.length;r<n;r++)t=e[r].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2])})}_parseLinesAsXYZI(e){this._pointsHaveIntensity=!0;let t=[];for(let r=0,n=e.length;r<n;r++)t=e[r].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3])})}_parseLinesAsXYZRGB(e){this._pointsHaveColor=!0;let t=[];for(let r=0,n=e.length;r<n;r++)t=e[r].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),r:parseFloat(t[3]),g:parseFloat(t[4]),b:parseFloat(t[5])})}_parseLinesAsXYZnXnYnZ(e){let t=[];for(let r=0,n=e.length;r<n;r++)t=e[r].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),nx:parseFloat(t[7]),ny:parseFloat(t[8]),nz:parseFloat(t[9])})}_parseLinesAsXYZIRGB(e){this._pointsHaveIntensity=!0,this._pointsHaveColor=!0;let t=[];for(let r=0,n=e.length;r<n;r++)t=e[r].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),r:parseFloat(t[4]),g:parseFloat(t[5]),b:parseFloat(t[6])})}_parseLinesAsXYZInXnYnZ(e){let t=[];for(let r=0,n=e.length;r<n;r++)t=e[r].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),nx:parseFloat(t[7]),ny:parseFloat(t[8]),nz:parseFloat(t[9])})}_parseLinesAsXYZRGBnXnYnZ(e){this._pointsHaveColor=!0,this._pointsHaveNormals=!0;let t=[];for(let r=0,n=e.length;r<n;r++)t=e[r].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),r:parseFloat(t[3]),g:parseFloat(t[4]),b:parseFloat(t[5]),nx:parseFloat(t[6]),ny:parseFloat(t[7]),nz:parseFloat(t[8])})}_parseLinesAsXYZIRGBnXnYnZ(e){this._pointsHaveIntensity=!0,this._pointsHaveColor=!0,this._pointsHaveNormals=!0;let t=[];for(let r=0,n=e.length;r<n;r++)t=e[r].split(/\s/g).filter(Boolean),this._points.push({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2]),i:parseFloat(t[3]),r:parseFloat(t[4]),g:parseFloat(t[5]),b:parseFloat(t[6]),nx:parseFloat(t[7]),ny:parseFloat(t[8]),nz:parseFloat(t[9])})}_parseLineB(e){const t=e.split(/\s/g).filter(Boolean),r=t.length,n=this._bufferIndex;3===r&&(this._positions[n]=parseFloat(t[0]),this._positions[n+1]=parseFloat(t[1]),this._positions[n+2]=parseFloat(t[2]),this._bufferIndex+=3)}_parseLineC(e){const t=e.split(/\s/g).filter(Boolean),r=t.length,n=this._bufferIndexC;3===r&&(this._positionsC[n]=Number.parseFloat(t[0]),this._positionsC[n+1]=Number.parseFloat(t[1]),this._positionsC[n+2]=Number.parseFloat(t[2]),this._bufferIndexC+=3)}_offsetPoints(){this._autoOffset&&(this._boundingBox.setFromPoints(this._points),this.setOffset(this._boundingBox.getCenter()));const e=this._offset.x,t=this._offset.y,r=this._offset.z;let n=null;for(let i=0,o=this._points.length;i<o;++i)n=this._points[i],n.x-=e,n.y-=t,n.z-=r}_createCloudPoint(e){const t=1e6,r=this._points.length,n=Math.ceil(r/t);let i=null,o=0,a=null;for(let r=0;r<n;++r){i=this._points.splice(0,t),o=i.length;const r=new L,n=new Float32Array(3*o),s=new Float32Array(3*o);let c=0,h=null;for(let e=0;e<o;++e)h=i[e],n[c]=h.x,n[c+1]=h.y,n[c+2]=h.z,this._pointsHaveColor?(s[c]=h.r/255,s[c+1]=h.g/255,s[c+2]=h.b/255):(s[c]=.1,s[c+1]=.2,s[c+2]=.5),c+=3;r.setAttribute("position",new k(n,3)),r.setAttribute("color",new k(s,3));const l=new N({size:.01,vertexColors:!0});a=new U(r,l),e.children.push(a)}}_createSubCloudPoint(e){const t=this._points.length,r=new L,n=new Float32Array(3*t),i=new Float32Array(3*t);let o=0,a=null;for(let e=0;e<t;++e)a=this._points[e],n[o]=a.x,n[o+1]=a.y,n[o+2]=a.z,this._pointsHaveColor?(i[o]=a.r/255,i[o+1]=a.g/255,i[o+2]=a.b/255):(i[o]=.1,i[o+1]=.2,i[o+2]=.5),o+=3;r.setAttribute("position",new k(n,3)),r.setAttribute("color",new k(i,3));const s=new N({size:.005,vertexColors:!0}),c=new U(r,s);c.rotation.x-=Math.PI/2,e.children.push(c),this._points=[]}}
/**
 * @module Loader/LASLoader
 * @desc A loader for ASC cloud point files.
 *
 * @requires {@link https://github.com/Itee/@itee/client @itee/client}
 * @requires {@link https://github.com/Itee/three-full three-full}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 * @example
 *
 * import { LASLoader } from '@itee/plugin-three'
 *
 * const loader = new LASLoader();
 *
 * // If the ASC file need to be offseted, it can be set before loading file.
 * loader.setOffset( {
 *      x: 1.0,
 *      y: 52.0,
 *      z: -5.0
 * } );
 *
 * // Then load the file and get the threejs Point Geometry
 * loader.load('/path/to/file.asc', function (geometry) {
 *
 *      scene.add( new Mesh( geometry ) );
 *
 * } );
 *
 */const Cu=new RegExp("\0","g"),Bu=kt({Created:0,Unclassified:1,Ground:2,LowVegetation:3,MediumVegetation:4,HighVegetation:5,Building:6,LowPoint:7,ModelKeyPoint:8,Water:9,OverlapPoints:12});class Eu{constructor(e=F,t=Gt){this.manager=e,this.logger=t,this._reader=new Bt,this._fullVersion="",this._boundingBox=new I,this._points=[],this._numberOfPoints=0,this._coloredPoints=!1,this._autoOffset=!1,this._offset={x:0,y:0,z:0},this.colorForPointClass={Created:{r:255,g:255,b:255},Unclassified:{r:60,g:60,b:60},Ground:{r:125,g:95,b:5},LowVegetation:{r:153,g:212,b:36},MediumVegetation:{r:52,g:148,b:25},HighVegetation:{r:27,g:77,b:13},Building:{r:153,g:138,b:95},LowPoint:{r:200,g:200,b:200},ModelKeyPoint:{r:237,g:31,b:31},Water:{r:31,g:186,b:237},OverlapPoints:{r:0,g:0,b:0}}}load(e,t,r,n,i){const o=new T(this.manager);o.setResponseType("arraybuffer"),o.load(e,e=>{this.parse(e,t,r,n,i)},r,n)}setOffset(e){this._offset=e,this._autoOffset=!1}parse(e,t,r,n){try{this._reader.buffer=e;if("LASF"!==this._reader.getString(4,!1))throw new Error("Invalid las file signature. Abort parsing !");this._reader.skipOffsetOf(24);const i=this._reader.getUint8(),o=this._reader.getUint8();this._reader.skipOffsetTo(0);const a=`${i}.${o}`,s=this._parseHeader(a),c=this._parseVariableLengthRecords(s),h=this._parsePointDataRecords(s,r);this.convert({Header:s,VariableLengthRecords:c,PointDataRecords:h},t,r,n)}catch(e){n(e)}}_parseHeader(e){switch(e){case"1.0":return this._parseHeader_1_0();case"1.1":return this._parseHeader_1_1();case"1.2":return this._parseHeader_1_2();case"1.3":return this._parseHeader_1_3();case"1.4":return this._parseHeader_1_4();default:throw new Error(`Insupported LAS file version: ${e}. Abort parsing !`)}}_parseHeader_1_0(){return{FileSignature:this._reader.getString(4),Reserved:this._reader.skipOffsetOf(Pt.Four),GUID_1:this._reader.getUint32(),GUID_2:this._reader.getUint16(),GUID_3:this._reader.getUint16(),GUID_4:this._reader.getUint8Array(8),VersionMajor:this._reader.getUint8(),VersionMinor:this._reader.getUint8(),SystemIdentifier:this._reader.getString(32).replace(Cu,""),GeneratingSoftware:this._reader.getString(32).replace(Cu,""),FlightDateJulian:this._reader.getUint16(),Year:this._reader.getUint16(),HeaderSize:this._reader.getUint16(),OffsetToPointData:this._reader.getUint32(),NumberOfVariableLengthRecords:this._reader.getUint32(),PointDataFormatID:this._reader.getUint8(),PointDataRecordLength:this._reader.getUint16(),NumberOfPointRecords:this._reader.getUint32(),NumberOfPointsByReturn:this._reader.getUint32Array(5),XScaleFactor:this._reader.getFloat64(),YScaleFactor:this._reader.getFloat64(),ZScaleFactor:this._reader.getFloat64(),XOffset:this._reader.getFloat64(),YOffset:this._reader.getFloat64(),ZOffset:this._reader.getFloat64(),MaxX:this._reader.getFloat64(),MinX:this._reader.getFloat64(),MaxY:this._reader.getFloat64(),MinY:this._reader.getFloat64(),MaxZ:this._reader.getFloat64(),MinZ:this._reader.getFloat64()}}_parseHeader_1_1(){return{FileSignature:this._reader.getString(4),FileSourceId:this._reader.getUint16(),Reserved:this._reader.skipOffsetOf(Pt.Two)&&null,GUID_1:this._reader.getUint32(),GUID_2:this._reader.getUint16(),GUID_3:this._reader.getUint16(),GUID_4:this._reader.getUint8Array(8),VersionMajor:this._reader.getUint8(),VersionMinor:this._reader.getUint8(),SystemIdentifier:this._reader.getString(32).replace(Cu,""),GeneratingSoftware:this._reader.getString(32).replace(Cu,""),FileCreationDayOfYear:this._reader.getUint16(),FileCreationYear:this._reader.getUint16(),HeaderSize:this._reader.getUint16(),OffsetToPointData:this._reader.getUint32(),NumberOfVariableLengthRecords:this._reader.getUint32(),PointDataFormatID:this._reader.getUint8(),PointDataRecordLength:this._reader.getUint16(),NumberOfPointRecords:this._reader.getUint32(),NumberOfPointsByReturn:this._reader.getUint32Array(5),XScaleFactor:this._reader.getFloat64(),YScaleFactor:this._reader.getFloat64(),ZScaleFactor:this._reader.getFloat64(),XOffset:this._reader.getFloat64(),YOffset:this._reader.getFloat64(),ZOffset:this._reader.getFloat64(),MaxX:this._reader.getFloat64(),MinX:this._reader.getFloat64(),MaxY:this._reader.getFloat64(),MinY:this._reader.getFloat64(),MaxZ:this._reader.getFloat64(),MinZ:this._reader.getFloat64()}}_parseHeader_1_2(){return{FileSignature:this._reader.getString(4),FileSourceId:this._reader.getUint16(),GlobalEncoding:{GPSTimeType:this._reader.getBit16()?"AdjustedStandardGPSTime":"GPSWeekTime",Reserved:this._reader.skipBitOffsetOf(15)},GUID_1:this._reader.getUint32(),GUID_2:this._reader.getUint16(),GUID_3:this._reader.getUint16(),GUID_4:this._reader.getUint8Array(8),VersionMajor:this._reader.getUint8(),VersionMinor:this._reader.getUint8(),SystemIdentifier:this._reader.getString(32).replace(Cu,""),GeneratingSoftware:this._reader.getString(32).replace(Cu,""),FileCreationDayOfYear:this._reader.getUint16(),FileCreationYear:this._reader.getUint16(),HeaderSize:this._reader.getUint16(),OffsetToPointData:this._reader.getUint32(),NumberOfVariableLengthRecords:this._reader.getUint32(),PointDataFormatID:this._reader.getUint8(),PointDataRecordLength:this._reader.getUint16(),NumberOfPointRecords:this._reader.getUint32(),NumberOfPointsByReturn:this._reader.getUint32Array(5),XScaleFactor:this._reader.getFloat64(),YScaleFactor:this._reader.getFloat64(),ZScaleFactor:this._reader.getFloat64(),XOffset:this._reader.getFloat64(),YOffset:this._reader.getFloat64(),ZOffset:this._reader.getFloat64(),MaxX:this._reader.getFloat64(),MinX:this._reader.getFloat64(),MaxY:this._reader.getFloat64(),MinY:this._reader.getFloat64(),MaxZ:this._reader.getFloat64(),MinZ:this._reader.getFloat64()}}_parseHeader_1_3(){return{FileSignature:this._reader.getString(4),FileSourceId:this._reader.getUint16(),GlobalEncoding:{GPSTimeType:this._reader.getBit16()?"AdjustedStandardGPSTime":"GPSWeekTime",WaveformDataPacketsInternal:this._reader.getBit16(),WaveformDataPacketsExternal:this._reader.getBit16(),ReturnNumbersHaveBeenSyntheticallyGenerated:this._reader.getBit16(),Reserved:this._reader.skipBitOffsetOf(12)},GUID_1:this._reader.getUint32(),GUID_2:this._reader.getUint16(),GUID_3:this._reader.getUint16(),GUID_4:this._reader.getUint8Array(8),VersionMajor:this._reader.getUint8(),VersionMinor:this._reader.getUint8(),SystemIdentifier:this._reader.getString(32).replace(Cu,""),GeneratingSoftware:this._reader.getString(32).replace(Cu,""),FileCreationDayOfYear:this._reader.getUint16(),FileCreationYear:this._reader.getUint16(),HeaderSize:this._reader.getUint16(),OffsetToPointData:this._reader.getUint32(),NumberOfVariableLengthRecords:this._reader.getUint32(),PointDataFormatID:this._reader.getUint8(),PointDataRecordLength:this._reader.getUint16(),NumberOfPointRecords:this._reader.getUint32(),NumberOfPointsByReturn:this._reader.getUint32Array(5),XScaleFactor:this._reader.getFloat64(),YScaleFactor:this._reader.getFloat64(),ZScaleFactor:this._reader.getFloat64(),XOffset:this._reader.getFloat64(),YOffset:this._reader.getFloat64(),ZOffset:this._reader.getFloat64(),MaxX:this._reader.getFloat64(),MinX:this._reader.getFloat64(),MaxY:this._reader.getFloat64(),MinY:this._reader.getFloat64(),MaxZ:this._reader.getFloat64(),MinZ:this._reader.getFloat64(),StartOfWaveformDataPacketRecord:this._reader.getUint64()}}_parseHeader_1_4(){return{FileSignature:this._reader.getString(4),FileSourceId:this._reader.getUint16(),GlobalEncoding:{GPSTimeType:this._reader.getBit16()?"AdjustedStandardGPSTime":"GPSWeekTime",WaveformDataPacketsInternal:this._reader.getBit16(),WaveformDataPacketsExternal:this._reader.getBit16(),ReturnNumbersHaveBeenSyntheticallyGenerated:this._reader.getBit16(),WKT:this._reader.getBit16()?"WKT":"GeoTIFF",Reserved:this._reader.skipBitOffsetOf(11)},GUID_1:this._reader.getUint32(),GUID_2:this._reader.getUint16(),GUID_3:this._reader.getUint16(),GUID_4:this._reader.getUint8Array(8),VersionMajor:this._reader.getUint8(),VersionMinor:this._reader.getUint8(),SystemIdentifier:this._reader.getString(32).replace(Cu,""),GeneratingSoftware:this._reader.getString(32).replace(Cu,""),FileCreationDayOfYear:this._reader.getUint16(),FileCreationYear:this._reader.getUint16(),HeaderSize:this._reader.getUint16(),OffsetToPointData:this._reader.getUint32(),NumberOfVariableLengthRecords:this._reader.getUint32(),PointDataRecordFormat:this._reader.getUint8(),PointDataRecordLength:this._reader.getUint16(),LegacyNumberOfPointRecords:this._reader.getUint32(),LegacyNumberOfPointsByReturn:this._reader.getUint32Array(5),XScaleFactor:this._reader.getFloat64(),YScaleFactor:this._reader.getFloat64(),ZScaleFactor:this._reader.getFloat64(),XOffset:this._reader.getFloat64(),YOffset:this._reader.getFloat64(),ZOffset:this._reader.getFloat64(),MaxX:this._reader.getFloat64(),MinX:this._reader.getFloat64(),MaxY:this._reader.getFloat64(),MinY:this._reader.getFloat64(),MaxZ:this._reader.getFloat64(),MinZ:this._reader.getFloat64(),StartOfWaveformDataPacketRecord:this._reader.getUint64(),StartOfFirstExtendedVariableLengthRecord:this._reader.getUint64(),NumberOfExtendedVariableLengthRecords:this._reader.getUint32(),NumberOfPointRecords:this._reader.getUint64(),NumberOfPointsByReturn:this._reader.getUint64Array(15)}}_parseVariableLengthRecords(e){const t=`${e.VersionMajor}.${e.VersionMinor}`,r=[];for(let n=0;n<e.NumberOfVariableLengthRecords;n++){const e=this._parseVariableLengthRecordHeader();
//!\ Legacy => RecordSignature = Reserved since las v1.1
if("1.0"===t&&43707!==e.Reserved)throw new Error("Invalid variable length record header signature... Abort parsing !");const n=e.UserID,i=e.RecordID,o=e.RecordLengthAfterHeader,a=this._parseVariableLengthRecordContent(n,i,o);r.push({Header:e,Content:a})}return r}_parseVariableLengthRecordHeader(){return{Reserved:this._reader.getUint16(),UserID:this._reader.getString(16).replace(Cu,""),RecordID:this._reader.getUint16(),RecordLengthAfterHeader:this._reader.getUint16(),Description:this._reader.getString(32).replace(Cu,"")}}_parseVariableLengthRecordContent(e,t,r){switch(e){case"LASF_Projection":return this._parseProjectionRecord(t,r);case"LASF_Spec":return this._parseSpecRecord();default:return this._parseCustomRecord(r)}}_parseProjectionRecord(e,t){switch(e){case 2111:return this._parseOGCMathTransformWKT();case 2112:return this._parseOGCCoordinateTransformWKT();case 34735:return this._parseGeoKeyDirectoryTag();case 34736:return this._parseGeoDoubleParamsTag(t);case 34737:return this._parseGeoASCIIParamsTag(t);default:console.error("Unable to determine LASF_Projection underlying type ! Skip current record."),this._reader.skipOffsetOf(t)}}_parseOGCMathTransformWKT(){}_parseOGCCoordinateTransformWKT(){}_parseGeoKeyDirectoryTag(){const e={wKeyDirectoryVersion:this._reader.getUint16(),wKeyRevision:this._reader.getUint16(),wMinorRevision:this._reader.getUint16(),wNumberOfKeys:this._reader.getUint16(),sKeyEntry:[]};for(let t=0;t<e.wNumberOfKeys;t++)e.sKeyEntry.push({wKeyID:this._reader.getUint16(),wTIFFTagLocation:this._reader.getUint16(),wCount:this._reader.getUint16(),wValue_Offset:this._reader.getUint16()});return e}_parseGeoDoubleParamsTag(e){const t=e/Pt.Height,r=[];for(let e=0;e<t;e++)r[e]=this._reader.getFloat64();return r}_parseGeoASCIIParamsTag(e){return this._reader.getString(e).replace(Cu,"")}_parseSpecRecord(e){if(!(e<100)){if(e>=100&&e<355)return this._parseWaveformPacketDesciptor();if(65535===e)return this._parseWaveformDataPacket();throw new RangeError(`Invalid spec record id: ${e}`)}switch(e){case 0:return this._parseClassificationLookupRecord();case 1:return this._parseHeaderLookupForFlightLinesRecord();case 2:return this._parseHistogramRecord();case 3:return this._parseTextAreaDescriptionRecord();case 4:return this._parseExtraBytesRecord();case 7:return this._parseSupersededRecord();default:throw new RangeError(`Invalid spec record id: ${e}`)}}_parseClassificationLookupRecord(){const e=[];for(let t=0;t<256;t++)e.push({ClassNumber:this._reader.getUint8(),Description:this._reader.getString(15).replace(Cu,"")});return e}_parseHeaderLookupForFlightLinesRecord(){return{FileMarkerNumber:this._reader.getUint8(),Filename:this._reader.getString(256).replace(Cu,"")}}_parseHistogramRecord(){}_parseTextAreaDescriptionRecord(){}_parseExtraBytesRecord(){}_parseSupersededRecord(){}_parseWaveformPacketDesciptor(){}_parseWaveformDataPacket(){}_parseCustomRecord(e){const t=new Uint8Array(e);for(let r=0;r<e;r++)t[r]=this._reader.getUint8();return t}_parsePointDataRecords(e,t){const r=e.OffsetToPointData;this._reader.offset!==r&&(console.error("The current reader offset does not match the header offset to point data ! Defaulting to header value."),this._reader.skipOffsetTo(r));const n=e.VersionMinor<4?e.PointDataFormatID:e.PointDataRecordFormat,i=this._getPointDataRecordFormat(n),o=e.VersionMinor<4?e.NumberOfPointRecords:e.LegacyNumberOfPointRecords,a=new Array(o);for(let e=0;e<o;e++)a[e]=i(),e%1e5==0&&t(new ProgressEvent("ParsePointDataRecords",{lengthComputable:!0,loaded:e,total:o}));return a}_getPointDataRecordFormat(e){switch(e){case 0:return this._parsePointDataRecordFormat_0.bind(this);case 1:return this._parsePointDataRecordFormat_1.bind(this);case 2:return this._parsePointDataRecordFormat_2.bind(this);case 3:return this._parsePointDataRecordFormat_3.bind(this);case 4:return this._parsePointDataRecordFormat_4.bind(this);case 5:return this._parsePointDataRecordFormat_5.bind(this);case 6:return this._parsePointDataRecordFormat_6.bind(this);case 7:return this._parsePointDataRecordFormat_7.bind(this);case 8:return this._parsePointDataRecordFormat_8.bind(this);case 9:return this._parsePointDataRecordFormat_9.bind(this);case 10:return this._parsePointDataRecordFormat_10.bind(this);default:throw new RangeError(`Invalid PointDataRecordFormat parameter: ${e}`)}}_parsePointDataRecordFormat_0(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits8(3),NumberOfReturns:this._reader.getBits8(3),ScanDirectionFlag:this._reader.getBit8(),EdgeOfFlightLine:this._reader.getBit8(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},ScanAngleRank:this._reader.getInt8(),UserData:this._reader.getUint8(),PointSourceId:this._reader.getUint16()}}_parsePointDataRecordFormat_1(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits8(3),NumberOfReturns:this._reader.getBits8(3),ScanDirectionFlag:this._reader.getBit8(),EdgeOfFlightLine:this._reader.getBit8(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},ScanAngleRank:this._reader.getInt8(),UserData:this._reader.getUint8(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64()}}_parsePointDataRecordFormat_2(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits8(3),NumberOfReturns:this._reader.getBits8(3),ScanDirectionFlag:this._reader.getBit8(),EdgeOfFlightLine:this._reader.getBit8(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},ScanAngleRank:this._reader.getInt8(),UserData:this._reader.getUint8(),PointSourceId:this._reader.getUint16(),R:this._reader.getUint16(),G:this._reader.getUint16(),B:this._reader.getUint16()}}_parsePointDataRecordFormat_3(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits8(3),NumberOfReturns:this._reader.getBits8(3),ScanDirectionFlag:this._reader.getBit8(),EdgeOfFlightLine:this._reader.getBit8(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},ScanAngleRank:this._reader.getInt8(),UserData:this._reader.getUint8(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),R:this._reader.getUint16(),G:this._reader.getUint16(),B:this._reader.getUint16()}}_parsePointDataRecordFormat_4(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits8(3),NumberOfReturns:this._reader.getBits8(3),ScanDirectionFlag:this._reader.getBit8(),EdgeOfFlightLine:this._reader.getBit8(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},ScanAngleRank:this._reader.getInt8(),UserData:this._reader.getUint8(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),WavePacketDescriptorIndex:this._reader.getUint8(),ByteOffsetToWaveformData:this._reader.getUint64(),WaveformPacketSizeInBytes:this._reader.getUint32(),ReturnPointWaveformLocation:this._reader.getFloat32(),Xt:this._reader.getFloat32(),Yt:this._reader.getFloat32(),Zt:this._reader.getFloat32()}}_parsePointDataRecordFormat_5(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits8(3),NumberOfReturns:this._reader.getBits8(3),ScanDirectionFlag:this._reader.getBit8(),EdgeOfFlightLine:this._reader.getBit8(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},ScanAngleRank:this._reader.getInt8(),UserData:this._reader.getUint8(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),R:this._reader.getUint16(),G:this._reader.getUint16(),B:this._reader.getUint16(),WavePacketDescriptorIndex:this._reader.getUint8(),ByteOffsetToWaveformData:this._reader.getUint64(),WaveformPacketSizeInBytes:this._reader.getUint32(),ReturnPointWaveformLocation:this._reader.getFloat32(),Xt:this._reader.getFloat32(),Yt:this._reader.getFloat32(),Zt:this._reader.getFloat32()}}_parsePointDataRecordFormat_6(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits16(4),NumberOfReturns:this._reader.getBits16(4),ClassificationFlags:this._reader.getBits16(4),ScannerChannel:this._reader.getBits16(2),ScanDirectionFlag:this._reader.getBit16(),EdgeOfFlightLine:this._reader.getBit16(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},UserData:this._reader.getUint8(),ScanAngle:this._reader.getInt16(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64()}}_parsePointDataRecordFormat_7(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits16(4),NumberOfReturns:this._reader.getBits16(4),ClassificationFlags:this._reader.getBits16(4),ScannerChannel:this._reader.getBits16(2),ScanDirectionFlag:this._reader.getBit16(),EdgeOfFlightLine:this._reader.getBit16(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},UserData:this._reader.getUint8(),ScanAngle:this._reader.getInt16(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),R:this._reader.getUint16(),G:this._reader.getUint16(),B:this._reader.getUint16()}}_parsePointDataRecordFormat_8(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits16(4),NumberOfReturns:this._reader.getBits16(4),ClassificationFlags:this._reader.getBits16(4),ScannerChannel:this._reader.getBits16(2),ScanDirectionFlag:this._reader.getBit16(),EdgeOfFlightLine:this._reader.getBit16(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},UserData:this._reader.getUint8(),ScanAngle:this._reader.getInt16(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),R:this._reader.getUint16(),G:this._reader.getUint16(),B:this._reader.getUint16(),NIR:this._reader.getUint16()}}_parsePointDataRecordFormat_9(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits16(4),NumberOfReturns:this._reader.getBits16(4),ClassificationFlags:this._reader.getBits16(4),ScannerChannel:this._reader.getBits16(2),ScanDirectionFlag:this._reader.getBit16(),EdgeOfFlightLine:this._reader.getBit16(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},UserData:this._reader.getUint8(),ScanAngle:this._reader.getInt16(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),WavePacketDescriptorIndex:this._reader.getUint8(),ByteOffsetToWaveformData:this._reader.getUint64(),WaveformPacketSizeInBytes:this._reader.getUint32(),ReturnPointWaveformLocation:this._reader.getFloat32(),Xt:this._reader.getFloat32(),Yt:this._reader.getFloat32(),Zt:this._reader.getFloat32()}}_parsePointDataRecordFormat_10(){return{X:this._reader.getInt32(),Y:this._reader.getInt32(),Z:this._reader.getInt32(),Intensity:this._reader.getUint16(),ReturnNumber:this._reader.getBits16(4),NumberOfReturns:this._reader.getBits16(4),ClassificationFlags:this._reader.getBits16(4),ScannerChannel:this._reader.getBits16(2),ScanDirectionFlag:this._reader.getBit16(),EdgeOfFlightLine:this._reader.getBit16(),Classification:{Class:this._reader.getBits8(5),Synthetic:this._reader.getBit8(),KeyPoint:this._reader.getBit8(),Withheld:this._reader.getBit8()},UserData:this._reader.getUint8(),ScanAngle:this._reader.getInt16(),PointSourceId:this._reader.getUint16(),GPSTime:this._reader.getFloat64(),R:this._reader.getUint16(),G:this._reader.getUint16(),B:this._reader.getUint16(),NIR:this._reader.getUint16(),WavePacketDescriptorIndex:this._reader.getUint8(),ByteOffsetToWaveformData:this._reader.getUint64(),WaveformPacketSizeInBytes:this._reader.getUint32(),ReturnPointWaveformLocation:this._reader.getFloat32(),Xt:this._reader.getFloat32(),Yt:this._reader.getFloat32(),Zt:this._reader.getFloat32()}}convert(e,t,r,n){try{const n=new z;n.name="Cloud",n.matrixAutoUpdate=!1,n.position.x=e.Header.XOffset,n.position.y=e.Header.YOffset,n.position.z=e.Header.ZOffset,n.userData={header:e.Header,records:e.VariableLengthRecords},this._createCloudPoints(n,e,r),t(n)}catch(e){n(e)}}_offsetPoints(){this._autoOffset&&(this._boundingBox.setFromPoints(this._points),this.setOffset(this._boundingBox.getCenter()));const e=this._offset.x,t=this._offset.y,r=this._offset.z;let n=null;for(let i=0,o=this._points.length;i<o;++i)n=this._points[i],n.x-=e,n.y-=t,n.z-=r}_createCloudPoints(e,t,r){const n={0:"Created",1:"Unclassified",2:"Ground",3:"LowVegetation",4:"MediumVegetation",5:"HighVegetation",6:"Building",7:"LowPoint",8:"ModelKeyPoint",9:"Water",12:"OverlapPoints"};let i=-1/0;for(let e of t.PointDataRecords){const t=e.Intensity;t>i&&(i=t)}const o=t.Header.XScaleFactor,a=t.Header.YScaleFactor,c=t.Header.ZScaleFactor,h=1e6,l=t.PointDataRecords.length,u=Math.ceil(l/h),d=t.Header.VersionMinor<4?t.Header.PointDataFormatID:t.Header.PointDataRecordFormat,m=![0,1,4,6,9].includes(d),f=new N({size:.01,vertexColors:!0});let p=0,g=null,_=null;for(let d=0;d<u;++d){g=t.PointDataRecords.splice(0,h),p=g.length;const u=new L,y=new Float32Array(3*p),w=new Float32Array(3*p);let b=0,M=null;for(let e=0;e<p;++e){const t=e+d*h;if(t%1e5==0&&r(new ProgressEvent("ConvertPointDataRecords",{lengthComputable:!0,loaded:t,total:l})),M=g[e],y[b]=M.X*o,y[b+1]=M.Y*a,y[b+2]=M.Z*c,m)w[b]=M.R/65535,w[b+1]=M.G/65535,w[b+2]=M.B/65535;else{const e=this.colorForPointClass[n[M.Classification.Class]];if(s(e))w[b]=e.r/255,w[b+1]=e.g/255,w[b+2]=e.b/255;else{const e=M.Intensity;w[b]=e/i,w[b+1]=e/i,w[b+2]=e/i}}b+=3}u.setAttribute("position",new k(y,3)),u.setAttribute("color",new k(w,3)),_=new U(u,f),e.add(_)}}_createSubCloudPoint(e){const t=this._points.length,r=new L,n=new Float32Array(3*t),i=new Float32Array(3*t);let o=0,a=null;for(let e=0;e<t;++e)a=this._points[e],n[o]=a.x,n[o+1]=a.y,n[o+2]=a.z,this._pointsHaveColor?(i[o]=a.r/255,i[o+1]=a.g/255,i[o+2]=a.b/255):(i[o]=.1,i[o+1]=.2,i[o+2]=.5),o+=3;r.setAttribute("position",new k(n,3)),r.setAttribute("color",new k(i,3));const s=new N({size:.005,vertexColors:!0}),c=new U(r,s);c.rotation.x-=Math.PI/2,e.children.push(c),this._points=[]}}class Pu{constructor(e,t){if(this.m_bits=new Array,t&&t.length)for(let e=0;e<t.length;e++)this.m_bits.push(t[e]?Pu._ON:Pu._OFF);else isNaN(t)||(this.m_bits=Pu.shred(t).m_bits);if(e&&this.m_bits.length!==e)if(this.m_bits.length<e)for(let t=this.m_bits.length;t<e;t++)this.m_bits.push(Pu._OFF);else for(let t=e;t>this.m_bits.length;t--)this.m_bits.pop()}static _intersect(e,t){return e===Pu._ON&&t===Pu._ON?Pu._ON:Pu._OFF}static _union(e,t){return e===Pu._ON||t===Pu._ON?Pu._ON:Pu._OFF}static _difference(e,t){return e===Pu._ON&&t!==Pu._ON?Pu._ON:Pu._OFF}static _getLen(e,t,r){var n=e.getLength(),i=t.getLength();return r?i:n}static getUnion(e,t){for(var r=Pu._getLen(e,t,!0),n=new Pu(r),i=0;i<r;i++)n.setAt(i,Pu._union(e.getAt(i),t.getAt(i)));return n}static getIntersection(e,t){for(var r=Pu._getLen(e,t,!0),n=new Pu(r),i=0;i<r;i++)n.setAt(i,Pu._intersect(e.getAt(i),t.getAt(i)));return n}static getDifference(e,t){for(var r=Pu._getLen(e,t,!0),n=new Pu(r),i=0;i<r;i++)n.setAt(i,Pu._difference(e.getAt(i),t.getAt(i)));return n}static shred(e){var t=new Array,r=e;do{t.push(r%2),r=Math.floor(r/2)}while(r>0);return new Pu(t.length,t.reverse())}getLength(){return this.m_bits.length}getAt(e){return e<this.m_bits.length?this.m_bits[e]:null}setAt(e,t){e<this.m_bits.length&&(this.m_bits[e]=t?Pu._ON:Pu._OFF)}resize(e){for(var t=new Array,r=0;r<e;r++)r<this.m_bits.length?t.push(this.m_bits[r]):t.push(Pu._OFF);this.m_bits=t}getCompliment(){for(var e=new Pu(this.m_bits.length),t=0;t<this.m_bits.length;t++)e.setAt(t,this.m_bits[t]?Pu._OFF:Pu._ON);return e}toString(){for(var e=new String,t=0;t<this.m_bits.length;t++)e=e.concat(this.m_bits[t]===Pu._ON?"1":"0");return e}toNumber(){for(var e=0,t=0,r=this.m_bits.length-1;r>=0;r--)this.m_bits[r]===Pu._ON&&(t+=Math.pow(2,e)),e++;return t}}Pu._ON=1,Pu._OFF=0;class Du{static getBit(e,t){return e&1<<t?1:0}static setBit(e,t){return e|1<<t}static clearBit(e,t){return e&~(1<<t)}static updateBit(e,t,r){return e&~(1<<t)|(r?1:0)<<t}static getBits(e,t){let r=0;for(let n of t)Du.getBit(e,n)&&(r=Du.setBit(r,n));return r}}
/**
 * @module Controllers/CameraControls
 * @desc This module export CameraControls class and CameraControlMode enum values.
 *
 * @requires {@link module: [@itee/client]{@link https://github.com/Itee/@itee/client}}
 * @requires {@link module: [@itee/utils]{@link https://github.com/Itee/@itee/utils}}
 * @requires {@link module: [@itee/validators]{@link https://github.com/Itee/@itee/validators}}
 * @requires {@link module: [three-full]{@link https://github.com/Itee/three-full}}
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @example
 *
 * import { CameraControls, CameraControlMode } from '@itee/plugin-three'
 *
 */const Ou=new D(0,0,-1),Au=new D(0,0,1),Gu=new D(0,1,0),Iu=new D(0,-1,0),zu=new D(1,0,0),Lu=new D(-1,0,0),ku=kt({None:0,Rotating:1,Panning:2,Rolling:3,Zooming:4,Moving:5}),Nu=kt({FirstPerson:1,Orbit:2,Fly:3,Path:4});class Uu extends R{constructor(e={}){const t={logger:Gt,camera:null,target:new H,mode:Nu.Orbit,domElement:"function"==typeof importScripts?null:window,...e};super(),this._handlers={onMouseEnter:this._onMouseEnter.bind(this),onMouseLeave:this._onMouseLeave.bind(this),onMouseDown:this._onMouseDown.bind(this),onMouseMove:this._onMouseMove.bind(this),onMouseWheel:this._onMouseWheel.bind(this),onMouseUp:this._onMouseUp.bind(this),onDblClick:this._onDblClick.bind(this),onTouchStart:this._onTouchStart.bind(this),onTouchEnd:this._onTouchEnd.bind(this),onTouchCancel:this._onTouchCancel.bind(this),onTouchLeave:this._onTouchLeave.bind(this),onTouchMove:this._onTouchMove.bind(this),onKeyDown:this._onKeyDown.bind(this),onKeyUp:this._onKeyUp.bind(this)},this.logger=t.logger,this.camera=t.camera,this.target=t.target,this.mode=t.mode,this.domElement=t.domElement,this.enabled=!0,this._paths=[],this._trackPath=!1,this._cameraJump=.1,this._currentPathPosition=null,this._currentPathOffset=0,this._currentPathIndex=0,this._currentPath=null,this._maxJump=1,this._lockedTarget=!0,this.previousTouches=[],this.canMove=!0,this.moveSpeed=1,this.canFront=!0,this.frontMinimum=-1/0,this.frontMaximum=-1/0,this.frontMinSpeed=0,this.frontSpeed=1,this.frontMaxSpeed=1/0,this.frontAcceleration=1,this.canBack=!0,this.backMinimum=-1/0,this.backMaximum=-1/0,this.backMinSpeed=0,this.backSpeed=1,this.backMaxSpeed=1/0,this.backAcceleration=1,this.canUp=!0,this.upMinimum=-1/0,this.upMaximum=-1/0,this.upMinSpeed=0,this.upSpeed=1,this.upMaxSpeed=1/0,this.upAcceleration=1,this.canDown=!0,this.downMinimum=-1/0,this.downMaximum=-1/0,this.downMinSpeed=0,this.downSpeed=1,this.downMaxSpeed=1/0,this.downAcceleration=1,this.canLeft=!0,this.leftMinimum=-1/0,this.leftMaximum=-1/0,this.leftMinSpeed=0,this.leftSpeed=1,this.leftMaxSpeed=1/0,this.leftAcceleration=1,this.canRight=!0,this.rightMinimum=-1/0,this.rightMaximum=-1/0,this.rightMinSpeed=0,this.rightSpeed=1,this.rightMaxSpeed=1/0,this.rightAcceleration=1,this.canRotate=!0,this.minPolarAngle=.001,this.maxPolarAngle=Math.PI-.001,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.rotateMinSpeed=0,this.rotateSpeed=1,this.rotateMaxSpeed=1/0,this.rotateAcceleration=1,this.canPan=!0,this.panMinimum=-1/0,this.panMaximum=-1/0,this.panMinSpeed=0,this.panSpeed=.001,this.panMaxSpeed=1/0,this.panAcceleration=1,this.canRoll=!0,this.rollMinimum=-1/0,this.rollMaximum=-1/0,this.rollMinSpeed=0,this.rollSpeed=.1,this.rollMaxSpeed=1/0,this.rollAcceleration=1,this.canZoom=!0,this.zoomMinimum=0,this.zoomMaximum=1/0,this.zoomMinSpeed=0,this.zoomSpeed=.001,this.zoomMaxSpeed=1/0,this.zoomAcceleration=1,this.canLookAt=!0,this.actionsMap={front:[Dt.Z.value,Dt.UP_ARROW.value],back:[Dt.S.value,Dt.DOWN_ARROW.value],up:[Dt.A.value,Dt.PAGE_UP.value],down:[Dt.E.value,Dt.PAGE_DOWN.value],left:[Dt.Q.value,Dt.LEFT_ARROW.value],right:[Dt.D.value,Dt.RIGHT_ARROW.value],rotate:[Ot.Left.value],pan:[Ot.Middle.value],roll:{left:[Dt.R.value],right:[Dt.T.value]},zoom:[Ot.Wheel.value],lookAtFront:[Dt.NUMPAD_2.value],lookAtFrontLeft:[Dt.NUMPAD_3.value],lookAtFrontRight:[Dt.NUMPAD_1.value],lookAtBack:[Dt.NUMPAD_8.value],lookAtBackLeft:[Dt.NUMPAD_9.value],lookAtBackRight:[Dt.NUMPAD_7.value],lookAtUp:[Dt.NUMPAD_5.value],lookAtDown:[Dt.NUMPAD_0.value],lookAtLeft:[Dt.NUMPAD_6.value],lookAtRight:[Dt.NUMPAD_4.value]},this._state=ku.None}get camera(){return this._camera}set camera(e){if(l(e))throw new Error("Camera cannot be null ! Expect an instance of Camera");if(g(e))throw new Error("Camera cannot be undefined ! Expect an instance of Camera");if(!e.isCamera)throw new Error(`Camera cannot be an instance of ${e.constructor.name}. Expect an instance of Camera.`);this._camera=e}get target(){return this._target}set target(e){if(l(e))throw new Error("Target cannot be null ! Expect an instance of Object3D.");if(g(e))throw new Error("Target cannot be undefined ! Expect an instance of Object3D.");if(!e.isObject3D)throw new Error(`Target cannot be an instance of ${e.constructor.name}. Expect an instance of Object3D.`);this._target=e}get mode(){return this._mode}set mode(e){if(l(e))throw new Error("Mode cannot be null ! Expect a value from CameraControlMode enum.");if(g(e))throw new Error("Mode cannot be undefined ! Expect a value from CameraControlMode enum.");if(!Nu.includes(e))throw new Error(`Mode cannot be an instance of ${e.constructor.name}. Expect a value from TCameraControlMode enum.`);this._mode=e,this._trackPath&&this._initPathDisplacement()}get paths(){return this._paths}set paths(e){this._paths=e}get trackPath(){return this._trackPath}set trackPath(e){if(_(e))throw new Error(`Track path cannot be an instance of ${e.constructor.name}. Expect a boolean.`);this._trackPath=e,this._trackPath&&this._initPathDisplacement()}get domElement(){return this._domElement}set domElement(e){if(l(e))throw new Error("DomElement cannot be null ! Expect an instance of HTMLDocument.");if(g(e))throw new Error("DomElement cannot be undefined ! Expect an instance of HTMLDocument.");if(!["Window","HTMLDocument","HTMLDivElement","HTMLCanvasElement","OffscreenCanvas"].includes(e.constructor.name))throw new Error(`DomElement cannot be an instance of ${e.constructor.name}. Expect an instance of Window, HTMLDocument or HTMLDivElement.`);this._domElement&&(this._domElement.removeEventListener("mouseenter",this._handlers.onMouseEnter,!1),this._domElement.removeEventListener("mouseleave",this._handlers.onMouseLeave,!1),this.dispose()),this._domElement=e,this._domElement.addEventListener("mouseenter",this._handlers.onMouseEnter,!1),this._domElement.addEventListener("mouseleave",this._handlers.onMouseLeave,!1),this.impose()}get handlers(){return this._handlers}setCamera(e){return this.camera=e,this}setTarget(e){return this.target=e,this}setMode(e){return this.mode=e,this}setPaths(e){return this.paths=e,this}addPath(e){return this._paths.push(e),this}setTrackPath(e){return this.trackPath=e,this}setDomElement(e){return this.domElement=e,this}impose(){this._domElement.addEventListener("keydown",this._handlers.onKeyDown,!1),this._domElement.addEventListener("keyup",this._handlers.onKeyUp,!1),this._domElement.addEventListener("dblclick",this._handlers.onDblClick,!1),this._domElement.addEventListener("mousedown",this._handlers.onMouseDown,!1),this._domElement.addEventListener("mousemove",this._handlers.onMouseMove,!1),this._domElement.addEventListener("mouseup",this._handlers.onMouseUp,!1),this._domElement.addEventListener("wheel",this._handlers.onMouseWheel,{capture:!0,once:!1,passive:!1}),this._domElement.addEventListener("touchcancel",this._handlers.onTouchCancel,!1),this._domElement.addEventListener("touchend",this._handlers.onTouchEnd,!1),this._domElement.addEventListener("touchleave",this._handlers.onTouchLeave,!1),this._domElement.addEventListener("touchmove",this._handlers.onTouchMove,{capture:!0,once:!1,passive:!1}),this._domElement.addEventListener("touchstart",this._handlers.onTouchStart,{capture:!0,once:!1,passive:!1}),this.dispatchEvent({type:"impose"})}dispose(){this._domElement.removeEventListener("keydown",this._handlers.onKeyDown,!1),this._domElement.removeEventListener("keyup",this._handlers.onKeyUp,!1),this._domElement.removeEventListener("dblclick",this._handlers.onDblClick,!1),this._domElement.removeEventListener("mousedown",this._handlers.onMouseDown,!1),this._domElement.removeEventListener("mousemove",this._handlers.onMouseMove,!1),this._domElement.removeEventListener("mouseup",this._handlers.onMouseUp,!1),this._domElement.removeEventListener("wheel",this._handlers.onMouseWheel,{capture:!0,once:!1,passive:!1}),this._domElement.removeEventListener("touchcancel",this._handlers.onTouchCancel,!1),this._domElement.removeEventListener("touchend",this._handlers.onTouchEnd,!1),this._domElement.removeEventListener("touchleave",this._handlers.onTouchLeave,!1),this._domElement.removeEventListener("touchmove",this._handlers.onTouchMove,{capture:!0,once:!1,passive:!1}),this._domElement.removeEventListener("touchstart",this._handlers.onTouchStart,{capture:!0,once:!1,passive:!1}),this.dispatchEvent({type:"dispose"})}update(){}setCameraPosition(e){return this._camera.position.copy(e),this._camera.lookAt(this._target.position),this}setTargetPosition(e){return this._target.position.copy(e),this._camera.lookAt(this._target.position),this}_preventEvent(e){e.preventDefault&&e.preventDefault()}_consumeEvent(e){e.cancelable&&e.stopImmediatePropagation&&e.stopImmediatePropagation()}_onKeyDown(e){if(!this.enabled)return;this._preventEvent(e);const t=this.actionsMap,r=e.keyCode;t.front.includes(r)?(this._front(),this._consumeEvent(e)):t.back.includes(r)?(this._back(),this._consumeEvent(e)):t.up.includes(r)?(this._up(),this._consumeEvent(e)):t.down.includes(r)?(this._down(),this._consumeEvent(e)):t.left.includes(r)?(this._left(),this._consumeEvent(e)):t.right.includes(r)?(this._right(),this._consumeEvent(e)):t.rotate.includes(r)?this._rotate(1):t.pan.includes(r)?(this._pan(1),this._consumeEvent(e)):t.roll.left.includes(r)?(this._roll(1),this._consumeEvent(e)):t.roll.right.includes(r)?(this._roll(-1),this._consumeEvent(e)):t.zoom.includes(r)?(this._zoom(1),this._consumeEvent(e)):t.lookAtFront.includes(r)?(this._lookAt(Ou),this._consumeEvent(e)):t.lookAtFrontLeft.includes(r)?(this._lookAt(new D(-1,0,-1).normalize()),this._consumeEvent(e)):t.lookAtFrontRight.includes(r)?(this._lookAt(new D(1,0,-1).normalize()),this._consumeEvent(e)):t.lookAtBack.includes(r)?(this._lookAt(Au),this._consumeEvent(e)):t.lookAtBackLeft.includes(r)?(this._lookAt(new D(-1,0,1).normalize()),this._consumeEvent(e)):t.lookAtBackRight.includes(r)?(this._lookAt(new D(1,0,1).normalize()),this._consumeEvent(e)):t.lookAtUp.includes(r)?(this._lookAt(Gu),this._consumeEvent(e)):t.lookAtDown.includes(r)?(this._lookAt(Iu),this._consumeEvent(e)):t.lookAtLeft.includes(r)?(this._lookAt(Lu),this._consumeEvent(e)):t.lookAtRight.includes(r)&&(this._lookAt(zu),this._consumeEvent(e))}_onKeyUp(e){this.enabled&&this._preventEvent(e)}_onTouchStart(e){this.enabled&&(this._preventEvent(e),this.previousTouches=e.touches)}_onTouchEnd(e){this.enabled&&(this._preventEvent(e),this.previousTouches=[],this._state=ku.None)}_onTouchCancel(e){this.enabled&&(this._preventEvent(e),this.previousTouches=[],this._state=ku.None)}_onTouchLeave(e){this.enabled&&(this._preventEvent(e),this.previousTouches=[],this._state=ku.None)}_onTouchMove(e){if(!this.enabled)return;this._preventEvent(e);const t=this.previousTouches,r=e.changedTouches,n=t.length,i=r.length;if(2===n&&2===i){const n=new j(t[0].clientX,t[0].clientY),i=new j(t[1].clientX,t[1].clientY),o=n.distanceTo(i),a=(new j).addVectors(n,i).divideScalar(2),s=(new j).subVectors(n,i).normalize(),c=new j(r[0].clientX,r[0].clientY),h=new j(r[1].clientX,r[1].clientY),l=c.distanceTo(h),u=(new j).addVectors(c,h).divideScalar(2),d=(new j).subVectors(n,i).normalize(),m=(new j).subVectors(u,a),f=l-o,p=d.dot(s);this._pan(m),this._zoom(f),this._roll(p),this._consumeEvent(e)}else if(1===n&&1===i){const n=new j(r[0].clientX-t[0].clientX,r[0].clientY-t[0].clientY).divideScalar(10);this._rotate(n),this._consumeEvent(e)}else this.logger.warn("Ignoring inconsistent touches event.");this.previousTouches=r}_onMouseEnter(e){this.enabled&&(this._preventEvent(e),this.impose(),e.target.constructor!==HTMLDocument&&this._domElement.focus())}_onMouseLeave(e){this.enabled&&(this._preventEvent(e),e.target.constructor!==HTMLDocument&&this._domElement.blur(),this.dispose(),this._state=ku.None)}_onMouseDown(e){if(!this.enabled)return;this._preventEvent(e);const t=this.actionsMap,r=e.button;t.front.includes(r)?(this._state=ku.Moving,this._front(),this._consumeEvent(e)):t.back.includes(r)?(this._state=ku.Moving,this._back(),this._consumeEvent(e)):t.up.includes(r)?(this._state=ku.Moving,this._up(),this._consumeEvent(e)):t.down.includes(r)?(this._state=ku.Moving,this._down(),this._consumeEvent(e)):t.left.includes(r)?(this._state=ku.Moving,this._left(),this._consumeEvent(e)):t.right.includes(r)?(this._state=ku.Moving,this._right(),this._consumeEvent(e)):t.rotate.includes(r)?(this._state=ku.Rotating,this._consumeEvent(e)):t.pan.includes(r)?(this._state=ku.Panning,this._consumeEvent(e)):t.roll.left.includes(r)||t.roll.right.includes(r)?(this._state=ku.Rolling,this._consumeEvent(e)):t.zoom.includes(r)?(this._state=ku.Zooming,this._consumeEvent(e)):this._state=ku.None}_onMouseMove(e){if(!this.enabled||this._state===ku.None)return;this._preventEvent(e);const t=this._state,r={x:e.movementX||e.mozMovementX||e.webkitMovementX||0,y:e.movementY||e.mozMovementY||e.webkitMovementY||0};switch(t){case ku.Moving:break;case ku.Rotating:this._rotate(r),this._consumeEvent(e);break;case ku.Panning:this._pan(r),this._consumeEvent(e);break;case ku.Rolling:this._roll(r),this._consumeEvent(e);break;case ku.Zooming:this._zoom(r),this._consumeEvent(e);break;default:throw new RangeError(`Unknown state: ${t}`)}}_onMouseWheel(e){if(!this.enabled)return;this._preventEvent(e);const t=e.wheelDelta||e.deltaY;this._zoom(t),this._consumeEvent(e)}_onMouseUp(e){this.enabled&&(this._preventEvent(e),this._state=ku.None,this._consumeEvent(e))}_onDblClick(e){this.enabled&&(this._preventEvent(e),this.logger.warn("CameraControls: Double click events is not implemented yet, sorry for the disagreement."))}_front(){if(this.canMove&&this.canFront){if(this._camera.isPerspectiveCamera){const e=Ou.clone().applyQuaternion(this._camera.quaternion),t=this._trackPath?this._getPathDisplacement(e):e.multiplyScalar(this.frontSpeed);this._camera.position.add(t),this._target.position.add(t)}else if(this._camera.isOrthographicCamera){const e=Ou.clone().applyQuaternion(this._camera.quaternion),t=this._trackPath?this._getPathDisplacement(e):e.multiplyScalar(this.frontSpeed);this._camera.position.add(t),this._target.position.add(t);const r=this.frontSpeed*this.zoomSpeed;this._camera.zoom+=r,this._camera.updateProjectionMatrix()}else this.logger.error(`Unmanaged displacement for camera of type ${this._camera.type}`);this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_back(){if(this.canMove&&this.canBack){if(this._camera.isPerspectiveCamera){const e=Au.clone().applyQuaternion(this._camera.quaternion),t=this._trackPath?this._getPathDisplacement(e):e.multiplyScalar(this.backSpeed);this._camera.position.add(t),this._target.position.add(t)}else if(this._camera.isOrthographicCamera){const e=Au.clone().applyQuaternion(this._camera.quaternion),t=this._trackPath?this._getPathDisplacement(e):e.multiplyScalar(this.backSpeed);this._camera.position.add(t),this._target.position.add(t);const r=this.backSpeed*this.zoomSpeed;this._camera.zoom-r<=0?this._camera.zoom=.01:this._camera.zoom-=r,this._camera.updateProjectionMatrix()}else this.logger.error(`Unmanaged displacement for camera of type ${this._camera.type}`);this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_up(){if(this.canMove&&this.canUp){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const e=Gu.clone().applyQuaternion(this._camera.quaternion).multiplyScalar(this.upSpeed);this._camera.position.add(e),this._target.position.add(e)}else this.logger.error(`Unmanaged displacement for camera of type ${this._camera.type}`);this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_down(){if(this.canMove&&this.canDown){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const e=Iu.clone().applyQuaternion(this._camera.quaternion).multiplyScalar(this.downSpeed);this._camera.position.add(e),this._target.position.add(e)}else this.logger.error(`Unmanaged displacement for camera of type ${this._camera.type}`);this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_left(){if(this.canMove&&this.canLeft){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const e=Lu.clone().applyQuaternion(this._camera.quaternion).multiplyScalar(this.leftSpeed);this._camera.position.add(e),this._target.position.add(e)}else this.logger.error(`Unmanaged displacement for camera of type ${this._camera.type}`);this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_right(){if(this.canMove&&this.canRight){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const e=zu.clone().applyQuaternion(this._camera.quaternion).multiplyScalar(this.rightSpeed);this._camera.position.add(e),this._target.position.add(e)}this.dispatchEvent({type:"move"}),this.dispatchEvent({type:"change"})}}_rotate(e){if(this.canRotate){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const t=this._camera.position,r=this._target.position,n=t.distanceTo(r),i=(new D).subVectors(t,r).normalize(),o=this.rotateSpeed;switch(this._mode){case Nu.FirstPerson:{const n=e.x,i=e.y,a=new D(-n,i,0).applyQuaternion(this._camera.quaternion).multiplyScalar(o).add(r),s=(new D).subVectors(a,t).normalize(),c=Gu.clone().dot(s),h=zu.clone().dot(s),l=.97;if(c<-l||c>l||h<-2||h>2)return;const u=s.multiplyScalar(1).add(t);this.setTargetPosition(u)}break;case Nu.Orbit:{const t=(new V).setFromVector3(i),a=t.theta+Ht(-e.x)*o,s=t.phi+Ht(-e.y)*o;t.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,a)),t.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,s));const c=(new D).setFromSpherical(t).multiplyScalar(n).add(r);this.setCameraPosition(c)}break;default:throw new RangeError(`Unamanaged rotation for camera mode ${this._mode}`)}}this.dispatchEvent({type:"rotate"}),this.dispatchEvent({type:"change"})}}_pan(e){if(this.canPan){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const t=this._camera.position,r=this._target.position,n=t.distanceTo(r),i=new D(-e.x,e.y,0).applyQuaternion(this._camera.quaternion).multiplyScalar(this.panSpeed*n);this._camera.position.add(i),this._target.position.add(i)}this.dispatchEvent({type:"pan"}),this.dispatchEvent({type:"change"})}}_roll(e){if(this.canRoll){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const t=this._camera.position,r=this._target.position,n=(new D).subVectors(t,r).normalize(),i=e*this.rollSpeed;this._camera.up.applyAxisAngle(n,i),this._camera.lookAt(r)}this.dispatchEvent({type:"roll"}),this.dispatchEvent({type:"change"})}}_zoom(e){if(this.canZoom){if(this._camera.isPerspectiveCamera)switch(this._mode){case Nu.FirstPerson:e>0?this._camera.fov--:this._camera.fov++,this._camera.updateProjectionMatrix();break;case Nu.Orbit:{const t=this._camera.position,r=this._target.position,n=t.distanceTo(r),i=Ou.clone().applyQuaternion(this._camera.quaternion).multiplyScalar(e*this.zoomSpeed*n);let o=t.clone().add(i);const a=(new D).subVectors(o,t).normalize(),s=(new D).subVectors(t,r).normalize(),c=(new D).subVectors(o,r).normalize(),h=a.dot(s),l=a.dot(c),u=o.distanceToSquared(r);h<0&&(u<this.zoomMinimum*this.zoomMinimum||l>0)&&(o=s.clone().multiplyScalar(this.zoomMinimum).add(r)),this._camera.position.copy(o)}break;default:throw new RangeError(`Invalid camera control mode parameter: ${this._mode}`)}else if(this._camera.isOrthographicCamera){const t=this.domElement.offsetWidth/this.domElement.offsetHeight,r=this._camera.position,n=this._target.position,i=r.distanceTo(n),o=(e>0?Ou.clone():Au.clone()).applyQuaternion(this._camera.quaternion).normalize().multiplyScalar(this.zoomSpeed*i);r.add(o);const a=r.distanceTo(n),s=a/2,c=a*t/2;this._camera.top=s,this._camera.bottom=-s,this._camera.right=c,this._camera.left=-c,this._camera.updateProjectionMatrix()}this.dispatchEvent({type:"zoom"}),this.dispatchEvent({type:"change"})}}_lookAt(e){if(this.canLookAt){if(this._camera.isPerspectiveCamera||this._camera.isOrthographicCamera){const t=e.clone(),r=this._camera.position,n=this._target.position,i=r.distanceTo(n);switch(this.mode){case Nu.FirstPerson:{t.y=-t.y;const e=t.multiplyScalar(i).add(r);this.setTargetPosition(e)}break;case Nu.Orbit:{const e=t.multiplyScalar(i).add(n);this.setCameraPosition(e)}break;default:throw new RangeError(`Invalid camera control mode parameter: ${this._mode}`)}}this.dispatchEvent({type:"lookAt"}),this.dispatchEvent({type:"change"})}}_initPathDisplacement(){if(h(this._paths))this.logger.warn("Try to init path displacement without any paths");else switch(a(this._currentPath)&&(this._currentPathIndex=0,this._currentPathOffset=0,this._currentPath=this._paths[0]),this._currentPathPosition=this._currentPath.getPointAt(this._currentPathOffset),this._mode){case Nu.FirstPerson:if(this._lockedTarget){const e=(new D).subVectors(this._currentPathPosition,this.camera.position);this._camera.position.add(e),this._target.position.add(e)}else this.setCameraPosition(this._currentPathPosition);break;case Nu.Orbit:if(this._lockedTarget){const e=(new D).subVectors(this._currentPathPosition,this.target.position);this._camera.position.add(e),this._target.position.add(e)}else this.setTargetPosition(this._currentPathPosition);break;default:throw new RangeError(`Invalid camera control _mode parameter: ${this._mode}`)}}_getPathDisplacement(e){let t=null;const r=this._currentPathPosition,n=this._currentPathOffset+this._cameraJump,i=n<1?n:1,o=this._currentPath.getPointAt(i),a=(new D).subVectors(o,r),s=a.clone().normalize(),c=e.dot(s),h=this._currentPathOffset-this._cameraJump,l=h>0?h:0,u=this._currentPath.getPointAt(l),d=(new D).subVectors(u,r),m=d.clone().normalize(),f=e.dot(m);if(0===c&&f<0){const r=this._getDirectionsMap();let n,i,o,a=-1;r.forEach(t=>{const r=t.index,s=t.startDisplacement;if(s){const t=s.clone().normalize(),c=e.dot(t);c>a&&(n=r,i=s,a=c,o=!0)}const c=t.endDisplacement;if(c){const t=c.clone().normalize(),s=e.dot(t);s>a&&(n=r,i=c,a=s,o=!1)}}),void 0!==n?(this._currentPathIndex=n,this._currentPath=this._paths[this._currentPathIndex],this._currentPathOffset=o?this._cameraJump:1-this._cameraJump,this._currentPathPosition=this._currentPath.getPointAt(this._currentPathOffset),t=i):(this.logger.warn("Reach path end."),t=new D)}else if(c>0&&f<=0)t=a,this._currentPathOffset=i,this._currentPathPosition=o;else if(c<=0&&f>0)t=d,this._currentPathOffset=l,this._currentPathPosition=u;else if(c<0&&0===f){const r=this._getDirectionsMap();let n,i,o,a=-1;r.forEach(t=>{const r=t.index,s=t.startDisplacement;if(s){const t=s.clone().normalize(),c=e.dot(t);c>a&&(n=r,i=s,a=c,o=!0)}const c=t.endDisplacement;if(c){const t=c.clone().normalize(),s=e.dot(t);s>a&&(n=r,i=c,a=s,o=!1)}}),void 0!==n?(this._currentPathIndex=n,this._currentPath=this._paths[this._currentPathIndex],this._currentPathOffset=o?this._cameraJump:1-this._cameraJump,this._currentPathPosition=this._currentPath.getPointAt(this._currentPathOffset),t=i):(this.logger.warn("Reach path start."),t=new D)}else c<0&&f<0||c>0&&f>0?c>f?(t=a,this._currentPathOffset=i,this._currentPathPosition=o):(t=d,this._currentPathOffset=l,this._currentPathPosition=u):(this.logger.warn("Unable to find correct next path position."),t=new D);return t}_getDirectionsMap(){const e=this._currentPathPosition,t=this._currentPathIndex,r=this._cameraJump,n=this._maxJump;return this._paths.reduce((i,o,a)=>{if(a===t)return i;const s=o.getPointAt(0);let c;e.distanceToSquared(s)<n&&(c=(new D).subVectors(o.getPointAt(r),s));const h=o.getPointAt(1);let l;return e.distanceToSquared(h)<n&&(l=(new D).subVectors(o.getPointAt(1-r),h)),(c||l)&&i.push({index:a,startDisplacement:c,endDisplacement:l}),i},[])}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Ru extends Y{constructor(e){super(e),this.isHighlightableMaterial=!0,this.depthTest=!1,this.depthWrite=!1,this.fog=!1,this.transparent=!0,this.linewidth=1,this.oldColor=this.color.clone()}highlight(e){if(e){const e=.35,t=this.color.r,r=this.color.g,n=this.color.b,i=Math.min(Math.max(0,t+t*e),1),o=Math.min(Math.max(0,r+r*e),1),a=Math.min(Math.max(0,n+n*e),1);this.color.setRGB(i,o,a)}else this.color.copy(this.oldColor)}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Hu extends W{constructor(e){super(e),this.isHighlightableMaterial=!0,this.depthTest=!1,this.depthWrite=!1,this.fog=!1,this.side=$,this.transparent=!0,this.oldColor=this.color.clone()}highlight(e){if(e){const e=.35,t=this.color.r,r=this.color.g,n=this.color.b,i=Math.min(Math.max(0,t+t*e),1),o=Math.min(Math.max(0,r+r*e),1),a=Math.min(Math.max(0,n+n*e),1);this.color.setRGB(i,o,a)}else this.color.copy(this.oldColor)}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class ju extends X{constructor(e={}){const t={geometry:new L,material:new W({visible:!1,depthTest:!1,depthWrite:!1,fog:!1,side:$,color:6636321}),...e};super(t.geometry,t.material),this.isHitbox=!0,this.type="Hitbox",this.matrixAutoUpdate=!1}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Vu extends ju{constructor(e={}){super({geometry:new Z(1.2,0),...e}),this.isOctahedricalHitbox=!0,this.type="OctahedricalHitbox"}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Yu extends H{constructor(e={}){const t={debug:!1,color:16777215,hitbox:null,...e};super(t),this.isHandle=!0,this.type="Handle",this.matrixAutoUpdate=!0,this.debug=t.debug,this.color=t.color,this.hitbox=t.hitbox,this.baseQuaternion=new q}get color(){return this.line.material.color.clone()}set color(e){if(l(e))throw new Error("Color cannot be null ! Expect an instance of Color.");if(g(e))throw new Error("Color cannot be undefined ! Expect an instance of Color.");this.traverse(t=>{let r=t.material;r&&r.color.setHex(e)})}get hitbox(){return this._hitbox}set hitbox(e){this._hitbox=e,this.add(e)}setColor(e){return this.color=e,this}setHitbox(e){return this.hitbox=e,this}setScale(e,t,r){return this.scale.set(e,t,r),this}setPosition(e,t,r){return this.position.set(e,t,r),this}highlight(e){for(let t=0,r=this.children.length;t<r;t++){const r=this.children[t];if(r.isHitbox)continue;const n=r.material;!g(n)&&n.isHighlightableMaterial&&n.highlight(e)}}raycast(e,t){const r=e.intersectObject(this._hitbox,!1);r.length>0&&t.push({distance:r[0].distance,object:this})}setRotationFromAxisAndAngle(e,t){return this.quaternion.setFromAxisAngle(e,t),this.baseQuaternion.copy(this.quaternion),this}update(e){}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Wu extends Yu{constructor(e={}){const t={color:16777215,hitbox:new Vu,...e};super(t),this.isOmnidirectionalHandle=!0,this.type="OmnidirectionalHandle";const r=new Z(.1,0),n=new Hu({color:t.color,transparent:!0,opacity:.55}),i=new X(r,n);i.matrixAutoUpdate=!1,this.add(i);const o=new K(r),a=new Ru({color:t.color,linewidth:4}),s=new Q(o,a);s.matrixAutoUpdate=!1,this.add(s)}update(e){super.update(e),this.updateMatrix(),this.hitbox.updateMatrix()}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class $u extends ju{constructor(e={}){const t=e.centered?[-.6,-.6,0,.6,-.6,0,.6,.6,0,-.6,.6,0]:[0,0,0,1.1,0,0,1.1,1.1,0,0,1.1,0],r=new L;r.setAttribute("position",new J(t,3)),r.setIndex([0,1,2,2,3,0]);super({geometry:r,...e}),this.isPlanarHitbox=!0,this.type="PlanarHitbox"}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Xu extends Yu{constructor(e={}){const t={showEdges:!1,centered:!1,color:16777215,hitbox:new $u({centered:e.centered||!1}),direction:new D(0,1,0),...e};if(super(t),this.isPlaneHandle=!0,this.type="PlaneHandle",t.showEdges){const e=new L;e.setAttribute("position",new J([.75,1,0,1,1,0,1,.75,0],3));const r=new Ru({color:t.color}),n=new ee(e,r);n.matrixAutoUpdate=!1,this.add(n)}const r=t.centered?[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]:[.1,.1,0,1,.1,0,1,1,0,.1,1,0],n=new L;n.setAttribute("position",new J(r,3)),n.setIndex([0,1,2,2,3,0]);const i=new Hu({color:t.color,transparent:!0,opacity:.35}),o=new X(n,i);if(o.matrixAutoUpdate=!1,this.add(o),this.xAxis=new D(1,0,0),this.yAxis=new D(0,1,0),this.zAxis=new D(0,0,1),this.xDirection=new D(t.direction.x,0,0),this.yDirection=new D(0,t.direction.y,0),this.zDirection=new D(0,0,t.direction.z),this.direction=t.direction,this.debug){const e=new D(0,0,0),r=t.direction,n=new te(r,e,1,1193046);this.add(n)}}get direction(){return this._direction}set direction(e){if(l(e))throw new Error("Direction cannot be null ! Expect an instance of Color.");if(g(e))throw new Error("Direction cannot be undefined ! Expect an instance of Color.");if(!(e instanceof D))throw new Error(`Direction cannot be an instance of ${e.constructor.name}. Expect an instance of Vector3.`);this._direction=e}update(e){super.update(e);const t=new D(this._direction.x,0,0),r=new D(0,this._direction.y,0),n=new D(0,0,this._direction.z),i=t.dot(e),o=r.dot(e),a=n.dot(e);this.quaternion.copy(this.baseQuaternion),i>0&&o>0&&0===a?(this.rotateOnAxis(this.zAxis,Ht(180)),this.xDirection.setX(-1),this.yDirection.setY(-1),this.zDirection.setZ(0)):i>0&&o<0&&0===a?(this.rotateOnAxis(this.zAxis,Ht(90)),this.xDirection.setX(-1),this.yDirection.setY(1),this.zDirection.setZ(0)):i<0&&o>0&&0===a?(this.rotateOnAxis(this.zAxis,Ht(270)),this.xDirection.setX(1),this.yDirection.setY(-1),this.zDirection.setZ(0)):i<0&&o<0&&0===a?(this.rotateOnAxis(this.zAxis,Ht(0)),this.xDirection.setX(1),this.yDirection.setY(1),this.zDirection.setZ(0)):i>0&&0===o&&a>0?(this.rotateOnAxis(this.zAxis,Ht(180)),this.xDirection.setX(-1),this.yDirection.setY(0),this.zDirection.setZ(-1)):i>0&&0===o&&a<0?(this.rotateOnAxis(this.zAxis,Ht(90)),this.xDirection.setX(-1),this.yDirection.setY(0),this.zDirection.setZ(1)):i<0&&0===o&&a>0?(this.rotateOnAxis(this.zAxis,Ht(270)),this.xDirection.setX(1),this.yDirection.setY(0),this.zDirection.setZ(-1)):i<0&&0===o&&a<0?(this.rotateOnAxis(this.zAxis,Ht(0)),this.xDirection.setX(1),this.yDirection.setY(0),this.zDirection.setZ(1)):0===i&&o>0&&a>0?(this.rotateOnAxis(this.zAxis,Ht(180)),this.xDirection.setX(0),this.yDirection.setY(-1),this.zDirection.setZ(-1)):0===i&&o>0&&a<0?(this.rotateOnAxis(this.zAxis,Ht(270)),this.xDirection.setX(0),this.yDirection.setY(-1),this.zDirection.setZ(1)):0===i&&o<0&&a>0?(this.rotateOnAxis(this.zAxis,Ht(90)),this.xDirection.setX(0),this.yDirection.setY(1),this.zDirection.setZ(-1)):0===i&&o<0&&a<0&&(this.rotateOnAxis(this.zAxis,Ht(0)),this.xDirection.setX(0),this.yDirection.setY(1),this.zDirection.setZ(1)),this.updateMatrix(),this.hitbox.updateMatrix()}setDirection(e){return this.direction=e,this}flipXDirection(){this.xDirection.setX(-this.xDirection.x)}flipYDirection(){this.yDirection.setY(-this.yDirection.y)}flipZDirection(){this.zDirection.setZ(-this.zDirection.z)}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Zu extends L{constructor(e=new D(0,0,0),t=new D(1,0,0)){super(),this.type="LineGeometry",this.setAttribute("position",new J([e.x,e.y,e.z,t.x,t.y,t.z],3))}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class qu extends ju{constructor(e={}){const t=new re(.2,0,1,4,1,!1);t.translate(0,.5,0);super({geometry:t,...e}),this.isCylindricaHitbox=!0,this.type="CylindricaHitbox"}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Ku extends Yu{constructor(e={}){const t={color:16777215,hitbox:new qu,direction:new D(0,1,0),...e};super(t),this.isScaleHandle=!0,this.type="ScaleHandle";const r=new Zu(new D(0,0,0),new D(0,.88,0)),n=new Ru({color:t.color}),i=new ee(r,n);i.matrixAutoUpdate=!1,this.add(i);const o=new ne(.12,.12,.12);o.translate(0,.94,0);const a=new Hu({color:t.color}),s=new X(o,a);s.matrixAutoUpdate=!1,this.add(s),this.direction=t.direction}get direction(){return this._direction}set direction(e){if(l(e))throw new Error("Direction cannot be null ! Expect an instance of Color.");if(g(e))throw new Error("Direction cannot be undefined ! Expect an instance of Color.");if(!(e instanceof D))throw new Error(`Direction cannot be an instance of ${e.constructor.name}. Expect an instance of Vector3.`);if(this._direction=e,e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{const t=new D(e.z,0,-e.x).normalize(),r=Math.acos(e.y);this.quaternion.setFromAxisAngle(t,r)}}update(e){super.update(e);this._direction.dot(e)>=0&&this.flipDirection(),this.updateMatrix(),this.hitbox.updateMatrix()}setDirection(e){return this.direction=e,this}flipDirection(){this.direction=this._direction.negate()}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Qu extends H{constructor(e={}){const t={debug:!1,planeSize:50,...e};super(t),this.isGizmo=!0,this.type="AbstractGizmo",this.matrixAutoUpdate=!0,this.debug=t.debug;const r=new ie(t.planeSize,t.planeSize,2,2),n=new W({side:$,visible:this.debug,transparent:!0,opacity:.33,color:1193046});this.intersectPlane=new X(r,n),this.intersectPlane.name="IntersectPlane",this.intersectPlane.matrixAutoUpdate=!0,this.intersectPlane.visible=!0,this.add(this.intersectPlane)}_setupHandles(e){const t=this;for(let r in e){const n=e[r];if(f(n))n.name=r,n.renderOrder=1/0,n.updateMatrix(),t.add(n);else for(let i=n.length;i--;){const n=e[r][i][0],o=e[r][i][1],a=e[r][i][2],s=e[r][i][3],c=e[r][i][4];n.name=r,n.tag=c,n.renderOrder=1/0,o&&n.position.set(o[0],o[1],o[2]),a&&n.rotation.set(a[0],a[1],a[2]),s&&n.scale.set(s[0],s[1],s[2]),n.updateMatrix();const h=n.geometry.clone();h.applyMatrix4(n.matrix),n.geometry=h,n.position.set(0,0,0),n.rotation.set(0,0,0),n.scale.set(1,1,1),t.add(n)}}}highlight(e){for(let e in this.handleGizmos)this.handleGizmos[e].highlight(!1);const t=this.handleGizmos[e];t&&t.highlight(!0)}update(e,t){this.traverse(e=>{e.isHandle&&e.update(t)}),this.updateIntersectPlane(e)}updateIntersectPlane(e){this.intersectPlane.lookAt(e),this.intersectPlane.updateMatrix()}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Ju extends Qu{constructor(){super(),this.isScaleGizmo=!0,this.type="ScaleGizmo",this.handleGizmos={XYZ:new Wu({color:11184810}).setScale(.15,.15,.15),XY:new Xu({color:11184640,direction:new D(1,1,0)}).setScale(.33,.33,1),YZ:new Xu({color:43690,direction:new D(0,1,1)}).setScale(.33,.33,1).setRotationFromAxisAndAngle(new D(0,1,0),Ht(-90)),XZ:new Xu({color:11141290,direction:new D(1,0,1)}).setScale(.33,.33,1).setRotationFromAxisAndAngle(new D(1,0,0),Ht(90)),X:new Ku({color:11141120,direction:new D(1,0,0)}),Y:new Ku({color:43520,direction:new D(0,1,0)}),Z:new Ku({color:170,direction:new D(0,0,1)})},this._setupHandles(this.handleGizmos)}raycast(e,t){if(e.intersectObject(this.intersectPlane,!0).length>0)for(let r of this.children)r.name!==this.intersectPlane.name&&r.raycast(e,t)}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class ed extends ju{constructor(e={}){const t=new J([0,0,0,.85,0,0,1.1,1.1,0,0,.85,0],3),r=new L;r.setAttribute("position",t),r.setIndex([0,1,2,2,3,0]);super({geometry:r,...e}),this.isPlanarHitbox=!0,this.type="PlanarHitbox"}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class td extends Yu{constructor(e={}){const t={color:16777215,hitbox:new ed,direction:new D(1,1,0),...e};super(t),this.isPlaneHandle=!0,this.type="PlaneHandle";const r=new L;r.setAttribute("position",new J([.1,.75,0,1,1,0,.75,.1,0],3));const n=new Ru({color:t.color}),i=new ee(r,n);i.matrixAutoUpdate=!1,this.add(i);const o=new L;o.setAttribute("position",new J([.1,.1,0,.75,.1,0,1,1,0,.1,.75,0],3)),o.setIndex([0,1,2,2,3,0]);const a=new Hu({color:t.color,transparent:!0,opacity:.35}),s=new X(o,a);s.matrixAutoUpdate=!1,this.add(s),this.direction=t.direction,this.xDirection=new D(t.direction.x,0,0),this.yDirection=new D(0,t.direction.y,0),this.zDirection=new D(0,0,t.direction.z),this.xAxis=new D(1,0,0),this.yAxis=new D(0,1,0),this.zAxis=new D(0,0,1)}get direction(){return this._direction}set direction(e){if(l(e))throw new Error("Direction cannot be null ! Expect an instance of Color.");if(g(e))throw new Error("Direction cannot be undefined ! Expect an instance of Color.");if(!(e instanceof D))throw new Error(`Direction cannot be an instance of ${e.constructor.name}. Expect an instance of Vector3.`);this._direction=e}update(e){super.update(e);const t=this.xDirection.dot(e),r=this.yDirection.dot(e),n=this.zDirection.dot(e);this.quaternion.copy(this.baseQuaternion),t>0&&r>0&&0===n?this.rotateOnAxis(this.zAxis,Ht(180)):t>0&&r<0&&0===n?this.rotateOnAxis(this.zAxis,Ht(90)):t<0&&r>0&&0===n?this.rotateOnAxis(this.zAxis,Ht(270)):t<0&&r<0&&0===n?this.rotateOnAxis(this.zAxis,Ht(0)):t>0&&0===r&&n>0?this.rotateOnAxis(this.zAxis,Ht(180)):t>0&&0===r&&n<0?this.rotateOnAxis(this.zAxis,Ht(90)):t<0&&0===r&&n>0?this.rotateOnAxis(this.zAxis,Ht(270)):t<0&&0===r&&n<0?this.rotateOnAxis(this.zAxis,Ht(0)):0===t&&r>0&&n>0?this.rotateOnAxis(this.zAxis,Ht(180)):0===t&&r>0&&n<0?this.rotateOnAxis(this.zAxis,Ht(270)):0===t&&r<0&&n>0?this.rotateOnAxis(this.zAxis,Ht(90)):0===t&&r<0&&n<0&&this.rotateOnAxis(this.zAxis,Ht(0)),this.updateMatrix(),this.hitbox.updateMatrix()}setDirection(e){return this.direction=e,this}flipXAxis(){const e=this._direction.clone();e.x=-e.x,this.direction=e}flipYAxis(){const e=this._direction.clone();e.y=-e.y,this.direction=e}flipZAxis(){const e=this._direction.clone();e.z=-e.z,this.direction=e}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class rd extends Yu{constructor(e={}){const t={color:16777215,hitbox:new qu,direction:new D(0,1,0),...e};super(t),this.isTranslateHandle=!0,this.type="TranslateHandle";const r=new Zu(new D(0,0,0),new D(0,.8,0)),n=new Ru({color:t.color}),i=new ee(r,n);i.matrixAutoUpdate=!1,this.add(i);const o=new oe(.05,.2,12,1,!1);o.translate(0,.9,0);const a=new Hu({color:t.color}),s=new X(o,a);s.matrixAutoUpdate=!1,this.add(s),this.direction=t.direction}get direction(){return this._direction}set direction(e){if(l(e))throw new Error("Direction cannot be null ! Expect an instance of Color.");if(g(e))throw new Error("Direction cannot be undefined ! Expect an instance of Color.");if(!(e instanceof D))throw new Error(`Direction cannot be an instance of ${e.constructor.name}. Expect an instance of Vector3.`);if(this._direction=e,e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{const t=new D(e.z,0,-e.x).normalize(),r=Math.acos(e.y);this.quaternion.setFromAxisAngle(t,r)}}update(e){super.update(e);this._direction.dot(e)>=0&&this.flipDirection(),this.updateMatrix(),this.hitbox.updateMatrix()}setDirection(e){return this.direction=e,this}flipDirection(){this.direction=this._direction.negate()}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class nd extends Qu{constructor(){super(),this.isTranslateGizmo=!0,this.type="TranslateGizmo",this.handleGizmos={X:new rd({color:11141120,direction:new D(1,0,0)}),Y:new rd({color:43520,direction:new D(0,1,0)}),Z:new rd({color:170,direction:new D(0,0,1)}),XY:new td({color:11184640,direction:new D(1,1,0)}).setScale(.33,.33,1),YZ:new td({color:43690,direction:new D(0,1,1)}).setScale(.33,.33,1).setRotationFromAxisAndAngle(new D(0,1,0),Ht(-90)),XZ:new td({color:11141290,direction:new D(1,0,1)}).setScale(.33,.33,1).setRotationFromAxisAndAngle(new D(1,0,0),Ht(90)),XYZ:new Wu({color:11184810}).setScale(.15,.15,.15)},this._setupHandles(this.handleGizmos)}raycast(e,t){if(e.intersectObject(this.intersectPlane,!0).length>0)for(let r of this.children)r.name!==this.intersectPlane.name&&r.raycast(e,t)}}
/**
 * @module Controllers/ClippingController
 *
 * @author [Ahmed DCHAR]{@link https://github.com/Dragoneel}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @example Todo
 *
 */class id extends Q{constructor(){super(),this.margin=.01,this.geometry=new K(new ne(2,2,2)),this.material=new Y({color:16777215}),this.matrixAutoUpdate=!1,this.normalPlanes={normalRightSide:new D(-1,0,0),normalLeftSide:new D(1,0,0),normalFrontSide:new D(0,-1,0),normalBackSide:new D(0,1,0),normalTopSide:new D(0,0,-1),normalBottomSide:new D(0,0,1)},this.planes={rightSidePlane:new ae(this.normalPlanes.normalRightSide.clone(),0),leftSidePlane:new ae(this.normalPlanes.normalLeftSide.clone(),0),frontSidePlane:new ae(this.normalPlanes.normalFrontSide.clone(),0),backSidePlane:new ae(this.normalPlanes.normalBackSide.clone(),0),topSidePlane:new ae(this.normalPlanes.normalTopSide.clone(),0),bottomSidePlane:new ae(this.normalPlanes.normalBottomSide.clone(),0)},this._boundingBox=new I}getBoundingSphere(){return this.geometry.computeBoundingSphere(),this.geometry.boundingSphere.applyMatrix4(this.matrixWorld),this.geometry.boundingSphere}setColor(e){this.material.color.set(e)}applyClippingTo(e,t){if(a(t))return;let r=[];for(let e in this.planes)r.push(this.planes[e]);t.traverse(t=>{if(a(t))return;if(a(t.geometry))return;if(a(t.material))return;const n=c(t.material)?t.material:[t.material];for(let t=0,i=n.length;t<i;t++){let i=n[t];i.clippingPlanes||(i.clippingPlanes=[]),i.clippingPlanes=e?r:[]}})}updateSize(e){this.scale.set(e.x,e.y,e.z)}update(){this._boundingBox.setFromObject(this);const e=this.margin,t=this._boundingBox.min,r=this._boundingBox.max;this.planes.rightSidePlane.constant=r.x+e,this.planes.leftSidePlane.constant=-t.x+e,this.planes.frontSidePlane.constant=r.y+e,this.planes.backSidePlane.constant=-t.y+e,this.planes.topSidePlane.constant=r.z+e,this.planes.bottomSidePlane.constant=-t.z+e}}const od=kt({None:"None",Translate:"Translate",Rotate:"Rotate",Scale:"Scale"});class ad extends H{constructor(e={}){const t={camera:null,domElement:window,mode:od.None,objectsToClip:new H,...e};super(),this._handlers={onMouseEnter:this._onMouseEnter.bind(this),onMouseLeave:this._onMouseLeave.bind(this),onMouseDown:this._onMouseDown.bind(this),onMouseMove:this._onMouseMove.bind(this),onMouseWheel:this._onMouseWheel.bind(this),onMouseUp:this._onMouseUp.bind(this),onDblClick:this._onDblClick.bind(this),onTouchStart:this._onTouchStart.bind(this),onTouchEnd:this._onTouchEnd.bind(this),onTouchCancel:this._onTouchCancel.bind(this),onTouchLeave:this._onTouchLeave.bind(this),onTouchMove:this._onTouchMove.bind(this),onKeyDown:this._onKeyDown.bind(this),onKeyUp:this._onKeyUp.bind(this)},this._events={impose:{type:"impose"},dispose:{type:"dispose"},change:{type:"change"},translate:{type:"translate"},rotate:{type:"rotate"},scale:{type:"scale"},mouseEnter:{type:"mouseEnter"},mouseLeave:{type:"mouseLeave"},mouseDown:{type:"mouseDown"},mouseUp:{type:"mouseUp"}},this._objectsToClipBoundingBox=new I,this._objectsToClipSize=new D,this._objectsToClipCenter=new D,this._clippingBox=new id,this.add(this._clippingBox),this.camera=t.camera,this.domElement=t.domElement,this.mode=t.mode,this.objectsToClip=t.objectsToClip,this.translationSnap=.1,this.scaleSnap=.1,this.rotationSnap=.1,this.matrixAutoUpdate=!1,this.enabled=!1,this.size=1,this._dragging=!1,this._firstPoint=new D,this._secondPoint=new D,this._mouseDisplacement=new D,this._offset=new D,this._raycaster=new se,this._pointerVector=new j,this._directionToMouse=new D,this._cameraPosition=new D,this._cameraDirection=new D,this._worldPosition=new D,this._worldRotation=new ce,this._gizmos={Translate:new nd,Scale:new Ju};for(let e in this._gizmos)this.add(this._gizmos[e]);this._currentGizmo=null,this._currentHandle=null,this.actionsMap={setMode:{translate:[Dt.T.value],rotate:[Dt.R.value],scale:[Dt.S.value]},translate:{front:[Dt.Z.value,Dt.UP_ARROW.value],back:[Dt.S.value,Dt.DOWN_ARROW.value],up:[Dt.A.value,Dt.PAGE_UP.value],down:[Dt.E.value,Dt.PAGE_DOWN.value],left:[Dt.Q.value,Dt.LEFT_ARROW.value],right:[Dt.D.value,Dt.RIGHT_ARROW.value]},scale:{widthPlus:[Dt.LEFT_ARROW.value],widthMinus:[Dt.RIGHT_ARROW.value],heightPlus:[Dt.PAGE_UP.value],heightMinus:[Dt.PAGE_DOWN.value],depthPlus:[Dt.UP_ARROW.value],depthMinus:[Dt.DOWN_ARROW.value]},rotate:{xAxis:[Dt.X.value],yAxis:[Dt.Y.value],zAxis:[Dt.Z.value]}}}get objectsToClip(){return this._objectsToClip}set objectsToClip(e){if(l(e))throw new Error("Objects to clip cannot be null ! Expect an instance of Object3D");if(g(e))throw new Error("Objects to clip cannot be undefined ! Expect an instance of Object3D");if(!(e instanceof H))throw new Error(`Objects to clip cannot be an instance of ${e.constructor.name}. Expect an instance of Object3D.`);this._objectsToClip=e,this.updateClipping()}get camera(){return this._camera}set camera(e){if(l(e))throw new Error("Camera cannot be null ! Expect an instance of Camera");if(g(e))throw new Error("Camera cannot be undefined ! Expect an instance of Camera");if(!e.isCamera&&!e.isPerspectiveCamera&&!e.isOrthographicCamera)throw new Error(`Camera cannot be an instance of ${e.constructor.name}. Expect an instance of Camera, PerspectiveCamera, or OrthographicCamera.`);this._camera=e}get domElement(){return this._domElement}set domElement(e){if(l(e))throw new Error("DomElement cannot be null ! Expect an instance of Window, HTMLDocument, HTMLDivElement or HTMLCanvasElement.");if(g(e))throw new Error("DomElement cannot be undefined ! Expect an instance of Window, HTMLDocument, HTMLDivElement or HTMLCanvasElement.");if(!(e instanceof Window||e instanceof HTMLDocument||e instanceof HTMLDivElement||e instanceof HTMLCanvasElement))throw new Error(`Target cannot be an instance of ${e.constructor.name}. Expect an instance of Window, HTMLDocument, HTMLDivElement or HTMLCanvasElement.`);this._domElement&&(this._domElement.removeEventListener("mouseenter",this._handlers.onMouseEnter,!1),this._domElement.removeEventListener("mouseleave",this._handlers.onMouseLeave,!1),this.dispose()),this._domElement=e,this._domElement.addEventListener("mouseenter",this._handlers.onMouseEnter,!1),this._domElement.addEventListener("mouseleave",this._handlers.onMouseLeave,!1),this.impose()}get mode(){return this._mode}set mode(e){if(l(e))throw new Error("Mode cannot be null ! Expect a value from ClippingModes enum.");if(g(e))throw new Error("Mode cannot be undefined ! Expect a value from ClippingModes enum.");this._mode=e;for(let e in this._gizmos)this._gizmos[e].visible=!1;this._mode===od.None?this._currentGizmo=null:(this._currentGizmo=this._gizmos[this._mode],this._currentGizmo.visible=!0),this.updateGizmo()}setCamera(e){return this.camera=e,this}setDomElement(e){return this.domElement=e,this}setMode(e){return this.mode=e,this}setObjectsToClip(e){return this.objectsToClip=e,this}impose(){this._domElement.addEventListener("keydown",this._handlers.onKeyDown,!1),this._domElement.addEventListener("keyup",this._handlers.onKeyUp,!1),this._domElement.addEventListener("dblclick",this._handlers.onDblClick,!1),this._domElement.addEventListener("mousedown",this._handlers.onMouseDown,!1),this._domElement.addEventListener("mousemove",this._handlers.onMouseMove,!1),this._domElement.addEventListener("mouseup",this._handlers.onMouseUp,!1),this._domElement.addEventListener("wheel",this._handlers.onMouseWheel,{capture:!0,once:!1,passive:!1}),this._domElement.addEventListener("touchcancel",this._handlers.onTouchCancel,!1),this._domElement.addEventListener("touchend",this._handlers.onTouchEnd,!1),this._domElement.addEventListener("touchleave",this._handlers.onTouchLeave,!1),this._domElement.addEventListener("touchmove",this._handlers.onTouchMove,{capture:!0,once:!1,passive:!1}),this._domElement.addEventListener("touchstart",this._handlers.onTouchStart,{capture:!0,once:!1,passive:!1}),this.dispatchEvent(this._events.impose)}dispose(){this._domElement.removeEventListener("keydown",this._handlers.onKeyDown,!1),this._domElement.removeEventListener("keyup",this._handlers.onKeyUp,!1),this._domElement.removeEventListener("dblclick",this._handlers.onDblClick,!1),this._domElement.removeEventListener("mousedown",this._handlers.onMouseDown,!1),this._domElement.removeEventListener("mousemove",this._handlers.onMouseMove,!1),this._domElement.removeEventListener("mouseup",this._handlers.onMouseUp,!1),this._domElement.removeEventListener("wheel",this._handlers.onMouseWheel,{capture:!0,once:!1,passive:!1}),this._domElement.removeEventListener("touchcancel",this._handlers.onTouchCancel,!1),this._domElement.removeEventListener("touchend",this._handlers.onTouchEnd,!1),this._domElement.removeEventListener("touchleave",this._handlers.onTouchLeave,!1),this._domElement.removeEventListener("touchmove",this._handlers.onTouchMove,{capture:!0,once:!1,passive:!1}),this._domElement.removeEventListener("touchstart",this._handlers.onTouchStart,{capture:!0,once:!1,passive:!1}),this.dispatchEvent(this._events.dispose)}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}enable(){this.visible=!0,this.enabled=!0,s(this._objectsToClip)&&(this._objectsToClipBoundingBox.setFromObject(this._objectsToClip),this._objectsToClipBoundingBox.getSize(this._objectsToClipSize),this._objectsToClipSize.divideScalar(2),this.scale.set(this._objectsToClipSize.x,this._objectsToClipSize.y,this._objectsToClipSize.z),this._objectsToClipBoundingBox.getCenter(this._objectsToClipCenter),this.position.set(this._objectsToClipCenter.x,this._objectsToClipCenter.y,this._objectsToClipCenter.z),this.updateMatrix(),this.updateMatrixWorld()),this.updateClipping(),this.updateGizmo()}disable(){this.visible=!1,this.enabled=!1,this.updateClipping()}updateClipping(){a(this._objectsToClip)||(this._clippingBox.update(),this._clippingBox.applyClippingTo(this.enabled,this._objectsToClip))}updateGizmo(){this.enabled&&this._mode!==od.None&&(a(this._currentGizmo)||(this._camera.getWorldPosition(this._cameraPosition),this._camera.getWorldDirection(this._cameraDirection),this._currentGizmo.update(this._cameraPosition,this._cameraDirection)))}_consumeEvent(e){e.cancelable&&e.stopImmediatePropagation()}_onKeyDown(e){if(!this.enabled)return;e.preventDefault();const t=this.actionsMap,r=e.keyCode;if(e.ctrlKey)switch(this._mode){case od.Translate:t.translate.front.includes(r)?(this._translateZ(this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.translate.back.includes(r)?(this._translateZ(-this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.translate.right.includes(r)?(this._translateX(this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.translate.left.includes(r)?(this._translateX(-this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.translate.up.includes(r)?(this._translateY(this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.translate.down.includes(r)&&(this._translateY(-this.translationSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change));break;case od.Rotate:break;case od.Scale:t.scale.depthPlus.includes(r)?(this._scaleZ(this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.scale.depthMinus.includes(r)?(this._scaleZ(-this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.scale.widthPlus.includes(r)?(this._scaleX(this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.scale.widthMinus.includes(r)?(this._scaleX(-this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.scale.heightPlus.includes(r)?(this._scaleY(this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)):t.scale.heightMinus.includes(r)&&(this._scaleY(-this.scaleSnap),this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change))}else t.setMode.translate.includes(r)?(this.setMode(od.Translate),this.updateClipping(),this._consumeEvent(e)):t.setMode.rotate.includes(r)?(this.setMode(od.Rotate),this.updateClipping(),this._consumeEvent(e)):t.setMode.scale.includes(r)&&(this.setMode(od.Scale),this.updateClipping(),this._consumeEvent(e))}_onKeyUp(e){this.enabled&&!e.defaultPrevented&&e.preventDefault()}_onDblClick(e){this.enabled&&this._mode!==od.None&&e.preventDefault()}_onMouseDown(e){if(!this.enabled)return;if(this._mode===od.None)return;if(e.button!==Ot.Left.value)return;if(a(this._currentHandle))return;e.preventDefault(),this._dragging=!0;const t=this.intersectObjects(e,[this._currentGizmo.intersectPlane]);t&&(this._firstPoint=t.point),this._consumeEvent(e),this.dispatchEvent(this._events.mouseDown)}_onMouseEnter(e){this.enabled&&this._mode!==od.None&&(e.preventDefault(),this.impose(),e.target.constructor!==HTMLDocument&&this._domElement.focus())}_onMouseLeave(e){this.enabled&&this._mode!==od.None&&(e.preventDefault(),this._dragging=!1,e.target.constructor!==HTMLDocument&&this._domElement.blur(),this.dispose())}_onMouseMove(e){if(this.enabled&&this._mode!==od.None)if(e.preventDefault(),!1===this._dragging){const t=this.intersectObjects(e,[this._currentGizmo]);if(t){const r=t.object;this._currentHandle&&r!==this._currentHandle&&(this._currentHandle.highlight(!1),this.dispatchEvent(this._events.mouseLeave)),this._currentHandle=r,this._currentHandle.highlight(!0),this.dispatchEvent(this._events.mouseEnter),this._consumeEvent(e)}else s(this._currentHandle)&&(this._currentHandle.highlight(!1),this._currentHandle=null,this.dispatchEvent(this._events.mouseLeave))}else{const t=this._currentHandle,r=t.name,n=this.intersectObjects(e,[this._currentGizmo.intersectPlane]);switch(n&&(this._secondPoint=n.point),this._mouseDisplacement.subVectors(this._secondPoint,this._firstPoint),this._firstPoint.copy(this._secondPoint),this._mode){case od.Translate:"X"===r?this._offset.set(1,0,0):"Y"===r?this._offset.set(0,1,0):"Z"===r?this._offset.set(0,0,1):"XY"===r?this._offset.set(1,1,0):"YZ"===r?this._offset.set(0,1,1):"XZ"===r?this._offset.set(1,0,1):"XYZ"===r&&this._offset.set(1,1,1),this._offset.multiply(this._mouseDisplacement),this._translate(this._offset);break;case od.Rotate:break;case od.Scale:if(t.isScaleHandle)this._offset.copy(this._currentHandle.direction).multiply(this._mouseDisplacement);else if(t.isPlaneHandle){const e=this._currentHandle.xDirection.dot(this._mouseDisplacement);e>0?this._offset.setX(Math.abs(this._mouseDisplacement.x)):e<0?this._offset.setX(-Math.abs(this._mouseDisplacement.x)):this._offset.setX(0);const t=this._currentHandle.yDirection.dot(this._mouseDisplacement);t>0?this._offset.setY(Math.abs(this._mouseDisplacement.y)):t<0?this._offset.setY(-Math.abs(this._mouseDisplacement.y)):this._offset.setY(0);const r=this._currentHandle.zDirection.dot(this._mouseDisplacement);r>0?this._offset.setZ(Math.abs(this._mouseDisplacement.z)):r<0?this._offset.setZ(-Math.abs(this._mouseDisplacement.z)):this._offset.setZ(0)}else if(t.isOmnidirectionalHandle){this.getWorldPosition(this._worldPosition),this._directionToMouse.subVectors(this._firstPoint,this._worldPosition);const e=this._directionToMouse.dot(this._mouseDisplacement)>0?this._mouseDisplacement.length():-this._mouseDisplacement.length();this._offset.set(e,e,e)}this._scale(this._offset);break;default:throw new RangeError(`Invalid switch parameter: ${this._mode}`)}this.updateClipping(),this._consumeEvent(e),this.dispatchEvent(this._events.change)}}_onMouseUp(e){if(!this.enabled)return;if(this._mode===od.None)return;if(e.button!==Ot.Left.value)return;e.preventDefault(),this._dragging=!1,this.dispatchEvent(this._events.mouseUp);const t=this.intersectObjects(e,[this._currentGizmo]);t?(this._currentHandle=t.object,this._currentHandle.highlight(!0),this._consumeEvent(e),this.dispatchEvent(this._events.mouseEnter)):s(this._currentHandle)&&(this._currentHandle.highlight(!1),this._currentHandle=null,this.dispatchEvent(this._events.mouseLeave)),this.updateGizmo()}_onMouseWheel(e){this.enabled&&e.preventDefault()}_onTouchCancel(e){this.enabled&&e.preventDefault()}_onTouchEnd(e){this.enabled&&e.preventDefault()}_onTouchLeave(e){this.enabled&&e.preventDefault()}_onTouchMove(e){this.enabled&&e.preventDefault()}_onTouchStart(e){this.enabled&&e.preventDefault()}getActiveHandle(e){}intersectObjects(e,t){const r=this._domElement.getBoundingClientRect(),n=(e.clientX-r.left)/r.width*2-1,i=-(e.clientY-r.top)/r.height*2+1;this._pointerVector.set(n,i),this._raycaster.setFromCamera(this._pointerVector,this._camera);const o=this._raycaster.intersectObjects(t,!1);return o[0]?o[0]:null}_translate(e){this.position.add(e),this.updateMatrix()}_translateX(e){this.position.setX(this.position.x+e),this.updateMatrix()}_translateY(e){this.position.setY(this.position.y+e),this.updateMatrix()}_translateZ(e){this.position.setZ(this.position.z+e),this.updateMatrix()}_translateXY(e,t){this.position.setX(this.position.x+e),this.position.setY(this.position.y+t),this.updateMatrix()}_translateXZ(e,t){this.position.setX(this.position.x+e),this.position.setZ(this.position.z+t),this.updateMatrix()}_translateYZ(e,t){this.position.setY(this.position.y+e),this.position.setZ(this.position.z+t),this.updateMatrix()}_translateXYZ(e,t,r){this.position.set(this.position.x+e,this.position.y+t,this.position.z+r),this.updateMatrix()}_rotateX(e){}_rotateY(e){}_rotateZ(e){}_rotateXY(e){}_rotateXZ(e){}_rotateYZ(e){}_rotateXYZ(e){}_scale(e){this.scale.add(e),this.updateMatrix()}_scaleX(e){this.scale.setX(this.scale.x+e),this.updateMatrix()}_scaleY(e){this.scale.setY(this.scale.y+e),this.updateMatrix()}_scaleZ(e){this.scale.setZ(this.scale.z+e),this.updateMatrix()}_scaleXY(e,t){this.scale.setX(this.scale.x+e),this.scale.setY(this.scale.y+t),this.updateMatrix()}_scaleXZ(e,t){this.scale.setX(this.scale.x+e),this.scale.setZ(this.scale.z+t),this.updateMatrix()}_scaleYZ(e,t){this.scale.setY(this.scale.y+e),this.scale.setZ(this.scale.z+t),this.updateMatrix()}_scaleXYZ(e,t,r){this.scale.set(this.scale.x+e,this.scale.y+t,this.scale.z+r),this.updateMatrix()}}
/**
 * @module Managers/CurvesManager
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @example Todo
 *
 */class sd extends At{constructor(e={}){super({basePath:"/curves",...e})}convert(e){if(!e)throw new Error("CurvesManager: Unable to convert null or undefined data !");const t=e.type;let r;switch(t){case"ArcCurve":r=new Me;break;case"CatmullRomCurve3":r=new be;break;case"CubicBezierCurve":r=new we;break;case"CubicBezierCurve3":r=new ye;break;case"Curve":r=new _e;break;case"CurvePath":r=new ge;break;case"EllipseCurve":r=new pe;break;case"LineCurve":r=new fe;break;case"LineCurve3":r=new me;break;case"Path":r=new de;break;case"QuadraticBezierCurve":r=new ue;break;case"QuadraticBezierCurve3":r=new le;break;case"SplineCurve":r=new he;break;case"Shape":r=new O;break;default:throw new Error(`TCurvesManager: Unknown curve of type: ${t}`)}return r.fromJSON(e),r}_onJson(e,t,r,n){const i=y(e)?[e]:e,o={};for(let e,t=0,a=i.length;t<a;t++){e=i[t];try{o[e._id]=this.convert(e)}catch(e){n(e)}r(t/a)}t(o)}}
/**
 * @module Managers/GeometriesManager
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @requires {@link TDataBaseManager}
 * @requires '../../../node_modules/three/src/core/Geometry'
 * @requires { BufferGeometry } from 'three'
 * @requires '../../../node_modules/three/src/core/BufferAttribute'
 *
 */const cd=kt({Int8Array:0,Uint8Array:1,Uint8ClampedArray:2,Int16Array:3,Uint16Array:4,Int32Array:5,Uint32Array:6,Float32Array:7,Float64Array:8});class hd extends At{constructor(e={}){const t={basePath:"/geometries",projectionSystem:"zBack",globalScale:1,computeNormals:!0,computeBoundingBox:!0,computeBoundingSphere:!0,...e};super(t),this.projectionSystem=t.projectionSystem,this.globalScale=t.globalScale,this.computeNormals=t.computeNormals,this.computeBoundingBox=t.computeBoundingBox,this.computeBoundingSphere=t.computeBoundingSphere}get computeBoundingBox(){return this._computeBoundingBox}set computeBoundingBox(e){if(l(e))throw new TypeError("Compute bounding box cannot be null ! Expect a boolean.");if(g(e))throw new TypeError("Compute bounding box cannot be undefined ! Expect a boolean.");if(_(e))throw new TypeError(`Compute bounding box cannot be an instance of ${e.constructor.name} ! Expect a boolean.`);this._computeBoundingBox=e}get computeBoundingSphere(){return this._computeBoundingSphere}set computeBoundingSphere(e){if(l(e))throw new TypeError("Compute bounding sphere cannot be null ! Expect a boolean.");if(g(e))throw new TypeError("Compute bounding sphere cannot be undefined ! Expect a boolean.");if(_(e))throw new TypeError(`Compute bounding sphere cannot be an instance of ${e.constructor.name} ! Expect a boolean.`);this._computeBoundingSphere=e}get computeNormals(){return this._computeNormals}set computeNormals(e){if(l(e))throw new TypeError("Compute normals cannot be null ! Expect a boolean.");if(g(e))throw new TypeError("Compute normals cannot be undefined ! Expect a boolean.");if(_(e))throw new TypeError(`Compute normals cannot be an instance of ${e.constructor.name} ! Expect a boolean.`);this._computeNormals=e}get projectionSystem(){return this._projectionSystem}set projectionSystem(e){if(l(e))throw new TypeError("Projection system cannot be null ! Expect a positive number.");if(g(e))throw new TypeError("Projection system cannot be undefined ! Expect a positive number.");this._projectionSystem=e}get globalScale(){return this._globalScale}set globalScale(e){if(l(e))throw new TypeError("Global scale cannot be null ! Expect a positive number.");if(g(e))throw new TypeError("Global scale cannot be undefined ! Expect a positive number.");this._globalScale=e}setComputeBoundingBox(e){return this.computeBoundingBox=e,this}setComputeBoundingShpere(e){return this.computeBoundingSphere=e,this}setComputeNormals(e){return this.computeNormals=e,this}setProjectionSystem(e){return this.projectionSystem=e,this}setGlobalScale(e){return this.globalScale=e,this}_onJson(e,t,r,n){const i=y(e)?[e]:e,o={};for(let e,t=0,a=i.length;t<a;t++){e=i[t];try{o[e._id]=this.convert(e)}catch(e){n(e)}r(new ProgressEvent("GeometriesManager",{lengthComputable:!0,loaded:t+1,total:a}))}t(o)}convert(e){if(!e)throw new Error("GeometriesManager: Unable to convert null or undefined data !");const t=e.type;if(!t)throw new Error("GeometriesManager: Unable to convert untyped data !");let r=null;if(e.isBufferGeometry||t.includes("BufferGeometry"))r=this._convertJsonToBufferGeometry(e),this._computeNormals&&r.computeVertexNormals();else{if(!e.isGeometry&&!t.includes("Geometry"))throw new Error(`TGeometriesManager: Unable to retrieve geometry of type ${t} !`);r=this._convertJsonToGeometry(e),this._computeNormals&&r.computeFaceNormals()}return this.computeBoundingBox&&(r.boundingBox=null,r.computeBoundingBox()),this.computeBoundingSphere&&(r.boundingSphere=null,r.computeBoundingSphere()),r}_convertJsonToGeometry(e){const t=e.types;let r=null;switch(t){case"BoxGeometry":r=new je;break;case"CircleGeometry":r=new He;break;case"CylinderGeometry":r=new Re;break;case"ConeGeometry":r=new Ue;break;case"EdgesGeometry":r=new K;break;case"DodecahedronGeometry":r=new Ne;break;case"ExtrudeGeometry":r=new ke;break;case"Geometry":r=new Le;break;case"IcosahedronGeometry":r=new ze;break;case"LatheGeometry":r=new Ie;break;case"OctahedronGeometry":r=new Ge;break;case"ParametricGeometry":r=new Ae;break;case"PlaneGeometry":r=new Oe;break;case"PolyhedronGeometry":r=new De;break;case"RingGeometry":r=new Pe;break;case"ShapeGeometry":r=new Ee;break;case"TetrahedronGeometry":r=new Be;break;case"TextGeometry":r=new Ce;break;case"TorusGeometry":r=new Te;break;case"TorusKnotGeometry":r=new Fe;break;case"TubeGeometry":r=new xe;break;case"SphereGeometry":r=new ve;break;case"WireframeGeometry":r=new Se;break;default:throw new Error(`TGeometriesManager: Unknown geometry of type: ${t}`)}r.uuid=e.uuid,r.name=e.name,r.type=e.type;for(var n=[],i=void 0,o=0,a=e.vertices.length;o<a;++o)i=e.vertices[o],n.push(new D(i.x,i.y,i.z));r.vertices=n;for(var s=[],c=void 0,h=0,l=e.faces.length;h<l;h++)c=e.faces[h],s.push(new Ve(c.a,c.b,c.c,c.normal,c.color,c.materialIndex));r.faces=s,r.morphTargets=[],r.morphNormals=[],r.skinWeights=[],r.skinIndices=[],r.lineDistances=[],r.elementsNeedUpdate=!0,r.verticesNeedUpdate=!0,r.uvsNeedUpdate=!0,r.normalsNeedUpdate=!0,r.colorsNeedUpdate=!0,r.lineDistancesNeedUpdate=!0,r.groupsNeedUpdate=!0}_convertJsonToBufferGeometry(e){const t=e.type;let r=null;switch(t){case"BoxBufferGeometry":r=new ne;break;case"BufferGeometry":case"ShapeBufferGeometry":r=new L;break;case"CircleBufferGeometry":r=new ot;break;case"CylinderBufferGeometry":r=new re;break;case"ConeBufferGeometry":r=new oe;break;case"DodecahedronBufferGeometry":r=new it;break;case"ExtrudeBufferGeometry":r=new nt;break;case"IcosahedronBufferGeometry":r=new rt;break;case"LatheBufferGeometry":r=new tt;break;case"OctahedronBufferGeometry":r=new Z;break;case"ParametricBufferGeometry":r=new et;break;case"PlaneBufferGeometry":r=new ie;break;case"PolyhedronBufferGeometry":r=new Je;break;case"RingBufferGeometry":r=new Qe;break;case"TetrahedronBufferGeometry":r=new Ke;break;case"TextBufferGeometry":r=new qe;break;case"TorusBufferGeometry":r=new Ze;break;case"TorusKnotBufferGeometry":r=new Xe;break;case"TubeBufferGeometry":r=new $e;break;case"SphereBufferGeometry":r=new We;break;case"InstancedBufferGeometry":r=new Ye;break;default:throw new Error(`TGeometriesManager: Unknown buffer geometry of type: ${t}`)}r._id=e._id,r.uuid=e.uuid,r.name=e.name;const n=e.index;if(n&&n.array&&n.array.length>0){const e=this.__convertBase64ToArrayBuffer(n.array),t=this.__convertArrayBufferToTypedArray(e);r.index=new k(t,n.itemSize,n.normalized)}const i=e.attributes;if(i){let e={};const t=i.position;if(t){const r=this.__convertBase64ToArrayBuffer(t.array),n=this.__convertArrayBufferToTypedArray(r),i=this.globalScale,o=new Float32Array(n);if("zBack"===this._projectionSystem){let e=null,t=null,r=null;for(let n=0,a=o.length;n<a;n+=3)e=o[n]/i,t=o[n+2]/i,r=-o[n+1]/i,o[n]=e,o[n+1]=t,o[n+2]=r}else for(let e=0,t=o.length;e<t;e++)o[e]/=i;e.position=new k(o,t.itemSize,t.normalized)}const n=i.normal;if(n){const t=this.__convertBase64ToArrayBuffer(n.array),r=this.__convertArrayBufferToTypedArray(t);e.normal=new k(r,n.itemSize,n.normalized)}const o=i.uv;if(o){const t=this.__convertBase64ToArrayBuffer(o.array),r=this.__convertArrayBufferToTypedArray(t);e.uv=new k(r,o.itemSize,o.normalized)}r.attributes=e}return s(e.groups)&&(r.groups=e.groups),s(e.boundingBox)&&(r.boundingBox=e.boundingBox),s(e.boundingSphere)&&(r.boundingSphere=e.boundingSphere),"ShapeBufferGeometry"===t&&(r.shapes=e.shapes.map(e=>(new O).fromJSON(e)),r.curveSegments=e.curveSegments),r}__convertArrayBufferToTypedArray(e){const t=new DataView(e),r=e.byteLength-1,n=t.getUint8(0);let i=null;switch(n){case cd.Int8Array:i=new Int8Array(r/1);for(let e=0,n=1;n<r;e++,n+=1)i[e]=t.getInt8(n);break;case cd.Uint8Array:i=new Uint8Array(r/1);for(let e=0,n=1;n<r;e++,n+=1)i[e]=t.getUint8(n);break;case cd.Uint8ClampedArray:i=new Uint8ClampedArray(r/1);for(let e=0,n=1;n<r;e++,n+=1)i[e]=t.getUint8(n);break;case cd.Int16Array:i=new Int16Array(r/2);for(let e=0,n=1;n<r;e++,n+=2)i[e]=t.getInt16(n);break;case cd.Uint16Array:i=new Uint16Array(r/2);for(let e=0,n=1;n<r;e++,n+=2)i[e]=t.getUint16(n);break;case cd.Int32Array:i=new Int32Array(r/4);for(let e=0,n=1;n<r;e++,n+=4)i[e]=t.getInt32(n);break;case cd.Uint32Array:i=new Uint32Array(r/4);for(let e=0,n=1;n<r;e++,n+=4)i[e]=t.getUint32(n);break;case cd.Float32Array:i=new Float32Array(r/4);for(let e=0,n=1;n<r;e++,n+=4)i[e]=t.getFloat32(n);break;case cd.Float64Array:i=new Float64Array(r/8);for(let e=0,n=1;n<r;e++,n+=8)i[e]=t.getFloat64(n);break;default:throw new RangeError(`Invalid switch parameter: ${n}`)}return i}__convertBase64ToArrayBuffer(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=new Uint8Array(256);for(let e=0;e<64;e++)r[t.charCodeAt(e)]=e;const n=e.length;let i=.75*n;"="===e[n-1]&&(i--,"="===e[n-2]&&i--);let o,a,s,c,h=new ArrayBuffer(i),l=new Uint8Array(h);for(let t=0,i=0;t<n;t+=4)o=r[e.charCodeAt(t)],a=r[e.charCodeAt(t+1)],s=r[e.charCodeAt(t+2)],c=r[e.charCodeAt(t+3)],l[i++]=o<<2|a>>4,l[i++]=(15&a)<<4|s>>2,l[i++]=(3&s)<<6|63&c;return h}}
/**
 * @module Managers/TexturesManager
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class ld extends At{constructor(e={}){super({basePath:"/textures",...e})}convert(e){if(!e)throw new Error("TexturesManager: Unable to convert null or undefined data !");const t=e.type;throw new Error(`TTexturesManager: Unknown texture of type: ${t}`)}_onJson(e,t,r,n){const i=y(e)?[e]:e,o={};for(let e,t=0,a=i.length;t<a;t++){e=i[t];try{o[e._id]=this.convert(e)}catch(e){n(e)}r(t/a)}t(o)}}
/**
 * @module Managers/MaterialsManager
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 * @requires TDataBaseManager
 *
 */const ud=(new ut).load("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH4gkKDRoGpGNegQAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAAMSURBVAjXY/j//z8ABf4C/tzMWecAAAAASUVORK5CYII=");class dd extends At{constructor(e={}){const t={basePath:"/materials",texturesPath:"/textures",texturesProviderOptions:{},generateMipmap:!1,autoFillTextures:!0,...e};super(t),this.texturesPath=t.texturesPath,this.generateMipmap=t.generateMipmap,this.autoFillTextures=t.autoFillTextures,this.texturesProvider=new at(t.texturesProviderOptions)}get texturesPath(){return this._texturesPath}set texturesPath(e){if(l(e))throw new TypeError("Textures path cannot be null ! Expect a non empty string.");if(g(e))throw new TypeError("Textures path cannot be undefined ! Expect a non empty string.");if(m(e))throw new TypeError(`Textures path cannot be an instance of ${e.constructor.name} ! Expect a non empty string.`);if(w(e))throw new TypeError("Textures path cannot be empty ! Expect a non empty string.");if(b(e))throw new TypeError("Textures path cannot contain only whitespace ! Expect a non empty string.");this._texturesPath=e}get texturesProvider(){return this._texturesProvider}set texturesProvider(e){if(l(e))throw new TypeError("Textures provider cannot be null ! Expect an instance of TextureLoader.");if(g(e))throw new TypeError("Textures provider cannot be undefined ! Expect an instance of TextureLoader.");if(!(e instanceof ld||e instanceof at))throw new TypeError(`Textures provider cannot be an instance of ${e.constructor.name} ! Expect an instance of TTexturesManager.`);this._texturesProvider=e}get generateMipmap(){return this._generateMipmap}set generateMipmap(e){if(l(e))throw new TypeError("Generate mipmap cannot be null ! Expect a boolean.");if(g(e))throw new TypeError("Generate mipmap cannot be undefined ! Expect a boolean.");if(_(e))throw new TypeError(`Generate mipmap cannot be an instance of ${e.constructor.name} ! Expect a boolean.`);this._generateMipmap=e}get autoFillTextures(){return this._autoFillTextures}set autoFillTextures(e){if(l(e))throw new TypeError("Global scale cannot be null ! Expect a boolean.");if(g(e))throw new TypeError("Global scale cannot be undefined ! Expect a positive number.");if(_(e))throw new TypeError("Global scale cannot be null ! Expect a boolean.");this._autoFillTextures=e}setTexturesPath(e){return this.texturesPath=e,this}setTexturesProvider(e){return this.texturesProvider=e,this}setGenerateMipmap(e){return this.generateMipmap=e,this}setAutoFillTextures(e){return this.autoFillTextures=e,this}_onJson(e,t,r,n){const i=y(e)?[e]:e,o={};for(let e,t=0,a=i.length;t<a;t++){e=i[t];try{o[e._id]=this.convert(e)}catch(e){n(e)}r(new ProgressEvent("MaterialsManager",{lengthComputable:!0,loaded:t+1,total:a}))}this._autoFillTextures?this.fillTextures(o,t,r,n):t(o)}convert(e){if(!e)throw new Error("MaterialsManager: Unable to convert null or undefined data !");const t=e.type;let r=null;switch(t){case"MeshPhongMaterial":{r=new ct,this._fillBaseMaterialData(r,e);const t=e.color;s(t)&&(r.color=this._setColor(t));const n=e.specular;s(n)&&(r.specular=this._setColor(n));const i=e.shininess;s(i)&&(r.shininess=i);const o=e.map;s(o)&&(r.map=o);const a=e.lightMap;s(a)&&(r.lightMap=a);const c=e.lightMapIntensity;s(c)&&(r.lightMapIntensity=c);const h=e.aoMap;s(h)&&(r.aoMap=h);const l=e.aoMapIntensity;s(l)&&(r.aoMapIntensity=l);const u=e.emissive;s(u)&&(r.emissive=this._setColor(u));const d=e.emissiveIntensity;s(d)&&(r.emissiveIntensity=d);const m=e.emissiveMap;s(m)&&(r.emissiveMap=m);const f=e.bumpMap;s(f)&&(r.bumpMap=f);const p=e.bumpScale;s(p)&&(r.bumpScale=p);const g=e.normalMap;s(g)&&(r.normalMap=g);const _=e.normalScale;s(_)&&(r.normalScale=this._setVector2(_));const y=e.displacementMap;s(y)&&(r.displacementMap=y);const w=e.displacementScale;s(w)&&(r.displacementScale=w);const b=e.displacementBias;s(b)&&(r.displacementBias=b);const M=e.specularMap;s(M)&&(r.specularMap=M);const S=e.alphaMap;s(S)&&(r.alphaMap=S);const v=e.envMap;s(v)&&(r.envMap=v);const x=e.combine;s(x)&&(r.combine=x);const F=e.reflectivity;s(F)&&(r.reflectivity=F);const T=e.refractionRatio;s(T)&&(r.refractionRatio=T);const C=e.wireframe;s(C)&&(r.wireframe=C);const B=e.wireframeLinewidth;s(B)&&(r.wireframeLinewidth=B);const E=e.wireframeLinecap;s(E)&&(r.wireframeLinecap=E);const P=e.wireframeLinejoin;s(P)&&(r.wireframeLinejoin=P);const D=e.skinning;s(D)&&(r.skinning=D);const O=e.morphTargets;s(O)&&(r.morphTargets=O);const A=e.morphNormals;s(A)&&(r.morphNormals=A)}break;case"MeshLambertMaterial":{r=new st,this._fillBaseMaterialData(r,e);const t=e.color;s(t)&&(r.color=this._setColor(t));const n=e.map;s(n)&&(r.map=n);const i=e.lightMap;s(i)&&(r.lightMap=i);const o=e.lightMapIntensity;s(o)&&(r.lightMapIntensity=o);const a=e.aoMap;s(a)&&(r.aoMap=a);const c=e.aoMapIntensity;s(c)&&(r.aoMapIntensity=c);const h=e.emissive;s(h)&&(r.emissive=this._setColor(h));const l=e.emissiveIntensity;s(l)&&(r.emissiveIntensity=l);const u=e.emissiveMap;s(u)&&(r.emissiveMap=u);const d=e.specularMap;s(d)&&(r.specularMap=d);const m=e.alphaMap;s(m)&&(r.alphaMap=m);const f=e.envMap;s(f)&&(r.envMap=f);const p=e.combine;s(p)&&(r.combine=p);const g=e.reflectivity;s(g)&&(r.reflectivity=g);const _=e.refractionRatio;s(_)&&(r.refractionRatio=_);const y=e.wireframe;s(y)&&(r.wireframe=y);const w=e.wireframeLinewidth;s(w)&&(r.wireframeLinewidth=w);const b=e.wireframeLinecap;s(b)&&(r.wireframeLinecap=b);const M=e.wireframeLinejoin;s(M)&&(r.wireframeLinejoin=M);const S=e.skinning;s(S)&&(r.skinning=S);const v=e.morphTargets;s(v)&&(r.morphTargets=v);const x=e.morphNormals;s(x)&&(r.morphNormals=x)}break;case"LineBasicMaterial":{r=new Y,this._fillBaseMaterialData(r,e);const t=e.color;s(t)&&(r.color=this._setColor(t))}break;case"PointsMaterial":{r=new N,this._fillBaseMaterialData(r,e);const t=e.color;s(t)&&(r.color=this._setColor(t));const n=e.map;s(n)&&(r.map=n);const i=e.morphTargets;s(i)&&(r.morphTargets=i);const o=e.size;s(o)&&(r.size=o);const a=e.sizeAttenuation;s(a)&&(r.sizeAttenuation=a)}break;default:throw new Error(`TMaterialsManager: Unmanaged material of type: ${t}`)}return r}_fillBaseMaterialData(e,t){const r=t._id;s(r)&&M(r)&&(e._id=r);const n=t.uuid;s(n)&&M(n)&&(e.uuid=n);const i=t.name;s(i)&&M(i)&&(e.name=i);const o=t.fog;s(o)&&(e.fog=o);const a=t.lights;s(a)&&(e.lights=a);const c=t.blending;s(c)&&(e.blending=c);const h=t.side;s(h)&&(e.side=h);const l=t.flatShading;s(l)&&(e.flatShading=l);const u=t.vertexColors;s(u)&&(e.vertexColors=u);const d=t.opacity;s(d)&&(e.opacity=d);const m=t.transparent;s(m)&&(e.transparent=m);const f=t.blendSrc;s(f)&&(e.blendSrc=f);const p=t.blendDst;s(p)&&(e.blendDst=p);const g=t.blendEquation;s(g)&&(e.blendEquation=g);const _=t.blendSrcAlpha;s(_)&&(e.blendSrcAlpha=_);const y=t.blendDstAlpha;s(y)&&(e.blendDstAlpha=y);const w=t.blendEquationAlpha;s(w)&&(e.blendEquationAlpha=w);const b=t.depthFunc;s(b)&&(e.depthFunc=b);const S=t.depthTest;s(S)&&(e.depthTest=S);const v=t.depthWrite;s(v)&&(e.depthWrite=v);const x=t.clippingPlanes;s(x)&&(e.clippingPlanes=x);const F=t.clipIntersection;s(F)&&(e.clipIntersection=F);const T=t.clipShadows;s(T)&&(e.clipShadows=T);const C=t.colorWrite;s(C)&&(e.colorWrite=C);const B=t.precision;s(B)&&(e.precision=B);const E=t.polygonOffset;s(E)&&(e.polygonOffset=E);const P=t.polygonOffsetFactor;s(P)&&(e.polygonOffsetFactor=P);const D=t.polygonOffsetUnits;s(D)&&(e.polygonOffsetUnits=D);const O=t.dithering;s(O)&&(e.dithering=O);const A=t.alphaTest;s(A)&&(e.alphaTest=A);const G=t.premultipliedAlpha;s(G)&&(e.premultipliedAlpha=G);const I=t.overdraw;s(I)&&(e.overdraw=I);const z=t.visible;s(z)&&(e.visible=z);const L=t.userData;s(L)&&(e.userData=L);const k=t.needsUpdate;s(k)&&(e.needsUpdate=k)}_setVector2(e){const t=e.x,r=e.y;if(a(t)||a(r))throw new Error("MaterialsManager: Unable to convert null or undefined vector 2 !");return new j(t,r)}_setColor(e){const t=e.r,r=e.g,n=e.b;if(a(t)||a(r)||a(n))throw new Error("MaterialsManager: Unable to convert null or undefined color !");return new ht(t,r,n)}fillTextures(e,t){const r=this._retrieveTexturesOf(e);for(let t in e){const n=e[t],i=r[t];for(let e in i)n[e]=i[e]}t(e)}_retrieveTexturesOf(e){const t=["map","lightMap","aoMap","emissiveMap","bumpMap","normalMap","displacementMap","specularMap","alphaMap","envMap"],r={},n={};for(let i in e){const o=e[i];let a={};for(let e=0,r=t.length;e<r;e++){let r=t[e];const i=o[r];if(s(i)&&M(i)&&S(i)){const e=`${this._texturesPath}/${i}`,t=n[e];if(s(t))a[r]=t;else{const t=this._texturesProvider.load(e,()=>{},()=>{},()=>{t.image||(t.image=ud,t.needsUpdate=!0)});t.name=i,this._generateMipmap||(t.generateMipmaps=!1,t.magFilter=lt,t.minFilter=lt),n[e]=t,a[r]=t}}}r[i]=a}return r}}
/**
 * @module Managers/ObjectsManager
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 */class md extends At{constructor(e={}){const t={basePath:"/objects",geometriesProviderOptions:{},materialsProviderOptions:{},projectionSystem:"zBack",globalScale:1,autoFillObjects3D:!0,...e};super(t),this.projectionSystem=t.projectionSystem,this.globalScale=t.globalScale,this.autoFillObjects3D=t.autoFillObjects3D,this.geometriesProvider=new hd(t.geometriesProviderOptions),this.materialsProvider=new dd(t.materialsProviderOptions)}get geometriesProvider(){return this._geometriesProvider}set geometriesProvider(e){if(l(e))throw new TypeError("Geometries provider cannot be null ! Expect an instance of GeometriesManager.");if(g(e))throw new TypeError("Geometries provider cannot be undefined ! Expect an instance of GeometriesManager.");if(!(e instanceof hd))throw new TypeError(`Geometries provider cannot be an instance of ${e.constructor.name} ! Expect an instance of TGeometriesManager.`);this._geometriesProvider=e}get materialsProvider(){return this._materialsProvider}set materialsProvider(e){if(l(e))throw new TypeError("Materials provider cannot be null ! Expect an instance of MaterialsManager.");if(g(e))throw new TypeError("Materials provider cannot be undefined ! Expect an instance of MaterialsManager.");if(!(e instanceof dd))throw new TypeError(`Materials provider cannot be an instance of ${e.constructor.name} ! Expect an instance of TMaterialsManager.`);this._materialsProvider=e}get projectionSystem(){return this._projectionSystem}set projectionSystem(e){if(l(e))throw new TypeError("Projection system cannot be null ! Expect a positive number.");if(g(e))throw new TypeError("Projection system cannot be undefined ! Expect a positive number.");this._projectionSystem=e}get globalScale(){return this._globalScale}set globalScale(e){if(l(e))throw new TypeError("Global scale cannot be null ! Expect a positive number.");if(g(e))throw new TypeError("Global scale cannot be undefined ! Expect a positive number.");this._globalScale=e}get autoFillObjects3D(){return this._autoFillObjects3D}set autoFillObjects3D(e){if(l(e))throw new TypeError("Global scale cannot be null ! Expect a boolean.");if(g(e))throw new TypeError("Global scale cannot be undefined ! Expect a positive number.");if(_(e))throw new TypeError("Global scale cannot be null ! Expect a boolean.");this._autoFillObjects3D=e}setGeometriesProvider(e){return this.geometriesProvider=e,this}setMaterialsProvider(e){return this.materialsProvider=e,this}setProjectionSystem(e){return this.projectionSystem=e,this}setGlobalScale(e){return this.globalScale=e,this}setAutoFillObjects3D(e){return this.autoFillObjects3D=e,this}_onJson(e,t,r,n){const i={};for(let t,o=0,a=e.length;o<a;o++){t=e[o];try{i[t._id]=this.convert(t)}catch(e){n(e)}r(new ProgressEvent("ObjectsManager",{lengthComputable:!0,loaded:o+1,total:a}))}this._autoFillObjects3D?this.fillObjects3D(i,t,r,n):t(i)}_onArrayBuffer(e,t,r,n){}_onBlob(e,t,r,n){}_onText(e,t,r,n){}convert(e){if(!e)throw new Error("ObjectsManager: Unable to convert null or undefined data !");const t=e.type;let r=null;switch(t){case"Object3D":r=new H,this._fillBaseObjectsData(r,e);break;case"Scene":r=new xt,this._fillBaseObjectsData(r,e),s(e.background)&&Number.isInteger(e.background)&&(r.background=new ht(e.background)),s(e.fog)&&("Fog"===e.fog.type?r.fog=new Ft(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(r.fog=new Tt(e.fog.color,e.fog.density))),r.overrideMaterial=e.overrideMaterial,r.autoUpdate=e.autoUpdate;break;case"PerspectiveCamera":r=new vt,this._fillBaseObjectsData(r,e),r.fov=e.fov,r.aspect=e.aspect,r.near=e.near,r.far=e.far,s(e.focus)&&(r.focus=e.focus),s(e.zoom)&&(r.zoom=e.zoom),s(e.filmGauge)&&(r.filmGauge=e.filmGauge),s(e.filmOffset)&&(r.filmOffset=e.filmOffset),s(e.view)&&(r.view=Object.assign({},e.view));break;case"OrthographicCamera":r=new St(e.left,e.right,e.top,e.bottom,e.near,e.far),this._fillBaseObjectsData(r,e);break;case"AmbientLight":r=new Mt(e.color,e.intensity),this._fillBaseObjectsData(r,e);break;case"DirectionalLight":r=new bt(e.color,e.intensity),this._fillBaseObjectsData(r,e);break;case"PointLight":r=new wt(e.color,e.intensity,e.distance,e.decay),this._fillBaseObjectsData(r,e);break;case"RectAreaLight":r=new yt(e.color,e.intensity,e.width,e.height),this._fillBaseObjectsData(r,e);break;case"SpotLight":r=new _t(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),this._fillBaseObjectsData(r,e);break;case"HemisphereLight":r=new gt(e.color,e.groundColor,e.intensity),this._fillBaseObjectsData(r,e);break;case"SkinnedMesh":r=new pt,this._fillBaseObjectsData(r,e),r.geometry=e.geometry,r.material=e.material,r.drawMode=e.drawMode,r.bindMode=e.bindMode,r.bindMatrix=e.bindMatrix,r.bindMatrixInverse=e.bindMatrixInverse;break;case"Mesh":r=new X,this._fillBaseObjectsData(r,e),r.geometry=e.geometry,r.material=e.material,r.drawMode=e.drawMode;break;case"LOD":r=new ft,this._fillBaseObjectsData(r,e),r.levels=e.levels;break;case"Line":r=new ee,this._fillBaseObjectsData(r,e),r.geometry=e.geometry,r.material=e.material,r.drawMode=e.drawMode;break;case"LineLoop":r=new mt,this._fillBaseObjectsData(r,e),r.geometry=e.geometry,r.material=e.material,r.drawMode=e.drawMode;break;case"LineSegments":r=new Q,this._fillBaseObjectsData(r,e),r.geometry=e.geometry,r.material=e.material,r.drawMode=e.drawMode;break;case"Points":r=new U,this._fillBaseObjectsData(r,e),r.geometry=e.geometry,r.material=e.material,r.drawMode=e.drawMode;break;case"Sprite":r=new dt,this._fillBaseObjectsData(r,e),r.material=e.material;break;case"Group":r=new z,this._fillBaseObjectsData(r,e);break;default:throw new Error(`TObjectsManager: Unknown object of type: ${t}`)}return r}_fillBaseObjectsData(e,t){e._id=t._id,s(t.uuid)&&(e.uuid=t.uuid),s(t.name)&&(e.name=t.name),s(t.parent)&&(e.parent=t.parent),v(t.children)&&(e.children=t.children),s(t.up)&&(e.up.x=t.up.x,e.up.y=t.up.y,e.up.z=t.up.z),s(t.position)&&("zBack"===this._projectionSystem?(e.position.x=t.position.x/this._globalScale,e.position.y=t.position.z/this._globalScale,e.position.z=-t.position.y/this._globalScale):(e.position.x=t.position.x/this._globalScale,e.position.y=t.position.y/this._globalScale,e.position.z=t.position.z/this._globalScale)),s(t.rotation)&&("zBack"===this._projectionSystem?(e.rotation.x=t.rotation.x,e.rotation.y=t.rotation.z,e.rotation.z=-t.rotation.y,e.rotation.order=t.rotation.order):(e.rotation.x=t.rotation.x,e.rotation.y=t.rotation.y,e.rotation.z=t.rotation.z,e.rotation.order=t.rotation.order)),s(t.quaternion)&&("zBack"===this._projectionSystem?(e.quaternion.x=t.quaternion.x,e.quaternion.y=t.quaternion.z,e.quaternion.z=-t.quaternion.y,e.quaternion.w=t.quaternion.w):(e.quaternion.x=t.quaternion.x,e.quaternion.y=t.quaternion.y,e.quaternion.z=t.quaternion.z,e.quaternion.w=t.quaternion.w)),s(t.scale)&&(0!==t.scale.x&&0!==t.scale.y&&0!==t.scale.z?(e.scale.x=t.scale.x,e.scale.y=t.scale.y,e.scale.z=t.scale.z):this.logger.warn("Try to assign null scale !")),s(t.modelViewMatrix)&&v(t.modelViewMatrix)&&e.modelViewMatrix.fromArray(t.modelViewMatrix),s(t.normalMatrix)&&v(t.normalMatrix)&&e.normalMatrix.fromArray(t.normalMatrix),s(t.matrix)&&v(t.matrix)&&e.matrix.fromArray(t.matrix),s(t.matrixWorld)&&v(t.matrixWorld)&&e.matrixWorld.fromArray(t.matrixWorld),s(t.matrixAutoUpdate)&&(e.matrixAutoUpdate=t.matrixAutoUpdate),s(t.matrixWorldNeedsUpdate)&&(e.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate),s(t.layers)&&(e.layers.mask=t.layers),s(t.visible)&&(e.visible=t.visible),s(t.castShadow)&&(e.castShadow=t.castShadow),s(t.receiveShadow)&&(e.receiveShadow=t.receiveShadow),s(t.frustumCulled)&&(e.frustumCulled=t.frustumCulled),s(t.renderOrder)&&(e.renderOrder=t.renderOrder),s(t.userData)&&(e.userData=t.userData)}fillObjects3D(e,t,r,n){const i=this,o=[];for(let t in e){const r=e[t];(r.geometry||r.material)&&o.push(e[t])}if(0===o.length)return void t(e);let a,s;function c(){if(a&&s){for(let t in e){const r=e[t];i.applyGeometry(r,a),i.applyMaterials(r,s)}t(e)}}this._retrieveGeometriesOf(o,e=>{a=e,c()},r,n),this._retrieveMaterialsOf(o,e=>{s=e,c()},r,n)}_retrieveGeometriesOf(e,t,r,n){const i=e.map(e=>e.geometry).filter((e,t,r)=>e&&r.indexOf(e)===t);0!==i.length?this._geometriesProvider.read(i,null,t,r,n):t({})}_retrieveMaterialsOf(e,t,r,n){const i=e.map(e=>e.material),o=[].concat.apply([],i).filter((e,t,r)=>e&&r.indexOf(e)===t);0!==o.length?this._materialsProvider.read(o,null,t,r,n):t({})}applyGeometry(e,t){const r=e.geometry;if(!r)return;const n=t[r];n?e.geometry=n:this.logger.error("Unable to retrieve geometry !!!")}applyMaterials(e,t){const r=e.material;if(r)if(Array.isArray(r))if(1===r.length){const n=t[r[0]];if(!n)return this.logger.error("Unable to retrieve material !!!"),null;e.material=n.clone()}else{e.material=[];for(let n=0,i=r.length;n<i;n++){const i=t[r[n]];if(!i)return this.logger.error("Unable to retrieve material !!!"),null;e.material.push(i.clone())}}else if("string"==typeof r){const n=t[r];if(!n)return void this.logger.error("Unable to retrieve material !!!");e.material=n.clone()}else this.logger.error("Invalid material ids, expected string or array of string")}}
/**
 * @module Objects3D/OrbitControlsHelper
 *
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 *
 */class fd extends Q{constructor(e={}){const t={radius:2,radials:16,circles:2,divisions:64,innerColor:new ht(4473924),outerColor:new ht(8947848),...e};super(fd._createInternalGeometry(t.radius,t.radials,t.circles,t.divisions,t.innerColor,t.outerColor),fd._createInternalMaterial()),this.matrixAutoUpdate=!1,this._intervalId=void 0}static _createInternalGeometry(e,t,r,n,i,o){const a=[],s=[];let c,h,l,u,d,m,f;for(u=0;u<=t;u++)l=u/t*(2*Math.PI),c=Math.sin(l)*e,h=Math.cos(l)*e,a.push(0,0,0),a.push(c,0,h),f=1&u?i:o,s.push(f.r,f.g,f.b),s.push(f.r,f.g,f.b);for(u=0;u<=r;u++){for(f=1&u?i:o,m=e-e/r*u,d=0;d<n;d++)l=d/n*(2*Math.PI),c=Math.sin(l)*m,h=Math.cos(l)*m,a.push(c,0,h),s.push(f.r,f.g,f.b),l=(d+1)/n*(2*Math.PI),c=Math.sin(l)*m,h=Math.cos(l)*m,a.push(c,0,h),s.push(f.r,f.g,f.b);a.push(-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1),s.push(0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1)}const p=new J(a,3);p.name="TOrbitControlsHelperPositionBufferAttribute";const g=new J(s,3);g.name="TOrbitControlsHelperColorBufferAttribute";const _=new L;return _.setAttribute("position",p),_.setAttribute("color",g),_.name="TOrbitControlsHelperGeometry",_}static _createInternalMaterial(){const e=new Y({vertexColors:Ct});return e.transparent=!0,e.opacity=0,e.name="TOrbitControlsHelperMaterial",e}startOpacityAnimation(){void 0!==this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this.material.opacity=1}endOpacityAnimation(){this._intervalId=setInterval(function(){this.material.opacity<=0?(this.material.opacity=0,clearInterval(this._intervalId),this._intervalId=void 0):this.material.opacity-=.1}.bind(this),100)}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class pd extends ju{constructor(e={}){super({geometry:new Ze(1,.12,4,12,Math.PI),...e}),this.isTorusHitbox=!0,this.type="TorusHitbox"}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class gd extends Qu{constructor(){super(),this.isRotateGizmo=!0,this.type="RotateGizmo";const e=(e,t,r)=>{const n=new L;let i=[];r=r||1;for(let n=0;n<=64*r;++n)"x"===t&&i.push(0,Math.cos(n/32*Math.PI)*e,Math.sin(n/32*Math.PI)*e),"y"===t&&i.push(Math.cos(n/32*Math.PI)*e,0,Math.sin(n/32*Math.PI)*e),"z"===t&&i.push(Math.sin(n/32*Math.PI)*e,Math.cos(n/32*Math.PI)*e,0);return n.setAttribute("position",new J(i,3)),n};this.handleGizmos={X:[[new ee(new e(1,"x",.5),new Ru({color:16711680}))],[new X(new Z(.04,0),new Hu({color:16711680})),[0,0,.99],null,[3,1,1]]],Y:[[new ee(new e(1,"y",.5),new Ru({color:65280}))],[new X(new Z(.04,0),new Hu({color:65280})),[0,0,.99],null,[3,1,1]]],Z:[[new ee(new e(1,"z",.5),new Ru({color:255}))],[new X(new Z(.04,0),new Hu({color:255})),[.99,0,0],null,[1,3,1]]],E:[[new ee(new e(1.25,"z",1),new Ru({color:13421568}))]],XYZ:[[new ee(new e(1,"z",1),new Ru({color:7895160}))]]},this.pickerGizmos={X:[[new pd,[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new pd,[0,0,0],[Math.PI/2,0,0]]],Z:[[new pd,[0,0,0],[0,0,-Math.PI/2]]],E:[[new pd({radius:1.25,tube:.12,radialSegments:2,tubularSegments:24})]],XYZ:[[new pd]]},this._setupHandles(this.handleGizmos)}raycast(e,t){if(e.intersectObject(this.intersectPlane,!0).length>0)for(let r of this.children)r.name!==this.intersectPlane.name&&r.raycast(e,t)}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class _d extends ju{constructor(e={}){super({geometry:new ne(1,1,1,1,1,1),...e}),this.isBoxHitbox=!0,this.type="BoxHitbox"}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class yd extends Yu{constructor(e={}){const t={boxColor:1067907,edgesColor:1193046,hitbox:new _d({geometry:new ne(1.1,1.1,1.1,1,1,1)}),...e};super(t),this.isOmnidirectionalHandle=!0,this.type="OmnidirectionalHandle";const r=new ne(1,1,1,1,1,1);r.name="BoxHandle_Box_Geometry";const n=new Hu({color:t.boxColor,transparent:!1,opacity:1});n.name="BoxHandle_Box_Material";const i=new X(r,n);i.name="BoxHandle_Box",i.matrixAutoUpdate=!1,this.add(i);const o=new K(r);o.name="BoxHandle_Edges_Geometry";const a=new Ru({color:t.edgesColor,linewidth:4,transparent:!1,opacity:1});a.name="BoxHandle_Edges_Material";const s=new Q(o,a);s.name="BoxHandle_Edges",s.matrixAutoUpdate=!1,this.add(s)}update(e){super.update(e),this.updateMatrix(),this.hitbox.updateMatrix()}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class wd extends Yu{constructor(e={}){const t={coneColor:1067907,edgesColor:1193046,hitbox:new _d({geometry:new oe(1.1,1.1)}),...e};super(t),this.isOmnidirectionalHandle=!0,this.type="OmnidirectionalHandle";const r=new oe(1,1);r.name="ConeHandle_Cone_Geometry";const n=new Hu({color:t.coneColor,transparent:!1,opacity:1});n.name="ConeHandle_Cone_Material";const i=new X(r,n);i.name="ConeHandle_Cone",i.matrixAutoUpdate=!0,this.add(i)}update(e){super.update(e),this.updateMatrix(),this.hitbox.updateMatrix()}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class bd extends Qu{constructor(e={}){const t={boxColor:11119017,edgesColor:13882323,...e};super(t),this.isLookAtGizmo=!0,this.type="LookAtGizmo",this.explodeFactor=.25,this.handleGizmos={FACE_RIGHT:new wd({coneColor:14483456}).setPosition(+(4+this.explodeFactor),0,0).setRotationFromAxisAndAngle(new D(0,0,1),Ht(90)).setScale(1,4,1),FACE_LEFT:new wd({coneColor:5570560}).setPosition(-(4+this.explodeFactor),0,0).setRotationFromAxisAndAngle(new D(0,0,1),Ht(-90)).setScale(1,4,1),FACE_TOP:new wd({coneColor:221}).setPosition(0,+(4+this.explodeFactor),0).setRotationFromAxisAndAngle(new D(1,0,0),Ht(180)).setScale(1,4,1),FACE_BOTTOM:new wd({coneColor:85}).setPosition(0,-(4+this.explodeFactor),0).setScale(1,4,1),FACE_FRONT:new wd({coneColor:21760}).setPosition(0,0,+(4+this.explodeFactor)).setRotationFromAxisAndAngle(new D(1,0,0),Ht(-90)).setScale(1,4,1),FACE_BACK:new wd({coneColor:56576}).setPosition(0,0,-(4+this.explodeFactor)).setRotationFromAxisAndAngle(new D(1,0,0),Ht(90)).setScale(1,4,1),CORNER_TOP_LEFT_FRONT:new yd(t).setPosition(-(2+this.explodeFactor),+(2+this.explodeFactor),+(2+this.explodeFactor)),CORNER_TOP_LEFT_BACK:new yd(t).setPosition(-(2+this.explodeFactor),+(2+this.explodeFactor),-(2+this.explodeFactor)),CORNER_TOP_RIGHT_FRONT:new yd(t).setPosition(+(2+this.explodeFactor),+(2+this.explodeFactor),+(2+this.explodeFactor)),CORNER_TOP_RIGHT_BACK:new yd(t).setPosition(+(2+this.explodeFactor),+(2+this.explodeFactor),-(2+this.explodeFactor)),CORNER_BOTTOM_LEFT_FRONT:new yd(t).setPosition(-(2+this.explodeFactor),-(2+this.explodeFactor),+(2+this.explodeFactor)),CORNER_BOTTOM_LEFT_BACK:new yd(t).setPosition(-(2+this.explodeFactor),-(2+this.explodeFactor),-(2+this.explodeFactor)),CORNER_BOTTOM_RIGHT_FRONT:new yd(t).setPosition(+(2+this.explodeFactor),-(2+this.explodeFactor),+(2+this.explodeFactor)),CORNER_BOTTOM_RIGHT_BACK:new yd(t).setPosition(+(2+this.explodeFactor),-(2+this.explodeFactor),-(2+this.explodeFactor)),EDGE_TOP_FRONT:new yd(t).setPosition(0,+(2+this.explodeFactor),+(2+this.explodeFactor)).setScale(3,1,1),EDGE_TOP_LEFT:new yd(t).setPosition(-(2+this.explodeFactor),+(2+this.explodeFactor),0).setScale(1,1,3),EDGE_TOP_BACK:new yd(t).setPosition(0,+(2+this.explodeFactor),-(2+this.explodeFactor)).setScale(3,1,1),EDGE_TOP_RIGHT:new yd(t).setPosition(+(2+this.explodeFactor),+(2+this.explodeFactor),0).setScale(1,1,3),EDGE_LEFT_FRONT:new yd(t).setPosition(-(2+this.explodeFactor),0,+(2+this.explodeFactor)).setScale(1,3,1),EDGE_LEFT_BACK:new yd(t).setPosition(-(2+this.explodeFactor),0,-(2+this.explodeFactor)).setScale(1,3,1),EDGE_RIGHT_FRONT:new yd(t).setPosition(+(2+this.explodeFactor),0,+(2+this.explodeFactor)).setScale(1,3,1),EDGE_RIGHT_BACK:new yd(t).setPosition(+(2+this.explodeFactor),0,-(2+this.explodeFactor)).setScale(1,3,1),EDGE_BOTTOM_FRONT:new yd(t).setPosition(0,-(2+this.explodeFactor),+(2+this.explodeFactor)).setScale(3,1,1),EDGE_BOTTOM_LEFT:new yd(t).setPosition(-(2+this.explodeFactor),-(2+this.explodeFactor),0).setScale(1,1,3),EDGE_BOTTOM_BACK:new yd(t).setPosition(0,-(2+this.explodeFactor),-(2+this.explodeFactor)).setScale(3,1,1),EDGE_BOTTOM_RIGHT:new yd(t).setPosition(+(2+this.explodeFactor),-(2+this.explodeFactor),0).setScale(1,1,3)},this._setupHandles(this.handleGizmos)}raycast(e,t){if(e.intersectObject(this.intersectPlane,!0).length>0)for(let r of this.children)r.raycast(e,t)}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Md extends Yu{constructor(e={}){super({...e}),this.isRotateHandle=!0,this.type="RotateHandle"}update(e){super.update(e),this.updateMatrix(),this.hitbox.updateMatrix()}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class Sd extends ju{constructor(e={}){super({geometry:new We(1,8,6,0,2*Math.PI,0,Math.PI),...e}),this.isSphericalHitbox=!0,this.type="SphericalHitbox"}}
/**
 * @author [Tristan Valcke]{@link https://github.com/Itee}
 * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}
 */class vd extends X{constructor(e,t={}){super(e,new Hu({color:t.color,transparent:!0,opacity:.55})),this.isHighlightableMesh=!0,this.type="HighlightableMesh"}highlight(e){this.material.highlight(e)}}export{Tu as ASCLoader,Qu as AbstractGizmo,Yu as AbstractHandle,ju as AbstractHitbox,Pu as BitArray,Du as BitManager,Nu as CameraControlMode,Uu as CameraControls,id as ClippingBox,ad as ClippingControls,od as ClippingModes,tu as ColorPalette,eu as Colors,sd as CurvesManager,qu as CylindricaHitbox,qt as DBFLoader,Fu as Directions,hd as GeometriesManager,vd as HighlightableMesh,Eu as LASLoader,bd as LookAtGizmo,td as LozengeHandle,ed as LozengeHitbox,dd as MaterialsManager,md as ObjectsManager,Wu as OctahedricalHandle,Vu as OctahedricalHitbox,fd as OrbitControlsHelper,$u as PlanarHitbox,Xu as PlaneHandle,Bu as PointClasses,gd as RotateGizmo,Md as RotateHandle,nr as SHPLoader,Ju as ScaleGizmo,Ku as ScaleHandle,rr as ShapeType,Sd as SphericalHitbox,ld as TexturesManager,pd as TorusHitbox,nd as TranslateGizmo,rd as TranslateHandle,Gl as registerPlugin};
