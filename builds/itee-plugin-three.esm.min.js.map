{"version":3,"file":"itee-plugin-three.esm.min.js","sources":["../sources/frontend/controllers/CameraControls.js","../sources/frontend/controllers/CameraPathController.js","../sources/frontend/controllers/ClippingControls.js","../sources/frontend/managers/BufferGeometriesManager.js","../sources/frontend/managers/CurvesManager.js","../sources/frontend/managers/FilairesManager.js","../sources/frontend/managers/GeometriesManager.js","../sources/frontend/managers/TexturesManager.js","../sources/frontend/managers/MaterialsManager.js","../sources/frontend/managers/ObjectsManager.js","../sources/frontend/objects3d/OrbitControlsHelper.js"],"sourcesContent":["/**\r\n * @author [Tristan Valcke]{@link https://github.com/Itee}\r\n * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}\r\n *\r\n * @file Todo\r\n *\r\n * @example Todo\r\n *\r\n */\r\n\r\nimport {\r\n    DefaultLogger,\r\n    Keys,\r\n    Mouse\r\n} from 'itee-client'\r\nimport {\r\n    degreesToRadians,\r\n    toEnum\r\n} from 'itee-utils'\r\nimport {\r\n    isEmptyArray,\r\n    isNotBoolean,\r\n    isNotDefined,\r\n    isNull,\r\n    isUndefined\r\n} from 'itee-validators'\r\nimport {\r\n    Camera,\r\n    EventDispatcher,\r\n    Object3D,\r\n    Spherical,\r\n    Vector2,\r\n    Vector3\r\n} from 'three-full'\r\n\r\nconst FRONT = new Vector3( 0, 0, -1 )\r\nconst BACK  = new Vector3( 0, 0, 1 )\r\nconst UP    = new Vector3( 0, 1, 0 )\r\nconst DOWN  = new Vector3( 0, -1, 0 )\r\nconst RIGHT = new Vector3( 1, 0, 0 )\r\nconst LEFT  = new Vector3( -1, 0, 0 )\r\n\r\nconst State = toEnum( {\r\n    None:     0,\r\n    Rotating: 1,\r\n    Panning:  2,\r\n    Rolling:  3,\r\n    Zooming:  4,\r\n    Moving:   5\r\n} )\r\n\r\nconst CameraControlMode = toEnum( {\r\n    FirstPerson: 1,\r\n    Orbit:       2,\r\n    Fly:         3,\r\n    Path:        4\r\n} )\r\n\r\nclass CameraControls extends EventDispatcher {\r\n\r\n    constructor ( parameters = {} ) {\r\n\r\n        const _parameters = {\r\n            ...{\r\n                logger:     DefaultLogger,\r\n                camera:     null,\r\n                target:     new Object3D(),\r\n                mode:       CameraControlMode.Orbit,\r\n                domElement: window\r\n            }, ...parameters\r\n        }\r\n\r\n        super()\r\n\r\n        // Need to be defined before domElement to make correct binding events\r\n        this._handlers = {\r\n            onMouseEnter:  this._onMouseEnter.bind( this ),\r\n            onMouseLeave:  this._onMouseLeave.bind( this ),\r\n            onMouseDown:   this._onMouseDown.bind( this ),\r\n            onMouseMove:   this._onMouseMove.bind( this ),\r\n            onMouseWheel:  this._onMouseWheel.bind( this ),\r\n            onMouseUp:     this._onMouseUp.bind( this ),\r\n            onDblClick:    this._onDblClick.bind( this ),\r\n            onTouchStart:  this._onTouchStart.bind( this ),\r\n            onTouchEnd:    this._onTouchEnd.bind( this ),\r\n            onTouchCancel: this._onTouchCancel.bind( this ),\r\n            onTouchLeave:  this._onTouchLeave.bind( this ),\r\n            onTouchMove:   this._onTouchMove.bind( this ),\r\n            onKeyDown:     this._onKeyDown.bind( this ),\r\n            onKeyUp:       this._onKeyUp.bind( this )\r\n        }\r\n\r\n        this.logger     = _parameters.logger\r\n        this.camera     = _parameters.camera\r\n        this.target     = _parameters.target\r\n        this.mode       = _parameters.mode\r\n        this.domElement = _parameters.domElement\r\n\r\n        // Set to false to disable controls\r\n        this.enabled = true\r\n\r\n        this._paths               = []\r\n        this._trackPath           = false\r\n        this._cameraJump          = 0.1 // = 1 / path.getLength()\r\n        this._currentPathPosition = null\r\n        this._currentPathOffset   = 0\r\n        this._currentPathIndex    = 0\r\n        this._currentPath         = null\r\n        this._maxJump             = 1.0\r\n\r\n        this._lockedTarget = true\r\n\r\n        // Touches events specific\r\n        this.previousTouches = []\r\n\r\n        // Set to false to disable all/specific displacement\r\n        this.canMove   = true\r\n        this.moveSpeed = 1.0\r\n\r\n        this.canFront          = true\r\n        this.frontMinimum      = -Infinity\r\n        this.frontMaximum      = -Infinity\r\n        this.frontMinSpeed     = 0.0\r\n        this.frontSpeed        = 1.0\r\n        this.frontMaxSpeed     = Infinity\r\n        this.frontAcceleration = 1.0\r\n\r\n        this.canBack          = true\r\n        this.backMinimum      = -Infinity\r\n        this.backMaximum      = -Infinity\r\n        this.backMinSpeed     = 0.0\r\n        this.backSpeed        = 1.0\r\n        this.backMaxSpeed     = Infinity\r\n        this.backAcceleration = 1.0\r\n\r\n        this.canUp          = true\r\n        this.upMinimum      = -Infinity\r\n        this.upMaximum      = -Infinity\r\n        this.upMinSpeed     = 0.0\r\n        this.upSpeed        = 1.0\r\n        this.upMaxSpeed     = Infinity\r\n        this.upAcceleration = 1.0\r\n\r\n        this.canDown          = true\r\n        this.downMinimum      = -Infinity\r\n        this.downMaximum      = -Infinity\r\n        this.downMinSpeed     = 0.0\r\n        this.downSpeed        = 1.0\r\n        this.downMaxSpeed     = Infinity\r\n        this.downAcceleration = 1.0\r\n\r\n        this.canLeft          = true\r\n        this.leftMinimum      = -Infinity\r\n        this.leftMaximum      = -Infinity\r\n        this.leftMinSpeed     = 0.0\r\n        this.leftSpeed        = 1.0\r\n        this.leftMaxSpeed     = Infinity\r\n        this.leftAcceleration = 1.0\r\n\r\n        this.canRight          = true\r\n        this.rightMinimum      = -Infinity\r\n        this.rightMaximum      = -Infinity\r\n        this.rightMinSpeed     = 0.0\r\n        this.rightSpeed        = 1.0\r\n        this.rightMaxSpeed     = Infinity\r\n        this.rightAcceleration = 1.0\r\n\r\n        this.canRotate = true\r\n\r\n        /**\r\n         * How far you can orbit vertically, upper and lower limits.\r\n         * Range is 0 to Math.PI radians.\r\n         * @type {number}\r\n         */\r\n        this.minPolarAngle = 0.001\r\n\r\n        /**\r\n         * How far you can orbit horizontally, upper and lower limits.\r\n         * If set, must be a sub-interval of the interval [ - Math.PI, Math.PI ].\r\n         * @type {number}\r\n         */\r\n        this.maxPolarAngle = ( Math.PI - 0.001 )\r\n        this.minAzimuthAngle    = -Infinity\r\n        this.maxAzimuthAngle    = Infinity\r\n        this.rotateMinSpeed     = 0.0\r\n        this.rotateSpeed        = 1.0\r\n        this.rotateMaxSpeed     = Infinity\r\n        this.rotateAcceleration = 1.0\r\n\r\n        this.canPan          = true\r\n        this.panMinimum      = -Infinity\r\n        this.panMaximum      = -Infinity\r\n        this.panMinSpeed     = 0.0\r\n        this.panSpeed        = 0.001\r\n        this.panMaxSpeed     = Infinity\r\n        this.panAcceleration = 1.0\r\n\r\n        this.canRoll          = true\r\n        this.rollMinimum      = -Infinity\r\n        this.rollMaximum      = -Infinity\r\n        this.rollMinSpeed     = 0.0\r\n        this.rollSpeed        = 0.1\r\n        this.rollMaxSpeed     = Infinity\r\n        this.rollAcceleration = 1.0\r\n\r\n        this.canZoom          = true\r\n        this.zoomMinimum      = 0\r\n        this.zoomMaximum      = Infinity\r\n        this.zoomMinSpeed     = 0.0\r\n        this.zoomSpeed        = 0.001\r\n        this.zoomMaxSpeed     = Infinity\r\n        this.zoomAcceleration = 1.0\r\n\r\n        this.canLookAt = true\r\n\r\n        // The actions map about input events\r\n        this.actionsMap = {\r\n            front:            [ Keys.Z.value, Keys.UP_ARROW.value ],\r\n            back:             [ Keys.S.value, Keys.DOWN_ARROW.value ],\r\n            up:               [ Keys.A.value, Keys.PAGE_UP.value ],\r\n            down:             [ Keys.E.value, Keys.PAGE_DOWN.value ],\r\n            left:             [ Keys.Q.value, Keys.LEFT_ARROW.value ],\r\n            right:            [ Keys.D.value, Keys.RIGHT_ARROW.value ],\r\n            rotate:           [ Mouse.LEFT.value ],\r\n            pan:              [ Mouse.MIDDLE.value ],\r\n            roll:             {\r\n                left:  [ Keys.R.value ],\r\n                right: [ Keys.T.value ]\r\n            },\r\n            zoom:             [ Mouse.WHEEL.value ],\r\n            lookAtFront:      [ Keys.NUMPAD_2.value ],\r\n            lookAtFrontLeft:  [ Keys.NUMPAD_3.value ],\r\n            lookAtFrontRight: [ Keys.NUMPAD_1.value ],\r\n            lookAtBack:       [ Keys.NUMPAD_8.value ],\r\n            lookAtBackLeft:   [ Keys.NUMPAD_9.value ],\r\n            lookAtBackRight:  [ Keys.NUMPAD_7.value ],\r\n            lookAtUp:         [ Keys.NUMPAD_5.value ],\r\n            lookAtDown:       [ Keys.NUMPAD_0.value ],\r\n            lookAtLeft:       [ Keys.NUMPAD_6.value ],\r\n            lookAtRight:      [ Keys.NUMPAD_4.value ]\r\n        }\r\n\r\n        // The current internal state of controller\r\n        this._state = State.None\r\n\r\n    }\r\n\r\n    get camera () {\r\n\r\n        return this._camera\r\n\r\n    }\r\n\r\n    set camera ( value ) {\r\n\r\n        if ( isNull( value ) ) { throw new Error( 'Camera cannot be null ! Expect an instance of Camera' ) }\r\n        if ( isUndefined( value ) ) { throw new Error( 'Camera cannot be undefined ! Expect an instance of Camera' ) }\r\n        if ( !( value instanceof Camera ) ) { throw new Error( `Camera cannot be an instance of ${value.constructor.name}. Expect an instance of Camera.` ) }\r\n\r\n        this._camera = value\r\n\r\n    }\r\n\r\n    get target () {\r\n\r\n        return this._target\r\n\r\n    }\r\n\r\n    set target ( value ) {\r\n\r\n        if ( isNull( value ) ) { throw new Error( 'Target cannot be null ! Expect an instance of Object3D.' ) }\r\n        if ( isUndefined( value ) ) { throw new Error( 'Target cannot be undefined ! Expect an instance of Object3D.' ) }\r\n        if ( !( value instanceof Object3D ) ) { throw new Error( `Target cannot be an instance of ${value.constructor.name}. Expect an instance of Object3D.` ) }\r\n\r\n        this._target = value\r\n\r\n    }\r\n\r\n    get mode () {\r\n        return this._mode\r\n    }\r\n\r\n    set mode ( value ) {\r\n\r\n        if ( isNull( value ) ) { throw new Error( 'Mode cannot be null ! Expect a value from CameraControlMode enum.' ) }\r\n        if ( isUndefined( value ) ) { throw new Error( 'Mode cannot be undefined ! Expect a value from CameraControlMode enum.' ) }\r\n        if ( !( value instanceof CameraControlMode ) ) { throw new Error( `Mode cannot be an instance of ${value.constructor.name}. Expect a value from TCameraControlMode enum.` ) }\r\n\r\n        this._mode = value\r\n\r\n        if ( this._trackPath ) {\r\n            this._initPathDisplacement()\r\n        }\r\n\r\n    }\r\n\r\n    get paths () {\r\n        return this._paths\r\n    }\r\n\r\n    set paths ( value ) {\r\n\r\n        this._paths = value\r\n\r\n    }\r\n\r\n    get trackPath () {\r\n        return this._trackPath\r\n    }\r\n\r\n    set trackPath ( value ) {\r\n\r\n        if ( isNotBoolean( value ) ) { throw new Error( `Track path cannot be an instance of ${value.constructor.name}. Expect a boolean.` ) }\r\n\r\n        this._trackPath = value\r\n\r\n        if ( this._trackPath ) {\r\n            this._initPathDisplacement()\r\n        }\r\n\r\n    }\r\n\r\n    get domElement () {\r\n\r\n        return this._domElement\r\n\r\n    }\r\n\r\n    set domElement ( value ) {\r\n\r\n        if ( isNull( value ) ) { throw new Error( 'DomElement cannot be null ! Expect an instance of HTMLDocument.' ) }\r\n        if ( isUndefined( value ) ) { throw new Error( 'DomElement cannot be undefined ! Expect an instance of HTMLDocument.' ) }\r\n        if ( !( ( value instanceof Window ) || ( value instanceof HTMLDocument ) || ( value instanceof HTMLDivElement ) || ( value instanceof HTMLCanvasElement ) ) ) { throw new Error( `DomElement cannot be an instance of ${value.constructor.name}. Expect an instance of Window, HTMLDocument or HTMLDivElement.` ) }\r\n\r\n        // Check focusability of given dom element because in case the element is not focusable\r\n        // the keydown event won't work !\r\n\r\n        // Clear previous element\r\n        if ( this._domElement ) {\r\n            this._domElement.removeEventListener( 'mouseenter', this._handlers.onMouseEnter, false )\r\n            this._domElement.removeEventListener( 'mouseleave', this._handlers.onMouseLeave, false )\r\n            this.dispose()\r\n        }\r\n\r\n        this._domElement = value\r\n        this._domElement.addEventListener( 'mouseenter', this._handlers.onMouseEnter, false )\r\n        this._domElement.addEventListener( 'mouseleave', this._handlers.onMouseLeave, false )\r\n        this.impose()\r\n\r\n    }\r\n\r\n    setCamera ( value ) {\r\n\r\n        this.camera = value\r\n        return this\r\n\r\n    }\r\n\r\n    setTarget ( value ) {\r\n\r\n        this.target = value\r\n        return this\r\n\r\n    }\r\n\r\n    setMode ( value ) {\r\n\r\n        this.mode = value\r\n        return this\r\n\r\n    }\r\n\r\n    setPaths ( value ) {\r\n\r\n        this.paths = value\r\n        return this\r\n\r\n    }\r\n\r\n    addPath ( value ) {\r\n\r\n        this._paths.push( value )\r\n        return this\r\n\r\n    }\r\n\r\n    setTrackPath ( value ) {\r\n\r\n        this.trackPath = value\r\n        return this\r\n\r\n    }\r\n\r\n    setDomElement ( value ) {\r\n\r\n        this.domElement = value\r\n        return this\r\n\r\n    }\r\n\r\n    ///////////////\r\n\r\n    impose () {\r\n\r\n        this._domElement.addEventListener( 'keydown', this._handlers.onKeyDown, false )\r\n        this._domElement.addEventListener( 'keyup', this._handlers.onKeyUp, false )\r\n\r\n        this._domElement.addEventListener( 'dblclick', this._handlers.onDblClick, false )\r\n        this._domElement.addEventListener( 'mousedown', this._handlers.onMouseDown, false )\r\n        this._domElement.addEventListener( 'mousemove', this._handlers.onMouseMove, false )\r\n        this._domElement.addEventListener( 'mouseup', this._handlers.onMouseUp, false )\r\n        this._domElement.addEventListener( 'wheel', this._handlers.onMouseWheel, {\r\n            capture: true,\r\n            once:    false,\r\n            passive: false\r\n        } )\r\n\r\n        this._domElement.addEventListener( 'touchcancel', this._handlers.onTouchCancel, false )\r\n        this._domElement.addEventListener( 'touchend', this._handlers.onTouchEnd, false )\r\n        this._domElement.addEventListener( 'touchleave', this._handlers.onTouchLeave, false )\r\n        this._domElement.addEventListener( 'touchmove', this._handlers.onTouchMove, {\r\n            capture: true,\r\n            once:    false,\r\n            passive: false\r\n        } )\r\n        this._domElement.addEventListener( 'touchstart', this._handlers.onTouchStart, {\r\n            capture: true,\r\n            once:    false,\r\n            passive: false\r\n        } )\r\n\r\n        this.dispatchEvent( { type: 'impose' } )\r\n\r\n    }\r\n\r\n    dispose () {\r\n\r\n        this._domElement.removeEventListener( 'keydown', this._handlers.onKeyDown, false )\r\n        this._domElement.removeEventListener( 'keyup', this._handlers.onKeyUp, false )\r\n\r\n        this._domElement.removeEventListener( 'dblclick', this._handlers.onDblClick, false )\r\n        this._domElement.removeEventListener( 'mousedown', this._handlers.onMouseDown, false )\r\n        this._domElement.removeEventListener( 'mousemove', this._handlers.onMouseMove, false )\r\n        this._domElement.removeEventListener( 'mouseup', this._handlers.onMouseUp, false )\r\n        this._domElement.removeEventListener( 'wheel', this._handlers.onMouseWheel, {\r\n            capture: true,\r\n            once:    false,\r\n            passive: false\r\n        } )\r\n\r\n        this._domElement.removeEventListener( 'touchcancel', this._handlers.onTouchCancel, false )\r\n        this._domElement.removeEventListener( 'touchend', this._handlers.onTouchEnd, false )\r\n        this._domElement.removeEventListener( 'touchleave', this._handlers.onTouchLeave, false )\r\n        this._domElement.removeEventListener( 'touchmove', this._handlers.onTouchMove, {\r\n            capture: true,\r\n            once:    false,\r\n            passive: false\r\n        } )\r\n        this._domElement.removeEventListener( 'touchstart', this._handlers.onTouchStart, {\r\n            capture: true,\r\n            once:    false,\r\n            passive: false\r\n        } )\r\n\r\n        this.dispatchEvent( { type: 'dispose' } )\r\n\r\n    }\r\n\r\n    update () {\r\n\r\n    }\r\n\r\n    setCameraPosition ( newCameraPosition ) {\r\n\r\n        this._camera.position.copy( newCameraPosition )\r\n        this._camera.lookAt( this._target.position )\r\n\r\n        return this\r\n\r\n    }\r\n\r\n    setTargetPosition ( newTargetPosition ) {\r\n\r\n        this._target.position.copy( newTargetPosition )\r\n        this._camera.lookAt( this._target.position )\r\n\r\n        return this\r\n\r\n    }\r\n\r\n    // Handlers\r\n    _consumeEvent ( event ) {\r\n\r\n        if ( !event.cancelable ) {\r\n            return\r\n        }\r\n\r\n        event.stopImmediatePropagation()\r\n\r\n    }\r\n\r\n    // Keys\r\n    _onKeyDown ( keyEvent ) {\r\n\r\n        if ( !this.enabled ) { return }\r\n        keyEvent.preventDefault()\r\n\r\n        const actionMap = this.actionsMap\r\n        const key       = keyEvent.keyCode\r\n\r\n        //todo\r\n        //        const altActive   = keyEvent.altKey\r\n        //        const ctrlActive  = keyEvent.ctrlKey\r\n        //        const metaActive  = keyEvent.metaKey\r\n        //        const shiftActive = keyEvent.shiftKey\r\n\r\n        if ( actionMap.front.includes( key ) ) {\r\n\r\n            this._front()\r\n            this._consumeEvent( keyEvent )\r\n\r\n        } else if ( actionMap.back.includes( key ) ) {\r\n\r\n            this._back()\r\n            this._consumeEvent( keyEvent )\r\n\r\n        } else if ( actionMap.up.includes( key ) ) {\r\n\r\n            this._up()\r\n            this._consumeEvent( keyEvent )\r\n\r\n        } else if ( actionMap.down.includes( key ) ) {\r\n\r\n            this._down()\r\n            this._consumeEvent( keyEvent )\r\n\r\n        } else if ( actionMap.left.includes( key ) ) {\r\n\r\n            this._left()\r\n            this._consumeEvent( keyEvent )\r\n\r\n        } else if ( actionMap.right.includes( key ) ) {\r\n\r\n            this._right()\r\n            this._consumeEvent( keyEvent )\r\n\r\n        } else if ( actionMap.rotate.includes( key ) ) {\r\n\r\n            this._rotate( 1.0 )\r\n        } else if ( actionMap.pan.includes( key ) ) {\r\n\r\n            this._pan( 1.0 )\r\n            this._consumeEvent( keyEvent )\r\n\r\n        } else if ( actionMap.roll.left.includes( key ) ) {\r\n\r\n            this._roll( 1.0 )\r\n            this._consumeEvent( keyEvent )\r\n\r\n        } else if ( actionMap.roll.right.includes( key ) ) {\r\n\r\n            this._roll( -1.0 )\r\n            this._consumeEvent( keyEvent )\r\n\r\n        } else if ( actionMap.zoom.includes( key ) ) {\r\n\r\n            this._zoom( 1.0 )\r\n            this._consumeEvent( keyEvent )\r\n\r\n        } else if ( actionMap.lookAtFront.includes( key ) ) {\r\n\r\n            this._lookAt( FRONT )\r\n            this._consumeEvent( keyEvent )\r\n\r\n        } else if ( actionMap.lookAtFrontLeft.includes( key ) ) {\r\n\r\n            this._lookAt( new Vector3( -1, 0, -1 ).normalize() )\r\n            this._consumeEvent( keyEvent )\r\n\r\n        } else if ( actionMap.lookAtFrontRight.includes( key ) ) {\r\n\r\n            this._lookAt( new Vector3( 1, 0, -1 ).normalize() )\r\n            this._consumeEvent( keyEvent )\r\n\r\n        } else if ( actionMap.lookAtBack.includes( key ) ) {\r\n\r\n            this._lookAt( BACK )\r\n            this._consumeEvent( keyEvent )\r\n\r\n        } else if ( actionMap.lookAtBackLeft.includes( key ) ) {\r\n\r\n            this._lookAt( new Vector3( -1, 0, 1 ).normalize() )\r\n            this._consumeEvent( keyEvent )\r\n\r\n        } else if ( actionMap.lookAtBackRight.includes( key ) ) {\r\n\r\n            this._lookAt( new Vector3( 1, 0, 1 ).normalize() )\r\n            this._consumeEvent( keyEvent )\r\n\r\n        } else if ( actionMap.lookAtUp.includes( key ) ) {\r\n\r\n            this._lookAt( UP )\r\n            this._consumeEvent( keyEvent )\r\n\r\n        } else if ( actionMap.lookAtDown.includes( key ) ) {\r\n\r\n            this._lookAt( DOWN )\r\n            this._consumeEvent( keyEvent )\r\n\r\n        } else if ( actionMap.lookAtLeft.includes( key ) ) {\r\n\r\n            this._lookAt( LEFT )\r\n            this._consumeEvent( keyEvent )\r\n\r\n        } else if ( actionMap.lookAtRight.includes( key ) ) {\r\n\r\n            this._lookAt( RIGHT )\r\n            this._consumeEvent( keyEvent )\r\n\r\n        } else {\r\n            // Unmapped key, just ignore it ! May be this is for an other controls.\r\n        }\r\n\r\n    }\r\n\r\n    _onKeyUp ( keyEvent ) {\r\n\r\n        if ( !this.enabled ) { return }\r\n        keyEvent.preventDefault()\r\n\r\n    }\r\n\r\n    // Touches\r\n    _onTouchStart ( touchEvent ) {\r\n\r\n        if ( !this.enabled ) { return }\r\n        touchEvent.preventDefault()\r\n\r\n        this.previousTouches = touchEvent.touches\r\n\r\n    }\r\n\r\n    _onTouchEnd ( touchEvent ) {\r\n\r\n        if ( !this.enabled ) { return }\r\n        touchEvent.preventDefault()\r\n\r\n        this.previousTouches = []\r\n        this._state          = State.None\r\n\r\n    }\r\n\r\n    _onTouchCancel ( touchEvent ) {\r\n\r\n        if ( !this.enabled ) { return }\r\n        touchEvent.preventDefault()\r\n\r\n        this.previousTouches = []\r\n        this._state          = State.None\r\n\r\n    }\r\n\r\n    _onTouchLeave ( touchEvent ) {\r\n\r\n        if ( !this.enabled ) { return }\r\n        touchEvent.preventDefault()\r\n\r\n        this.previousTouches = []\r\n        this._state          = State.None\r\n\r\n    }\r\n\r\n    _onTouchMove ( touchEvent ) {\r\n\r\n        if ( !this.enabled ) { return }\r\n        touchEvent.preventDefault()\r\n\r\n        const previousTouches         = this.previousTouches\r\n        const currentTouches          = touchEvent.changedTouches\r\n        const numberOfPreviousTouches = previousTouches.length\r\n        const numberOfCurrentTouches  = currentTouches.length\r\n\r\n        if ( numberOfPreviousTouches === 2 && numberOfCurrentTouches === 2 ) {\r\n\r\n            const previousTouchA    = new Vector2( previousTouches[ 0 ].clientX, previousTouches[ 0 ].clientY )\r\n            const previousTouchB    = new Vector2( previousTouches[ 1 ].clientX, previousTouches[ 1 ].clientY )\r\n            const previousGap       = previousTouchA.distanceTo( previousTouchB )\r\n            const previousCenter    = new Vector2().addVectors( previousTouchA, previousTouchB ).divideScalar( 2 )\r\n            const previousDirection = new Vector2().subVectors( previousTouchA, previousTouchB ).normalize()\r\n\r\n            const currentTouchA    = new Vector2( currentTouches[ 0 ].clientX, currentTouches[ 0 ].clientY )\r\n            const currentTouchB    = new Vector2( currentTouches[ 1 ].clientX, currentTouches[ 1 ].clientY )\r\n            const currentGap       = currentTouchA.distanceTo( currentTouchB )\r\n            const currentCenter    = new Vector2().addVectors( currentTouchA, currentTouchB ).divideScalar( 2 )\r\n            const currentDirection = new Vector2().subVectors( previousTouchA, previousTouchB ).normalize()\r\n\r\n            const deltaPan  = new Vector2().subVectors( currentCenter, previousCenter )\r\n            const deltaZoom = currentGap - previousGap\r\n            const deltaRoll = currentDirection.dot( previousDirection )\r\n\r\n            this._pan( deltaPan )\r\n            this._zoom( deltaZoom )\r\n            this._roll( deltaRoll )\r\n            this._consumeEvent( touchEvent )\r\n\r\n        } else if ( numberOfPreviousTouches === 1 && numberOfCurrentTouches === 1 ) {\r\n\r\n            const deltaRotate = new Vector2(\r\n                currentTouches[ 0 ].clientX - previousTouches[ 0 ].clientX,\r\n                currentTouches[ 0 ].clientY - previousTouches[ 0 ].clientY\r\n            ).divideScalar( 10 ) //todo: to high sensibility else !!!\r\n\r\n            this._rotate( deltaRotate )\r\n            this._consumeEvent( touchEvent )\r\n\r\n        } else {\r\n\r\n            this.logger.warn( 'Ignoring inconsistent touches event.' )\r\n\r\n        }\r\n\r\n        this.previousTouches = currentTouches\r\n\r\n    }\r\n\r\n    // Mouse\r\n    _onMouseEnter ( mouseEvent ) {\r\n\r\n        if ( !this.enabled ) { return }\r\n        mouseEvent.preventDefault()\r\n\r\n        this.impose()\r\n        if ( mouseEvent.target.constructor !== HTMLDocument ) {\r\n            this._domElement.focus()\r\n        }\r\n\r\n    }\r\n\r\n    _onMouseLeave ( mouseEvent ) {\r\n\r\n        if ( !this.enabled ) { return }\r\n        mouseEvent.preventDefault()\r\n\r\n        if ( mouseEvent.target.constructor !== HTMLDocument ) {\r\n            this._domElement.blur()\r\n        }\r\n        this.dispose()\r\n        this._state = State.None\r\n\r\n    }\r\n\r\n    _onMouseDown ( mouseEvent ) {\r\n\r\n        if ( !this.enabled ) { return }\r\n        mouseEvent.preventDefault()\r\n\r\n        const actionMap = this.actionsMap\r\n        const button    = mouseEvent.button\r\n\r\n        if ( actionMap.front.includes( button ) ) {\r\n\r\n            this._state = State.Moving\r\n            this._front()\r\n            this._consumeEvent( mouseEvent )\r\n\r\n        } else if ( actionMap.back.includes( button ) ) {\r\n\r\n            this._state = State.Moving\r\n            this._back()\r\n            this._consumeEvent( mouseEvent )\r\n\r\n        } else if ( actionMap.up.includes( button ) ) {\r\n\r\n            this._state = State.Moving\r\n            this._up()\r\n            this._consumeEvent( mouseEvent )\r\n\r\n        } else if ( actionMap.down.includes( button ) ) {\r\n\r\n            this._state = State.Moving\r\n            this._down()\r\n            this._consumeEvent( mouseEvent )\r\n\r\n        } else if ( actionMap.left.includes( button ) ) {\r\n\r\n            this._state = State.Moving\r\n            this._left()\r\n            this._consumeEvent( mouseEvent )\r\n\r\n        } else if ( actionMap.right.includes( button ) ) {\r\n\r\n            this._state = State.Moving\r\n            this._right()\r\n            this._consumeEvent( mouseEvent )\r\n\r\n        } else if ( actionMap.rotate.includes( button ) ) {\r\n\r\n            this._state = State.Rotating\r\n            this._consumeEvent( mouseEvent )\r\n\r\n        } else if ( actionMap.pan.includes( button ) ) {\r\n\r\n            this._state = State.Panning\r\n            this._consumeEvent( mouseEvent )\r\n\r\n        } else if ( actionMap.roll.left.includes( button ) ) {\r\n\r\n            this._state = State.Rolling\r\n            this._consumeEvent( mouseEvent )\r\n\r\n        } else if ( actionMap.roll.right.includes( button ) ) {\r\n\r\n            this._state = State.Rolling\r\n            this._consumeEvent( mouseEvent )\r\n\r\n        } else if ( actionMap.zoom.includes( button ) ) {\r\n\r\n            this._state = State.Zooming\r\n            this._consumeEvent( mouseEvent )\r\n\r\n        } else {\r\n\r\n            this._state = State.None\r\n\r\n        }\r\n\r\n    }\r\n\r\n    _onMouseMove ( mouseEvent ) {\r\n\r\n        if ( !this.enabled || this._state === State.None ) { return }\r\n        mouseEvent.preventDefault()\r\n\r\n        const state = this._state\r\n        const delta = {\r\n            x: mouseEvent.movementX || mouseEvent.mozMovementX || mouseEvent.webkitMovementX || 0,\r\n            y: mouseEvent.movementY || mouseEvent.mozMovementY || mouseEvent.webkitMovementY || 0\r\n        }\r\n\r\n        switch ( state ) {\r\n\r\n            case State.Moving:\r\n                break\r\n\r\n            case State.Rotating:\r\n                this._rotate( delta )\r\n                this._consumeEvent( mouseEvent )\r\n                break\r\n\r\n            case State.Panning:\r\n                this._pan( delta )\r\n                this._consumeEvent( mouseEvent )\r\n                break\r\n\r\n            case State.Rolling:\r\n                this._roll( delta )\r\n                this._consumeEvent( mouseEvent )\r\n                break\r\n\r\n            case State.Zooming:\r\n                this._zoom( delta )\r\n                this._consumeEvent( mouseEvent )\r\n                break\r\n\r\n            default:\r\n                throw new RangeError( `Unknown state: ${state}` )\r\n\r\n        }\r\n\r\n    }\r\n\r\n    //todo allow other displacement from wheel\r\n    _onMouseWheel ( mouseEvent ) {\r\n\r\n        if ( !this.enabled ) { return }\r\n        mouseEvent.preventDefault()\r\n\r\n        const delta = mouseEvent.wheelDelta || mouseEvent.deltaY\r\n        this._zoom( delta )\r\n        this._consumeEvent( mouseEvent )\r\n\r\n    }\r\n\r\n    _onMouseUp ( mouseEvent ) {\r\n\r\n        if ( !this.enabled ) { return }\r\n        mouseEvent.preventDefault()\r\n\r\n        this._state = State.None\r\n\r\n    }\r\n\r\n    _onDblClick ( mouseEvent ) {\r\n\r\n        if ( !this.enabled ) { return }\r\n        mouseEvent.preventDefault()\r\n\r\n        this.logger.warn( 'CameraControls: Double click events is not implemented yet, sorry for the disagreement.' )\r\n\r\n    }\r\n\r\n    // Positional methods\r\n    _front () {\r\n\r\n        if ( !this.canMove || !this.canFront ) { return }\r\n\r\n        if ( this._camera.type === 'PerspectiveCamera' ) {\r\n\r\n            const cameraDirection = FRONT.clone().applyQuaternion( this._camera.quaternion )\r\n            const displacement    = ( this._trackPath ) ? this._getPathDisplacement( cameraDirection ) : cameraDirection.multiplyScalar( this.frontSpeed )\r\n\r\n            this._camera.position.add( displacement )\r\n            this._target.position.add( displacement )\r\n\r\n        } else {\r\n\r\n            // Todo: ...\r\n\r\n        }\r\n\r\n        this.dispatchEvent( { type: 'move' } )\r\n        this.dispatchEvent( { type: 'change' } )\r\n\r\n    }\r\n\r\n    _back () {\r\n\r\n        if ( !this.canMove || !this.canBack ) { return }\r\n\r\n        if ( this._camera.type === 'PerspectiveCamera' ) {\r\n\r\n            const cameraDirection = BACK.clone().applyQuaternion( this._camera.quaternion )\r\n            const displacement    = ( this._trackPath ) ? this._getPathDisplacement( cameraDirection ) : cameraDirection.multiplyScalar( this.backSpeed )\r\n\r\n            this._camera.position.add( displacement )\r\n            this._target.position.add( displacement )\r\n\r\n        } else {\r\n\r\n            // Todo: ...\r\n\r\n        }\r\n\r\n        this.dispatchEvent( { type: 'move' } )\r\n        this.dispatchEvent( { type: 'change' } )\r\n\r\n    }\r\n\r\n    _up () {\r\n\r\n        if ( !this.canMove || !this.canUp ) { return }\r\n\r\n        if ( this._camera.type === 'PerspectiveCamera' ) {\r\n\r\n            const displacement = UP.clone()\r\n                                   .applyQuaternion( this._camera.quaternion )\r\n                                   .multiplyScalar( this.upSpeed )\r\n\r\n            this._camera.position.add( displacement )\r\n            this._target.position.add( displacement )\r\n\r\n        } else {\r\n\r\n            // Todo: ...\r\n\r\n        }\r\n\r\n        this.dispatchEvent( { type: 'move' } )\r\n        this.dispatchEvent( { type: 'change' } )\r\n\r\n    }\r\n\r\n    _down () {\r\n\r\n        if ( !this.canMove || !this.canDown ) { return }\r\n\r\n        if ( this._camera.type === 'PerspectiveCamera' ) {\r\n\r\n            const displacement = DOWN.clone()\r\n                                     .applyQuaternion( this._camera.quaternion )\r\n                                     .multiplyScalar( this.downSpeed )\r\n\r\n            this._camera.position.add( displacement )\r\n            this._target.position.add( displacement )\r\n\r\n        } else {\r\n\r\n            // Todo: ...\r\n\r\n        }\r\n\r\n        this.dispatchEvent( { type: 'move' } )\r\n        this.dispatchEvent( { type: 'change' } )\r\n\r\n    }\r\n\r\n    _left () {\r\n\r\n        if ( !this.canMove || !this.canLeft ) { return }\r\n\r\n        if ( this._camera.type === 'PerspectiveCamera' ) {\r\n\r\n            const displacement = LEFT.clone()\r\n                                     .applyQuaternion( this._camera.quaternion )\r\n                                     .multiplyScalar( this.leftSpeed )\r\n\r\n            this._camera.position.add( displacement )\r\n            this._target.position.add( displacement )\r\n\r\n        } else {\r\n\r\n            // Todo: ...\r\n\r\n        }\r\n\r\n        this.dispatchEvent( { type: 'move' } )\r\n        this.dispatchEvent( { type: 'change' } )\r\n\r\n    }\r\n\r\n    _right () {\r\n\r\n        if ( !this.canMove || !this.canRight ) { return }\r\n\r\n        if ( this._camera.type === 'PerspectiveCamera' ) {\r\n\r\n            const displacement = RIGHT.clone()\r\n                                      .applyQuaternion( this._camera.quaternion )\r\n                                      .multiplyScalar( this.rightSpeed )\r\n\r\n            this._camera.position.add( displacement )\r\n            this._target.position.add( displacement )\r\n\r\n        } else {\r\n\r\n            // Todo: ...\r\n\r\n        }\r\n\r\n        this.dispatchEvent( { type: 'move' } )\r\n        this.dispatchEvent( { type: 'change' } )\r\n\r\n    }\r\n\r\n    _rotate ( delta ) {\r\n\r\n        if ( !this.canRotate ) { return }\r\n\r\n        if ( this._camera.type === 'PerspectiveCamera' ) {\r\n\r\n            const cameraPosition = this._camera.position\r\n            const targetPosition = this._target.position\r\n            const distanceTo     = cameraPosition.distanceTo( targetPosition )\r\n            const targetToCamera = new Vector3().subVectors( cameraPosition, targetPosition ).normalize()\r\n            const rotateSpeed    = this.rotateSpeed\r\n\r\n            switch ( this._mode ) {\r\n\r\n                case CameraControlMode.FirstPerson:\r\n\r\n                    //        const normalizedX = (delta.x / this._domElement.clientWidth) - 1.0\r\n                    //        const normalizedY = (delta.y / this._domElement.clientHeight) - 1.0\r\n                    const normalizedX = delta.x\r\n                    const normalizedY = delta.y\r\n\r\n                    const newTargetPosition = new Vector3( -normalizedX, normalizedY, 0 )\r\n                        .applyQuaternion( this._camera.quaternion )\r\n                        .multiplyScalar( rotateSpeed )\r\n                        .add( targetPosition )\r\n\r\n                    // Protect against owl head\r\n                    const cameraToTargetDirection = new Vector3().subVectors( newTargetPosition, cameraPosition ).normalize()\r\n                    const dotProductUp            = UP.clone().dot( cameraToTargetDirection )\r\n                    const dotProductRight         = RIGHT.clone().dot( cameraToTargetDirection )\r\n\r\n                    const max = 0.97\r\n                    if ( dotProductUp < -max || dotProductUp > max || dotProductRight < -2 || dotProductRight > 2 ) {\r\n                        return\r\n                    }\r\n\r\n                    // Care the target distance will change the sensitivity of mouse move\r\n                    // and\r\n                    // We need to set target at pre-defined distance of camera\r\n                    // because if we use newTargetPosition the distance between\r\n                    // camera and target will increase silently over the time\r\n                    const lockedTargetPostion = cameraToTargetDirection.multiplyScalar( 1.0 ) // Todo: option\r\n                                                                       .add( cameraPosition )\r\n                    this.setTargetPosition( lockedTargetPostion )\r\n\r\n                    break\r\n\r\n                case CameraControlMode.Orbit:\r\n\r\n                    // restrict theta and phi between desired limits\r\n                    const spherical = new Spherical().setFromVector3( targetToCamera )\r\n\r\n                    const newTheta  = spherical.theta + ( degreesToRadians( -delta.x ) * rotateSpeed )\r\n                    const newPhi    = spherical.phi + ( degreesToRadians( -delta.y ) * rotateSpeed )\r\n                    spherical.theta = Math.max( this.minAzimuthAngle, Math.min( this.maxAzimuthAngle, newTheta ) )\r\n                    spherical.phi   = Math.max( this.minPolarAngle, Math.min( this.maxPolarAngle, newPhi ) )\r\n\r\n                    const newPosition = new Vector3().setFromSpherical( spherical )\r\n                                                     .multiplyScalar( distanceTo )\r\n                                                     .add( targetPosition )\r\n\r\n                    this.setCameraPosition( newPosition )\r\n\r\n                    break\r\n\r\n                default:\r\n                    throw new RangeError( `Unamanaged rotation for camera mode ${this._mode}` )\r\n\r\n            }\r\n\r\n        } else {\r\n\r\n            // Todo: ...\r\n\r\n        }\r\n\r\n        this.dispatchEvent( { type: 'rotate' } )\r\n        this.dispatchEvent( { type: 'change' } )\r\n\r\n    }\r\n\r\n    _pan ( delta ) {\r\n\r\n        if ( !this.canPan ) { return }\r\n\r\n        if ( this._camera.type === 'PerspectiveCamera' ) {\r\n\r\n            // Take into account the distance between the camera and his target\r\n            const cameraPosition = this._camera.position\r\n            const targetPosition = this._target.position\r\n            const distanceTo     = cameraPosition.distanceTo( targetPosition )\r\n            const displacement   = new Vector3( -delta.x, delta.y, 0 ).applyQuaternion( this._camera.quaternion )\r\n                                                                      .multiplyScalar( this.panSpeed * distanceTo )\r\n\r\n            this._camera.position.add( displacement )\r\n            this._target.position.add( displacement )\r\n\r\n        } else {\r\n\r\n            // Todo: ...\r\n\r\n        }\r\n\r\n        this.dispatchEvent( { type: 'pan' } )\r\n        this.dispatchEvent( { type: 'change' } )\r\n\r\n    }\r\n\r\n    _roll ( delta ) {\r\n\r\n        if ( !this.canRoll ) { return }\r\n\r\n        if ( this._camera.type === 'PerspectiveCamera' ) {\r\n\r\n            const cameraPosition = this._camera.position\r\n            const targetPosition = this._target.position\r\n            const targetToCamera = new Vector3().subVectors( cameraPosition, targetPosition ).normalize()\r\n            const angle          = delta * this.rollSpeed\r\n\r\n            this._camera.up.applyAxisAngle( targetToCamera, angle )\r\n            this._camera.lookAt( targetPosition )\r\n            //or\r\n            //        this._camera.rotateOnAxis( targetToCamera, angle )\r\n\r\n        } else {\r\n\r\n            // Todo: ...\r\n\r\n        }\r\n\r\n        this.dispatchEvent( { type: 'roll' } )\r\n        this.dispatchEvent( { type: 'change' } )\r\n\r\n    }\r\n\r\n    _zoom ( delta ) {\r\n\r\n        if ( !this.canZoom ) { return }\r\n\r\n        if ( this._camera.type === 'PerspectiveCamera' ) {\r\n\r\n            switch ( this._mode ) {\r\n\r\n                case CameraControlMode.FirstPerson:\r\n\r\n                    if ( delta > 0 ) {\r\n                        this._camera.fov--\r\n                    } else {\r\n                        this._camera.fov++\r\n                    }\r\n\r\n                    this._camera.updateProjectionMatrix()\r\n\r\n                    break\r\n\r\n                case CameraControlMode.Orbit:\r\n\r\n                    const cameraPosition                 = this._camera.position\r\n                    const targetPosition                 = this._target.position\r\n                    const distanceBetweenCameraAndTarget = cameraPosition.distanceTo( targetPosition )\r\n                    const displacement                   = FRONT.clone()\r\n                                                                .applyQuaternion( this._camera.quaternion )\r\n                                                                .multiplyScalar( delta * this.zoomSpeed * distanceBetweenCameraAndTarget )\r\n\r\n                    let cameraNextPosition                   = cameraPosition.clone().add( displacement )\r\n                    const currentCameraToNextCameraDirection = new Vector3().subVectors( cameraNextPosition, cameraPosition ).normalize()\r\n                    const targetToCurrentCameraDirection     = new Vector3().subVectors( cameraPosition, targetPosition ).normalize()\r\n                    const targetToNextCameraDirection        = new Vector3().subVectors( cameraNextPosition, targetPosition ).normalize()\r\n                    const dotCurrentDirection                = currentCameraToNextCameraDirection.dot( targetToCurrentCameraDirection )\r\n                    const dotNextDirection                   = currentCameraToNextCameraDirection.dot( targetToNextCameraDirection )\r\n                    const nextCameraToTargetSquaredDistance  = cameraNextPosition.distanceToSquared( targetPosition )\r\n\r\n                    if ( dotCurrentDirection < 0 && ( ( nextCameraToTargetSquaredDistance < ( this.zoomMinimum * this.zoomMinimum ) ) || dotNextDirection > 0 ) ) {\r\n\r\n                        cameraNextPosition = targetToCurrentCameraDirection.clone()\r\n                                                                           .multiplyScalar( this.zoomMinimum )\r\n                                                                           .add( targetPosition )\r\n\r\n                    }\r\n\r\n                    this._camera.position.copy( cameraNextPosition )\r\n\r\n                    break\r\n\r\n                default:\r\n                    throw new RangeError( `Invalid camera control mode parameter: ${this._mode}` )\r\n\r\n            }\r\n\r\n        } else {\r\n\r\n            // Todo: ...\r\n\r\n        }\r\n\r\n        this.dispatchEvent( { type: 'zoom' } )\r\n        this.dispatchEvent( { type: 'change' } )\r\n\r\n    }\r\n\r\n    _lookAt ( direction ) {\r\n\r\n        if ( !this.canLookAt ) { return }\r\n\r\n        if ( this._camera.type === 'PerspectiveCamera' ) {\r\n\r\n            const _direction     = direction.clone()\r\n            const cameraPosition = this._camera.position\r\n            const targetPosition = this._target.position\r\n            const distanceTo     = cameraPosition.distanceTo( targetPosition )\r\n\r\n            switch ( this.mode ) {\r\n\r\n                case CameraControlMode.FirstPerson:\r\n                    // The result is inverted in front of Orbit type but is correct in FP mode except up and down so invert y axis\r\n                    _direction.y            = -( _direction.y )\r\n                    const newTargetPosition = _direction.multiplyScalar( distanceTo ).add( cameraPosition )\r\n                    this.setTargetPosition( newTargetPosition )\r\n                    break\r\n\r\n                case CameraControlMode.Orbit:\r\n                    const newCameraPosition = _direction.multiplyScalar( distanceTo ).add( targetPosition )\r\n                    this.setCameraPosition( newCameraPosition )\r\n                    break\r\n\r\n                default:\r\n                    throw new RangeError( `Invalid camera control mode parameter: ${this._mode}` )\r\n\r\n            }\r\n\r\n        } else {\r\n\r\n            // Todo: ...\r\n\r\n        }\r\n\r\n        this.dispatchEvent( { type: 'lookAt' } )\r\n        this.dispatchEvent( { type: 'change' } )\r\n\r\n    }\r\n\r\n    // Helpers\r\n    _initPathDisplacement () {\r\n\r\n        //todo: project on closest path position\r\n        //todo: move on path in the FRONT camera direction\r\n\r\n        if ( isEmptyArray( this._paths ) ) {\r\n            this.logger.warn( 'Try to init path displacement without any paths' )\r\n            return\r\n        }\r\n\r\n        if ( isNotDefined( this._currentPath ) ) {\r\n\r\n            this._currentPathIndex  = 0\r\n            this._currentPathOffset = 0\r\n            this._currentPath       = this._paths[ 0 ]\r\n\r\n        }\r\n\r\n        this._currentPathPosition = this._currentPath.getPointAt( this._currentPathOffset )\r\n\r\n        switch ( this._mode ) {\r\n\r\n            case CameraControlMode.FirstPerson:\r\n\r\n                if ( this._lockedTarget ) {\r\n\r\n                    const displacement = new Vector3().subVectors( this._currentPathPosition, this.camera.position )\r\n                    this._camera.position.add( displacement )\r\n                    this._target.position.add( displacement )\r\n\r\n                } else {\r\n\r\n                    this.setCameraPosition( this._currentPathPosition )\r\n\r\n                }\r\n\r\n                break\r\n\r\n            case CameraControlMode.Orbit:\r\n\r\n                if ( this._lockedTarget ) {\r\n\r\n                    const displacement = new Vector3().subVectors( this._currentPathPosition, this.target.position )\r\n                    this._camera.position.add( displacement )\r\n                    this._target.position.add( displacement )\r\n\r\n                } else {\r\n\r\n                    this.setTargetPosition( this._currentPathPosition )\r\n\r\n                }\r\n\r\n                break\r\n\r\n            default:\r\n                throw new RangeError( `Invalid camera control _mode parameter: ${this._mode}` )\r\n\r\n        }\r\n\r\n    }\r\n\r\n    _getPathDisplacement ( cameraDirection ) {\r\n\r\n        let displacement = null\r\n\r\n        //Todo: add options to move in camera direction or not\r\n        // try a default positive progress on path\r\n        const currentPathPosition = this._currentPathPosition\r\n\r\n        const nextPositiveOffset   = this._currentPathOffset + this._cameraJump\r\n        const positiveOffset       = ( nextPositiveOffset < 1 ) ? nextPositiveOffset : 1\r\n        const positivePathPosition = this._currentPath.getPointAt( positiveOffset )\r\n        const positiveDisplacement = new Vector3().subVectors( positivePathPosition, currentPathPosition )\r\n        const positiveDirection    = positiveDisplacement.clone().normalize()\r\n        const positiveDot          = cameraDirection.dot( positiveDirection )\r\n\r\n        const nextNegativeOffset   = this._currentPathOffset - this._cameraJump\r\n        const negativeOffset       = ( nextNegativeOffset > 0 ) ? nextNegativeOffset : 0\r\n        const negativePathPosition = this._currentPath.getPointAt( negativeOffset )\r\n        const negativeDisplacement = new Vector3().subVectors( negativePathPosition, currentPathPosition )\r\n        const negativeDirection    = negativeDisplacement.clone().normalize()\r\n        const negativeDot          = cameraDirection.dot( negativeDirection )\r\n\r\n        if ( positiveDot === 0 && negativeDot < 0 ) {\r\n\r\n            // Search closest path\r\n            const pathExtremityMap = this._getDirectionsMap()\r\n\r\n            let indexOfBestPath  = undefined\r\n            let bestDisplacement = undefined\r\n            let bestDotProduct   = -1\r\n            let isFromStart      = undefined\r\n            pathExtremityMap.forEach( ( pathExtremity ) => {\r\n\r\n                const pathIndex = pathExtremity.index\r\n\r\n                const startDisplacement = pathExtremity.startDisplacement\r\n                if ( startDisplacement ) {\r\n\r\n                    const startDirection = startDisplacement.clone().normalize()\r\n                    const startDot       = cameraDirection.dot( startDirection )\r\n\r\n                    if ( startDot > bestDotProduct ) {\r\n\r\n                        indexOfBestPath  = pathIndex\r\n                        bestDisplacement = startDisplacement\r\n                        bestDotProduct   = startDot\r\n                        isFromStart      = true\r\n\r\n                    }\r\n\r\n                }\r\n\r\n                const endDisplacement = pathExtremity.endDisplacement\r\n                if ( endDisplacement ) {\r\n\r\n                    const endDirection = endDisplacement.clone().normalize()\r\n                    const endDot       = cameraDirection.dot( endDirection )\r\n\r\n                    if ( endDot > bestDotProduct ) {\r\n                        indexOfBestPath  = pathIndex\r\n                        bestDisplacement = endDisplacement\r\n                        bestDotProduct   = endDot\r\n                        isFromStart      = false\r\n                    }\r\n\r\n                }\r\n\r\n            } )\r\n\r\n            if ( indexOfBestPath !== undefined ) {\r\n\r\n                this._currentPathIndex    = indexOfBestPath\r\n                this._currentPath         = this._paths[ this._currentPathIndex ]\r\n                this._currentPathOffset   = ( isFromStart ) ? this._cameraJump : 1 - this._cameraJump\r\n                this._currentPathPosition = this._currentPath.getPointAt( this._currentPathOffset )\r\n                displacement              = bestDisplacement\r\n\r\n            } else {\r\n\r\n                this.logger.warn( 'Reach path end.' )\r\n                displacement = new Vector3()\r\n\r\n            }\r\n\r\n        } else if ( positiveDot > 0 && negativeDot <= 0 ) {\r\n\r\n            displacement              = positiveDisplacement\r\n            this._currentPathOffset   = positiveOffset\r\n            this._currentPathPosition = positivePathPosition\r\n\r\n        } else if ( positiveDot <= 0 && negativeDot > 0 ) {\r\n\r\n            displacement              = negativeDisplacement\r\n            this._currentPathOffset   = negativeOffset\r\n            this._currentPathPosition = negativePathPosition\r\n\r\n        } else if ( positiveDot < 0 && negativeDot === 0 ) {\r\n\r\n            // Search closest path\r\n            const pathExtremityMap = this._getDirectionsMap()\r\n\r\n            let indexOfBestPath  = undefined\r\n            let bestDisplacement = undefined\r\n            let bestDotProduct   = -1\r\n            let isFromStart      = undefined\r\n            pathExtremityMap.forEach( ( pathExtremity ) => {\r\n\r\n                const pathIndex = pathExtremity.index\r\n\r\n                const startDisplacement = pathExtremity.startDisplacement\r\n                if ( startDisplacement ) {\r\n\r\n                    const startDirection = startDisplacement.clone().normalize()\r\n                    const startDot       = cameraDirection.dot( startDirection )\r\n\r\n                    if ( startDot > bestDotProduct ) {\r\n\r\n                        indexOfBestPath  = pathIndex\r\n                        bestDisplacement = startDisplacement\r\n                        bestDotProduct   = startDot\r\n                        isFromStart      = true\r\n\r\n                    }\r\n\r\n                }\r\n\r\n                const endDisplacement = pathExtremity.endDisplacement\r\n                if ( endDisplacement ) {\r\n\r\n                    const endDirection = endDisplacement.clone().normalize()\r\n                    const endDot       = cameraDirection.dot( endDirection )\r\n\r\n                    if ( endDot > bestDotProduct ) {\r\n                        indexOfBestPath  = pathIndex\r\n                        bestDisplacement = endDisplacement\r\n                        bestDotProduct   = endDot\r\n                        isFromStart      = false\r\n                    }\r\n\r\n                }\r\n\r\n            } )\r\n\r\n            if ( indexOfBestPath !== undefined ) {\r\n\r\n                this._currentPathIndex    = indexOfBestPath\r\n                this._currentPath         = this._paths[ this._currentPathIndex ]\r\n                this._currentPathOffset   = ( isFromStart ) ? this._cameraJump : 1 - this._cameraJump\r\n                this._currentPathPosition = this._currentPath.getPointAt( this._currentPathOffset )\r\n                displacement              = bestDisplacement\r\n\r\n            } else {\r\n\r\n                this.logger.warn( 'Reach path start.' )\r\n                displacement = new Vector3()\r\n\r\n            }\r\n\r\n        } else if ( ( positiveDot < 0 && negativeDot < 0 ) || ( positiveDot > 0 && negativeDot > 0 ) ) { // Could occurs in high sharp curve with big move step\r\n\r\n            if ( positiveDot > negativeDot ) {\r\n\r\n                displacement              = positiveDisplacement\r\n                this._currentPathOffset   = positiveOffset\r\n                this._currentPathPosition = positivePathPosition\r\n\r\n            } else {\r\n\r\n                displacement              = negativeDisplacement\r\n                this._currentPathOffset   = negativeOffset\r\n                this._currentPathPosition = negativePathPosition\r\n\r\n            }\r\n\r\n        } else {\r\n\r\n            this.logger.warn( 'Unable to find correct next path position.' )\r\n            displacement = new Vector3()\r\n\r\n        }\r\n\r\n        return displacement\r\n\r\n    }\r\n\r\n    _getDirectionsMap () {\r\n\r\n        //todo: use cache !!! Could become a complet map with nodes on path network\r\n\r\n        const currentPathPosition = this._currentPathPosition\r\n        const currentIndex        = this._currentPathIndex\r\n        const jump                = this._cameraJump\r\n        const maxDistance         = this._maxJump\r\n\r\n        return this._paths.reduce( ( array, path, index ) => {\r\n\r\n            if ( index === currentIndex ) { return array }\r\n\r\n            const start           = path.getPointAt( 0 )\r\n            const distanceToStart = currentPathPosition.distanceToSquared( start )\r\n            let startDisplacement = undefined\r\n            if ( distanceToStart < maxDistance ) {\r\n                startDisplacement = new Vector3().subVectors( path.getPointAt( jump ), start )\r\n            }\r\n\r\n            const end           = path.getPointAt( 1 )\r\n            const distanceToEnd = currentPathPosition.distanceToSquared( end )\r\n            let endDisplacement = undefined\r\n            if ( distanceToEnd < maxDistance ) {\r\n                endDisplacement = new Vector3().subVectors( path.getPointAt( 1 - jump ), end )\r\n            }\r\n\r\n            if ( startDisplacement || endDisplacement ) {\r\n                array.push( {\r\n                    index,\r\n                    startDisplacement,\r\n                    endDisplacement\r\n                } )\r\n            }\r\n\r\n            return array\r\n\r\n        }, [] )\r\n\r\n    }\r\n\r\n}\r\n\r\nexport {\r\n    CameraControls,\r\n    CameraControlMode\r\n}\r\n\r\n//// Extra work\r\n\r\n//\r\n//// t: current time, b: begInnIng value, c: change In value, d: duration\r\n//const ease = {\r\n//    def:              'easeOutQuad',\r\n//    easeInQuad:       function ( x, t, b, c, d ) {\r\n//        return c * (t /= d) * t + b;\r\n//    },\r\n//    easeOutQuad:      function ( x, t, b, c, d ) {\r\n//        return -c * (t /= d) * (t - 2) + b;\r\n//    },\r\n//    easeInOutQuad:    function ( x, t, b, c, d ) {\r\n//        if ( (t /= d / 2) < 1 ) {\r\n//            return c / 2 * t * t + b;\r\n//        }\r\n//        return -c / 2 * ((--t) * (t - 2) - 1) + b;\r\n//    },\r\n//    easeInCubic:      function ( x, t, b, c, d ) {\r\n//        return c * (t /= d) * t * t + b;\r\n//    },\r\n//    easeOutCubic:     function ( x, t, b, c, d ) {\r\n//        return c * ((t = t / d - 1) * t * t + 1) + b;\r\n//    },\r\n//    easeInOutCubic:   function ( x, t, b, c, d ) {\r\n//        if ( (t /= d / 2) < 1 ) {\r\n//            return c / 2 * t * t * t + b;\r\n//        }\r\n//        return c / 2 * ((t -= 2) * t * t + 2) + b;\r\n//    },\r\n//    easeInQuart:      function ( x, t, b, c, d ) {\r\n//        return c * (t /= d) * t * t * t + b;\r\n//    },\r\n//    easeOutQuart:     function ( x, t, b, c, d ) {\r\n//        return -c * ((t = t / d - 1) * t * t * t - 1) + b;\r\n//    },\r\n//    easeInOutQuart:   function ( x, t, b, c, d ) {\r\n//        if ( (t /= d / 2) < 1 ) {\r\n//            return c / 2 * t * t * t * t + b;\r\n//        }\r\n//        return -c / 2 * ((t -= 2) * t * t * t - 2) + b;\r\n//    },\r\n//    easeInQuint:      function ( x, t, b, c, d ) {\r\n//        return c * (t /= d) * t * t * t * t + b;\r\n//    },\r\n//    easeOutQuint:     function ( x, t, b, c, d ) {\r\n//        return c * ((t = t / d - 1) * t * t * t * t + 1) + b;\r\n//    },\r\n//    easeInOutQuint:   function ( x, t, b, c, d ) {\r\n//        if ( (t /= d / 2) < 1 ) {\r\n//            return c / 2 * t * t * t * t * t + b;\r\n//        }\r\n//        return c / 2 * ((t -= 2) * t * t * t * t + 2) + b;\r\n//    },\r\n//    easeInSine:       function ( x, t, b, c, d ) {\r\n//        return -c * Math.cos( t / d * (Math.PI / 2) ) + c + b;\r\n//    },\r\n//    easeOutSine:      function ( x, t, b, c, d ) {\r\n//        return c * Math.sin( t / d * (Math.PI / 2) ) + b;\r\n//    },\r\n//    easeInOutSine:    function ( x, t, b, c, d ) {\r\n//        return -c / 2 * (Math.cos( Math.PI * t / d ) - 1) + b;\r\n//    },\r\n//    easeInExpo:       function ( x, t, b, c, d ) {\r\n//        return (t == 0) ? b : c * Math.pow( 2, 10 * (t / d - 1) ) + b;\r\n//    },\r\n//    easeOutExpo:      function ( x, t, b, c, d ) {\r\n//        return (t == d) ? b + c : c * (-Math.pow( 2, -10 * t / d ) + 1) + b;\r\n//    },\r\n//    easeInOutExpo:    function ( x, t, b, c, d ) {\r\n//        if ( t == 0 ) {\r\n//            return b;\r\n//        }\r\n//        if ( t == d ) {\r\n//            return b + c;\r\n//        }\r\n//        if ( (t /= d / 2) < 1 ) {\r\n//            return c / 2 * Math.pow( 2, 10 * (t - 1) ) + b;\r\n//        }\r\n//        return c / 2 * (-Math.pow( 2, -10 * --t ) + 2) + b;\r\n//    },\r\n//    easeInCirc:       function ( x, t, b, c, d ) {\r\n//        return -c * (Math.sqrt( 1 - (t /= d) * t ) - 1) + b;\r\n//    },\r\n//    easeOutCirc:      function ( x, t, b, c, d ) {\r\n//        return c * Math.sqrt( 1 - (t = t / d - 1) * t ) + b;\r\n//    },\r\n//    easeInOutCirc:    function ( x, t, b, c, d ) {\r\n//        if ( (t /= d / 2) < 1 ) {\r\n//            return -c / 2 * (Math.sqrt( 1 - t * t ) - 1) + b;\r\n//        }\r\n//        return c / 2 * (Math.sqrt( 1 - (t -= 2) * t ) + 1) + b;\r\n//    },\r\n//    easeInElastic:    function ( x, t, b, c, d ) {\r\n//        var s = 1.70158;\r\n//        var p = 0;\r\n//        var a = c;\r\n//        if ( t == 0 ) {\r\n//            return b;\r\n//        }\r\n//        if ( (t /= d) == 1 ) {\r\n//            return b + c;\r\n//        }\r\n//        if ( !p ) {\r\n//            p = d * .3;\r\n//        }\r\n//        if ( a < Math.abs( c ) ) {\r\n//            a     = c;\r\n//            var s = p / 4;\r\n//        }\r\n//        else {\r\n//            var s = p / (2 * Math.PI) * Math.asin( c / a );\r\n//        }\r\n//        return -(a * Math.pow( 2, 10 * (t -= 1) ) * Math.sin( (t * d - s) * (2 * Math.PI) / p )) + b;\r\n//    },\r\n//    easeOutElastic:   function ( x, t, b, c, d ) {\r\n//        var s = 1.70158;\r\n//        var p = 0;\r\n//        var a = c;\r\n//        if ( t == 0 ) {\r\n//            return b;\r\n//        }\r\n//        if ( (t /= d) == 1 ) {\r\n//            return b + c;\r\n//        }\r\n//        if ( !p ) {\r\n//            p = d * .3;\r\n//        }\r\n//        if ( a < Math.abs( c ) ) {\r\n//            a     = c;\r\n//            var s = p / 4;\r\n//        }\r\n//        else {\r\n//            var s = p / (2 * Math.PI) * Math.asin( c / a );\r\n//        }\r\n//        return a * Math.pow( 2, -10 * t ) * Math.sin( (t * d - s) * (2 * Math.PI) / p ) + c + b;\r\n//    },\r\n//    easeInOutElastic: function ( x, t, b, c, d ) {\r\n//        var s = 1.70158;\r\n//        var p = 0;\r\n//        var a = c;\r\n//        if ( t == 0 ) {\r\n//            return b;\r\n//        }\r\n//        if ( (t /= d / 2) == 2 ) {\r\n//            return b + c;\r\n//        }\r\n//        if ( !p ) {\r\n//            p = d * (.3 * 1.5);\r\n//        }\r\n//        if ( a < Math.abs( c ) ) {\r\n//            a     = c;\r\n//            var s = p / 4;\r\n//        }\r\n//        else {\r\n//            var s = p / (2 * Math.PI) * Math.asin( c / a );\r\n//        }\r\n//        if ( t < 1 ) {\r\n//            return -.5 * (a * Math.pow( 2, 10 * (t -= 1) ) * Math.sin( (t * d - s) * (2 * Math.PI) / p )) + b;\r\n//        }\r\n//        return a * Math.pow( 2, -10 * (t -= 1) ) * Math.sin( (t * d - s) * (2 * Math.PI) / p ) * .5 + c + b;\r\n//    },\r\n//    easeInBack:       function ( x, t, b, c, d, s ) {\r\n//        if ( s == undefined ) {\r\n//            s = 1.70158;\r\n//        }\r\n//        return c * (t /= d) * t * ((s + 1) * t - s) + b;\r\n//    },\r\n//    easeOutBack:      function ( x, t, b, c, d, s ) {\r\n//        if ( s == undefined ) {\r\n//            s = 1.70158;\r\n//        }\r\n//        return c * ((t = t / d - 1) * t * ((s + 1) * t + s) + 1) + b;\r\n//    },\r\n//    easeInOutBack:    function ( x, t, b, c, d, s ) {\r\n//        if ( s == undefined ) {\r\n//            s = 1.70158;\r\n//        }\r\n//        if ( (t /= d / 2) < 1 ) {\r\n//            return c / 2 * (t * t * (((s *= (1.525)) + 1) * t - s)) + b;\r\n//        }\r\n//        return c / 2 * ((t -= 2) * t * (((s *= (1.525)) + 1) * t + s) + 2) + b;\r\n//    },\r\n//    easeInBounce:     function ( x, t, b, c, d ) {\r\n//        return c - jQuery.easing.easeOutBounce( x, d - t, 0, c, d ) + b;\r\n//    },\r\n//    easeOutBounce:    function ( x, t, b, c, d ) {\r\n//        if ( (t /= d) < (1 / 2.75) ) {\r\n//            return c * (7.5625 * t * t) + b;\r\n//        } else if ( t < (2 / 2.75) ) {\r\n//            return c * (7.5625 * (t -= (1.5 / 2.75)) * t + .75) + b;\r\n//        } else if ( t < (2.5 / 2.75) ) {\r\n//            return c * (7.5625 * (t -= (2.25 / 2.75)) * t + .9375) + b;\r\n//        } else {\r\n//            return c * (7.5625 * (t -= (2.625 / 2.75)) * t + .984375) + b;\r\n//        }\r\n//    },\r\n//    easeInOutBounce:  function ( x, t, b, c, d ) {\r\n//        if ( t < d / 2 ) {\r\n//            return jQuery.easing.easeInBounce( x, t * 2, 0, c, d ) * .5 + b;\r\n//        }\r\n//        return jQuery.easing.easeOutBounce( x, t * 2 - d, 0, c, d ) * .5 + c * .5 + b;\r\n//    }\r\n//}\r\n//\r\n////const accelerations = {\r\n////    Linear: function( speed ) {\r\n////        return speed + acceleration\r\n////    }\r\n////}\r\n//\r\n//class Movement {\r\n//\r\n//    constructor ( min, max, minSpeed, currentSpeed, maxSpeed, acceleration ) {\r\n//\r\n//        this.bounds   = {\r\n//            min: -Infinity,\r\n//            max: Infinity\r\n//        }\r\n//        this.speed    = {\r\n//            min:     0,\r\n//            current: 1.0,\r\n//            max:     Infinity\r\n//        }\r\n//        this.minSpeed = 0.0\r\n//        this.speed    = 1.0\r\n//        this.maxSpeed = Infinity\r\n//\r\n//        this.acceleration = function ( timer ) {\r\n//            return speed += 0.1\r\n//        }\r\n//\r\n//        this.deceleration = function ( timer, speed ) {\r\n//            return speed -= 0.1\r\n//        }\r\n//    }\r\n//\r\n//}\r\n","/**\r\n * @author [Tristan Valcke]{@link https://github.com/Itee}\r\n * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}\r\n *\r\n * @file Todo\r\n *\r\n * @example Todo\r\n *\r\n */\r\n\r\nimport {\r\n    DefaultLogger as TLogger,\r\n    Keys\r\n}                            from 'itee-client'\r\nimport {\r\n    isNull,\r\n    isUndefined\r\n}                            from 'itee-validators'\r\nimport {\r\n    Camera,\r\n    EventDispatcher,\r\n    MOUSE,\r\n    Object3D,\r\n    Quaternion,\r\n    Vector3\r\n}                            from 'three-full'\r\nimport { CameraControlMode } from './CameraControls'\r\n\r\nconst PI_2    = Math.PI / 2\r\nconst STATE   = {\r\n    NONE:   -1,\r\n    ROTATE: 0,\r\n    ZOOM:   1,\r\n    PAN:    2\r\n}\r\nconst xVector = new Vector3( 1, 0, 0 )\r\nconst yVector = new Vector3( 0, 1, 0 )\r\n\r\n/**\r\n *\r\n * @param camera\r\n * @param domElement\r\n * @constructor\r\n */\r\nfunction CameraPathController ( parameters = {} ) {\r\n\r\n    const _parameters = {\r\n        ...{\r\n            camera:     null,\r\n            target:     new Object3D(),\r\n            mode:       CameraControlMode.Orbit,\r\n            domElement: window\r\n        }, ...parameters\r\n    }\r\n\r\n    const self = this\r\n\r\n    let currentState = STATE.NONE\r\n\r\n    this.camera     = _parameters.camera\r\n    this.cameraJump = 0.0\r\n\r\n    this.paths               = []\r\n    this.pathsMap            = new Map()\r\n    this.currentPath         = undefined\r\n    this.currentPathIndex    = -1\r\n    this.currentPathPosition = 0\r\n\r\n    this.domElement      = ( domElement !== undefined ) ? domElement : document\r\n    this.forwardControl  = this.domElement.children[ 0 ].children[ 0 ].children[ 0 ]\r\n    this.backwardControl = this.domElement.children[ 0 ].children[ 1 ].children[ 0 ]\r\n    this.timeoutId       = undefined\r\n\r\n    // Set to false to disable controls\r\n    this.enabled = false\r\n\r\n    // Set to false to disable zooming\r\n    this.enableZoom = true\r\n    this.zoomSpeed  = 1.0\r\n\r\n    // Set to false to disable rotating\r\n    this.enableRotate = true\r\n    this.rotateSpeed  = 0.0025\r\n\r\n    // Set to false to disable panning\r\n    this.enablePan   = true\r\n    this.keyPanSpeed = 7.0\t// pixels moved per arrow key push\r\n\r\n    this.verticalOffset = 1.5\r\n\r\n    this.keysCodes = {\r\n        forwardKeys:  [ Keys.Z, Keys.UP_ARROW ],\r\n        backwardKeys: [ Keys.S, Keys.BOTTOM_ARROW ]\r\n    }\r\n\r\n    // Mouse\r\n    let mouseQuat = {\r\n        x: new Quaternion(),\r\n        y: new Quaternion()\r\n    }\r\n\r\n    this.mouseButtons = {\r\n        ORBIT: MOUSE.LEFT,\r\n        ZOOM:  MOUSE.MIDDLE,\r\n        PAN:   MOUSE.RIGHT\r\n    }\r\n\r\n    this.orientation = {\r\n        x: 0,\r\n        y: 0\r\n    }\r\n\r\n    // Private methods\r\n    function moveForward () {\r\n\r\n        self.currentPathPosition += self.cameraJump\r\n        if ( self.currentPathPosition > 1 ) {\r\n\r\n            TLogger.log( 'reachEnd' )\r\n            var indexOfNextPath           = self.pathsMap.get( self.currentPathIndex ).indexOfNextPath\r\n            var indexOfNextPathOfNextPath = self.pathsMap.get( indexOfNextPath ).indexOfNextPath\r\n\r\n            // If next path of the next path is the current path that means flows are in the same direction\r\n            // so we need to inverse the current path position to 1 to start at the right position\r\n            if ( indexOfNextPathOfNextPath === self.currentPathIndex ) {\r\n                self.currentPathPosition = 1\r\n            } else {\r\n                self.currentPathPosition = 0\r\n            }\r\n\r\n            self.currentPathIndex = indexOfNextPath\r\n            self.currentPath      = self.paths[ indexOfNextPath ]\r\n\r\n        }\r\n\r\n        self.update()\r\n        self.dispatchEvent( { type: 'move' } )\r\n\r\n    }\r\n\r\n    function moveBackward () {\r\n\r\n        self.currentPathPosition -= self.cameraJump\r\n        if ( self.currentPathPosition < 0 ) {\r\n\r\n            TLogger.log( 'reachStart' )\r\n            var indexOfPreviousPath               = self.pathsMap.get( self.currentPathIndex ).indexOfPreviousPath\r\n            var indexOfPreviousPathOfPreviousPath = self.pathsMap.get( indexOfPreviousPath ).indexOfPreviousPath\r\n\r\n            // If previous path of the previous path is the current path that means flows have the same origin\r\n            // so we need to inverse the current path position to 0 to start at the right position\r\n            if ( indexOfPreviousPathOfPreviousPath === self.currentPathIndex ) {\r\n                self.currentPathPosition = 0\r\n            } else {\r\n                self.currentPathPosition = 1\r\n            }\r\n\r\n            self.currentPathIndex = indexOfPreviousPath\r\n            self.currentPath      = self.paths[ indexOfPreviousPath ]\r\n\r\n        }\r\n\r\n        self.update()\r\n        self.dispatchEvent( { type: 'move' } )\r\n\r\n    }\r\n\r\n    function rotate ( event ) {\r\n\r\n        //TLogger.log( 'handleMouseMoveRotate' )\r\n\r\n        var movementX = event.movementX || event.mozMovementX || event.webkitMovementX || 0\r\n        var movementY = event.movementY || event.mozMovementY || event.webkitMovementY || 0\r\n\r\n        var orientation = self.orientation\r\n        orientation.y += movementX * self.rotateSpeed\r\n        orientation.x += movementY * self.rotateSpeed\r\n        orientation.x   = Math.max( -PI_2, Math.min( PI_2, orientation.x ) )\r\n\r\n        self.update()\r\n        self.dispatchEvent( { type: 'rotate' } )\r\n\r\n    }\r\n\r\n    // Handlers\r\n    function onKeyDown ( event ) {\r\n\r\n        if ( self.enabled === false ) {\r\n            return\r\n        }\r\n\r\n        var pathCurrentPoint = self.currentPath.getPointAt( self.currentPathPosition )\r\n        var pathNextPoint    = undefined\r\n        var pathDirection    = undefined\r\n        if ( self.currentPathPosition + self.cameraJump > 1 ) { // end of path\r\n            pathNextPoint = self.currentPath.getPointAt( self.currentPathPosition - self.cameraJump )\r\n            pathDirection = pathNextPoint.sub( pathCurrentPoint ).normalize().negate()\r\n        } else {\r\n            pathNextPoint = self.currentPath.getPointAt( self.currentPathPosition + self.cameraJump )\r\n            pathDirection = pathNextPoint.sub( pathCurrentPoint ).normalize()\r\n        }\r\n\r\n        var cameraDirection = camera.getWorldDirection().normalize()\r\n        var dotProduct      = cameraDirection.dot( pathDirection )\r\n\r\n        if ( dotProduct > 0 && self.keysCodes.forwardKeys.includes( event.keyCode ) ) {\r\n\r\n            event.preventDefault()\r\n            moveForward()\r\n\r\n        } else if ( dotProduct < 0 && self.keysCodes.forwardKeys.includes( event.keyCode ) ) {\r\n\r\n            event.preventDefault()\r\n            moveBackward()\r\n\r\n        } else if ( dotProduct > 0 && self.keysCodes.backwardKeys.includes( event.keyCode ) ) {\r\n\r\n            event.preventDefault()\r\n            moveBackward()\r\n\r\n        } else if ( dotProduct < 0 && self.keysCodes.backwardKeys.includes( event.keyCode ) ) {\r\n\r\n            event.preventDefault()\r\n            moveForward()\r\n\r\n        } else {\r\n\r\n            TLogger.warn( 'The key event is not implemented for key code: ' + event.keyCode )\r\n\r\n        }\r\n\r\n    }\r\n\r\n    function onKeyUp ( event ) {\r\n\r\n        if ( self.enabled === false ) {\r\n            return\r\n        }\r\n\r\n        if ( !self.keysCodes.forwardKeys.includes( event.keyCode ) && !self.keysCodes.backwardKeys.includes( event.keyCode ) ) {\r\n            return\r\n        }\r\n\r\n        if ( event ) { event.preventDefault() }\r\n\r\n        self.dispatchEvent( { type: 'moveEnd' } )\r\n\r\n    }\r\n\r\n    function onMouseDown ( event ) {\r\n\r\n        if ( self.enabled === false ) {\r\n            return\r\n        }\r\n\r\n        event.preventDefault()\r\n\r\n        if ( self.enableRotate === true && event.button === self.mouseButtons.ORBIT ) {\r\n\r\n            currentState = STATE.ROTATE\r\n\r\n        } else if ( self.enableZoom === true && event.button === self.mouseButtons.ZOOM ) {\r\n\r\n            // state = STATE.DOLLY\r\n\r\n        } else if ( self.enablePan === true && event.button === self.mouseButtons.PAN ) {\r\n\r\n            // state = STATE.PAN\r\n\r\n        }\r\n\r\n    }\r\n\r\n    function onMouseMove ( event ) {\r\n\r\n        if ( self.enabled === false ) {\r\n            return\r\n        }\r\n\r\n        event.preventDefault()\r\n\r\n        if ( currentState === STATE.ROTATE ) {\r\n\r\n            rotate( event )\r\n\r\n        } else if ( currentState === STATE.DOLLY ) {\r\n\r\n            // handleMouseMoveDolly( event )\r\n\r\n        } else if ( currentState === STATE.PAN ) {\r\n\r\n            // handleMouseMovePan( event )\r\n\r\n        }\r\n\r\n    }\r\n\r\n    function onMouseUp ( event ) {\r\n\r\n        if ( self.enabled === false ) {\r\n            return\r\n        }\r\n\r\n        if ( event ) { event.preventDefault() }\r\n\r\n        currentState = STATE.NONE\r\n\r\n        self.dispatchEvent( { type: 'rotateEnd' } )\r\n\r\n    }\r\n\r\n    function onForward ( event ) {\r\n\r\n        clearTimeout( self.timeoutId )\r\n\r\n        event.keyCode = Keys.UP_ARROW\r\n        onKeyDown( event )\r\n\r\n        self.timeoutId = setTimeout( onKeyUp.bind( self ), 750 )\r\n\r\n    }\r\n\r\n    function onBackward ( event ) {\r\n\r\n        clearTimeout( self.timeoutId )\r\n\r\n        event.keyCode = Keys.BOTTOM_ARROW\r\n        onKeyDown( event )\r\n\r\n        self.timeoutId = setTimeout( onKeyUp.bind( self ), 750 )\r\n\r\n    }\r\n\r\n    // Public function that access private methods\r\n    this.update = function () {\r\n\r\n        if ( this.enabled === false ) {\r\n            return\r\n        }\r\n\r\n        // Update position\r\n        var newPosition        = this.currentPath.getPointAt( this.currentPathPosition )\r\n        this.camera.position.x = newPosition.x\r\n        this.camera.position.y = newPosition.y + this.verticalOffset\r\n        this.camera.position.z = newPosition.z\r\n\r\n        // Update rotation\r\n        mouseQuat.x.setFromAxisAngle( xVector, this.orientation.x )\r\n        mouseQuat.y.setFromAxisAngle( yVector, this.orientation.y )\r\n        this.camera.quaternion.copy( mouseQuat.y ).multiply( mouseQuat.x )\r\n\r\n    }\r\n\r\n    this.dispose = function () {\r\n\r\n        this.domElement.removeEventListener( 'mousedown', onMouseDown, false )\r\n        this.domElement.removeEventListener( 'mousemove', onMouseMove, false )\r\n        this.domElement.removeEventListener( 'mouseup', onMouseUp, false )\r\n\r\n        window.removeEventListener( 'keydown', onKeyDown, false )\r\n        window.removeEventListener( 'keyup', onKeyUp, false )\r\n\r\n    }\r\n\r\n    this.domElement.addEventListener( 'mousedown', onMouseDown, false )\r\n    this.domElement.addEventListener( 'mousemove', onMouseMove, false )\r\n    this.domElement.addEventListener( 'mouseup', onMouseUp, false )\r\n\r\n    window.addEventListener( 'keydown', onKeyDown, false )\r\n    window.addEventListener( 'keyup', onKeyUp, false )\r\n\r\n    this.forwardControl.addEventListener( 'click', onForward, false )\r\n    this.backwardControl.addEventListener( 'click', onBackward, false )\r\n\r\n}\r\n\r\nObject.assign( CameraPathController.prototype, EventDispatcher.prototype, {\r\n\r\n    get camera () {\r\n\r\n        return this._camera\r\n\r\n    },\r\n\r\n    set camera ( value ) {\r\n\r\n        if ( isNull( value ) ) { throw new Error( 'Camera cannot be null ! Expect an instance of Camera' ) }\r\n        if ( isUndefined( value ) ) { throw new Error( 'Camera cannot be undefined ! Expect an instance of Camera' ) }\r\n        if ( !( value instanceof Camera ) ) { throw new Error( `Camera cannot be an instance of ${value.constructor.name}. Expect an instance of Camera.` ) }\r\n\r\n        this._camera = value\r\n\r\n    },\r\n\r\n    setCamera ( value ) {\r\n\r\n        this.camera = value\r\n        return this\r\n\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param path\r\n     */\r\n    setPath ( path ) {\r\n\r\n        this.currentPath = path\r\n        this.cameraJump  = 1 / path.getLength()\r\n\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param paths\r\n     * @param nameOfFirstPathToFollow\r\n     */\r\n    setPaths ( paths, nameOfFirstPathToFollow ) {\r\n\r\n        this.paths            = paths\r\n        this.currentPathIndex = 0\r\n\r\n        var pathToFollow = this.paths[ this.currentPathIndex ]\r\n\r\n        var numberOfPaths = this.paths.length\r\n\r\n        var firstPath      = undefined\r\n        var startFirstPath = undefined\r\n        var endFirstPath   = undefined\r\n\r\n        var secondPath      = undefined\r\n        var startSecondPath = undefined\r\n        var endSecondPath   = undefined\r\n\r\n        for ( var firstPathIndex = 0 ; firstPathIndex < numberOfPaths ; firstPathIndex++ ) {\r\n\r\n            firstPath      = this.paths[ firstPathIndex ]\r\n            startFirstPath = firstPath.getPointAt( 0 )\r\n            endFirstPath   = firstPath.getPointAt( 1 )\r\n\r\n            if ( nameOfFirstPathToFollow && firstPath.name === nameOfFirstPathToFollow ) {\r\n                pathToFollow          = firstPath\r\n                this.currentPathIndex = firstPathIndex\r\n            }\r\n\r\n            var closestStartDistance    = Infinity\r\n            var closestEndDistance      = Infinity\r\n            var indexOfClosestStartPath = undefined\r\n            var indexOfClosestEndPath   = undefined\r\n\r\n            for ( var secondPathIndex = 0 ; secondPathIndex < numberOfPaths ; secondPathIndex++ ) {\r\n\r\n                if ( firstPathIndex === secondPathIndex ) {\r\n                    continue\r\n                }\r\n\r\n                secondPath      = this.paths[ secondPathIndex ]\r\n                startSecondPath = secondPath.getPointAt( 0 )\r\n                endSecondPath   = secondPath.getPointAt( 1 )\r\n\r\n                if ( startFirstPath.distanceTo( startSecondPath ) < closestStartDistance ) {\r\n\r\n                    closestStartDistance    = startFirstPath.distanceTo( startSecondPath )\r\n                    indexOfClosestStartPath = secondPathIndex\r\n\r\n                }\r\n\r\n                if ( startFirstPath.distanceTo( endSecondPath ) < closestStartDistance ) {\r\n\r\n                    closestStartDistance    = startFirstPath.distanceTo( endSecondPath )\r\n                    indexOfClosestStartPath = secondPathIndex\r\n\r\n                }\r\n\r\n                if ( endFirstPath.distanceTo( startSecondPath ) < closestEndDistance ) {\r\n\r\n                    closestEndDistance    = endFirstPath.distanceTo( startSecondPath )\r\n                    indexOfClosestEndPath = secondPathIndex\r\n\r\n                }\r\n\r\n                if ( endFirstPath.distanceTo( endSecondPath ) < closestEndDistance ) {\r\n\r\n                    closestEndDistance    = endFirstPath.distanceTo( endSecondPath )\r\n                    indexOfClosestEndPath = secondPathIndex\r\n\r\n                }\r\n\r\n            }\r\n\r\n            this.pathsMap.set( firstPathIndex, {\r\n                indexOfPreviousPath: indexOfClosestStartPath,\r\n                indexOfNextPath:     indexOfClosestEndPath\r\n            } )\r\n\r\n        }\r\n\r\n        //        TLogger.log( this.pathsMap )\r\n\r\n        this.setPath( pathToFollow )\r\n\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param quat\r\n     */\r\n    setMouseQuat ( quat ) {\r\n\r\n        this.orientation.y = Math.asin( quat.y ) * 2\r\n        this.orientation.x = 0\r\n\r\n    },\r\n\r\n    /**\r\n     *\r\n     */\r\n    getCurrentPathPosition () {\r\n\r\n        return this.currentPath.getPointAt( this.currentPathPosition )\r\n\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @return {undefined}\r\n     */\r\n    getNextPathPosition () {\r\n\r\n        var nextPosition = undefined\r\n\r\n        if ( this.currentPathPosition + this.cameraJump > 1 ) { // end of path\r\n            nextPosition = this.currentPath.getPointAt( this.currentPathPosition - this.cameraJump ).negate()\r\n        } else {\r\n            nextPosition = this.currentPath.getPointAt( this.currentPathPosition + this.cameraJump )\r\n        }\r\n\r\n        return nextPosition\r\n\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @return {number}\r\n     */\r\n    getDistanceFromStart () {\r\n\r\n        //Linear distance\r\n        //\t\tvar firstPosition = this.currentPath.getPointAt( 0 )\r\n        //\t\tvar currentPosition = this.currentPath.getPointAt( this.currentPathPosition )\r\n        //\r\n        //\t\treturn firstPosition.distanceTo( currentPosition )\r\n\r\n        // Accordingly to the fact than currentPathPosition is an multiple of cameraJump that is equals to 1 / path.getLength()\r\n        // Todo: need to go the projection to Tronon\r\n        return this.currentPathPosition * this.currentPath.getLength()\r\n\r\n    },\r\n\r\n    /**\r\n     *\r\n     */\r\n    lookAtPath () {\r\n\r\n        // Set lookup point at the camera height\r\n        var nextPosition = this.getNextPathPosition()\r\n        nextPosition.y   = this.camera.position.y\r\n\r\n        this.camera.lookAt( nextPosition )\r\n\r\n        // We need to update local orientation else on first move event the camera will return to default position !\r\n        this.setMouseQuat( this.camera.quaternion )\r\n\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param position\r\n     */\r\n    goTo ( position ) {\r\n\r\n        //Todo: Should use 2D instead of 3D !\r\n\r\n        var numberOfPoints    = undefined\r\n        var currentPath       = undefined\r\n        var currentPathPoints = undefined\r\n        var closestPointIndex = undefined\r\n        var closestPath       = undefined\r\n        var closestPathIndex  = undefined\r\n        var currentDistance   = undefined\r\n        var closestDistance   = Infinity\r\n\r\n        for ( var pathIndex = 0, numberOfPath = this.paths.length ; pathIndex < numberOfPath ; pathIndex++ ) {\r\n\r\n            currentPath       = this.paths[ pathIndex ]\r\n            numberOfPoints    = Math.floor( currentPath.getLength() )\r\n            currentPathPoints = currentPath.getSpacedPoints( numberOfPoints )\r\n\r\n            for ( var pointIndex = 0 ; pointIndex < numberOfPoints ; pointIndex++ ) {\r\n\r\n                currentDistance = position.distanceTo( currentPathPoints[ pointIndex ] )\r\n\r\n                if ( currentDistance < closestDistance ) {\r\n\r\n                    closestDistance   = currentDistance\r\n                    closestPathIndex  = pathIndex\r\n                    closestPath       = currentPath\r\n                    closestPointIndex = pointIndex\r\n\r\n                }\r\n\r\n            }\r\n\r\n        }\r\n\r\n        this.setPath( closestPath )\r\n        this.currentPathIndex    = closestPathIndex\r\n        this.currentPathPosition = this.cameraJump * closestPointIndex\r\n\r\n        this.lookAtPath()\r\n        this.update()\r\n\r\n        this.dispatchEvent( { type: 'moveEnd' } )\r\n        this.dispatchEvent( { type: 'rotateEnd' } )\r\n\r\n    }\r\n\r\n} )\r\n\r\nexport { CameraPathController }\r\n","/**\r\n * @author [Ahmed DCHAR]{@link https://github.com/Dragoneel}\r\n * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}\r\n *\r\n * @file Todo\r\n *\r\n * @example Todo\r\n *\r\n */\r\n\r\n/* global Math */\r\n\r\nimport {\r\n    degreesToRadians,\r\n    toEnum\r\n} from 'itee-utils'\r\nimport {\r\n    isArray,\r\n    isDefined,\r\n    isNotArray,\r\n    isNotDefined,\r\n    isNull,\r\n    isUndefined\r\n} from 'itee-validators'\r\nimport {\r\n    Box3,\r\n    BoxBufferGeometry,\r\n    BufferGeometry,\r\n    Camera,\r\n    ConeBufferGeometry,\r\n    CylinderBufferGeometry,\r\n    DoubleSide,\r\n    EdgesGeometry,\r\n    Euler,\r\n    Float32BufferAttribute,\r\n    Line,\r\n    LineBasicMaterial,\r\n    LineSegments,\r\n    Mesh,\r\n    MeshBasicMaterial,\r\n    Object3D,\r\n    OctahedronBufferGeometry,\r\n    Plane,\r\n    PlaneBufferGeometry,\r\n    Quaternion,\r\n    Raycaster,\r\n    SphereBufferGeometry,\r\n    TorusBufferGeometry,\r\n    Vector2,\r\n    Vector3\r\n} from 'three-full'\r\nimport {\r\n    Keys,\r\n    Mouse\r\n} from 'itee-client'\r\n\r\n// Basic Geometries\r\n\r\nclass LineGeometry extends BufferGeometry {\r\n\r\n    constructor ( pointA = new Vector3( 0, 0, 0 ), pointB = new Vector3( 1, 0, 0 ) ) {\r\n        super()\r\n\r\n        this.type = 'LineGeometry'\r\n        this.addAttribute( 'position', new Float32BufferAttribute( [ pointA.x, pointA.y, pointA.z, pointB.x, pointB.y, pointB.z ], 3 ) )\r\n\r\n    }\r\n\r\n}\r\n\r\nclass ClippingBox extends LineSegments {\r\n\r\n    constructor () {\r\n        super()\r\n\r\n        this.geometry = new EdgesGeometry( new BoxBufferGeometry( 2, 2, 2 ) )\r\n        this.material = new LineBasicMaterial( {\r\n            color: 0xffffff\r\n        } )\r\n\r\n        // Planes\r\n        this.normalPlanes = {\r\n            normalRightSide:  new Vector3( -1, 0, 0 ),\r\n            normalLeftSide:   new Vector3( 1, 0, 0 ),\r\n            normalFrontSide:  new Vector3( 0, -1, 0 ),\r\n            normalBackSide:   new Vector3( 0, 1, 0 ),\r\n            normalTopSide:    new Vector3( 0, 0, -1 ),\r\n            normalBottomSide: new Vector3( 0, 0, 1 )\r\n        }\r\n\r\n        this.planes = {\r\n            rightSidePlane:  new Plane( this.normalPlanes.normalRightSide.clone(), 0 ),\r\n            leftSidePlane:   new Plane( this.normalPlanes.normalLeftSide.clone(), 0 ),\r\n            frontSidePlane:  new Plane( this.normalPlanes.normalFrontSide.clone(), 0 ),\r\n            backSidePlane:   new Plane( this.normalPlanes.normalBackSide.clone(), 0 ),\r\n            topSidePlane:    new Plane( this.normalPlanes.normalTopSide.clone(), 0 ),\r\n            bottomSidePlane: new Plane( this.normalPlanes.normalBottomSide.clone(), 0 )\r\n        }\r\n\r\n        this._boundingBox = new Box3()\r\n\r\n    }\r\n\r\n    getBoundingSphere () {\r\n\r\n        this.geometry.computeBoundingSphere()\r\n        this.geometry.boundingSphere.applyMatrix4( this.matrixWorld )\r\n\r\n        return this.geometry.boundingSphere\r\n\r\n    }\r\n\r\n    setColor ( color ) {\r\n\r\n        this.material.color.set( color )\r\n\r\n    }\r\n\r\n    applyClippingTo ( state, objects ) {\r\n\r\n        if ( isNotDefined( objects ) ) { return }\r\n\r\n        let planes = []\r\n        for ( let i in this.planes ) {\r\n            planes.push( this.planes[ i ] )\r\n        }\r\n\r\n        objects.traverse( ( object ) => {\r\n\r\n            if ( isNotDefined( object ) ) { return }\r\n            if ( isNotDefined( object.geometry ) ) { return }\r\n            if ( isNotDefined( object.material ) ) { return }\r\n\r\n            const materials = isArray( object.material ) ? object.material : [ object.material ]\r\n\r\n            for ( let materialIndex = 0, numberOfMaterial = materials.length ; materialIndex < numberOfMaterial ; materialIndex++ ) {\r\n                let material = materials[ materialIndex ]\r\n                if ( !material.clippingPlanes ) {\r\n                    material.clippingPlanes = []\r\n                }\r\n                material.clippingPlanes = ( state ) ? planes : []\r\n            }\r\n\r\n        } )\r\n\r\n    }\r\n\r\n    updateSize ( size ) {\r\n\r\n        this.scale.set( size.x, size.y, size.z )\r\n\r\n    }\r\n\r\n    update () {\r\n\r\n        this._boundingBox.setFromObject( this )\r\n\r\n        const margin = 0.0\r\n        const min    = this._boundingBox.min\r\n        const max    = this._boundingBox.max\r\n\r\n        this.planes.rightSidePlane.constant  = max.x + margin\r\n        this.planes.leftSidePlane.constant   = -min.x + margin\r\n        this.planes.frontSidePlane.constant  = max.y + margin\r\n        this.planes.backSidePlane.constant   = -min.y + margin\r\n        this.planes.topSidePlane.constant    = max.z + margin\r\n        this.planes.bottomSidePlane.constant = -min.z + margin\r\n\r\n    }\r\n\r\n}\r\n\r\n// Materials\r\n\r\nclass HighlightableMaterial extends MeshBasicMaterial {\r\n\r\n    constructor ( parameters ) {\r\n        super( parameters )\r\n        this.isHighlightableMaterial = true\r\n        //        this.type                    = 'HighlightableMaterial'\r\n\r\n        this.depthTest   = false\r\n        this.depthWrite  = false\r\n        this.fog         = false\r\n        this.side        = DoubleSide\r\n        this.transparent = true\r\n        this.oldColor    = this.color.clone()\r\n\r\n    }\r\n\r\n    highlight ( highlighted ) {\r\n\r\n        if ( highlighted ) {\r\n\r\n            const lum = 0.35\r\n            const _r  = this.color.r\r\n            const _g  = this.color.g\r\n            const _b  = this.color.b\r\n            const r   = Math.min( Math.max( 0, _r + ( _r * lum ) ), 1.0 )\r\n            const g   = Math.min( Math.max( 0, _g + ( _g * lum ) ), 1.0 )\r\n            const b   = Math.min( Math.max( 0, _b + ( _b * lum ) ), 1.0 )\r\n            this.color.setRGB( r, g, b )\r\n\r\n        } else {\r\n\r\n            this.color.copy( this.oldColor )\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\nclass HighlightableLineMaterial extends LineBasicMaterial {\r\n\r\n    constructor ( parameters ) {\r\n        super( parameters )\r\n        this.isHighlightableMaterial = true\r\n        //        this.type                    = 'HighlightableLineMaterial'\r\n\r\n        this.depthTest   = false\r\n        this.depthWrite  = false\r\n        this.fog         = false\r\n        this.transparent = true\r\n        this.linewidth   = 1\r\n        this.oldColor    = this.color.clone()\r\n\r\n    }\r\n\r\n    highlight ( highlighted ) {\r\n\r\n        if ( highlighted ) {\r\n\r\n            const lum = 0.35\r\n            const _r  = this.color.r\r\n            const _g  = this.color.g\r\n            const _b  = this.color.b\r\n            const r   = Math.min( Math.max( 0, _r + ( _r * lum ) ), 1.0 )\r\n            const g   = Math.min( Math.max( 0, _g + ( _g * lum ) ), 1.0 )\r\n            const b   = Math.min( Math.max( 0, _b + ( _b * lum ) ), 1.0 )\r\n            this.color.setRGB( r, g, b )\r\n\r\n        } else {\r\n\r\n            this.color.copy( this.oldColor )\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\n// Pickers\r\n\r\nclass AbstractHitbox extends Mesh {\r\n\r\n    constructor ( parameters = {} ) {\r\n\r\n        const _parameters = {\r\n            ...{\r\n                geometry: new BufferGeometry(),\r\n                material: new MeshBasicMaterial( {\r\n                    visible:    false,\r\n                    depthTest:  false,\r\n                    depthWrite: false,\r\n                    fog:        false,\r\n                    side:       DoubleSide\r\n                    //                    opacity:     0.0,\r\n                    //                    transparent: true\r\n                } )\r\n            }, ...parameters\r\n        }\r\n\r\n        super( _parameters.geometry, _parameters.material )\r\n        this.isHitbox = true\r\n        this.type     = 'Hitbox'\r\n\r\n    }\r\n}\r\n\r\nclass CylindricaHitbox extends AbstractHitbox {\r\n\r\n    constructor ( parameters = {} ) {\r\n\r\n        const cylinderGeometry = new CylinderBufferGeometry( 0.2, 0, 1, 4, 1, false )\r\n        cylinderGeometry.translate( 0, 0.5, 0 )\r\n        const _parameters = {\r\n            ...{\r\n                geometry: cylinderGeometry\r\n            }, ...parameters\r\n        }\r\n\r\n        super( _parameters )\r\n        this.isCylindricaHitbox = true\r\n        this.type               = 'CylindricaHitbox'\r\n\r\n    }\r\n\r\n}\r\n\r\nclass PlanarHitbox extends AbstractHitbox {\r\n\r\n    constructor ( parameters = {} ) {\r\n\r\n        const planePositions      = [\r\n            0.0, 0.0, 0.0,\r\n            1.1, 0.0, 0.0,\r\n            1.1, 1.1, 0.0,\r\n            0.0, 1.1, 0.0\r\n        ]\r\n        const planeIndexes        = [\r\n            0, 1, 2,\r\n            2, 3, 0\r\n        ]\r\n        const planeBufferGeometry = new BufferGeometry()\r\n        planeBufferGeometry.addAttribute( 'position', new Float32BufferAttribute( planePositions, 3 ) )\r\n        planeBufferGeometry.setIndex( planeIndexes )\r\n\r\n        const _parameters = {\r\n            ...{\r\n                geometry: planeBufferGeometry\r\n            }, ...parameters\r\n        }\r\n\r\n        super( _parameters )\r\n        this.isPlanarHitbox = true\r\n        this.type           = 'PlanarHitbox'\r\n\r\n    }\r\n\r\n}\r\n\r\nclass LozengeHitbox extends AbstractHitbox {\r\n\r\n    constructor ( parameters = {} ) {\r\n\r\n        // Lozenge\r\n        const lozengePositions        = [\r\n            0.0, 0.0, 0.0,\r\n            0.85, 0.0, 0.0,\r\n            1.1, 1.1, 0.0,\r\n            0.0, 0.85, 0.0\r\n        ]\r\n        const lozengeIndexes          = [\r\n            0, 1, 2,\r\n            2, 3, 0\r\n        ]\r\n        const positionBufferAttribute = new Float32BufferAttribute( lozengePositions, 3 )\r\n        const lozengeBufferGeometry   = new BufferGeometry()\r\n        lozengeBufferGeometry.addAttribute( 'position', positionBufferAttribute )\r\n        lozengeBufferGeometry.setIndex( lozengeIndexes )\r\n\r\n        const _parameters = {\r\n            ...{\r\n                geometry: lozengeBufferGeometry\r\n            }, ...parameters\r\n        }\r\n\r\n        super( _parameters )\r\n        this.isPlanarHitbox = true\r\n        this.type           = 'PlanarHitbox'\r\n\r\n    }\r\n\r\n}\r\n\r\nclass OctahedricalHitbox extends AbstractHitbox {\r\n\r\n    constructor ( parameters = {} ) {\r\n\r\n        const _parameters = {\r\n            ...{\r\n                geometry: new OctahedronBufferGeometry( 1.2, 0 )\r\n            }, ...parameters\r\n        }\r\n\r\n        super( _parameters )\r\n        this.isOctahedricalHitbox = true\r\n        this.type                 = 'OctahedricalHitbox'\r\n\r\n    }\r\n\r\n}\r\n\r\nclass SphericalHitbox extends AbstractHitbox {\r\n\r\n    constructor ( parameters = {} ) {\r\n\r\n        const _parameters = {\r\n            ...{\r\n                geometry: new SphereBufferGeometry( 1, 8, 6, 0, 2 * Math.PI, 0, Math.PI )\r\n            }, ...parameters\r\n        }\r\n\r\n        super( _parameters )\r\n        this.isSphericalHitbox = true\r\n        this.type              = 'SphericalHitbox'\r\n\r\n    }\r\n\r\n}\r\n\r\nclass TorusHitbox extends AbstractHitbox {\r\n\r\n    constructor ( parameters = {} ) {\r\n\r\n        const _parameters = {\r\n            ...{\r\n                geometry: new TorusBufferGeometry( 1, 0.12, 4, 12, Math.PI )\r\n            }, ...parameters\r\n        }\r\n\r\n        super( _parameters )\r\n        this.isTorusHitbox = true\r\n        this.type          = 'TorusHitbox'\r\n\r\n    }\r\n\r\n}\r\n\r\n// Handles\r\nclass AbstractHandle extends Object3D {\r\n\r\n    constructor ( parameters = {} ) {\r\n\r\n        const _parameters = {\r\n            ...{\r\n                color:  0xffffff,\r\n                hitbox: null\r\n            }, ...parameters\r\n        }\r\n\r\n        super()\r\n        this.isHandle = true\r\n        this.type     = 'Handle'\r\n\r\n        this.color  = _parameters.color\r\n        this.hitbox = _parameters.hitbox\r\n\r\n        this.baseQuaternion = new Quaternion()\r\n\r\n    }\r\n\r\n    get color () {\r\n\r\n        return this.line.material.color.clone()\r\n\r\n    }\r\n\r\n    set color ( value ) {\r\n\r\n        if ( isNull( value ) ) { throw new Error( 'Color cannot be null ! Expect an instance of Color.' ) }\r\n        if ( isUndefined( value ) ) { throw new Error( 'Color cannot be undefined ! Expect an instance of Color.' ) }\r\n        //        if ( !( value instanceof Color ) ) { throw new Error( `Color cannot be an instance of ${value.constructor.name}. Expect an instance of Color.` ) }\r\n\r\n        this.traverse( ( child ) => {\r\n\r\n            let materials = child.material\r\n            if ( !materials ) { return }\r\n\r\n            materials.color.setHex( value )\r\n\r\n        } )\r\n\r\n    }\r\n\r\n    get hitbox () {\r\n        return this._hitbox\r\n    }\r\n\r\n    set hitbox ( value ) {\r\n        this._hitbox = value\r\n        this.add( value )\r\n    }\r\n\r\n    setColor ( value ) {\r\n\r\n        this.color = value\r\n        return this\r\n\r\n    }\r\n\r\n    setHitbox ( value ) {\r\n        this.hitbox = value\r\n        return this\r\n    }\r\n\r\n    setScale ( x, y, z ) {\r\n\r\n        this.scale.set( x, y, z )\r\n        return this\r\n\r\n    }\r\n\r\n    setPosition ( x, y, z ) {\r\n        this.position.set( x, y, z )\r\n        return this\r\n    }\r\n\r\n    highlight ( value ) {\r\n\r\n        for ( let childIndex = 0, numberOfChildren = this.children.length ; childIndex < numberOfChildren ; childIndex++ ) {\r\n            const child = this.children[ childIndex ]\r\n            if ( child.isHitbox ) { continue }\r\n\r\n            const childMaterial = child.material\r\n            if ( isUndefined( childMaterial ) || !childMaterial.isHighlightableMaterial ) { continue }\r\n\r\n            childMaterial.highlight( value )\r\n        }\r\n\r\n    }\r\n\r\n    raycast ( raycaster, intersects ) {\r\n\r\n        const intersections = raycaster.intersectObject( this._hitbox, false )\r\n        if ( intersections.length > 0 ) {\r\n            intersects.push( {\r\n                distance: intersections[ 0 ].distance,\r\n                object:   this\r\n            } )\r\n        }\r\n\r\n    }\r\n\r\n    setRotationFromAxisAndAngle ( axis, angle ) {\r\n\r\n        this.quaternion.setFromAxisAngle( axis, angle )\r\n        this.baseQuaternion.copy( this.quaternion )\r\n        return this\r\n\r\n    }\r\n\r\n    update ( cameraDirection ) {}\r\n\r\n}\r\n\r\nclass TranslateHandle extends AbstractHandle {\r\n\r\n    constructor ( parameters = {} ) {\r\n\r\n        const _parameters = {\r\n            ...{\r\n                color:     0xffffff,\r\n                hitbox:    new CylindricaHitbox(),\r\n                direction: new Vector3( 0, 1, 0 )\r\n            }, ...parameters\r\n        }\r\n\r\n        super( _parameters )\r\n        this.isTranslateHandle = true\r\n        this.type              = 'TranslateHandle'\r\n\r\n        const lineGeometry = new LineGeometry( new Vector3( 0, 0, 0 ), new Vector3( 0, 0.8, 0 ) )\r\n        const lineMaterial = new HighlightableLineMaterial( { color: _parameters.color } )\r\n        const line         = new Line( lineGeometry, lineMaterial )\r\n        this.add( line )\r\n\r\n        const coneGeometry = new ConeBufferGeometry( 0.05, 0.2, 12, 1, false )\r\n        coneGeometry.translate( 0, 0.9, 0 )\r\n        const coneMaterial = new HighlightableMaterial( { color: _parameters.color } )\r\n        const cone         = new Mesh( coneGeometry, coneMaterial )\r\n        this.add( cone )\r\n\r\n        this.direction = _parameters.direction\r\n\r\n    }\r\n\r\n    get direction () {\r\n\r\n        return this._direction\r\n\r\n    }\r\n\r\n    set direction ( value ) {\r\n\r\n        if ( isNull( value ) ) { throw new Error( 'Direction cannot be null ! Expect an instance of Color.' ) }\r\n        if ( isUndefined( value ) ) { throw new Error( 'Direction cannot be undefined ! Expect an instance of Color.' ) }\r\n        if ( !( value instanceof Vector3 ) ) { throw new Error( `Direction cannot be an instance of ${value.constructor.name}. Expect an instance of Vector3.` ) }\r\n\r\n        this._direction = value\r\n\r\n        if ( value.y > 0.99999 ) {\r\n\r\n            this.quaternion.set( 0, 0, 0, 1 )\r\n\r\n        } else if ( value.y < -0.99999 ) {\r\n\r\n            this.quaternion.set( 1, 0, 0, 0 )\r\n\r\n        } else {\r\n\r\n            const axis    = new Vector3( value.z, 0, -value.x ).normalize()\r\n            const radians = Math.acos( value.y )\r\n\r\n            this.quaternion.setFromAxisAngle( axis, radians )\r\n\r\n        }\r\n\r\n    }\r\n\r\n    update ( cameraDirection ) {\r\n\r\n        super.update( cameraDirection )\r\n\r\n        const dotProduct = this._direction.dot( cameraDirection )\r\n        if ( dotProduct >= 0 ) {\r\n            this.flipDirection()\r\n        }\r\n\r\n    }\r\n\r\n    setDirection ( direction ) {\r\n\r\n        this.direction = direction\r\n        return this\r\n\r\n    }\r\n\r\n    flipDirection () {\r\n\r\n        this.direction = this._direction.negate()\r\n\r\n    }\r\n\r\n}\r\n\r\nclass ScaleHandle extends AbstractHandle {\r\n\r\n    constructor ( parameters = {} ) {\r\n\r\n        const _parameters = {\r\n            ...{\r\n                color:     0xffffff,\r\n                hitbox:    new CylindricaHitbox(),\r\n                direction: new Vector3( 0, 1, 0 )\r\n            }, ...parameters\r\n        }\r\n\r\n        super( _parameters )\r\n        this.isScaleHandle = true\r\n        this.type          = 'ScaleHandle'\r\n\r\n        const lineGeometry = new LineGeometry( new Vector3( 0, 0, 0 ), new Vector3( 0, 0.88, 0 ) )\r\n        const lineMaterial = new HighlightableLineMaterial( { color: _parameters.color } )\r\n        const line         = new Line( lineGeometry, lineMaterial )\r\n        this.add( line )\r\n\r\n        const boxGeometry = new BoxBufferGeometry( 0.12, 0.12, 0.12 )\r\n        boxGeometry.translate( 0, 0.94, 0 )\r\n        const boxMaterial = new HighlightableMaterial( { color: _parameters.color } )\r\n        const box         = new Mesh( boxGeometry, boxMaterial )\r\n        this.add( box )\r\n\r\n        this.direction = _parameters.direction\r\n\r\n    }\r\n\r\n    get direction () {\r\n\r\n        return this._direction\r\n\r\n    }\r\n\r\n    set direction ( value ) {\r\n\r\n        if ( isNull( value ) ) { throw new Error( 'Direction cannot be null ! Expect an instance of Color.' ) }\r\n        if ( isUndefined( value ) ) { throw new Error( 'Direction cannot be undefined ! Expect an instance of Color.' ) }\r\n        if ( !( value instanceof Vector3 ) ) { throw new Error( `Direction cannot be an instance of ${value.constructor.name}. Expect an instance of Vector3.` ) }\r\n\r\n        this._direction = value\r\n\r\n        if ( value.y > 0.99999 ) {\r\n\r\n            this.quaternion.set( 0, 0, 0, 1 )\r\n\r\n        } else if ( value.y < -0.99999 ) {\r\n\r\n            this.quaternion.set( 1, 0, 0, 0 )\r\n\r\n        } else {\r\n\r\n            const axis    = new Vector3( value.z, 0, -value.x ).normalize()\r\n            const radians = Math.acos( value.y )\r\n\r\n            this.quaternion.setFromAxisAngle( axis, radians )\r\n\r\n        }\r\n\r\n    }\r\n\r\n    update ( cameraDirection ) {\r\n\r\n        super.update( cameraDirection )\r\n\r\n        const dotProduct = this._direction.dot( cameraDirection )\r\n        if ( dotProduct >= 0 ) {\r\n            this.flipDirection()\r\n        }\r\n\r\n    }\r\n\r\n    setDirection ( direction ) {\r\n\r\n        this.direction = direction\r\n        return this\r\n\r\n    }\r\n\r\n    flipDirection () {\r\n\r\n        this.direction = this._direction.negate()\r\n\r\n    }\r\n\r\n}\r\n\r\nclass RotateHandle extends AbstractHandle {\r\n\r\n    constructor ( parameters = {} ) {\r\n\r\n        const _parameters = {\r\n            ...{}, ...parameters\r\n        }\r\n\r\n        super( _parameters )\r\n        this.isRotateHandle = true\r\n        this.type           = 'RotateHandle'\r\n\r\n    }\r\n\r\n    update ( cameraDirection ) {\r\n        super.update( cameraDirection )\r\n    }\r\n\r\n}\r\n\r\nclass PlaneHandle extends AbstractHandle {\r\n\r\n    constructor ( parameters = {} ) {\r\n\r\n        const _parameters = {\r\n            ...{\r\n                color:     0xffffff,\r\n                hitbox:    new PlanarHitbox(),\r\n                direction: new Vector3( 0, 1, 0 )\r\n            }, ...parameters\r\n        }\r\n\r\n        super( _parameters )\r\n        this.isPlaneHandle = true\r\n        this.type          = 'PlaneHandle'\r\n\r\n        // Edge line\r\n        const lineBufferGeometry = new BufferGeometry()\r\n        lineBufferGeometry.addAttribute( 'position', new Float32BufferAttribute( [ 0.75, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.75, 0.0 ], 3 ) )\r\n\r\n        const lineMaterial = new HighlightableLineMaterial( {\r\n            color: _parameters.color\r\n        } )\r\n\r\n        const line = new Line( lineBufferGeometry, lineMaterial )\r\n        this.add( line )\r\n\r\n        // Plane\r\n        const planePositions      = [\r\n            0.1, 0.1, 0.0,\r\n            1.0, 0.1, 0.0,\r\n            1.0, 1.0, 0.0,\r\n            0.1, 1.0, 0.0\r\n        ]\r\n        const planeIndexes        = [\r\n            0, 1, 2,\r\n            2, 3, 0\r\n        ]\r\n        const planeBufferGeometry = new BufferGeometry()\r\n        planeBufferGeometry.addAttribute( 'position', new Float32BufferAttribute( planePositions, 3 ) )\r\n        planeBufferGeometry.setIndex( planeIndexes )\r\n\r\n        const planeMaterial = new HighlightableMaterial( {\r\n            color:       _parameters.color,\r\n            transparent: true,\r\n            opacity:     0.35\r\n        } )\r\n        const plane         = new Mesh( planeBufferGeometry, planeMaterial )\r\n        this.add( plane )\r\n\r\n        this.xAxis = new Vector3( 1, 0, 0 )\r\n        this.yAxis = new Vector3( 0, 1, 0 )\r\n        this.zAxis = new Vector3( 0, 0, 1 )\r\n\r\n        this.xDirection = new Vector3( _parameters.direction.x, 0, 0 )\r\n        this.yDirection = new Vector3( 0, _parameters.direction.y, 0 )\r\n        this.zDirection = new Vector3( 0, 0, _parameters.direction.z )\r\n        this.direction  = _parameters.direction\r\n\r\n    }\r\n\r\n    get direction () {\r\n\r\n        return this._direction\r\n\r\n    }\r\n\r\n    set direction ( value ) {\r\n\r\n        if ( isNull( value ) ) { throw new Error( 'Direction cannot be null ! Expect an instance of Color.' ) }\r\n        if ( isUndefined( value ) ) { throw new Error( 'Direction cannot be undefined ! Expect an instance of Color.' ) }\r\n        if ( !( value instanceof Vector3 ) ) { throw new Error( `Direction cannot be an instance of ${value.constructor.name}. Expect an instance of Vector3.` ) }\r\n\r\n        this._direction = value\r\n\r\n    }\r\n\r\n    update ( cameraDirection ) {\r\n\r\n        super.update( cameraDirection )\r\n\r\n        // Decompose direction by main orientation\r\n        const xDirection = new Vector3( this._direction.x, 0, 0 )\r\n        const yDirection = new Vector3( 0, this._direction.y, 0 )\r\n        const zDirection = new Vector3( 0, 0, this._direction.z )\r\n        const xDot       = xDirection.dot( cameraDirection )\r\n        const yDot       = yDirection.dot( cameraDirection )\r\n        const zDot       = zDirection.dot( cameraDirection )\r\n\r\n        this.quaternion.copy( this.baseQuaternion )\r\n\r\n        // XY Plane\r\n        if ( xDot > 0 && yDot > 0 && zDot === 0 ) {\r\n\r\n            this.rotateOnAxis( this.zAxis, degreesToRadians( 180 ) )\r\n            this.xDirection.setX( -1 )\r\n            this.yDirection.setY( -1 )\r\n            this.zDirection.setZ( 0 )\r\n\r\n        } else if ( xDot > 0 && yDot < 0 && zDot === 0 ) {\r\n\r\n            this.rotateOnAxis( this.zAxis, degreesToRadians( 90 ) )\r\n            this.xDirection.setX( -1 )\r\n            this.yDirection.setY( 1 )\r\n            this.zDirection.setZ( 0 )\r\n\r\n        } else if ( xDot < 0 && yDot > 0 && zDot === 0 ) {\r\n\r\n            this.rotateOnAxis( this.zAxis, degreesToRadians( 270 ) )\r\n            this.xDirection.setX( 1 )\r\n            this.yDirection.setY( -1 )\r\n            this.zDirection.setZ( 0 )\r\n\r\n        } else if ( xDot < 0 && yDot < 0 && zDot === 0 ) {\r\n\r\n            this.rotateOnAxis( this.zAxis, degreesToRadians( 0 ) )\r\n            this.xDirection.setX( 1 )\r\n            this.yDirection.setY( 1 )\r\n            this.zDirection.setZ( 0 )\r\n\r\n        }\r\n\r\n        // XZ Plane\r\n        else if ( xDot > 0 && yDot === 0 && zDot > 0 ) {\r\n\r\n            this.rotateOnAxis( this.zAxis, degreesToRadians( 180 ) )\r\n            this.xDirection.setX( -1 )\r\n            this.yDirection.setY( 0 )\r\n            this.zDirection.setZ( -1 )\r\n\r\n        } else if ( xDot > 0 && yDot === 0 && zDot < 0 ) {\r\n\r\n            this.rotateOnAxis( this.zAxis, degreesToRadians( 90 ) )\r\n            this.xDirection.setX( -1 )\r\n            this.yDirection.setY( 0 )\r\n            this.zDirection.setZ( 1 )\r\n\r\n        } else if ( xDot < 0 && yDot === 0 && zDot > 0 ) {\r\n\r\n            this.rotateOnAxis( this.zAxis, degreesToRadians( 270 ) )\r\n            this.xDirection.setX( 1 )\r\n            this.yDirection.setY( 0 )\r\n            this.zDirection.setZ( -1 )\r\n\r\n        } else if ( xDot < 0 && yDot === 0 && zDot < 0 ) {\r\n\r\n            this.rotateOnAxis( this.zAxis, degreesToRadians( 0 ) )\r\n            this.xDirection.setX( 1 )\r\n            this.yDirection.setY( 0 )\r\n            this.zDirection.setZ( 1 )\r\n\r\n        }\r\n\r\n        // YZ Plane\r\n        else if ( xDot === 0 && yDot > 0 && zDot > 0 ) {\r\n\r\n            this.rotateOnAxis( this.zAxis, degreesToRadians( 180 ) )\r\n            this.xDirection.setX( 0 )\r\n            this.yDirection.setY( -1 )\r\n            this.zDirection.setZ( -1 )\r\n\r\n        } else if ( xDot === 0 && yDot > 0 && zDot < 0 ) {\r\n\r\n            this.rotateOnAxis( this.zAxis, degreesToRadians( 270 ) )\r\n            this.xDirection.setX( 0 )\r\n            this.yDirection.setY( -1 )\r\n            this.zDirection.setZ( 1 )\r\n\r\n        } else if ( xDot === 0 && yDot < 0 && zDot > 0 ) {\r\n\r\n            this.rotateOnAxis( this.zAxis, degreesToRadians( 90 ) )\r\n            this.xDirection.setX( 0 )\r\n            this.yDirection.setY( 1 )\r\n            this.zDirection.setZ( -1 )\r\n\r\n        } else if ( xDot === 0 && yDot < 0 && zDot < 0 ) {\r\n\r\n            this.rotateOnAxis( this.zAxis, degreesToRadians( 0 ) )\r\n            this.xDirection.setX( 0 )\r\n            this.yDirection.setY( 1 )\r\n            this.zDirection.setZ( 1 )\r\n\r\n        }\r\n\r\n    }\r\n\r\n    setDirection ( direction ) {\r\n\r\n        this.direction = direction\r\n        return this\r\n\r\n    }\r\n\r\n    flipXDirection () {\r\n\r\n        this.xDirection.setX( -this.xDirection.x )\r\n\r\n    }\r\n\r\n    flipYDirection () {\r\n\r\n        this.yDirection.setY( -this.yDirection.y )\r\n\r\n    }\r\n\r\n    flipZDirection () {\r\n\r\n        this.zDirection.setZ( -this.zDirection.z )\r\n\r\n    }\r\n\r\n}\r\n\r\nclass LozengeHandle extends AbstractHandle {\r\n\r\n    constructor ( parameters = {} ) {\r\n\r\n        const _parameters = {\r\n            ...{\r\n                color:     0xffffff,\r\n                hitbox:    new LozengeHitbox(),\r\n                direction: new Vector3( 1, 1, 0 )\r\n            }, ...parameters\r\n        }\r\n\r\n        super( _parameters )\r\n        this.isPlaneHandle = true\r\n        this.type          = 'PlaneHandle'\r\n\r\n        // Edge line\r\n        const lineBufferGeometry = new BufferGeometry()\r\n        lineBufferGeometry.addAttribute( 'position', new Float32BufferAttribute( [ 0.1, 0.75, 0.0, 1.0, 1.0, 0.0, 0.75, 0.1, 0.0 ], 3 ) )\r\n\r\n        const lineMaterial = new HighlightableLineMaterial( {\r\n            color: _parameters.color\r\n        } )\r\n\r\n        const line = new Line( lineBufferGeometry, lineMaterial )\r\n        this.add( line )\r\n\r\n        // Lozenge\r\n        const lozengePositions      = [\r\n            0.1, 0.1, 0.0,\r\n            0.75, 0.1, 0.0,\r\n            1.0, 1.0, 0.0,\r\n            0.1, 0.75, 0.0\r\n        ]\r\n        const lozengeIndexes        = [\r\n            0, 1, 2,\r\n            2, 3, 0\r\n        ]\r\n        const lozengeBufferGeometry = new BufferGeometry()\r\n        lozengeBufferGeometry.addAttribute( 'position', new Float32BufferAttribute( lozengePositions, 3 ) )\r\n        lozengeBufferGeometry.setIndex( lozengeIndexes )\r\n\r\n        const lozengeMaterial = new HighlightableMaterial( {\r\n            color:       _parameters.color,\r\n            transparent: true,\r\n            opacity:     0.35\r\n        } )\r\n        const lozenge         = new Mesh( lozengeBufferGeometry, lozengeMaterial )\r\n        this.add( lozenge )\r\n\r\n        this.direction  = _parameters.direction\r\n        this.xDirection = new Vector3( _parameters.direction.x, 0, 0 )\r\n        this.yDirection = new Vector3( 0, _parameters.direction.y, 0 )\r\n        this.zDirection = new Vector3( 0, 0, _parameters.direction.z )\r\n        this.xAxis      = new Vector3( 1, 0, 0 )\r\n        this.yAxis      = new Vector3( 0, 1, 0 )\r\n        this.zAxis      = new Vector3( 0, 0, 1 )\r\n    }\r\n\r\n    get direction () {\r\n\r\n        return this._direction\r\n\r\n    }\r\n\r\n    set direction ( value ) {\r\n\r\n        if ( isNull( value ) ) { throw new Error( 'Direction cannot be null ! Expect an instance of Color.' ) }\r\n        if ( isUndefined( value ) ) { throw new Error( 'Direction cannot be undefined ! Expect an instance of Color.' ) }\r\n        if ( !( value instanceof Vector3 ) ) { throw new Error( `Direction cannot be an instance of ${value.constructor.name}. Expect an instance of Vector3.` ) }\r\n\r\n        this._direction = value\r\n\r\n    }\r\n\r\n    update ( cameraDirection ) {\r\n\r\n        super.update( cameraDirection )\r\n\r\n        const xDot = this.xDirection.dot( cameraDirection )\r\n        const yDot = this.yDirection.dot( cameraDirection )\r\n        const zDot = this.zDirection.dot( cameraDirection )\r\n\r\n        this.quaternion.copy( this.baseQuaternion )\r\n\r\n        // XY Plane\r\n        if ( xDot > 0 && yDot > 0 && zDot === 0 ) {\r\n\r\n            this.rotateOnAxis( this.zAxis, degreesToRadians( 180 ) )\r\n\r\n        } else if ( xDot > 0 && yDot < 0 && zDot === 0 ) {\r\n\r\n            this.rotateOnAxis( this.zAxis, degreesToRadians( 90 ) )\r\n\r\n        } else if ( xDot < 0 && yDot > 0 && zDot === 0 ) {\r\n\r\n            this.rotateOnAxis( this.zAxis, degreesToRadians( 270 ) )\r\n\r\n        } else if ( xDot < 0 && yDot < 0 && zDot === 0 ) {\r\n\r\n            this.rotateOnAxis( this.zAxis, degreesToRadians( 0 ) )\r\n\r\n        }\r\n\r\n        // XZ Plane\r\n        else if ( xDot > 0 && yDot === 0 && zDot > 0 ) {\r\n\r\n            this.rotateOnAxis( this.zAxis, degreesToRadians( 180 ) )\r\n\r\n        } else if ( xDot > 0 && yDot === 0 && zDot < 0 ) {\r\n\r\n            this.rotateOnAxis( this.zAxis, degreesToRadians( 90 ) )\r\n\r\n        } else if ( xDot < 0 && yDot === 0 && zDot > 0 ) {\r\n\r\n            this.rotateOnAxis( this.zAxis, degreesToRadians( 270 ) )\r\n\r\n        } else if ( xDot < 0 && yDot === 0 && zDot < 0 ) {\r\n\r\n            this.rotateOnAxis( this.zAxis, degreesToRadians( 0 ) )\r\n\r\n        }\r\n\r\n        // YZ Plane\r\n        else if ( xDot === 0 && yDot > 0 && zDot > 0 ) {\r\n\r\n            this.rotateOnAxis( this.zAxis, degreesToRadians( 180 ) )\r\n\r\n        } else if ( xDot === 0 && yDot > 0 && zDot < 0 ) {\r\n\r\n            this.rotateOnAxis( this.zAxis, degreesToRadians( 270 ) )\r\n\r\n        } else if ( xDot === 0 && yDot < 0 && zDot > 0 ) {\r\n\r\n            this.rotateOnAxis( this.zAxis, degreesToRadians( 90 ) )\r\n\r\n        } else if ( xDot === 0 && yDot < 0 && zDot < 0 ) {\r\n\r\n            this.rotateOnAxis( this.zAxis, degreesToRadians( 0 ) )\r\n\r\n        }\r\n\r\n    }\r\n\r\n    setDirection ( direction ) {\r\n\r\n        this.direction = direction\r\n        return this\r\n\r\n    }\r\n\r\n    flipXAxis () {\r\n\r\n        const tempDirection = this._direction.clone()\r\n        tempDirection.x     = -tempDirection.x\r\n\r\n        this.direction = tempDirection\r\n\r\n    }\r\n\r\n    flipYAxis () {\r\n\r\n        const tempDirection = this._direction.clone()\r\n        tempDirection.y     = -tempDirection.y\r\n\r\n        this.direction = tempDirection\r\n\r\n    }\r\n\r\n    flipZAxis () {\r\n\r\n        const tempDirection = this._direction.clone()\r\n        tempDirection.z     = -tempDirection.z\r\n\r\n        this.direction = tempDirection\r\n\r\n    }\r\n\r\n}\r\n\r\nclass OctahedricalHandle extends AbstractHandle {\r\n\r\n    constructor ( parameters = {} ) {\r\n\r\n        const _parameters = {\r\n            ...{\r\n                color:  0xffffff,\r\n                hitbox: new OctahedricalHitbox()\r\n            }, ...parameters\r\n        }\r\n\r\n        super( _parameters )\r\n        this.isOmnidirectionalHandle = true\r\n        this.type                    = 'OmnidirectionalHandle'\r\n\r\n        const octahedronGeometry = new OctahedronBufferGeometry( 1, 0 )\r\n        const octahedronMaterial = new HighlightableMaterial( {\r\n            color:       _parameters.color,\r\n            transparent: true,\r\n            opacity:     0.55\r\n        } )\r\n        const octahedron         = new Mesh( octahedronGeometry, octahedronMaterial )\r\n        this.add( octahedron )\r\n\r\n        const edgesGeometry = new EdgesGeometry( octahedronGeometry )\r\n        const edgesMaterial = new HighlightableLineMaterial( {\r\n            color:     _parameters.color,\r\n            linewidth: 4\r\n        } )\r\n        const edges         = new LineSegments( edgesGeometry, edgesMaterial )\r\n        this.add( edges )\r\n\r\n    }\r\n\r\n    update ( cameraDirection ) {\r\n        super.update( cameraDirection )\r\n    }\r\n\r\n}\r\n\r\n// Gizmos\r\n\r\nclass AbstractGizmo extends Object3D {\r\n\r\n    constructor () {\r\n\r\n        super()\r\n        this.isGizmo = true\r\n        this.type    = 'AbstractGizmo'\r\n\r\n    }\r\n\r\n    init () {\r\n\r\n        this.handles = new Object3D()\r\n\r\n        this.add( this.handles )\r\n\r\n        //// PLANES\r\n        const planeGeometry = new PlaneBufferGeometry( 50, 50, 2, 2 )\r\n        const planeMaterial = new MeshBasicMaterial( {\r\n            side:    DoubleSide,\r\n            visible: false\r\n            //            transparent: true,\r\n            //            opacity:     0.1\r\n        } )\r\n        this.intersectPlane = new Mesh( planeGeometry, planeMaterial )\r\n        this.add( this.intersectPlane )\r\n\r\n        //// HANDLES\r\n\r\n        const setupGizmos = ( gizmoMap, parent ) => {\r\n\r\n            for ( let name in gizmoMap ) {\r\n\r\n                const element = gizmoMap[ name ]\r\n                if ( isNotArray( element ) ) {\r\n\r\n                    element.name        = name\r\n                    element.renderOrder = Infinity\r\n\r\n                    parent.add( element )\r\n\r\n                } else {\r\n\r\n                    for ( let i = element.length ; i-- ; ) {\r\n\r\n                        const object   = gizmoMap[ name ][ i ][ 0 ]\r\n                        const position = gizmoMap[ name ][ i ][ 1 ]\r\n                        const rotation = gizmoMap[ name ][ i ][ 2 ]\r\n                        const scale    = gizmoMap[ name ][ i ][ 3 ]\r\n                        const tag      = gizmoMap[ name ][ i ][ 4 ]\r\n\r\n                        // name and tag properties are essential for picking and updating logic.\r\n                        object.name = name\r\n                        object.tag  = tag\r\n\r\n                        // avoid being hidden by other transparent objects\r\n                        object.renderOrder = Infinity\r\n\r\n                        if ( position ) {\r\n                            object.position.set( position[ 0 ], position[ 1 ], position[ 2 ] )\r\n                        }\r\n                        if ( rotation ) {\r\n                            object.rotation.set( rotation[ 0 ], rotation[ 1 ], rotation[ 2 ] )\r\n                        }\r\n                        if ( scale ) {\r\n                            object.scale.set( scale[ 0 ], scale[ 1 ], scale[ 2 ] )\r\n                        }\r\n\r\n                        object.updateMatrix()\r\n\r\n                        const tempGeometry = object.geometry.clone()\r\n                        tempGeometry.applyMatrix( object.matrix )\r\n                        object.geometry = tempGeometry\r\n\r\n                        object.position.set( 0, 0, 0 )\r\n                        object.rotation.set( 0, 0, 0 )\r\n                        object.scale.set( 1, 1, 1 )\r\n\r\n                        parent.add( object )\r\n\r\n                    }\r\n\r\n                }\r\n\r\n            }\r\n\r\n        }\r\n\r\n        setupGizmos( this.handleGizmos, this.handles )\r\n\r\n    }\r\n\r\n    highlight ( axis ) {\r\n\r\n        // Reset highlight for all of them\r\n        for ( let key in this.handleGizmos ) {\r\n            this.handleGizmos[ key ].highlight( false )\r\n        }\r\n\r\n        // Highlight the picked (if exist)\r\n        const currentHandle = this.handleGizmos[ axis ]\r\n        if ( currentHandle ) {\r\n            currentHandle.highlight( true )\r\n        }\r\n\r\n    }\r\n\r\n    update ( cameraPosition, cameraDirection ) {\r\n\r\n        this.traverse( ( child ) => {\r\n\r\n            if ( !child.isHandle ) { return }\r\n\r\n            child.update( cameraDirection )\r\n\r\n        } )\r\n\r\n        this.updateIntersectPlane( cameraPosition )\r\n\r\n    }\r\n\r\n    updateIntersectPlane ( cameraPosition ) {\r\n\r\n        this.intersectPlane.lookAt( cameraPosition )\r\n\r\n    }\r\n\r\n}\r\n\r\nclass TranslateGizmo extends AbstractGizmo {\r\n\r\n    constructor () {\r\n\r\n        super()\r\n        this.isTranslateGizmo = true\r\n        this.type             = 'TranslateGizmo'\r\n\r\n        this.handleGizmos = {\r\n\r\n            X: new TranslateHandle( {\r\n                color:     0xaa0000,\r\n                direction: new Vector3( 1, 0, 0 )\r\n            } ),\r\n\r\n            Y: new TranslateHandle( {\r\n                color:     0x00aa00,\r\n                direction: new Vector3( 0, 1, 0 )\r\n            } ),\r\n\r\n            Z: new TranslateHandle( {\r\n                color:     0x0000aa,\r\n                direction: new Vector3( 0, 0, 1 )\r\n            } ),\r\n\r\n            XY: new LozengeHandle( {\r\n                color:     0xaaaa00,\r\n                direction: new Vector3( 1, 1, 0 )\r\n            } ).setScale( 0.33, 0.33, 1.0 ),\r\n\r\n            YZ: new LozengeHandle( {\r\n                color:     0x00aaaa,\r\n                direction: new Vector3( 0, 1, 1 )\r\n            } ).setScale( 0.33, 0.33, 1.0 )\r\n               .setRotationFromAxisAndAngle( new Vector3( 0, 1, 0 ), degreesToRadians( -90 ) ),\r\n\r\n            XZ: new LozengeHandle( {\r\n                color:     0xaa00aa,\r\n                direction: new Vector3( 1, 0, 1 )\r\n            } ).setScale( 0.33, 0.33, 1.0 )\r\n               .setRotationFromAxisAndAngle( new Vector3( 1, 0, 0 ), degreesToRadians( 90 ) ),\r\n\r\n            XYZ: new OctahedricalHandle( {\r\n                color: 0xaaaaaa\r\n            } ).setScale( 0.15, 0.15, 0.15 )\r\n\r\n        }\r\n\r\n        this.init()\r\n\r\n    }\r\n\r\n}\r\n\r\nclass RotateGizmo extends AbstractGizmo {\r\n\r\n    constructor () {\r\n\r\n        super()\r\n        this.isRotateGizmo = true\r\n        this.type          = 'RotateGizmo'\r\n\r\n        const CircleGeometry = ( radius, facing, arc ) => {\r\n\r\n            const geometry = new BufferGeometry()\r\n            let vertices   = []\r\n            arc            = arc ? arc : 1\r\n\r\n            for ( let i = 0 ; i <= 64 * arc ; ++i ) {\r\n\r\n                if ( facing === 'x' ) {\r\n                    vertices.push( 0, Math.cos( i / 32 * Math.PI ) * radius, Math.sin( i / 32 * Math.PI ) * radius )\r\n                }\r\n                if ( facing === 'y' ) {\r\n                    vertices.push( Math.cos( i / 32 * Math.PI ) * radius, 0, Math.sin( i / 32 * Math.PI ) * radius )\r\n                }\r\n                if ( facing === 'z' ) {\r\n                    vertices.push( Math.sin( i / 32 * Math.PI ) * radius, Math.cos( i / 32 * Math.PI ) * radius, 0 )\r\n                }\r\n\r\n            }\r\n\r\n            geometry.addAttribute( 'position', new Float32BufferAttribute( vertices, 3 ) )\r\n            return geometry\r\n\r\n        }\r\n\r\n        this.handleGizmos = {\r\n\r\n            X: [\r\n                [ new Line( new CircleGeometry( 1, 'x', 0.5 ), new HighlightableLineMaterial( { color: 0xff0000 } ) ) ],\r\n                [ new Mesh( new OctahedronBufferGeometry( 0.04, 0 ), new HighlightableMaterial( { color: 0xff0000 } ) ), [ 0, 0, 0.99 ], null, [ 3, 1, 1 ] ]\r\n            ],\r\n\r\n            Y: [\r\n                [ new Line( new CircleGeometry( 1, 'y', 0.5 ), new HighlightableLineMaterial( { color: 0x00ff00 } ) ) ],\r\n                [ new Mesh( new OctahedronBufferGeometry( 0.04, 0 ), new HighlightableMaterial( { color: 0x00ff00 } ) ), [ 0, 0, 0.99 ], null, [ 3, 1, 1 ] ]\r\n            ],\r\n\r\n            Z: [\r\n                [ new Line( new CircleGeometry( 1, 'z', 0.5 ), new HighlightableLineMaterial( { color: 0x0000ff } ) ) ],\r\n                [ new Mesh( new OctahedronBufferGeometry( 0.04, 0 ), new HighlightableMaterial( { color: 0x0000ff } ) ), [ 0.99, 0, 0 ], null, [ 1, 3, 1 ] ]\r\n            ],\r\n\r\n            E: [\r\n                [ new Line( new CircleGeometry( 1.25, 'z', 1 ), new HighlightableLineMaterial( { color: 0xcccc00 } ) ) ]\r\n            ],\r\n\r\n            XYZ: [\r\n                [ new Line( new CircleGeometry( 1, 'z', 1 ), new HighlightableLineMaterial( { color: 0x787878 } ) ) ]\r\n            ]\r\n\r\n        }\r\n\r\n        this.pickerGizmos = {\r\n\r\n            X: [\r\n                [ new TorusHitbox(), [ 0, 0, 0 ], [ 0, -Math.PI / 2, -Math.PI / 2 ] ]\r\n            ],\r\n\r\n            Y: [\r\n                [ new TorusHitbox(), [ 0, 0, 0 ], [ Math.PI / 2, 0, 0 ] ]\r\n            ],\r\n\r\n            Z: [\r\n                [ new TorusHitbox(), [ 0, 0, 0 ], [ 0, 0, -Math.PI / 2 ] ]\r\n            ],\r\n\r\n            E: [\r\n                [\r\n                    new TorusHitbox( {\r\n                        radius:          1.25,\r\n                        tube:            0.12,\r\n                        radialSegments:  2,\r\n                        tubularSegments: 24\r\n                    } )\r\n                ]\r\n            ],\r\n\r\n            XYZ: [\r\n                [ new TorusHitbox() ]\r\n            ]\r\n\r\n        }\r\n\r\n        //        this.pickerGizmos.XYZ[ 0 ][ 0 ].visible = false // disable XYZ picker gizmo\r\n\r\n        this.init()\r\n\r\n    }\r\n\r\n    /*\r\n     update ( rotation, eye2 ) {\r\n\r\n     super.update( rotation, eye2 )\r\n\r\n     const tempMatrix     = new Matrix4()\r\n     const worldRotation  = new Euler( 0, 0, 1 )\r\n     const tempQuaternion = new Quaternion()\r\n     const unitX          = new Vector3( 1, 0, 0 )\r\n     const unitY          = new Vector3( 0, 1, 0 )\r\n     const unitZ          = new Vector3( 0, 0, 1 )\r\n     const quaternionX    = new Quaternion()\r\n     const quaternionY    = new Quaternion()\r\n     const quaternionZ    = new Quaternion()\r\n     const eye            = eye2.clone()\r\n\r\n     worldRotation.copy( this.planes[ 'XY' ].rotation )\r\n     tempQuaternion.setFromEuler( worldRotation )\r\n\r\n     tempMatrix.makeRotationFromQuaternion( tempQuaternion ).getInverse( tempMatrix )\r\n     eye.applyMatrix4( tempMatrix )\r\n\r\n     this.traverse( child => {\r\n\r\n     tempQuaternion.setFromEuler( worldRotation )\r\n\r\n     if ( child.name === 'X' ) {\r\n\r\n     quaternionX.setFromAxisAngle( unitX, Math.atan2( -eye.y, eye.z ) )\r\n     tempQuaternion.multiplyQuaternions( tempQuaternion, quaternionX )\r\n     child.quaternion.copy( tempQuaternion )\r\n\r\n     }\r\n\r\n     if ( child.name === 'Y' ) {\r\n\r\n     quaternionY.setFromAxisAngle( unitY, Math.atan2( eye.x, eye.z ) )\r\n     tempQuaternion.multiplyQuaternions( tempQuaternion, quaternionY )\r\n     child.quaternion.copy( tempQuaternion )\r\n\r\n     }\r\n\r\n     if ( child.name === 'Z' ) {\r\n\r\n     quaternionZ.setFromAxisAngle( unitZ, Math.atan2( eye.y, eye.x ) )\r\n     tempQuaternion.multiplyQuaternions( tempQuaternion, quaternionZ )\r\n     child.quaternion.copy( tempQuaternion )\r\n\r\n     }\r\n\r\n     } )\r\n\r\n     }\r\n     */\r\n\r\n}\r\n\r\nclass ScaleGizmo extends AbstractGizmo {\r\n\r\n    constructor () {\r\n\r\n        super()\r\n        this.isScaleGizmo = true\r\n        this.type         = 'ScaleGizmo'\r\n\r\n        this.handleGizmos = {\r\n\r\n            XYZ: new OctahedricalHandle( {\r\n                color: 0xaaaaaa\r\n            } ).setScale( 0.15, 0.15, 0.15 ),\r\n\r\n            XY: new PlaneHandle( {\r\n                color:     0xaaaa00,\r\n                direction: new Vector3( 1, 1, 0 )\r\n            } ).setScale( 0.33, 0.33, 1.0 ),\r\n\r\n            YZ: new PlaneHandle( {\r\n                color:     0x00aaaa,\r\n                direction: new Vector3( 0, 1, 1 )\r\n            } ).setScale( 0.33, 0.33, 1.0 )\r\n               .setRotationFromAxisAndAngle( new Vector3( 0, 1, 0 ), degreesToRadians( -90 ) ),\r\n\r\n            XZ: new PlaneHandle( {\r\n                color:     0xaa00aa,\r\n                direction: new Vector3( 1, 0, 1 )\r\n            } ).setScale( 0.33, 0.33, 1.0 )\r\n               .setRotationFromAxisAndAngle( new Vector3( 1, 0, 0 ), degreesToRadians( 90 ) ),\r\n\r\n            X: new ScaleHandle( {\r\n                color:     0xaa0000,\r\n                direction: new Vector3( 1, 0, 0 )\r\n            } ),\r\n\r\n            Y: new ScaleHandle( {\r\n                color:     0x00aa00,\r\n                direction: new Vector3( 0, 1, 0 )\r\n            } ),\r\n\r\n            Z: new ScaleHandle( {\r\n                color:     0x0000aa,\r\n                direction: new Vector3( 0, 0, 1 )\r\n            } )\r\n\r\n        }\r\n\r\n        this.init()\r\n\r\n    }\r\n\r\n}\r\n\r\n// Controller\r\nconst ClippingModes = toEnum( {\r\n    None:      0,\r\n    Translate: 1,\r\n    Rotate:    2,\r\n    Scale:     3\r\n} )\r\n\r\nclass ClippingControls extends Object3D {\r\n\r\n    constructor ( parameters = {} ) {\r\n\r\n        const _parameters = {\r\n            ...{\r\n                camera:        null,\r\n                domElement:    window,\r\n                mode:          ClippingModes.None,\r\n                objectsToClip: new Object3D()\r\n            }, ...parameters\r\n        }\r\n\r\n        super()\r\n\r\n        // Need to be defined before domElement to make correct binding events\r\n        this._handlers                 = {\r\n            onMouseEnter:  this._onMouseEnter.bind( this ),\r\n            onMouseLeave:  this._onMouseLeave.bind( this ),\r\n            onMouseDown:   this._onMouseDown.bind( this ),\r\n            onMouseMove:   this._onMouseMove.bind( this ),\r\n            onMouseWheel:  this._onMouseWheel.bind( this ),\r\n            onMouseUp:     this._onMouseUp.bind( this ),\r\n            onDblClick:    this._onDblClick.bind( this ),\r\n            onTouchStart:  this._onTouchStart.bind( this ),\r\n            onTouchEnd:    this._onTouchEnd.bind( this ),\r\n            onTouchCancel: this._onTouchCancel.bind( this ),\r\n            onTouchLeave:  this._onTouchLeave.bind( this ),\r\n            onTouchMove:   this._onTouchMove.bind( this ),\r\n            onKeyDown:     this._onKeyDown.bind( this ),\r\n            onKeyUp:       this._onKeyUp.bind( this )\r\n        }\r\n        // Could/Should(?) use the objectsToClip boundingbox if exist ! [only in case we are sure that boundingbox (is/must be) implemented for each object3D.]\r\n        this._objectsToClipBoundingBox = new Box3()\r\n\r\n        this._clippingBox = new ClippingBox()\r\n        this.add( this._clippingBox )\r\n\r\n        this.camera          = _parameters.camera\r\n        this.domElement      = _parameters.domElement\r\n        this.mode            = _parameters.mode\r\n        this.objectsToClip   = _parameters.objectsToClip\r\n        this.translationSnap = 0.1\r\n        this.scaleSnap       = 0.1\r\n        this.rotationSnap    = 0.1\r\n\r\n        this.enabled = false // Should be true by default\r\n\r\n        this.size = 1\r\n\r\n        this._dragging          = false\r\n        this._firstPoint        = new Vector3()\r\n        this._secondPoint       = new Vector3()\r\n        this._mouseDisplacement = new Vector3()\r\n        this._offset            = new Vector3()\r\n        this._raycaster         = new Raycaster()\r\n        this._pointerVector     = new Vector2()\r\n        this._directionToMouse  = new Vector3()\r\n        this._cameraPosition    = new Vector3()\r\n        this._cameraDirection   = new Vector3()\r\n        this._worldPosition     = new Vector3()\r\n        this._worldRotation     = new Euler()\r\n\r\n        this._gizmos = {\r\n            //            'None':      null,\r\n            'Translate': new TranslateGizmo(),\r\n            'Scale':     new ScaleGizmo()\r\n            //            'Rotate':    new RotateGizmo(),\r\n        }\r\n        for ( let mode in this._gizmos ) {\r\n            this.add( this._gizmos[ mode ] )\r\n        }\r\n        this._currentGizmo  = null\r\n        this._currentHandle = null\r\n\r\n        this._events = {\r\n            change:       { type: 'change' },\r\n            mouseEnter:   { type: 'mouseEnter' },\r\n            mouseLeave:   { type: 'mouseLeave' },\r\n            mouseDown:    { type: 'mouseDown' },\r\n            mouseUp:      { type: 'mouseUp' },\r\n            objectChange: { type: 'objectChange' }\r\n        }\r\n\r\n        // The actions map about input events\r\n        this.actionsMap = {\r\n            setMode:   {\r\n                translate: [ Keys.T.value ],\r\n                rotate:    [ Keys.R.value ],\r\n                scale:     [ Keys.S.value ]\r\n            },\r\n            translate: {\r\n                front: [ Keys.Z.value, Keys.UP_ARROW.value ],\r\n                back:  [ Keys.S.value, Keys.DOWN_ARROW.value ],\r\n                up:    [ Keys.A.value, Keys.PAGE_UP.value ],\r\n                down:  [ Keys.E.value, Keys.PAGE_DOWN.value ],\r\n                left:  [ Keys.Q.value, Keys.LEFT_ARROW.value ],\r\n                right: [ Keys.D.value, Keys.RIGHT_ARROW.value ]\r\n            },\r\n            scale:     {\r\n                widthPlus:   [ Keys.LEFT_ARROW.value ],\r\n                widthMinus:  [ Keys.RIGHT_ARROW.value ],\r\n                heightPlus:  [ Keys.PAGE_UP.value ],\r\n                heightMinus: [ Keys.PAGE_DOWN.value ],\r\n                depthPlus:   [ Keys.UP_ARROW.value ],\r\n                depthMinus:  [ Keys.DOWN_ARROW.value ]\r\n            },\r\n            rotate:    {\r\n                xAxis: [ Keys.X.value ],\r\n                yAxis: [ Keys.Y.value ],\r\n                zAxis: [ Keys.Z.value ]\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    get objectsToClip () {\r\n        return this._objectsToClip\r\n    }\r\n\r\n    set objectsToClip ( value ) {\r\n\r\n        if ( isNull( value ) ) { throw new Error( 'Objects to clip cannot be null ! Expect an instance of Object3D' ) }\r\n        if ( isUndefined( value ) ) { throw new Error( 'Objects to clip cannot be undefined ! Expect an instance of Object3D' ) }\r\n        if ( !( value instanceof Object3D ) ) { throw new Error( `Objects to clip cannot be an instance of ${value.constructor.name}. Expect an instance of Object3D.` ) }\r\n\r\n        this._objectsToClip = value\r\n\r\n        const size = new Vector3()\r\n        this._objectsToClipBoundingBox\r\n            .makeEmpty()\r\n            .expandByObject( value )\r\n            .getSize( size )\r\n\r\n        const x = Math.round( size.x ) || 50\r\n        const y = Math.round( size.y ) || 22\r\n        const z = Math.round( size.z ) || 70\r\n        this.scale.set( x, y, z )\r\n        //        this.scale.set( 50, 22, 70 )\r\n\r\n        this._clippingBox.update()\r\n\r\n    }\r\n\r\n    get camera () {\r\n        return this._camera\r\n    }\r\n\r\n    set camera ( value ) {\r\n\r\n        if ( isNull( value ) ) { throw new Error( 'Camera cannot be null ! Expect an instance of Camera' ) }\r\n        if ( isUndefined( value ) ) { throw new Error( 'Camera cannot be undefined ! Expect an instance of Camera' ) }\r\n        if ( !( value instanceof Camera ) ) { throw new Error( `Camera cannot be an instance of ${value.constructor.name}. Expect an instance of Camera.` ) }\r\n\r\n        this._camera = value\r\n\r\n    }\r\n\r\n    get domElement () {\r\n        return this._domElement\r\n    }\r\n\r\n    set domElement ( value ) {\r\n\r\n        if ( isNull( value ) ) { throw new Error( 'DomElement cannot be null ! Expect an instance of Window, HTMLDocument, HTMLDivElement or HTMLCanvasElement.' ) }\r\n        if ( isUndefined( value ) ) { throw new Error( 'DomElement cannot be undefined ! Expect an instance of Window, HTMLDocument, HTMLDivElement or HTMLCanvasElement.' ) }\r\n        if ( !( ( value instanceof Window ) || ( value instanceof HTMLDocument ) || ( value instanceof HTMLDivElement ) || ( value instanceof HTMLCanvasElement ) ) ) { throw new Error( `Target cannot be an instance of ${value.constructor.name}. Expect an instance of Window, HTMLDocument, HTMLDivElement or HTMLCanvasElement.` ) }\r\n\r\n        // Clear previous element\r\n        if ( this._domElement ) {\r\n            this._domElement.removeEventListener( 'mouseenter', this._handlers.onMouseEnter, false )\r\n            this._domElement.removeEventListener( 'mouseleave', this._handlers.onMouseLeave, false )\r\n            this.dispose()\r\n        }\r\n\r\n        this._domElement = value\r\n        this._domElement.addEventListener( 'mouseenter', this._handlers.onMouseEnter, false )\r\n        this._domElement.addEventListener( 'mouseleave', this._handlers.onMouseLeave, false )\r\n        this.impose()\r\n\r\n    }\r\n\r\n    get mode () {\r\n        return this._mode\r\n    }\r\n\r\n    set mode ( value ) {\r\n\r\n        if ( isNull( value ) ) { throw new Error( 'Mode cannot be null ! Expect a value from ClippingModes enum.' ) }\r\n        if ( isUndefined( value ) ) { throw new Error( 'Mode cannot be undefined ! Expect a value from ClippingModes enum.' ) }\r\n        if ( !( value instanceof ClippingModes ) ) { throw new Error( `Mode cannot be an instance of ${value.constructor.name}. Expect a value from TClippingModes enum.` ) }\r\n\r\n        this._mode = value\r\n\r\n        // Reset gizmos visibility\r\n        for ( let mode in this._gizmos ) {\r\n            this._gizmos[ mode ].visible = false\r\n        }\r\n\r\n        if ( this._mode === ClippingModes.None ) {\r\n\r\n            this._currentGizmo = null\r\n\r\n        } else {\r\n\r\n            this._currentGizmo         = this._gizmos[ this._mode.name ]\r\n            this._currentGizmo.visible = true\r\n\r\n        }\r\n\r\n    }\r\n\r\n    setCamera ( value ) {\r\n\r\n        this.camera = value\r\n        return this\r\n\r\n    }\r\n\r\n    setDomElement ( value ) {\r\n\r\n        this.domElement = value\r\n        return this\r\n\r\n    }\r\n\r\n    setMode ( value ) {\r\n\r\n        this.mode = value\r\n        return this\r\n\r\n    }\r\n\r\n    setObjectsToClip ( objects ) {\r\n\r\n        this.objectsToClip = objects\r\n        return this\r\n\r\n    }\r\n\r\n    impose () {\r\n\r\n        this._domElement.addEventListener( 'keydown', this._handlers.onKeyDown, false )\r\n        this._domElement.addEventListener( 'keyup', this._handlers.onKeyUp, false )\r\n\r\n        this._domElement.addEventListener( 'dblclick', this._handlers.onDblClick, false )\r\n        this._domElement.addEventListener( 'mousedown', this._handlers.onMouseDown, false )\r\n        this._domElement.addEventListener( 'mousemove', this._handlers.onMouseMove, false )\r\n        this._domElement.addEventListener( 'mouseup', this._handlers.onMouseUp, false )\r\n        this._domElement.addEventListener( 'wheel', this._handlers.onMouseWheel, {\r\n            capture: true,\r\n            once:    false,\r\n            passive: false\r\n        } )\r\n\r\n        this._domElement.addEventListener( 'touchcancel', this._handlers.onTouchCancel, false )\r\n        this._domElement.addEventListener( 'touchend', this._handlers.onTouchEnd, false )\r\n        this._domElement.addEventListener( 'touchleave', this._handlers.onTouchLeave, false )\r\n        this._domElement.addEventListener( 'touchmove', this._handlers.onTouchMove, {\r\n            capture: true,\r\n            once:    false,\r\n            passive: false\r\n        } )\r\n        this._domElement.addEventListener( 'touchstart', this._handlers.onTouchStart, {\r\n            capture: true,\r\n            once:    false,\r\n            passive: false\r\n        } )\r\n\r\n        this.dispatchEvent( { type: 'impose' } )\r\n\r\n    }\r\n\r\n    dispose () {\r\n\r\n        this._domElement.removeEventListener( 'keydown', this._handlers.onKeyDown, false )\r\n        this._domElement.removeEventListener( 'keyup', this._handlers.onKeyUp, false )\r\n\r\n        this._domElement.removeEventListener( 'dblclick', this._handlers.onDblClick, false )\r\n        this._domElement.removeEventListener( 'mousedown', this._handlers.onMouseDown, false )\r\n        this._domElement.removeEventListener( 'mousemove', this._handlers.onMouseMove, false )\r\n        this._domElement.removeEventListener( 'mouseup', this._handlers.onMouseUp, false )\r\n        this._domElement.removeEventListener( 'wheel', this._handlers.onMouseWheel, {\r\n            capture: true,\r\n            once:    false,\r\n            passive: false\r\n        } )\r\n\r\n        this._domElement.removeEventListener( 'touchcancel', this._handlers.onTouchCancel, false )\r\n        this._domElement.removeEventListener( 'touchend', this._handlers.onTouchEnd, false )\r\n        this._domElement.removeEventListener( 'touchleave', this._handlers.onTouchLeave, false )\r\n        this._domElement.removeEventListener( 'touchmove', this._handlers.onTouchMove, {\r\n            capture: true,\r\n            once:    false,\r\n            passive: false\r\n        } )\r\n        this._domElement.removeEventListener( 'touchstart', this._handlers.onTouchStart, {\r\n            capture: true,\r\n            once:    false,\r\n            passive: false\r\n        } )\r\n\r\n        this.dispatchEvent( { type: 'dispose' } )\r\n\r\n    }\r\n\r\n    setTranslationSnap ( translationSnap ) {\r\n        this.translationSnap = translationSnap\r\n    }\r\n\r\n    setRotationSnap ( rotationSnap ) {\r\n        this.rotationSnap = rotationSnap\r\n    }\r\n\r\n    enable () {\r\n\r\n        this.visible = true\r\n        this.enabled = true\r\n        this.updateClipping()\r\n\r\n    }\r\n\r\n    disable () {\r\n\r\n        this.visible = false\r\n        this.enabled = false\r\n        this.updateClipping()\r\n\r\n    }\r\n\r\n    updateClipping () {\r\n\r\n        if ( isNotDefined( this._objectsToClip ) ) { return }\r\n\r\n        this._clippingBox.update()\r\n        this._clippingBox.applyClippingTo( this.enabled, this._objectsToClip )\r\n\r\n    }\r\n\r\n    update () {\r\n\r\n        if ( !this.enabled ) { return }\r\n        if ( this._mode === ClippingModes.None ) { return }\r\n        if ( isNotDefined( this._currentGizmo ) ) { return }\r\n\r\n        this._camera.getWorldPosition( this._cameraPosition )\r\n        this._camera.getWorldDirection( this._cameraDirection )\r\n        this._currentGizmo.update( this._cameraPosition, this._cameraDirection )\r\n\r\n    }\r\n\r\n    /// Handlers\r\n    _consumeEvent ( event ) {\r\n\r\n        if ( !event.cancelable ) {\r\n            return\r\n        }\r\n\r\n        event.stopImmediatePropagation()\r\n\r\n    }\r\n\r\n    // Keyboard\r\n    _onKeyDown ( keyEvent ) {\r\n\r\n        if ( !this.enabled ) { return }\r\n        keyEvent.preventDefault()\r\n\r\n        const actionMap   = this.actionsMap\r\n        const key         = keyEvent.keyCode\r\n        const altActive   = keyEvent.altKey\r\n        const ctrlActive  = keyEvent.ctrlKey\r\n        const metaActive  = keyEvent.metaKey\r\n        const shiftActive = keyEvent.shiftKey\r\n\r\n        if ( altActive ) {\r\n\r\n        } else if ( ctrlActive ) {\r\n\r\n            switch ( this._mode ) {\r\n\r\n                case ClippingModes.Translate:\r\n\r\n                    if ( actionMap.translate.front.includes( key ) ) {\r\n\r\n                        this._translateZ( this.translationSnap )\r\n                        this.updateClipping()\r\n                        this._consumeEvent( keyEvent )\r\n                        this.dispatchEvent( this._events.objectChange )\r\n\r\n                    } else if ( actionMap.translate.back.includes( key ) ) {\r\n\r\n                        this._translateZ( -this.translationSnap )\r\n                        this.updateClipping()\r\n                        this._consumeEvent( keyEvent )\r\n                        this.dispatchEvent( this._events.objectChange )\r\n\r\n                    } else if ( actionMap.translate.right.includes( key ) ) {\r\n\r\n                        this._translateX( this.translationSnap )\r\n                        this.updateClipping()\r\n                        this._consumeEvent( keyEvent )\r\n                        this.dispatchEvent( this._events.objectChange )\r\n\r\n                    } else if ( actionMap.translate.left.includes( key ) ) {\r\n\r\n                        this._translateX( -this.translationSnap )\r\n                        this.updateClipping()\r\n                        this._consumeEvent( keyEvent )\r\n                        this.dispatchEvent( this._events.objectChange )\r\n\r\n                    } else if ( actionMap.translate.up.includes( key ) ) {\r\n\r\n                        this._translateY( this.translationSnap )\r\n                        this.updateClipping()\r\n                        this._consumeEvent( keyEvent )\r\n                        this.dispatchEvent( this._events.objectChange )\r\n\r\n                    } else if ( actionMap.translate.down.includes( key ) ) {\r\n\r\n                        this._translateY( -this.translationSnap )\r\n                        this.updateClipping()\r\n                        this._consumeEvent( keyEvent )\r\n                        this.dispatchEvent( this._events.objectChange )\r\n\r\n                    }\r\n\r\n                    break\r\n\r\n                case ClippingModes.Rotate:\r\n\r\n                    break\r\n\r\n                case ClippingModes.Scale:\r\n\r\n                    if ( actionMap.scale.depthPlus.includes( key ) ) {\r\n\r\n                        this._scaleZ( this.scaleSnap )\r\n                        this.updateClipping()\r\n                        this._consumeEvent( keyEvent )\r\n                        this.dispatchEvent( this._events.objectChange )\r\n\r\n                    } else if ( actionMap.scale.depthMinus.includes( key ) ) {\r\n\r\n                        this._scaleZ( -this.scaleSnap )\r\n                        this.updateClipping()\r\n                        this._consumeEvent( keyEvent )\r\n                        this.dispatchEvent( this._events.objectChange )\r\n\r\n                    } else if ( actionMap.scale.widthPlus.includes( key ) ) {\r\n\r\n                        this._scaleX( this.scaleSnap )\r\n                        this.updateClipping()\r\n                        this._consumeEvent( keyEvent )\r\n                        this.dispatchEvent( this._events.objectChange )\r\n\r\n                    } else if ( actionMap.scale.widthMinus.includes( key ) ) {\r\n\r\n                        this._scaleX( -this.scaleSnap )\r\n                        this.updateClipping()\r\n                        this._consumeEvent( keyEvent )\r\n                        this.dispatchEvent( this._events.objectChange )\r\n\r\n                    } else if ( actionMap.scale.heightPlus.includes( key ) ) {\r\n\r\n                        this._scaleY( this.scaleSnap )\r\n                        this.updateClipping()\r\n                        this._consumeEvent( keyEvent )\r\n                        this.dispatchEvent( this._events.objectChange )\r\n\r\n                    } else if ( actionMap.scale.heightMinus.includes( key ) ) {\r\n\r\n                        this._scaleY( -this.scaleSnap )\r\n                        this.updateClipping()\r\n                        this._consumeEvent( keyEvent )\r\n                        this.dispatchEvent( this._events.objectChange )\r\n\r\n                    }\r\n\r\n                    break\r\n\r\n                default:\r\n                    break\r\n\r\n            }\r\n\r\n        } else if ( metaActive ) {\r\n        } else if ( shiftActive ) {\r\n        } else if ( actionMap.setMode.translate.includes( key ) ) {\r\n\r\n            this.setMode( ClippingModes.Translate )\r\n            this.updateClipping()\r\n            this._consumeEvent( keyEvent )\r\n\r\n        } else if ( actionMap.setMode.rotate.includes( key ) ) {\r\n\r\n            this.setMode( ClippingModes.Rotate )\r\n            this.updateClipping()\r\n            this._consumeEvent( keyEvent )\r\n\r\n        } else if ( actionMap.setMode.scale.includes( key ) ) {\r\n\r\n            this.setMode( ClippingModes.Scale )\r\n            this.updateClipping()\r\n            this._consumeEvent( keyEvent )\r\n\r\n        }\r\n\r\n    }\r\n\r\n    _onKeyUp ( keyEvent ) {\r\n\r\n        if ( !this.enabled || keyEvent.defaultPrevented ) { return }\r\n        keyEvent.preventDefault()\r\n\r\n        // Todo...\r\n\r\n    }\r\n\r\n    // Mouse\r\n    _onDblClick ( mouseEvent ) {\r\n\r\n        if ( !this.enabled ) { return }\r\n        if ( this._mode === ClippingModes.None ) { return }\r\n        mouseEvent.preventDefault()\r\n\r\n        // Todo...\r\n\r\n    }\r\n\r\n    _onMouseDown ( mouseEvent ) {\r\n\r\n        if ( !this.enabled ) { return }\r\n        if ( this._mode === ClippingModes.None ) { return }\r\n        if ( mouseEvent.button !== Mouse.LEFT.value ) { return }\r\n        if ( isNotDefined( this._currentHandle ) ) { return }\r\n\r\n        mouseEvent.preventDefault()\r\n\r\n        this._dragging = true\r\n\r\n        // Set the current plane to intersect with mouse\r\n        // Add first reference to mouse position for next usage under mouse move\r\n        const planeIntersect = this.intersectObjects( mouseEvent, [ this._currentGizmo.intersectPlane ] )\r\n        if ( planeIntersect ) {\r\n            this._firstPoint = planeIntersect.point\r\n        }\r\n\r\n        this._consumeEvent( mouseEvent )\r\n        this.dispatchEvent( this._events.mouseDown )\r\n\r\n    }\r\n\r\n    _onMouseEnter ( mouseEvent ) {\r\n\r\n        if ( !this.enabled ) { return }\r\n        if ( this._mode === ClippingModes.None ) { return }\r\n        mouseEvent.preventDefault()\r\n\r\n        this.impose()\r\n        if ( mouseEvent.target.constructor !== HTMLDocument ) {\r\n            this._domElement.focus()\r\n        }\r\n\r\n    }\r\n\r\n    _onMouseLeave ( mouseEvent ) {\r\n\r\n        if ( !this.enabled ) { return }\r\n        if ( this._mode === ClippingModes.None ) { return }\r\n        mouseEvent.preventDefault()\r\n\r\n        this._dragging = false\r\n\r\n        if ( mouseEvent.target.constructor !== HTMLDocument ) {\r\n            this._domElement.blur()\r\n        }\r\n        this.dispose()\r\n\r\n    }\r\n\r\n    _onMouseMove ( mouseEvent ) {\r\n\r\n        if ( !this.enabled ) { return }\r\n        if ( this._mode === ClippingModes.None ) { return }\r\n\r\n        mouseEvent.preventDefault()\r\n\r\n        // Check for hovering or not\r\n        if ( this._dragging === false ) {\r\n\r\n            // Check mouseIn\r\n            const intersect = this.intersectObjects( mouseEvent, this._currentGizmo.handles.children )\r\n            if ( intersect ) {\r\n\r\n                const handle = intersect.object\r\n\r\n                // Check if a previous handle is already selected\r\n                if ( this._currentHandle && handle !== this._currentHandle ) {\r\n                    this._currentHandle.highlight( false )\r\n                    this.dispatchEvent( this._events.mouseLeave )\r\n                }\r\n\r\n                this._currentHandle = handle\r\n                this._currentHandle.highlight( true )\r\n                this.dispatchEvent( this._events.mouseEnter )\r\n\r\n                this._consumeEvent( mouseEvent )\r\n\r\n            } else if ( isDefined( this._currentHandle ) ) {\r\n\r\n                this._currentHandle.highlight( false )\r\n                this._currentHandle = null\r\n                this.dispatchEvent( this._events.mouseLeave )\r\n\r\n            }\r\n\r\n        } else {\r\n\r\n            const currentHandle     = this._currentHandle\r\n            const currentHandleName = currentHandle.name\r\n\r\n            const planeIntersect = this.intersectObjects( mouseEvent, [ this._currentGizmo.intersectPlane ] )\r\n            if ( planeIntersect ) {\r\n\r\n                this._secondPoint = planeIntersect.point\r\n\r\n            }\r\n\r\n            // Update the mouse displacement in world coordinates\r\n            this._mouseDisplacement.subVectors( this._secondPoint, this._firstPoint )\r\n            this._firstPoint.copy( this._secondPoint )\r\n\r\n            // Apply change\r\n            switch ( this._mode ) {\r\n\r\n                case ClippingModes.Translate:\r\n\r\n                    if ( currentHandleName === 'X' ) {\r\n\r\n                        this._offset.set( 1, 0, 0 )\r\n\r\n                    } else if ( currentHandleName === 'Y' ) {\r\n\r\n                        this._offset.set( 0, 1, 0 )\r\n\r\n                    } else if ( currentHandleName === 'Z' ) {\r\n\r\n                        this._offset.set( 0, 0, 1 )\r\n\r\n                    } else if ( currentHandleName === 'XY' ) {\r\n\r\n                        this._offset.set( 1, 1, 0 )\r\n\r\n                    } else if ( currentHandleName === 'YZ' ) {\r\n\r\n                        this._offset.set( 0, 1, 1 )\r\n\r\n                    } else if ( currentHandleName === 'XZ' ) {\r\n\r\n                        this._offset.set( 1, 0, 1 )\r\n\r\n                    } else if ( currentHandleName === 'XYZ' ) {\r\n\r\n                        this._offset.set( 1, 1, 1 )\r\n\r\n                    }\r\n\r\n                    this._offset.multiply( this._mouseDisplacement )\r\n                    this._translate( this._offset )\r\n                    break\r\n\r\n                case ClippingModes.Rotate:\r\n\r\n                    if ( currentHandle.isRotateHandle ) {\r\n\r\n                    } else if ( currentHandle.isPlaneHandle ) {\r\n\r\n                    } else if ( currentHandle.isOmnidirectionalHandle ) {\r\n\r\n                    }\r\n\r\n                    break\r\n\r\n                case ClippingModes.Scale:\r\n\r\n                    if ( currentHandle.isScaleHandle ) {\r\n\r\n                        this._offset\r\n                            .copy( this._currentHandle.direction )\r\n                            .multiply( this._mouseDisplacement )\r\n\r\n                    } else if ( currentHandle.isPlaneHandle ) {\r\n\r\n                        const xDot = this._currentHandle.xDirection.dot( this._mouseDisplacement )\r\n                        if ( xDot > 0 ) {\r\n                            this._offset.setX( Math.abs( this._mouseDisplacement.x ) )\r\n                        } else if ( xDot < 0 ) {\r\n                            this._offset.setX( -Math.abs( this._mouseDisplacement.x ) )\r\n                        } else {\r\n                            this._offset.setX( 0 )\r\n                        }\r\n\r\n                        const yDot = this._currentHandle.yDirection.dot( this._mouseDisplacement )\r\n                        if ( yDot > 0 ) {\r\n                            this._offset.setY( Math.abs( this._mouseDisplacement.y ) )\r\n                        } else if ( yDot < 0 ) {\r\n                            this._offset.setY( -Math.abs( this._mouseDisplacement.y ) )\r\n                        } else {\r\n                            this._offset.setY( 0 )\r\n                        }\r\n\r\n                        const zDot = this._currentHandle.zDirection.dot( this._mouseDisplacement )\r\n                        if ( zDot > 0 ) {\r\n                            this._offset.setZ( Math.abs( this._mouseDisplacement.z ) )\r\n                        } else if ( zDot < 0 ) {\r\n                            this._offset.setZ( -Math.abs( this._mouseDisplacement.z ) )\r\n                        } else {\r\n                            this._offset.setZ( 0 )\r\n                        }\r\n\r\n                    } else if ( currentHandle.isOmnidirectionalHandle ) {\r\n\r\n                        this.getWorldPosition( this._worldPosition )\r\n                        this._directionToMouse.subVectors( this._firstPoint, this._worldPosition )\r\n                        const worldDot = this._directionToMouse.dot( this._mouseDisplacement )\r\n                        const length   = ( worldDot > 0 ) ? this._mouseDisplacement.length() : -this._mouseDisplacement.length()\r\n                        this._offset.set( length, length, length )\r\n\r\n                    }\r\n\r\n                    this._scale( this._offset )\r\n                    break\r\n\r\n                default:\r\n                    throw new RangeError( `Invalid switch parameter: ${this._mode}` )\r\n                    break\r\n\r\n            }\r\n\r\n            this.updateClipping()\r\n            this._consumeEvent( mouseEvent )\r\n            this.dispatchEvent( this._events.objectChange )\r\n\r\n        }\r\n\r\n    }\r\n\r\n    _onMouseUp ( mouseEvent ) {\r\n\r\n        if ( !this.enabled ) { return }\r\n        if ( this._mode === ClippingModes.None ) { return }\r\n        if ( event.button !== Mouse.LEFT.value ) { return }\r\n\r\n        mouseEvent.preventDefault()\r\n        this._consumeEvent( mouseEvent )\r\n\r\n        this._dragging = false\r\n        this.dispatchEvent( this._events.mouseUp )\r\n\r\n        // Check mouseIn\r\n        const intersect = this.intersectObjects( mouseEvent, this._currentGizmo.handles.children )\r\n        if ( intersect ) {\r\n\r\n            const handle = intersect.object\r\n\r\n            this._currentHandle = handle\r\n            this._currentHandle.highlight( true )\r\n\r\n            this._consumeEvent( mouseEvent )\r\n            this.dispatchEvent( this._events.mouseEnter )\r\n\r\n        } else if ( isDefined( this._currentHandle ) ) {\r\n\r\n            this._currentHandle.highlight( false )\r\n            this._currentHandle = null\r\n\r\n            this.dispatchEvent( this._events.mouseLeave )\r\n\r\n        }\r\n\r\n    }\r\n\r\n    _onMouseWheel ( mouseEvent ) {\r\n\r\n        if ( !this.enabled ) { return }\r\n        mouseEvent.preventDefault()\r\n\r\n        // Todo...\r\n\r\n    }\r\n\r\n    // Touche\r\n    _onTouchCancel ( touchEvent ) {\r\n\r\n        if ( !this.enabled ) { return }\r\n        touchEvent.preventDefault()\r\n\r\n        // Todo...\r\n\r\n    }\r\n\r\n    _onTouchEnd ( touchEvent ) {\r\n\r\n        if ( !this.enabled ) { return }\r\n        touchEvent.preventDefault()\r\n\r\n        // Todo...\r\n\r\n    }\r\n\r\n    _onTouchLeave ( touchEvent ) {\r\n\r\n        if ( !this.enabled ) { return }\r\n        touchEvent.preventDefault()\r\n\r\n        // Todo...\r\n\r\n    }\r\n\r\n    _onTouchMove ( touchEvent ) {\r\n\r\n        if ( !this.enabled ) { return }\r\n        touchEvent.preventDefault()\r\n\r\n        // Todo...\r\n\r\n    }\r\n\r\n    _onTouchStart ( touchEvent ) {\r\n\r\n        if ( !this.enabled ) { return }\r\n        touchEvent.preventDefault()\r\n\r\n        // Todo...\r\n\r\n    }\r\n\r\n    /// Utils\r\n    getActiveHandle ( pointer ) {\r\n\r\n    }\r\n\r\n    intersectObjects ( pointer, objects ) {\r\n\r\n        // calculate mouse position in normalized device coordinates\r\n        // (-1 to +1) for both components\r\n        /*\r\n         const mousePositionX  = mouseEvent.layerX || mouseEvent.offsetX || 1\r\n         const mousePositionY  = mouseEvent.layerY || mouseEvent.offsetY || 1\r\n         const containerWidth  = this._domElement.offsetWidth\r\n         const containerHeight = this._domElement.offsetHeight\r\n         const x               = ( mousePositionX / containerWidth ) * 2 - 1\r\n         const y               = -( mousePositionY / containerHeight ) * 2 + 1\r\n         */\r\n\r\n        const clientRect = this._domElement.getBoundingClientRect()\r\n        const x          = ( ( ( pointer.clientX - clientRect.left ) / clientRect.width ) * 2 ) - 1\r\n        const y          = ( -( ( pointer.clientY - clientRect.top ) / clientRect.height ) * 2 ) + 1\r\n\r\n        this._pointerVector.set( x, y )\r\n        this._raycaster.setFromCamera( this._pointerVector, this._camera )\r\n\r\n        const intersections = this._raycaster.intersectObjects( objects, false )\r\n        return intersections[ 0 ] ? intersections[ 0 ] : null\r\n\r\n    }\r\n\r\n    // Methods\r\n\r\n    // Moving\r\n    _translate ( displacement ) {\r\n\r\n        this.position.add( displacement )\r\n\r\n    }\r\n\r\n    _translateX ( deltaX ) {\r\n\r\n        this.position.setX( this.position.x + deltaX )\r\n\r\n    }\r\n\r\n    _translateY ( deltaY ) {\r\n\r\n        this.position.setY( this.position.y + deltaY )\r\n\r\n    }\r\n\r\n    _translateZ ( deltaZ ) {\r\n\r\n        this.position.setZ( this.position.z + deltaZ )\r\n\r\n    }\r\n\r\n    _translateXY ( deltaX, deltaY ) {\r\n\r\n        this.position.setX( this.position.x + deltaX )\r\n        this.position.setY( this.position.y + deltaY )\r\n\r\n    }\r\n\r\n    _translateXZ ( deltaX, deltaZ ) {\r\n\r\n        this.position.setX( this.position.x + deltaX )\r\n        this.position.setZ( this.position.z + deltaZ )\r\n\r\n    }\r\n\r\n    _translateYZ ( deltaY, deltaZ ) {\r\n\r\n        this.position.setY( this.position.y + deltaY )\r\n        this.position.setZ( this.position.z + deltaZ )\r\n\r\n    }\r\n\r\n    _translateXYZ ( deltaX, deltaY, deltaZ ) {\r\n\r\n        this.position.set( this.position.x + deltaX, this.position.y + deltaY, this.position.z + deltaZ )\r\n\r\n    }\r\n\r\n    // Rotating\r\n    _rotateX ( delta ) {}\r\n\r\n    _rotateY ( delta ) {}\r\n\r\n    _rotateZ ( delta ) {}\r\n\r\n    _rotateXY ( delta ) {}\r\n\r\n    _rotateXZ ( delta ) {}\r\n\r\n    _rotateYZ ( delta ) {}\r\n\r\n    _rotateXYZ ( delta ) {}\r\n\r\n    // Scaling\r\n    _scale ( changeAmout ) {\r\n\r\n        this.scale.add( changeAmout )\r\n\r\n    }\r\n\r\n    _scaleX ( deltaX ) {\r\n\r\n        this.scale.setX( this.scale.x + deltaX )\r\n\r\n    }\r\n\r\n    _scaleY ( deltaY ) {\r\n\r\n        this.scale.setY( this.scale.y + deltaY )\r\n\r\n    }\r\n\r\n    _scaleZ ( deltaZ ) {\r\n\r\n        this.scale.setZ( this.scale.z + deltaZ )\r\n\r\n    }\r\n\r\n    _scaleXY ( deltaX, deltaY ) {\r\n\r\n        this.scale.setX( this.scale.x + deltaX )\r\n        this.scale.setY( this.scale.y + deltaY )\r\n\r\n    }\r\n\r\n    _scaleXZ ( deltaX, deltaZ ) {\r\n\r\n        this.scale.setX( this.scale.x + deltaX )\r\n        this.scale.setZ( this.scale.z + deltaZ )\r\n\r\n    }\r\n\r\n    _scaleYZ ( deltaY, deltaZ ) {\r\n\r\n        this.scale.setY( this.scale.y + deltaY )\r\n        this.scale.setZ( this.scale.z + deltaZ )\r\n\r\n    }\r\n\r\n    _scaleXYZ ( deltaX, deltaY, deltaZ ) {\r\n\r\n        this.scale.set( this.scale.x + deltaX, this.scale.y + deltaY, this.scale.z + deltaZ )\r\n\r\n    }\r\n\r\n}\r\n\r\nexport {\r\n    ClippingBox,\r\n    HighlightableMaterial,\r\n    HighlightableLineMaterial,\r\n    AbstractGizmo,\r\n    TranslateGizmo,\r\n    RotateGizmo,\r\n    ScaleGizmo,\r\n    ClippingModes,\r\n    ClippingControls\r\n}\r\n","/**\r\n * @author [Tristan Valcke]{@link https://github.com/Itee}\r\n * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}\r\n *\r\n * @file Todo\r\n *\r\n * @example Todo\r\n *\r\n */\r\n\r\nimport { TDataBaseManager } from 'itee-client'\r\nimport { isObject }         from 'itee-validators'\r\nimport {\r\n    Object3D,\r\n    Scene\r\n}                           from 'three-full'\r\n\r\n/**\r\n *\r\n * @constructor\r\n */\r\nfunction BufferGeometriesManager () {\r\n\r\n    TDataBaseManager.call( this )\r\n    this.basePath = '/buffergeometries'\r\n\r\n}\r\n\r\nBufferGeometriesManager.prototype = Object.assign( Object.create( TDataBaseManager.prototype ), {\r\n\r\n    /**\r\n     *\r\n     */\r\n    constructor: BufferGeometriesManager,\r\n\r\n    /**\r\n     *\r\n     * @param jsonData\r\n     * @param onError\r\n     * @return {*}\r\n     */\r\n    convert ( data, onError ) {\r\n\r\n        const textureType = data.type\r\n        let texture       = undefined\r\n\r\n        switch ( textureType ) {\r\n\r\n            case 'Scene':\r\n                texture = new Scene()\r\n                break\r\n\r\n            default:\r\n                texture = new Object3D()\r\n                break\r\n\r\n        }\r\n\r\n        // Common object properties\r\n\r\n        if ( textureType === 'Line' ) {\r\n\r\n        }\r\n\r\n        return texture\r\n\r\n    }\r\n\r\n} )\r\n\r\nObject.defineProperties( BufferGeometriesManager.prototype, {\r\n\r\n    /**\r\n     *\r\n     */\r\n    _onJson: {\r\n        value: function _onJson ( jsonData, onSuccess, onProgress, onError ) {\r\n\r\n            // Normalize to array\r\n            const datas   = ( isObject( jsonData ) ) ? [ jsonData ] : jsonData\r\n            const results = {}\r\n            let result    = undefined\r\n\r\n            for ( let dataIndex = 0, numberOfDatas = datas.length, data = undefined ; dataIndex < numberOfDatas ; dataIndex++ ) {\r\n\r\n                data   = datas[ dataIndex ]\r\n                result = this.convert( data, onError )\r\n                if ( result ) { results[ data._id ] = result }\r\n\r\n                onProgress( dataIndex / numberOfDatas )\r\n\r\n            }\r\n\r\n            onSuccess( results )\r\n\r\n        }\r\n    }\r\n\r\n} )\r\n\r\nexport { BufferGeometriesManager }\r\n","/**\r\n * @author [Tristan Valcke]{@link https://github.com/Itee}\r\n * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}\r\n *\r\n * @file Todo\r\n *\r\n * @example Todo\r\n *\r\n */\r\n\r\nimport { TDataBaseManager } from 'itee-client'\r\nimport { isObject }         from 'itee-validators'\r\nimport {\r\n    ArcCurve,\r\n    CatmullRomCurve3,\r\n    CubicBezierCurve,\r\n    CubicBezierCurve3,\r\n    Curve,\r\n    CurvePath,\r\n    EllipseCurve,\r\n    LineCurve,\r\n    LineCurve3,\r\n    Path,\r\n    QuadraticBezierCurve,\r\n    QuadraticBezierCurve3,\r\n    Shape,\r\n    SplineCurve\r\n}                           from 'three-full'\r\n\r\n/**\r\n *\r\n * @constructor\r\n */\r\nfunction CurvesManager () {\r\n\r\n    TDataBaseManager.call( this )\r\n    this.basePath = '/curves'\r\n\r\n}\r\n\r\nCurvesManager.prototype = Object.assign( Object.create( TDataBaseManager.prototype ), {\r\n\r\n    /**\r\n     *\r\n     */\r\n    constructor: CurvesManager,\r\n\r\n    /**\r\n     *\r\n     * @param data\r\n     * @return {*}\r\n     */\r\n    convert ( data ) {\r\n\r\n        if ( !data ) {\r\n            throw new Error( 'CurvesManager: Unable to convert null or undefined data !' )\r\n        }\r\n\r\n        const curveType = data.type\r\n        let curve       = undefined\r\n\r\n        switch ( curveType ) {\r\n\r\n            case 'ArcCurve':\r\n                curve = new ArcCurve()\r\n                break\r\n\r\n            case 'CatmullRomCurve3':\r\n                curve = new CatmullRomCurve3()\r\n                break\r\n\r\n            case 'CubicBezierCurve':\r\n                curve = new CubicBezierCurve()\r\n                break\r\n\r\n            case 'CubicBezierCurve3':\r\n                curve = new CubicBezierCurve3()\r\n                break\r\n\r\n            case 'Curve':\r\n                curve = new Curve()\r\n                break\r\n\r\n            case 'CurvePath':\r\n                curve = new CurvePath()\r\n                break\r\n\r\n            case 'EllipseCurve':\r\n                curve = new EllipseCurve()\r\n                break\r\n\r\n            case 'LineCurve':\r\n                curve = new LineCurve()\r\n                break\r\n\r\n            case 'LineCurve3':\r\n                curve = new LineCurve3()\r\n                break\r\n\r\n            // Missing NURBSCurve\r\n\r\n            case 'Path':\r\n                curve = new Path()\r\n                break\r\n\r\n            case 'QuadraticBezierCurve':\r\n                curve = new QuadraticBezierCurve()\r\n                break\r\n\r\n            case 'QuadraticBezierCurve3':\r\n                curve = new QuadraticBezierCurve3()\r\n                break\r\n\r\n            case 'SplineCurve':\r\n                curve = new SplineCurve()\r\n                break\r\n\r\n            case 'Shape':\r\n                curve = new Shape()\r\n                break\r\n\r\n            default:\r\n                throw new Error( `TCurvesManager: Unknown curve of type: ${curveType}` )\r\n                break\r\n\r\n        }\r\n\r\n        curve.fromJSON( data )\r\n\r\n        return curve\r\n\r\n    }\r\n\r\n} )\r\n\r\nObject.defineProperties( CurvesManager.prototype, {\r\n\r\n    /**\r\n     *\r\n     */\r\n    _onJson: {\r\n        value: function _onJson ( jsonData, onSuccess, onProgress, onError ) {\r\n\r\n            // Normalize to array\r\n            const datas   = ( isObject( jsonData ) ) ? [ jsonData ] : jsonData\r\n            const results = {}\r\n\r\n            for ( let dataIndex = 0, numberOfDatas = datas.length, data = undefined ; dataIndex < numberOfDatas ; dataIndex++ ) {\r\n\r\n                data = datas[ dataIndex ]\r\n\r\n                try {\r\n                    results[ data._id ] = this.convert( data )\r\n                } catch ( err ) {\r\n                    onError( err )\r\n                }\r\n\r\n                onProgress( dataIndex / numberOfDatas )\r\n\r\n            }\r\n\r\n            onSuccess( results )\r\n\r\n        }\r\n    }\r\n\r\n} )\r\n\r\nexport { CurvesManager }\r\n","/**\r\n * @author [Ahmed DCHAR]{@link https://github.com/Dragoneel}\r\n * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}\r\n *\r\n * @class ClassName\r\n * @classdesc Todo...\r\n * @example Todo...\r\n *\r\n */\r\n\r\n/* eslint-env browser */\r\n\r\nimport {\r\n    DefaultLogger as TLogger,\r\n    ResponseType,\r\n    TDataBaseManager\r\n} from 'itee-client'\r\nimport {\r\n    isNotDefined,\r\n    isObject\r\n} from 'itee-validators'\r\nimport {\r\n    BufferGeometry,\r\n    Float32BufferAttribute,\r\n    Line,\r\n    LineBasicMaterial,\r\n    Mesh,\r\n    MeshPhongMaterial,\r\n    SphereBufferGeometry\r\n} from 'three-full'\r\n\r\nclass FilairesManager extends TDataBaseManager {\r\n\r\n    /**\r\n     *\r\n     * @param basePath\r\n     * @param responseType\r\n     * @param bunchSize\r\n     * @param progressManager\r\n     * @param errorManager\r\n     */\r\n    constructor ( parameters = {} ) {\r\n\r\n        const _parameters = {\r\n            ...{\r\n                basePath:               '/',\r\n                responseType:           ResponseType.Json,\r\n                bunchSize:              500,\r\n                requestAggregationTime: 200,\r\n                requestsConcurrency:    6,\r\n                logger:                 TLogger\r\n            }, ...parameters\r\n        }\r\n\r\n        super( _parameters )\r\n\r\n    }\r\n\r\n    //// Methods\r\n\r\n    _onJson ( jsonData, onSuccess, onProgress, onError ) {\r\n\r\n        // Normalize to array\r\n        const datas   = ( isObject( jsonData ) ) ? [ jsonData ] : jsonData\r\n        const results = {}\r\n\r\n        for ( let dataIndex = 0, numberOfDatas = datas.length, data = undefined ; dataIndex < numberOfDatas ; dataIndex++ ) {\r\n\r\n            data = datas[ dataIndex ]\r\n\r\n            try {\r\n                results[ data.id ] = this.convert( data )\r\n            } catch ( err ) {\r\n                onError( err )\r\n            }\r\n\r\n            onProgress( new ProgressEvent( 'FilairesManager', {\r\n                lengthComputable: true,\r\n                loaded:           dataIndex + 1,\r\n                total:            numberOfDatas\r\n            } ) )\r\n\r\n        }\r\n\r\n        onSuccess( results )\r\n\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param data\r\n     * @return {*}\r\n     */\r\n    convert ( data ) {\r\n\r\n        if ( !data ) {\r\n            throw new Error( 'FilairesManager: Unable to convert null or undefined data !' )\r\n        }\r\n\r\n        const objectType = data.type\r\n        let object       = null\r\n\r\n        if ( isNotDefined( objectType ) ) {\r\n            throw new Error( `TFilaireManager.convert() : data type must be defined !!!` )\r\n        }\r\n\r\n        switch ( objectType ) {\r\n\r\n            case 'NaissanceVoute':\r\n                object = this._parseFilaire( data, 0x875100 )\r\n                break\r\n\r\n            case 'Radier':\r\n                object = this._parseFilaire( data, 0x0089af )\r\n                break\r\n\r\n            case 'Intrados':\r\n                object = this._parseFilaire( data, 0xc100b4 )\r\n                break\r\n\r\n            case 'Br':\r\n            case 'Bp':\r\n            case 'Src':\r\n                object = this._parsePoint( data, 0x00ff00 )\r\n                break\r\n\r\n            default:\r\n                throw new Error( `TFilaireManager: Unknown object of type: ${objectType}` )\r\n\r\n        }\r\n\r\n        return object\r\n\r\n    }\r\n\r\n    _parseFilaire ( data, color ) {\r\n\r\n        const geoJson   = JSON.parse( data.geojson )\r\n        const positions = geoJson.coordinates.reduce( ( acc, val ) => acc.concat( val ), [] )\r\n\r\n        if ( isNotDefined( positions ) ) {\r\n            throw new Error( `TFilaireManager._parseFilaire() : ${data.type} geometry doesn't contains coordinates !!!` )\r\n        }\r\n\r\n        const material = new LineBasicMaterial( {\r\n            color: color\r\n        } )\r\n\r\n        const bufferGeometry = new BufferGeometry()\r\n        bufferGeometry.addAttribute( 'position', new Float32BufferAttribute( positions, 3 ) )\r\n\r\n        let object = new Line( bufferGeometry, material )\r\n        if ( !isNotDefined( data.type ) ) {\r\n            object.name = ''.concat( data.type, '_' ).concat( data.numero_bloc, '_' ).concat( data.id )\r\n        } else {\r\n            object.name = ''.concat( data.id )\r\n        }\r\n\r\n        return object\r\n\r\n    }\r\n\r\n    _parsePoint ( data, color ) {\r\n\r\n        const geoJson   = JSON.parse( data.geojson )\r\n        const positions = geoJson.coordinates.reduce( ( acc, val ) => acc.concat( val ), [] )\r\n\r\n        if ( isNotDefined( positions ) ) {\r\n            throw new Error( 'FilairesManager._parsePoint() : '.concat( data.type, ' geometry doesn\\'t contains coordinates !!!' ) )\r\n        }\r\n\r\n        let geometry = new SphereBufferGeometry( parseFloat( data.attribut ), 50, 50, 0, Math.PI * 2, 0, Math.PI * 2 )\r\n        geometry.computeVertexNormals()\r\n\r\n        let material = new MeshPhongMaterial( { color: color } )\r\n        let object   = new Mesh( geometry, material )\r\n\r\n        object.position.set( positions[ '0' ], positions[ '1' ], positions[ '2' ] )\r\n\r\n        if ( !isNotDefined( data.type ) ) {\r\n            object.name = ''.concat( data.type, '_' ).concat( data.numero_bloc, '_' ).concat( data.id )\r\n        } else {\r\n            object.name = ''.concat( data.id )\r\n        }\r\n\r\n        return object\r\n\r\n    }\r\n\r\n}\r\n\r\nexport { FilairesManager }\r\n","/**\r\n * @author [Tristan Valcke]{@link https://github.com/Itee}\r\n * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}\r\n *\r\n * @class GeometriesManager\r\n * @classdesc Todo...\r\n * @example Todo...\r\n *\r\n * @requires {@link TDataBaseManager}\r\n * @requires '../../../node_modules/three/src/core/Geometry'\r\n * @requires { BufferGeometry } from 'three'\r\n * @requires '../../../node_modules/three/src/core/BufferAttribute'\r\n *\r\n */\r\n\r\n/* eslint-env browser */\r\n\r\nimport { TDataBaseManager } from 'itee-client'\r\nimport {\r\n    isDefined,\r\n    isNotBoolean,\r\n    isNull,\r\n    isObject,\r\n    isUndefined\r\n}                           from 'itee-validators'\r\nimport {\r\n    BoxBufferGeometry,\r\n    BoxGeometry,\r\n    BufferAttribute,\r\n    BufferGeometry,\r\n    CircleBufferGeometry,\r\n    CircleGeometry,\r\n    ConeBufferGeometry,\r\n    ConeGeometry,\r\n    CylinderBufferGeometry,\r\n    CylinderGeometry,\r\n    DodecahedronBufferGeometry,\r\n    DodecahedronGeometry,\r\n    EdgesGeometry,\r\n    ExtrudeBufferGeometry,\r\n    ExtrudeGeometry,\r\n    Face3,\r\n    Geometry,\r\n    IcosahedronBufferGeometry,\r\n    IcosahedronGeometry,\r\n    InstancedBufferGeometry,\r\n    LatheBufferGeometry,\r\n    LatheGeometry,\r\n    OctahedronBufferGeometry,\r\n    OctahedronGeometry,\r\n    ParametricBufferGeometry,\r\n    ParametricGeometry,\r\n    PlaneBufferGeometry,\r\n    PlaneGeometry,\r\n    PolyhedronBufferGeometry,\r\n    PolyhedronGeometry,\r\n    RingBufferGeometry,\r\n    RingGeometry,\r\n    Shape,\r\n    ShapeGeometry,\r\n    SphereBufferGeometry,\r\n    SphereGeometry,\r\n    TetrahedronBufferGeometry,\r\n    TetrahedronGeometry,\r\n    TextBufferGeometry,\r\n    TextGeometry,\r\n    TorusBufferGeometry,\r\n    TorusGeometry,\r\n    TorusKnotBufferGeometry,\r\n    TorusKnotGeometry,\r\n    TubeBufferGeometry,\r\n    TubeGeometry,\r\n    Vector3,\r\n    WireframeGeometry\r\n}                           from 'three-full'\r\n\r\nconst ArrayType = {\r\n    Int8Array:         0,\r\n    Uint8Array:        1,\r\n    Uint8ClampedArray: 2,\r\n    Int16Array:        3,\r\n    Uint16Array:       4,\r\n    Int32Array:        5,\r\n    Uint32Array:       6,\r\n    Float32Array:      7,\r\n    Float64Array:      8\r\n}\r\n\r\nclass GeometriesManager extends TDataBaseManager {\r\n\r\n    /**\r\n     *\r\n     * @param parameters\r\n     */\r\n    constructor ( parameters = {} ) {\r\n\r\n        const _parameters = {\r\n            ...{\r\n                basePath:              '/geometries',\r\n                projectionSystem:      'zBack',\r\n                globalScale:           1,\r\n                computeNormals:        true,\r\n                computeBoundingBox:    true,\r\n                computeBoundingSphere: true\r\n            }, ...parameters\r\n        }\r\n\r\n        super( _parameters )\r\n\r\n        this.projectionSystem      = _parameters.projectionSystem\r\n        this.globalScale           = _parameters.globalScale\r\n        this.computeNormals        = _parameters.computeNormals\r\n        this.computeBoundingBox    = _parameters.computeBoundingBox\r\n        this.computeBoundingSphere = _parameters.computeBoundingSphere\r\n    }\r\n\r\n    //// Getter/Setter\r\n\r\n    get computeBoundingBox () {\r\n        return this._computeBoundingBox\r\n    }\r\n\r\n    set computeBoundingBox ( value ) {\r\n        if ( isNull( value ) ) { throw new TypeError( 'Compute bounding box cannot be null ! Expect a boolean.' ) }\r\n        if ( isUndefined( value ) ) { throw new TypeError( 'Compute bounding box cannot be undefined ! Expect a boolean.' ) }\r\n        if ( isNotBoolean( value ) ) { throw new TypeError( `Compute bounding box cannot be an instance of ${value.constructor.name} ! Expect a boolean.` ) }\r\n\r\n        this._computeBoundingBox = value\r\n    }\r\n\r\n    get computeBoundingSphere () {\r\n        return this._computeBoundingSphere\r\n    }\r\n\r\n    set computeBoundingSphere ( value ) {\r\n        if ( isNull( value ) ) { throw new TypeError( 'Compute bounding sphere cannot be null ! Expect a boolean.' ) }\r\n        if ( isUndefined( value ) ) { throw new TypeError( 'Compute bounding sphere cannot be undefined ! Expect a boolean.' ) }\r\n        if ( isNotBoolean( value ) ) { throw new TypeError( `Compute bounding sphere cannot be an instance of ${value.constructor.name} ! Expect a boolean.` ) }\r\n\r\n        this._computeBoundingSphere = value\r\n    }\r\n\r\n    get computeNormals () {\r\n        return this._computeNormals\r\n    }\r\n\r\n    set computeNormals ( value ) {\r\n        if ( isNull( value ) ) { throw new TypeError( 'Compute normals cannot be null ! Expect a boolean.' ) }\r\n        if ( isUndefined( value ) ) { throw new TypeError( 'Compute normals cannot be undefined ! Expect a boolean.' ) }\r\n        if ( isNotBoolean( value ) ) { throw new TypeError( `Compute normals cannot be an instance of ${value.constructor.name} ! Expect a boolean.` ) }\r\n\r\n        this._computeNormals = value\r\n    }\r\n\r\n    get projectionSystem () {\r\n        return this._projectionSystem\r\n    }\r\n\r\n    set projectionSystem ( value ) {\r\n\r\n        if ( isNull( value ) ) { throw new TypeError( 'Projection system cannot be null ! Expect a positive number.' ) }\r\n        if ( isUndefined( value ) ) { throw new TypeError( 'Projection system cannot be undefined ! Expect a positive number.' ) }\r\n\r\n        this._projectionSystem = value\r\n\r\n    }\r\n\r\n    get globalScale () {\r\n        return this._globalScale\r\n    }\r\n\r\n    set globalScale ( value ) {\r\n\r\n        if ( isNull( value ) ) { throw new TypeError( 'Global scale cannot be null ! Expect a positive number.' ) }\r\n        if ( isUndefined( value ) ) { throw new TypeError( 'Global scale cannot be undefined ! Expect a positive number.' ) }\r\n\r\n        this._globalScale = value\r\n\r\n    }\r\n\r\n    setComputeBoundingBox ( value ) {\r\n\r\n        this.computeBoundingBox = value\r\n        return this\r\n\r\n    }\r\n\r\n    setComputeBoundingShpere ( value ) {\r\n\r\n        this.computeBoundingSphere = value\r\n        return this\r\n\r\n    }\r\n\r\n    setComputeNormals ( value ) {\r\n        this.computeNormals = value\r\n        return this\r\n    }\r\n\r\n    setProjectionSystem ( value ) {\r\n\r\n        this.projectionSystem = value\r\n        return this\r\n\r\n    }\r\n\r\n    setGlobalScale ( value ) {\r\n\r\n        this.globalScale = value\r\n        return this\r\n\r\n    }\r\n\r\n    //// Methods\r\n\r\n    _onJson ( jsonData, onSuccess, onProgress, onError ) {\r\n\r\n        // Normalize to array\r\n        const datas   = ( isObject( jsonData ) ) ? [ jsonData ] : jsonData\r\n        const results = {}\r\n\r\n        for ( let dataIndex = 0, numberOfDatas = datas.length, data = undefined ; dataIndex < numberOfDatas ; dataIndex++ ) {\r\n\r\n            data = datas[ dataIndex ]\r\n\r\n            try {\r\n                results[ data._id ] = this.convert( data )\r\n            } catch ( err ) {\r\n                onError( err )\r\n            }\r\n\r\n            onProgress( new ProgressEvent( 'GeometriesManager', {\r\n                lengthComputable: true,\r\n                loaded:           dataIndex + 1,\r\n                total:            numberOfDatas\r\n            } ) )\r\n\r\n        }\r\n\r\n        onSuccess( results )\r\n\r\n    }\r\n\r\n    /**\r\n     * @public\r\n     * @memberOf GeometriesManager.prototype\r\n     *\r\n     * @param data\r\n     * @returns {*}\r\n     */\r\n    convert ( data ) {\r\n\r\n        if ( !data ) {\r\n            throw new Error( 'GeometriesManager: Unable to convert null or undefined data !' )\r\n        }\r\n\r\n        const geometryType = data.type\r\n        if ( !geometryType ) {\r\n            throw new Error( 'GeometriesManager: Unable to convert untyped data !' )\r\n        }\r\n\r\n        let geometry = null\r\n\r\n        // Keep backward compat to next Major release\r\n        if ( data.isBufferGeometry || geometryType.includes( 'BufferGeometry' ) ) {\r\n\r\n            geometry = this._convertJsonToBufferGeometry( data )\r\n            if ( this._computeNormals ) {\r\n                geometry.computeVertexNormals()\r\n            }\r\n\r\n        } else if ( data.isGeometry || geometryType.includes( 'Geometry' ) ) {\r\n\r\n            geometry = this._convertJsonToGeometry( data )\r\n            if ( this._computeNormals ) {\r\n                geometry.computeFaceNormals()\r\n            }\r\n\r\n        } else {\r\n\r\n            throw new Error( `TGeometriesManager: Unable to retrieve geometry of type ${geometryType} !` )\r\n\r\n        }\r\n\r\n        // Todo: Allow to force if exist\r\n        if ( this.computeBoundingBox ) {\r\n            geometry.boundingBox = null\r\n            geometry.computeBoundingBox()\r\n        }\r\n\r\n        if ( this.computeBoundingSphere ) {\r\n            geometry.boundingSphere = null\r\n            geometry.computeBoundingSphere()\r\n        }\r\n\r\n        return geometry\r\n\r\n    }\r\n\r\n    _convertJsonToGeometry ( data ) {\r\n\r\n        const geometryType = data.types\r\n        let geometry       = null\r\n\r\n        switch ( geometryType ) {\r\n\r\n            case 'BoxGeometry':\r\n                geometry = new BoxGeometry()\r\n                break\r\n\r\n            case 'CircleGeometry':\r\n                geometry = new CircleGeometry()\r\n                break\r\n\r\n            case 'CylinderGeometry':\r\n                geometry = new CylinderGeometry()\r\n                break\r\n\r\n            case 'ConeGeometry':\r\n                geometry = new ConeGeometry()\r\n                break\r\n\r\n            case 'EdgesGeometry':\r\n                geometry = new EdgesGeometry()\r\n                break\r\n\r\n            case 'DodecahedronGeometry':\r\n                geometry = new DodecahedronGeometry()\r\n                break\r\n\r\n            case 'ExtrudeGeometry':\r\n                geometry = new ExtrudeGeometry()\r\n                break\r\n\r\n            case 'Geometry':\r\n                geometry = new Geometry()\r\n                break\r\n\r\n            case 'IcosahedronGeometry':\r\n                geometry = new IcosahedronGeometry()\r\n                break\r\n\r\n            case 'LatheGeometry':\r\n                geometry = new LatheGeometry()\r\n                break\r\n\r\n            case 'OctahedronGeometry':\r\n                geometry = new OctahedronGeometry()\r\n                break\r\n\r\n            case 'ParametricGeometry':\r\n                geometry = new ParametricGeometry()\r\n                break\r\n\r\n            case 'PlaneGeometry':\r\n                geometry = new PlaneGeometry()\r\n                break\r\n\r\n            case 'PolyhedronGeometry':\r\n                geometry = new PolyhedronGeometry()\r\n                break\r\n\r\n            case 'RingGeometry':\r\n                geometry = new RingGeometry()\r\n                break\r\n\r\n            case 'ShapeGeometry':\r\n                geometry = new ShapeGeometry()\r\n                break\r\n\r\n            case 'TetrahedronGeometry':\r\n                geometry = new TetrahedronGeometry()\r\n                break\r\n\r\n            case 'TextGeometry':\r\n                geometry = new TextGeometry()\r\n                break\r\n\r\n            case 'TorusGeometry':\r\n                geometry = new TorusGeometry()\r\n                break\r\n\r\n            case 'TorusKnotGeometry':\r\n                geometry = new TorusKnotGeometry()\r\n                break\r\n\r\n            case 'TubeGeometry':\r\n                geometry = new TubeGeometry()\r\n                break\r\n\r\n            case 'SphereGeometry':\r\n                geometry = new SphereGeometry()\r\n                break\r\n\r\n            case 'WireframeGeometry':\r\n                geometry = new WireframeGeometry()\r\n                break\r\n\r\n            default:\r\n                throw new Error( `TGeometriesManager: Unknown geometry of type: ${geometryType}` )\r\n                break\r\n\r\n        }\r\n\r\n        geometry.uuid = data.uuid\r\n        geometry.name = data.name\r\n        geometry.type = data.type\r\n\r\n        var vertices = []\r\n        var vertex   = undefined\r\n        for ( var index = 0, numberOfVertices = data.vertices.length ; index < numberOfVertices ; ++index ) {\r\n\r\n            vertex = data.vertices[ index ]\r\n            vertices.push( new Vector3( vertex.x, vertex.y, vertex.z ) )\r\n\r\n        }\r\n        geometry.vertices = vertices\r\n        //                geometry.colors                  = data.colors\r\n\r\n        var faces = []\r\n        var face  = undefined\r\n        for ( var faceIndex = 0, numberOfFaces = data.faces.length ; faceIndex < numberOfFaces ; faceIndex++ ) {\r\n            face = data.faces[ faceIndex ]\r\n            faces.push( new Face3( face.a, face.b, face.c, face.normal, face.color, face.materialIndex ) )\r\n        }\r\n        geometry.faces         = faces\r\n        //                geometry.faceVertexUvs           = [ [ Number ] ]\r\n        geometry.morphTargets  = []\r\n        geometry.morphNormals  = []\r\n        geometry.skinWeights   = []\r\n        geometry.skinIndices   = []\r\n        geometry.lineDistances = []\r\n\r\n        geometry.elementsNeedUpdate      = true //data.elementsNeedUpdate\r\n        geometry.verticesNeedUpdate      = true //data.verticesNeedUpdate\r\n        geometry.uvsNeedUpdate           = true //data.uvsNeedUpdate\r\n        geometry.normalsNeedUpdate       = true //data.normalsNeedUpdate\r\n        geometry.colorsNeedUpdate        = true //data.colorsNeedUpdate\r\n        geometry.lineDistancesNeedUpdate = true //data.lineDistancesNeedUpdate\r\n        geometry.groupsNeedUpdate        = true //data.groupsNeedUpdate\r\n\r\n    }\r\n\r\n    _convertJsonToBufferGeometry ( data ) {\r\n\r\n        const bufferGeometryType = data.type\r\n        let bufferGeometry       = null\r\n\r\n        switch ( bufferGeometryType ) {\r\n\r\n            case 'BoxBufferGeometry':\r\n                bufferGeometry = new BoxBufferGeometry()\r\n                break\r\n\r\n            case 'BufferGeometry':\r\n                bufferGeometry = new BufferGeometry()\r\n                break\r\n\r\n            case 'CircleBufferGeometry':\r\n                bufferGeometry = new CircleBufferGeometry()\r\n                break\r\n\r\n            case 'CylinderBufferGeometry':\r\n                bufferGeometry = new CylinderBufferGeometry()\r\n                break\r\n\r\n            case 'ConeBufferGeometry':\r\n                bufferGeometry = new ConeBufferGeometry()\r\n                break\r\n\r\n            case 'DodecahedronBufferGeometry':\r\n                bufferGeometry = new DodecahedronBufferGeometry()\r\n                break\r\n\r\n            case 'ExtrudeBufferGeometry':\r\n                bufferGeometry = new ExtrudeBufferGeometry()\r\n                break\r\n\r\n            case 'IcosahedronBufferGeometry':\r\n                bufferGeometry = new IcosahedronBufferGeometry()\r\n                break\r\n\r\n            case 'LatheBufferGeometry':\r\n                bufferGeometry = new LatheBufferGeometry()\r\n                break\r\n\r\n            case 'OctahedronBufferGeometry':\r\n                bufferGeometry = new OctahedronBufferGeometry()\r\n                break\r\n\r\n            case 'ParametricBufferGeometry':\r\n                bufferGeometry = new ParametricBufferGeometry()\r\n                break\r\n\r\n            case 'PlaneBufferGeometry':\r\n                bufferGeometry = new PlaneBufferGeometry()\r\n                break\r\n\r\n            case 'PolyhedronBufferGeometry':\r\n                bufferGeometry = new PolyhedronBufferGeometry()\r\n                break\r\n\r\n            case 'RingBufferGeometry':\r\n                bufferGeometry = new RingBufferGeometry()\r\n                break\r\n\r\n            case 'ShapeBufferGeometry':\r\n                bufferGeometry = new BufferGeometry()\r\n                //                bufferGeometry = new ShapeBufferGeometry(  )\r\n                break\r\n\r\n            case 'TetrahedronBufferGeometry':\r\n                bufferGeometry = new TetrahedronBufferGeometry()\r\n                break\r\n\r\n            case 'TextBufferGeometry':\r\n                bufferGeometry = new TextBufferGeometry()\r\n                break\r\n\r\n            case 'TorusBufferGeometry':\r\n                bufferGeometry = new TorusBufferGeometry()\r\n                break\r\n\r\n            case 'TorusKnotBufferGeometry':\r\n                bufferGeometry = new TorusKnotBufferGeometry()\r\n                break\r\n\r\n            case 'TubeBufferGeometry':\r\n                bufferGeometry = new TubeBufferGeometry()\r\n                break\r\n\r\n            case 'SphereBufferGeometry':\r\n                bufferGeometry = new SphereBufferGeometry()\r\n                break\r\n\r\n            case 'InstancedBufferGeometry':\r\n                bufferGeometry = new InstancedBufferGeometry()\r\n                break\r\n\r\n            default:\r\n                throw new Error( `TGeometriesManager: Unknown buffer geometry of type: ${bufferGeometryType}` )\r\n\r\n        }\r\n\r\n        // COMMON PARTS\r\n        bufferGeometry._id  = data._id\r\n        bufferGeometry.uuid = data.uuid\r\n        bufferGeometry.name = data.name\r\n\r\n        // Extract index\r\n        const dataIndexes = data.index\r\n        if ( dataIndexes && dataIndexes.array && dataIndexes.array.length > 0 ) {\r\n\r\n            const arrayBuffer    = this.__convertBase64ToArrayBuffer( dataIndexes.array )\r\n            const typedArray     = this.__convertArrayBufferToTypedArray( arrayBuffer )\r\n            bufferGeometry.index = new BufferAttribute( typedArray, dataIndexes.itemSize, dataIndexes.normalized )\r\n\r\n        }\r\n\r\n        // Extract attributes\r\n        const dataAttributes = data.attributes\r\n        if ( dataAttributes ) {\r\n\r\n            let attributes = {}\r\n\r\n            // TODO: using loop instead !!\r\n            const positionAttributes = dataAttributes.position\r\n            if ( positionAttributes ) {\r\n\r\n                const arrayBuffer = this.__convertBase64ToArrayBuffer( positionAttributes.array )\r\n                const typedArray  = this.__convertArrayBufferToTypedArray( arrayBuffer )\r\n                const globalScale = this.globalScale\r\n\r\n                const positionArray = new Float32Array( typedArray )\r\n\r\n                if ( this._projectionSystem === 'zBack' ) {\r\n\r\n                    let x = null\r\n                    let y = null\r\n                    let z = null\r\n                    for ( let pi = 0, numPos = positionArray.length ; pi < numPos ; pi += 3 ) {\r\n                        x                       = positionArray[ pi ] / globalScale\r\n                        y                       = positionArray[ pi + 2 ] / globalScale\r\n                        z                       = -positionArray[ pi + 1 ] / globalScale\r\n                        positionArray[ pi ]     = x\r\n                        positionArray[ pi + 1 ] = y\r\n                        positionArray[ pi + 2 ] = z\r\n                    }\r\n\r\n                } else {\r\n\r\n                    for ( let posIndex = 0, numPos = positionArray.length ; posIndex < numPos ; posIndex++ ) {\r\n                        positionArray[ posIndex ] /= globalScale\r\n                    }\r\n\r\n                }\r\n\r\n                attributes[ 'position' ] = new BufferAttribute( positionArray, positionAttributes.itemSize, positionAttributes.normalized )\r\n\r\n            }\r\n\r\n            const normalAttributes = dataAttributes.normal\r\n            if ( normalAttributes ) {\r\n\r\n                const arrayBuffer      = this.__convertBase64ToArrayBuffer( normalAttributes.array )\r\n                const typedArray       = this.__convertArrayBufferToTypedArray( arrayBuffer )\r\n                attributes[ 'normal' ] = new BufferAttribute( typedArray, normalAttributes.itemSize, normalAttributes.normalized )\r\n\r\n            }\r\n\r\n            const uvAttributes = dataAttributes.uv\r\n            if ( uvAttributes ) {\r\n\r\n                const arrayBuffer  = this.__convertBase64ToArrayBuffer( uvAttributes.array )\r\n                const typedArray   = this.__convertArrayBufferToTypedArray( arrayBuffer )\r\n                attributes[ 'uv' ] = new BufferAttribute( typedArray, uvAttributes.itemSize, uvAttributes.normalized )\r\n\r\n            }\r\n\r\n            bufferGeometry.attributes = attributes\r\n\r\n        }\r\n\r\n        if ( isDefined( data.groups ) ) {\r\n            bufferGeometry.groups = data.groups\r\n        }\r\n\r\n        // Need to set null because only checked vs undefined data.boundingBox\r\n        if ( isDefined( data.boundingBox ) ) {\r\n            bufferGeometry.boundingBox = data.boundingBox\r\n        }\r\n\r\n        // idem... data.boundingSphere\r\n        if ( isDefined( data.boundingSphere ) ) {\r\n            bufferGeometry.boundingSphere = data.boundingSphere\r\n        }\r\n\r\n        //        if ( isDefined( data.drawRange ) ) {\r\n        //            bufferGeometry.drawRange = data.drawRange\r\n        //        }\r\n\r\n        if ( bufferGeometryType === 'ShapeBufferGeometry' ) {\r\n\r\n            bufferGeometry.shapes        = data.shapes.map( jsonShape => {return new Shape().fromJSON( jsonShape )} )\r\n            bufferGeometry.curveSegments = data.curveSegments\r\n\r\n        } else {\r\n\r\n        }\r\n\r\n        return bufferGeometry\r\n\r\n    }\r\n\r\n    __convertArrayBufferToTypedArray ( arrayBuffer ) {\r\n\r\n        const ONE_BYTE       = 1\r\n        const TWO_BYTE       = 2\r\n        const FOUR_BYTE      = 4\r\n        const HEIGHT_BYTE    = 8\r\n        const dataView       = new DataView( arrayBuffer )\r\n        const dataByteLength = arrayBuffer.byteLength - 1\r\n        const type           = dataView.getUint8( 0 )\r\n\r\n        let typedArray = null\r\n\r\n        switch ( type ) {\r\n\r\n            case ArrayType.Int8Array:\r\n                typedArray = new Int8Array( dataByteLength / ONE_BYTE )\r\n                for ( let index = 0, offset = 1 ; offset < dataByteLength ; index++, offset += ONE_BYTE ) {\r\n                    typedArray[ index ] = dataView.getInt8( offset )\r\n                }\r\n                break\r\n\r\n            case ArrayType.Uint8Array:\r\n                typedArray = new Uint8Array( dataByteLength / ONE_BYTE )\r\n                for ( let index = 0, offset = 1 ; offset < dataByteLength ; index++, offset += ONE_BYTE ) {\r\n                    typedArray[ index ] = dataView.getUint8( offset )\r\n                }\r\n                break\r\n\r\n            case ArrayType.Uint8ClampedArray:\r\n                typedArray = new Uint8ClampedArray( dataByteLength / ONE_BYTE )\r\n                for ( let index = 0, offset = 1 ; offset < dataByteLength ; index++, offset += ONE_BYTE ) {\r\n                    typedArray[ index ] = dataView.getUint8( offset )\r\n                }\r\n                break\r\n\r\n            case ArrayType.Int16Array:\r\n                typedArray = new Int16Array( dataByteLength / TWO_BYTE )\r\n                for ( let index = 0, offset = 1 ; offset < dataByteLength ; index++, offset += TWO_BYTE ) {\r\n                    typedArray[ index ] = dataView.getInt16( offset )\r\n                }\r\n                break\r\n\r\n            case ArrayType.Uint16Array:\r\n                typedArray = new Uint16Array( dataByteLength / TWO_BYTE )\r\n                for ( let index = 0, offset = 1 ; offset < dataByteLength ; index++, offset += TWO_BYTE ) {\r\n                    typedArray[ index ] = dataView.getUint16( offset )\r\n                }\r\n                break\r\n\r\n            case ArrayType.Int32Array:\r\n                typedArray = new Int32Array( dataByteLength / FOUR_BYTE )\r\n                for ( let index = 0, offset = 1 ; offset < dataByteLength ; index++, offset += FOUR_BYTE ) {\r\n                    typedArray[ index ] = dataView.getInt32( offset )\r\n                }\r\n                break\r\n\r\n            case ArrayType.Uint32Array:\r\n                typedArray = new Uint32Array( dataByteLength / FOUR_BYTE )\r\n                for ( let index = 0, offset = 1 ; offset < dataByteLength ; index++, offset += FOUR_BYTE ) {\r\n                    typedArray[ index ] = dataView.getUint32( offset )\r\n                }\r\n                break\r\n\r\n            case ArrayType.Float32Array:\r\n                typedArray = new Float32Array( dataByteLength / FOUR_BYTE )\r\n                for ( let index = 0, offset = 1 ; offset < dataByteLength ; index++, offset += FOUR_BYTE ) {\r\n                    typedArray[ index ] = dataView.getFloat32( offset )\r\n                }\r\n                break\r\n\r\n            case ArrayType.Float64Array:\r\n                typedArray = new Float64Array( dataByteLength / HEIGHT_BYTE )\r\n                for ( let index = 0, offset = 1 ; offset < dataByteLength ; index++, offset += HEIGHT_BYTE ) {\r\n                    typedArray[ index ] = dataView.getFloat64( offset )\r\n                }\r\n                break\r\n\r\n            default:\r\n                throw new RangeError( `Invalid switch parameter: ${type}` )\r\n\r\n        }\r\n\r\n        return typedArray\r\n\r\n    }\r\n\r\n    __convertBase64ToArrayBuffer ( base64 ) {\r\n\r\n        const chars  = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'\r\n        const lookup = new Uint8Array( 256 )\r\n        for ( let i = 0 ; i < chars.length ; i++ ) {\r\n            lookup[ chars.charCodeAt( i ) ] = i\r\n        }\r\n\r\n        ////////\r\n\r\n        const base64Length = base64.length\r\n\r\n        let bufferLength = base64Length * 0.75\r\n        if ( base64[ base64Length - 1 ] === '=' ) {\r\n            bufferLength--\r\n            if ( base64[ base64Length - 2 ] === '=' ) {\r\n                bufferLength--\r\n            }\r\n        }\r\n\r\n        let arraybuffer = new ArrayBuffer( bufferLength )\r\n        let bytes       = new Uint8Array( arraybuffer )\r\n        let encoded1    = undefined\r\n        let encoded2    = undefined\r\n        let encoded3    = undefined\r\n        let encoded4    = undefined\r\n\r\n        for ( let i = 0, pointer = 0 ; i < base64Length ; i += 4 ) {\r\n            encoded1 = lookup[ base64.charCodeAt( i ) ]\r\n            encoded2 = lookup[ base64.charCodeAt( i + 1 ) ]\r\n            encoded3 = lookup[ base64.charCodeAt( i + 2 ) ]\r\n            encoded4 = lookup[ base64.charCodeAt( i + 3 ) ]\r\n\r\n            bytes[ pointer++ ] = ( encoded1 << 2 ) | ( encoded2 >> 4 )\r\n            bytes[ pointer++ ] = ( ( encoded2 & 15 ) << 4 ) | ( encoded3 >> 2 )\r\n            bytes[ pointer++ ] = ( ( encoded3 & 3 ) << 6 ) | ( encoded4 & 63 )\r\n        }\r\n\r\n        return arraybuffer\r\n\r\n    }\r\n\r\n}\r\n\r\nexport { GeometriesManager }\r\n","/**\r\n * @author [Tristan Valcke]{@link https://github.com/Itee}\r\n * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}\r\n *\r\n * @file Todo\r\n *\r\n * @example Todo\r\n *\r\n */\r\n\r\nimport { TDataBaseManager } from 'itee-client'\r\nimport { isObject }         from 'itee-validators'\r\n\r\n/**\r\n *\r\n * @constructor\r\n */\r\nfunction TexturesManager () {\r\n\r\n    TDataBaseManager.call( this )\r\n    this.basePath = '/textures'\r\n\r\n}\r\n\r\nTexturesManager.prototype = Object.assign( Object.create( TDataBaseManager.prototype ), {\r\n\r\n    /**\r\n     *\r\n     */\r\n    constructor: TexturesManager,\r\n\r\n    /**\r\n     *\r\n     * @param data\r\n     * @return {*}\r\n     */\r\n    convert ( data ) {\r\n\r\n        if ( !data ) {\r\n            throw new Error( 'TexturesManager: Unable to convert null or undefined data !' )\r\n        }\r\n\r\n        const textureType = data.type\r\n        let texture       = undefined\r\n\r\n        switch ( textureType ) {\r\n\r\n            default:\r\n                throw new Error( `TTexturesManager: Unknown texture of type: ${textureType}` )\r\n                break\r\n\r\n        }\r\n\r\n        // Common object properties\r\n\r\n        if ( textureType === 'Line' ) {\r\n\r\n        }\r\n\r\n        return texture\r\n\r\n    }\r\n\r\n} )\r\n\r\nObject.defineProperties( TexturesManager.prototype, {\r\n\r\n    /**\r\n     *\r\n     */\r\n    _onJson: {\r\n        value: function _onJson ( jsonData, onSuccess, onProgress, onError ) {\r\n\r\n            // Normalize to array\r\n            const datas   = ( isObject( jsonData ) ) ? [ jsonData ] : jsonData\r\n            const results = {}\r\n\r\n            for ( let dataIndex = 0, numberOfDatas = datas.length, data = undefined ; dataIndex < numberOfDatas ; dataIndex++ ) {\r\n\r\n                data = datas[ dataIndex ]\r\n\r\n                try {\r\n                    results[ data._id ] = this.convert( data )\r\n                } catch ( err ) {\r\n                    onError( err )\r\n                }\r\n\r\n                onProgress( dataIndex / numberOfDatas )\r\n\r\n            }\r\n\r\n            onSuccess( results )\r\n        }\r\n    }\r\n\r\n} )\r\n\r\nexport { TexturesManager }\r\n","/**\r\n * @author [Tristan Valcke]{@link https://github.com/Itee}\r\n * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}\r\n *\r\n * @class TScenesManager\r\n * @classdesc Todo...\r\n * @example Todo...\r\n * @requires TDataBaseManager\r\n *\r\n */\r\n\r\n/* eslint-env browser */\r\n\r\nimport { TDataBaseManager } from 'itee-client'\r\nimport {\r\n    isBlankString,\r\n    isDefined,\r\n    isEmptyString,\r\n    isNotBoolean,\r\n    isNotDefined,\r\n    isNotEmptyString,\r\n    isNotString,\r\n    isNull,\r\n    isObject,\r\n    isString,\r\n    isUndefined\r\n}                           from 'itee-validators'\r\nimport {\r\n    Color,\r\n    ImageLoader,\r\n    LinearFilter,\r\n    LineBasicMaterial,\r\n    MeshLambertMaterial,\r\n    MeshPhongMaterial,\r\n    PointsMaterial,\r\n    TextureLoader,\r\n    Vector2\r\n}                           from 'three-full'\r\nimport { TexturesManager }  from './TexturesManager'\r\n\r\nconst DEFAULT_IMAGE = new ImageLoader().load( 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH4gkKDRoGpGNegQAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAAMSURBVAjXY/j//z8ABf4C/tzMWecAAAAASUVORK5CYII=' )\r\n\r\nclass MaterialsManager extends TDataBaseManager {\r\n\r\n    /**\r\n     *\r\n     * @param basePath\r\n     * @param responseType\r\n     * @param bunchSize\r\n     * @param progressManager\r\n     * @param errorManager\r\n     * @param texturesPath\r\n     * @param texturesProvider\r\n     */\r\n    constructor ( parameters = {} ) {\r\n\r\n        const _parameters = {\r\n            ...{\r\n                basePath:         '/materials',\r\n                texturesPath:     '/textures',\r\n                texturesProvider: new TextureLoader(),\r\n                generateMipmap:   false,\r\n                autoFillTextures: true\r\n            }, ...parameters\r\n        }\r\n\r\n        super( _parameters )\r\n\r\n        this.texturesPath     = _parameters.texturesPath\r\n        this.texturesProvider = _parameters.texturesProvider\r\n        this.generateMipmap   = _parameters.generateMipmap\r\n        this.autoFillTextures = _parameters.autoFillTextures\r\n\r\n    }\r\n\r\n    get texturesPath () {\r\n        return this._texturesPath\r\n    }\r\n\r\n    set texturesPath ( value ) {\r\n\r\n        if ( isNull( value ) ) { throw new TypeError( 'Textures path cannot be null ! Expect a non empty string.' ) }\r\n        if ( isUndefined( value ) ) { throw new TypeError( 'Textures path cannot be undefined ! Expect a non empty string.' ) }\r\n        if ( isNotString( value ) ) { throw new TypeError( `Textures path cannot be an instance of ${value.constructor.name} ! Expect a non empty string.` ) }\r\n        if ( isEmptyString( value ) ) { throw new TypeError( 'Textures path cannot be empty ! Expect a non empty string.' ) }\r\n        if ( isBlankString( value ) ) { throw new TypeError( 'Textures path cannot contain only whitespace ! Expect a non empty string.' ) }\r\n\r\n        this._texturesPath = value\r\n\r\n    }\r\n\r\n    get texturesProvider () {\r\n        return this._texturesProvider\r\n    }\r\n\r\n    set texturesProvider ( value ) {\r\n\r\n        if ( isNull( value ) ) { throw new TypeError( 'Textures provider cannot be null ! Expect an instance of TextureLoader.' ) }\r\n        if ( isUndefined( value ) ) { throw new TypeError( 'Textures provider cannot be undefined ! Expect an instance of TextureLoader.' ) }\r\n        if ( !( value instanceof TexturesManager ) && !( value instanceof TextureLoader ) ) { throw new TypeError( `Textures provider cannot be an instance of ${value.constructor.name} ! Expect an instance of TTexturesManager.` ) }\r\n\r\n        this._texturesProvider = value\r\n\r\n    }\r\n\r\n    get generateMipmap () {\r\n        return this._generateMipmap\r\n    }\r\n\r\n    set generateMipmap ( value ) {\r\n\r\n        if ( isNull( value ) ) { throw new TypeError( 'Generate mipmap cannot be null ! Expect a boolean.' ) }\r\n        if ( isUndefined( value ) ) { throw new TypeError( 'Generate mipmap cannot be undefined ! Expect a boolean.' ) }\r\n        if ( isNotBoolean( value ) ) { throw new TypeError( `Generate mipmap cannot be an instance of ${value.constructor.name} ! Expect a boolean.` ) }\r\n\r\n        this._generateMipmap = value\r\n    }\r\n\r\n    get autoFillTextures () {\r\n        return this._autoFillTextures\r\n    }\r\n\r\n    set autoFillTextures ( value ) {\r\n\r\n        if ( isNull( value ) ) { throw new TypeError( 'Global scale cannot be null ! Expect a boolean.' ) }\r\n        if ( isUndefined( value ) ) { throw new TypeError( 'Global scale cannot be undefined ! Expect a positive number.' ) }\r\n        if ( isNotBoolean( value ) ) { throw new TypeError( 'Global scale cannot be null ! Expect a boolean.' ) }\r\n\r\n        this._autoFillTextures = value\r\n\r\n    }\r\n\r\n    setTexturesPath ( value ) {\r\n\r\n        this.texturesPath = value\r\n        return this\r\n\r\n    }\r\n\r\n    setTexturesProvider ( value ) {\r\n\r\n        this.texturesProvider = value\r\n        return this\r\n\r\n    }\r\n\r\n    setGenerateMipmap ( value ) {\r\n\r\n        this.generateMipmap = value\r\n        return this\r\n\r\n    }\r\n\r\n    setAutoFillTextures ( value ) {\r\n\r\n        this.autoFillTextures = value\r\n        return this\r\n\r\n    }\r\n\r\n    //// Methods\r\n\r\n    _onJson ( jsonData, onSuccess, onProgress, onError ) {\r\n\r\n        // Normalize to array\r\n        const datas   = ( isObject( jsonData ) ) ? [ jsonData ] : jsonData\r\n        const results = {}\r\n\r\n        for ( let dataIndex = 0, numberOfDatas = datas.length, data = undefined ; dataIndex < numberOfDatas ; dataIndex++ ) {\r\n\r\n            data = datas[ dataIndex ]\r\n\r\n            try {\r\n                results[ data._id ] = this.convert( data )\r\n            } catch ( err ) {\r\n                onError( err )\r\n            }\r\n\r\n            onProgress( new ProgressEvent( 'MaterialsManager', {\r\n                lengthComputable: true,\r\n                loaded:           dataIndex + 1,\r\n                total:            numberOfDatas\r\n            } ) )\r\n\r\n        }\r\n\r\n        if ( this._autoFillTextures ) {\r\n            this.fillTextures( results, onSuccess, onProgress, onError )\r\n        } else {\r\n            onSuccess( results )\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param data\r\n     * @return {undefined}\r\n     */\r\n    convert ( data ) {\r\n\r\n        if ( !data ) {\r\n            throw new Error( 'MaterialsManager: Unable to convert null or undefined data !' )\r\n        }\r\n\r\n        const type   = data.type\r\n        let material = null\r\n\r\n        switch ( type ) {\r\n\r\n            case 'MeshPhongMaterial': {\r\n                material = new MeshPhongMaterial()\r\n                this._fillBaseMaterialData( material, data )\r\n\r\n                const color = data.color\r\n                if ( isDefined( color ) ) {\r\n                    material.color = this._setColor( color )\r\n                }\r\n\r\n                const specular = data.specular\r\n                if ( isDefined( specular ) ) {\r\n                    material.specular = this._setColor( specular )\r\n                }\r\n\r\n                const shininess = data.shininess\r\n                if ( isDefined( shininess ) ) {\r\n                    material.shininess = shininess\r\n                }\r\n\r\n                const map = data.map\r\n                if ( isDefined( map ) ) {\r\n                    material.map = map\r\n                }\r\n\r\n                const lightMap = data.lightMap\r\n                if ( isDefined( lightMap ) ) {\r\n                    material.lightMap = lightMap\r\n                }\r\n\r\n                const lightMapIntensity = data.lightMapIntensity\r\n                if ( isDefined( lightMapIntensity ) ) {\r\n                    material.lightMapIntensity = lightMapIntensity\r\n                }\r\n\r\n                const aoMap = data.aoMap\r\n                if ( isDefined( aoMap ) ) {\r\n                    material.aoMap = aoMap\r\n                }\r\n\r\n                const aoMapIntensity = data.aoMapIntensity\r\n                if ( isDefined( aoMapIntensity ) ) {\r\n                    material.aoMapIntensity = aoMapIntensity\r\n                }\r\n\r\n                const emissive = data.emissive\r\n                if ( isDefined( emissive ) ) {\r\n                    material.emissive = this._setColor( emissive )\r\n                }\r\n\r\n                const emissiveIntensity = data.emissiveIntensity\r\n                if ( isDefined( emissiveIntensity ) ) {\r\n                    material.emissiveIntensity = emissiveIntensity\r\n                }\r\n\r\n                const emissiveMap = data.emissiveMap\r\n                if ( isDefined( emissiveMap ) ) {\r\n                    material.emissiveMap = emissiveMap\r\n                }\r\n\r\n                const bumpMap = data.bumpMap\r\n                if ( isDefined( bumpMap ) ) {\r\n                    material.bumpMap = bumpMap\r\n                }\r\n\r\n                const bumpScale = data.bumpScale\r\n                if ( isDefined( bumpScale ) ) {\r\n                    material.bumpScale = bumpScale\r\n                }\r\n\r\n                const normalMap = data.normalMap\r\n                if ( isDefined( normalMap ) ) {\r\n                    material.normalMap = normalMap\r\n                }\r\n\r\n                const normalScale = data.normalScale\r\n                if ( isDefined( normalScale ) ) {\r\n                    material.normalScale = this._setVector2( normalScale )\r\n                }\r\n\r\n                const displacementMap = data.displacementMap\r\n                if ( isDefined( displacementMap ) ) {\r\n                    material.displacementMap = displacementMap\r\n                }\r\n\r\n                const displacementScale = data.displacementScale\r\n                if ( isDefined( displacementScale ) ) {\r\n                    material.displacementScale = displacementScale\r\n                }\r\n\r\n                const displacementBias = data.displacementBias\r\n                if ( isDefined( displacementBias ) ) {\r\n                    material.displacementBias = displacementBias\r\n                }\r\n\r\n                const specularMap = data.specularMap\r\n                if ( isDefined( specularMap ) ) {\r\n                    material.specularMap = specularMap\r\n                }\r\n\r\n                const alphaMap = data.alphaMap\r\n                if ( isDefined( alphaMap ) ) {\r\n                    material.alphaMap = alphaMap\r\n                }\r\n\r\n                const envMap = data.envMap\r\n                if ( isDefined( envMap ) ) {\r\n                    material.envMap = envMap\r\n                }\r\n\r\n                const combine = data.combine\r\n                if ( isDefined( combine ) ) {\r\n                    material.combine = combine\r\n                }\r\n\r\n                const reflectivity = data.reflectivity\r\n                if ( isDefined( reflectivity ) ) {\r\n                    material.reflectivity = reflectivity\r\n                }\r\n\r\n                const refractionRatio = data.refractionRatio\r\n                if ( isDefined( refractionRatio ) ) {\r\n                    material.refractionRatio = refractionRatio\r\n                }\r\n\r\n                const wireframe = data.wireframe\r\n                if ( isDefined( wireframe ) ) {\r\n                    material.wireframe = wireframe\r\n                }\r\n\r\n                const wireframeLinewidth = data.wireframeLinewidth\r\n                if ( isDefined( wireframeLinewidth ) ) {\r\n                    material.wireframeLinewidth = wireframeLinewidth\r\n                }\r\n\r\n                const wireframeLinecap = data.wireframeLinecap\r\n                if ( isDefined( wireframeLinecap ) ) {\r\n                    material.wireframeLinecap = wireframeLinecap\r\n                }\r\n\r\n                const wireframeLinejoin = data.wireframeLinejoin\r\n                if ( isDefined( wireframeLinejoin ) ) {\r\n                    material.wireframeLinejoin = wireframeLinejoin\r\n                }\r\n\r\n                const skinning = data.skinning\r\n                if ( isDefined( skinning ) ) {\r\n                    material.skinning = skinning\r\n                }\r\n\r\n                const morphTargets = data.morphTargets\r\n                if ( isDefined( morphTargets ) ) {\r\n                    material.morphTargets = morphTargets\r\n                }\r\n\r\n                const morphNormals = data.morphNormals\r\n                if ( isDefined( morphNormals ) ) {\r\n                    material.morphNormals = morphNormals\r\n                }\r\n\r\n                break\r\n            }\r\n\r\n            case 'MeshLambertMaterial': {\r\n                material = new MeshLambertMaterial()\r\n                this._fillBaseMaterialData( material, data )\r\n\r\n                const color = data.color\r\n                if ( isDefined( color ) ) {\r\n                    material.color = this._setColor( color )\r\n                }\r\n\r\n                const map = data.map\r\n                if ( isDefined( map ) ) {\r\n                    material.map = map\r\n                }\r\n\r\n                const lightMap = data.lightMap\r\n                if ( isDefined( lightMap ) ) {\r\n                    material.lightMap = lightMap\r\n                }\r\n\r\n                const lightMapIntensity = data.lightMapIntensity\r\n                if ( isDefined( lightMapIntensity ) ) {\r\n                    material.lightMapIntensity = lightMapIntensity\r\n                }\r\n\r\n                const aoMap = data.aoMap\r\n                if ( isDefined( aoMap ) ) {\r\n                    material.aoMap = aoMap\r\n                }\r\n\r\n                const aoMapIntensity = data.aoMapIntensity\r\n                if ( isDefined( aoMapIntensity ) ) {\r\n                    material.aoMapIntensity = aoMapIntensity\r\n                }\r\n\r\n                const emissive = data.emissive\r\n                if ( isDefined( emissive ) ) {\r\n                    material.emissive = this._setColor( emissive )\r\n                }\r\n\r\n                const emissiveIntensity = data.emissiveIntensity\r\n                if ( isDefined( emissiveIntensity ) ) {\r\n                    material.emissiveIntensity = emissiveIntensity\r\n                }\r\n\r\n                const emissiveMap = data.emissiveMap\r\n                if ( isDefined( emissiveMap ) ) {\r\n                    material.emissiveMap = emissiveMap\r\n                }\r\n\r\n                const specularMap = data.specularMap\r\n                if ( isDefined( specularMap ) ) {\r\n                    material.specularMap = specularMap\r\n                }\r\n\r\n                const alphaMap = data.alphaMap\r\n                if ( isDefined( alphaMap ) ) {\r\n                    material.alphaMap = alphaMap\r\n                }\r\n\r\n                const envMap = data.envMap\r\n                if ( isDefined( envMap ) ) {\r\n                    material.envMap = envMap\r\n                }\r\n\r\n                const combine = data.combine\r\n                if ( isDefined( combine ) ) {\r\n                    material.combine = combine\r\n                }\r\n\r\n                const reflectivity = data.reflectivity\r\n                if ( isDefined( reflectivity ) ) {\r\n                    material.reflectivity = reflectivity\r\n                }\r\n\r\n                const refractionRatio = data.refractionRatio\r\n                if ( isDefined( refractionRatio ) ) {\r\n                    material.refractionRatio = refractionRatio\r\n                }\r\n\r\n                const wireframe = data.wireframe\r\n                if ( isDefined( wireframe ) ) {\r\n                    material.wireframe = wireframe\r\n                }\r\n\r\n                const wireframeLinewidth = data.wireframeLinewidth\r\n                if ( isDefined( wireframeLinewidth ) ) {\r\n                    material.wireframeLinewidth = wireframeLinewidth\r\n                }\r\n\r\n                const wireframeLinecap = data.wireframeLinecap\r\n                if ( isDefined( wireframeLinecap ) ) {\r\n                    material.wireframeLinecap = wireframeLinecap\r\n                }\r\n\r\n                const wireframeLinejoin = data.wireframeLinejoin\r\n                if ( isDefined( wireframeLinejoin ) ) {\r\n                    material.wireframeLinejoin = wireframeLinejoin\r\n                }\r\n\r\n                const skinning = data.skinning\r\n                if ( isDefined( skinning ) ) {\r\n                    material.skinning = skinning\r\n                }\r\n\r\n                const morphTargets = data.morphTargets\r\n                if ( isDefined( morphTargets ) ) {\r\n                    material.morphTargets = morphTargets\r\n                }\r\n\r\n                const morphNormals = data.morphNormals\r\n                if ( isDefined( morphNormals ) ) {\r\n                    material.morphNormals = morphNormals\r\n                }\r\n\r\n                break\r\n            }\r\n\r\n            case 'LineBasicMaterial': {\r\n                material = new LineBasicMaterial()\r\n                this._fillBaseMaterialData( material, data )\r\n\r\n                const color = data.color\r\n                if ( isDefined( color ) ) {\r\n                    material.color = this._setColor( color )\r\n                }\r\n\r\n                break\r\n            }\r\n\r\n            case 'PointsMaterial': {\r\n                material = new PointsMaterial()\r\n                this._fillBaseMaterialData( material, data )\r\n\r\n                const color = data.color\r\n                if ( isDefined( color ) ) {\r\n                    material.color = this._setColor( color )\r\n                }\r\n\r\n                const map = data.map\r\n                if ( isDefined( map ) ) {\r\n                    material.map = map\r\n                }\r\n\r\n                const morphTargets = data.morphTargets\r\n                if ( isDefined( morphTargets ) ) {\r\n                    material.morphTargets = morphTargets\r\n                }\r\n\r\n                const size = data.size\r\n                if ( isDefined( size ) ) {\r\n                    material.size = size\r\n                }\r\n\r\n                const sizeAttenuation = data.sizeAttenuation\r\n                if ( isDefined( sizeAttenuation ) ) {\r\n                    material.sizeAttenuation = sizeAttenuation\r\n                }\r\n\r\n                break\r\n            }\r\n\r\n            default:\r\n                throw new Error( `TMaterialsManager: Unmanaged material of type: ${type}` )\r\n                break\r\n\r\n        }\r\n\r\n        return material\r\n\r\n    }\r\n\r\n    _fillBaseMaterialData ( material, data ) {\r\n\r\n        const _id = data._id\r\n        if ( isDefined( _id ) && isString( _id ) ) {\r\n            material._id = _id\r\n        }\r\n\r\n        const uuid = data.uuid\r\n        if ( isDefined( uuid ) && isString( uuid ) ) {\r\n            material.uuid = uuid\r\n        }\r\n\r\n        const name = data.name\r\n        if ( isDefined( name ) && isString( name ) ) {\r\n            material.name = name\r\n        }\r\n\r\n        const fog = data.fog\r\n        if ( isDefined( fog ) ) {\r\n            material.fog = fog\r\n        }\r\n\r\n        const lights = data.lights\r\n        if ( isDefined( lights ) ) {\r\n            material.lights = lights\r\n        }\r\n\r\n        const blending = data.blending\r\n        if ( isDefined( blending ) ) {\r\n            material.blending = blending\r\n        }\r\n\r\n        const side = data.side\r\n        if ( isDefined( side ) ) {\r\n            material.side = side\r\n        }\r\n\r\n        const flatShading = data.flatShading\r\n        if ( isDefined( flatShading ) ) {\r\n            material.flatShading = flatShading\r\n        }\r\n\r\n        const vertexColors = data.vertexColors\r\n        if ( isDefined( vertexColors ) ) {\r\n            material.vertexColors = vertexColors\r\n        }\r\n\r\n        const opacity = data.opacity\r\n        if ( isDefined( opacity ) ) {\r\n            material.opacity = opacity\r\n        }\r\n\r\n        const transparent = data.transparent\r\n        if ( isDefined( transparent ) ) {\r\n            material.transparent = transparent\r\n        }\r\n\r\n        const blendSrc = data.blendSrc\r\n        if ( isDefined( blendSrc ) ) {\r\n            material.blendSrc = blendSrc\r\n        }\r\n\r\n        const blendDst = data.blendDst\r\n        if ( isDefined( blendDst ) ) {\r\n            material.blendDst = blendDst\r\n        }\r\n\r\n        const blendEquation = data.blendEquation\r\n        if ( isDefined( blendEquation ) ) {\r\n            material.blendEquation = blendEquation\r\n        }\r\n\r\n        const blendSrcAlpha = data.blendSrcAlpha\r\n        if ( isDefined( blendSrcAlpha ) ) {\r\n            material.blendSrcAlpha = blendSrcAlpha\r\n        }\r\n\r\n        const blendDstAlpha = data.blendDstAlpha\r\n        if ( isDefined( blendDstAlpha ) ) {\r\n            material.blendDstAlpha = blendDstAlpha\r\n        }\r\n\r\n        const blendEquationAlpha = data.blendEquationAlpha\r\n        if ( isDefined( blendEquationAlpha ) ) {\r\n            material.blendEquationAlpha = blendEquationAlpha\r\n        }\r\n\r\n        const depthFunc = data.depthFunc\r\n        if ( isDefined( depthFunc ) ) {\r\n            material.depthFunc = depthFunc\r\n        }\r\n\r\n        const depthTest = data.depthTest\r\n        if ( isDefined( depthTest ) ) {\r\n            material.depthTest = depthTest\r\n        }\r\n\r\n        const depthWrite = data.depthWrite\r\n        if ( isDefined( depthWrite ) ) {\r\n            material.depthWrite = depthWrite\r\n        }\r\n\r\n        const clippingPlanes = data.clippingPlanes\r\n        if ( isDefined( clippingPlanes ) ) {\r\n            material.clippingPlanes = clippingPlanes\r\n        }\r\n\r\n        const clipIntersection = data.clipIntersection\r\n        if ( isDefined( clipIntersection ) ) {\r\n            material.clipIntersection = clipIntersection\r\n        }\r\n\r\n        const clipShadows = data.clipShadows\r\n        if ( isDefined( clipShadows ) ) {\r\n            material.clipShadows = clipShadows\r\n        }\r\n\r\n        const colorWrite = data.colorWrite\r\n        if ( isDefined( colorWrite ) ) {\r\n            material.colorWrite = colorWrite\r\n        }\r\n\r\n        const precision = data.precision\r\n        if ( isDefined( precision ) ) {\r\n            material.precision = precision\r\n        }\r\n\r\n        const polygonOffset = data.polygonOffset\r\n        if ( isDefined( polygonOffset ) ) {\r\n            material.polygonOffset = polygonOffset\r\n        }\r\n\r\n        const polygonOffsetFactor = data.polygonOffsetFactor\r\n        if ( isDefined( polygonOffsetFactor ) ) {\r\n            material.polygonOffsetFactor = polygonOffsetFactor\r\n        }\r\n\r\n        const polygonOffsetUnits = data.polygonOffsetUnits\r\n        if ( isDefined( polygonOffsetUnits ) ) {\r\n            material.polygonOffsetUnits = polygonOffsetUnits\r\n        }\r\n\r\n        const dithering = data.dithering\r\n        if ( isDefined( dithering ) ) {\r\n            material.dithering = dithering\r\n        }\r\n\r\n        const alphaTest = data.alphaTest\r\n        if ( isDefined( alphaTest ) ) {\r\n            material.alphaTest = alphaTest\r\n        }\r\n\r\n        const premultipliedAlpha = data.premultipliedAlpha\r\n        if ( isDefined( premultipliedAlpha ) ) {\r\n            material.premultipliedAlpha = premultipliedAlpha\r\n        }\r\n\r\n        const overdraw = data.overdraw\r\n        if ( isDefined( overdraw ) ) {\r\n            material.overdraw = overdraw\r\n        }\r\n\r\n        const visible = data.visible\r\n        if ( isDefined( visible ) ) {\r\n            material.visible = visible\r\n        }\r\n\r\n        const userData = data.userData\r\n        if ( isDefined( userData ) ) {\r\n            material.userData = userData\r\n        }\r\n\r\n        const needsUpdate = data.needsUpdate\r\n        if ( isDefined( needsUpdate ) ) {\r\n            material.needsUpdate = needsUpdate\r\n        }\r\n\r\n    }\r\n\r\n    _setVector2 ( vec2 ) {\r\n\r\n        const x = vec2.x\r\n        const y = vec2.y\r\n        if ( isNotDefined( x ) || isNotDefined( y ) ) {\r\n            throw new Error( 'MaterialsManager: Unable to convert null or undefined vector 2 !' )\r\n        }\r\n\r\n        return new Vector2( x, y )\r\n\r\n    }\r\n\r\n    _setColor ( color ) {\r\n\r\n        const r = color.r\r\n        const g = color.g\r\n        const b = color.b\r\n        if ( isNotDefined( r ) || isNotDefined( g ) || isNotDefined( b ) ) {\r\n            throw new Error( 'MaterialsManager: Unable to convert null or undefined color !' )\r\n        }\r\n\r\n        return new Color( r, g, b )\r\n\r\n    }\r\n\r\n    fillTextures ( materials, onSuccess, onProgress, onError ) {\r\n\r\n        const texturesMap = this._retrieveTexturesOf( materials )\r\n\r\n        for ( let key in materials ) {\r\n\r\n            const material = materials[ key ]\r\n            const textures = texturesMap[ key ]\r\n\r\n            for ( let textureKey in textures ) {\r\n                material[ textureKey ] = textures[ textureKey ]\r\n            }\r\n\r\n        }\r\n\r\n        // Don't forget to return all input object to callback,\r\n        // else some ids won't never be considered as processed !\r\n        onSuccess( materials )\r\n\r\n    }\r\n\r\n    _retrieveTexturesOf ( materials ) {\r\n\r\n        const availableTextures = [ 'map', 'lightMap', 'aoMap', 'emissiveMap', 'bumpMap', 'normalMap', 'displacementMap', 'specularMap', 'alphaMap', 'envMap' ]\r\n        const texturesMap       = {}\r\n        const localCache        = {}\r\n\r\n        for ( let id in materials ) {\r\n\r\n            const material = materials[ id ]\r\n\r\n            let textures = {}\r\n            for ( let i = 0, numberOfAvailableTextures = availableTextures.length ; i < numberOfAvailableTextures ; i++ ) {\r\n                let mapType = availableTextures[ i ]\r\n\r\n                const map = material[ mapType ]\r\n                if ( isDefined( map ) && isString( map ) && isNotEmptyString( map ) ) {\r\n\r\n                    const texturePath  = `${this._texturesPath}/${map}`\r\n                    const cachedResult = localCache[ texturePath ]\r\n\r\n                    if ( isDefined( cachedResult ) ) {\r\n\r\n                        textures[ mapType ] = cachedResult\r\n\r\n                    } else {\r\n\r\n                        const texture = this._texturesProvider.load(\r\n                            texturePath,\r\n                            () => {},\r\n                            () => {},\r\n                            () => {\r\n\r\n                                if ( !texture.image ) {\r\n                                    texture.image       = DEFAULT_IMAGE\r\n                                    texture.needsUpdate = true\r\n                                }\r\n\r\n                            }\r\n                        )\r\n                        texture.name  = map\r\n\r\n                        if ( !this._generateMipmap ) {\r\n                            texture.generateMipmaps = false\r\n                            texture.magFilter       = LinearFilter\r\n                            texture.minFilter       = LinearFilter\r\n                        }\r\n\r\n                        localCache[ texturePath ] = texture\r\n                        textures[ mapType ]       = texture\r\n\r\n                    }\r\n\r\n                }\r\n\r\n            }\r\n\r\n            texturesMap[ id ] = textures\r\n\r\n        }\r\n\r\n        return texturesMap\r\n\r\n    }\r\n\r\n}\r\n\r\nexport { MaterialsManager }\r\n","/**\r\n * @author [Tristan Valcke]{@link https://github.com/Itee}\r\n * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}\r\n *\r\n * @class ClassName\r\n * @classdesc Todo...\r\n * @example Todo...\r\n *\r\n */\r\n\r\n/* eslint-env browser */\r\n\r\nimport { TDataBaseManager }   from 'itee-client'\r\nimport {\r\n    isDefined,\r\n    isNotBoolean,\r\n    isNotEmptyArray,\r\n    isNull,\r\n    isUndefined\r\n}                            from 'itee-validators'\r\nimport {\r\n    AmbientLight,\r\n    Color,\r\n    DirectionalLight,\r\n    Fog,\r\n    FogExp2,\r\n    Group,\r\n    HemisphereLight,\r\n    Line,\r\n    LineLoop,\r\n    LineSegments,\r\n    LOD,\r\n    Mesh,\r\n    Object3D,\r\n    OrthographicCamera,\r\n    PerspectiveCamera,\r\n    PointLight,\r\n    Points,\r\n    RectAreaLight,\r\n    Scene,\r\n    SkinnedMesh,\r\n    SpotLight,\r\n    Sprite\r\n}                            from 'three-full'\r\nimport { GeometriesManager } from './GeometriesManager'\r\nimport { MaterialsManager }  from './MaterialsManager'\r\n\r\nclass ObjectsManager extends TDataBaseManager {\r\n\r\n    /**\r\n     *\r\n     * @param parameters\r\n     */\r\n    constructor ( parameters = {} ) {\r\n\r\n        const _parameters = {\r\n            ...{\r\n                basePath:           '/objects',\r\n                geometriesProvider: new GeometriesManager(),\r\n                materialsProvider:  new MaterialsManager(),\r\n                projectionSystem:   'zBack',\r\n                globalScale:        1,\r\n                autoFillObjects3D:  true\r\n            }, ...parameters\r\n        }\r\n\r\n        super( _parameters )\r\n\r\n        this.geometriesProvider = _parameters.geometriesProvider\r\n        this.materialsProvider  = _parameters.materialsProvider\r\n        this.projectionSystem   = _parameters.projectionSystem\r\n        this.globalScale        = _parameters.globalScale\r\n        this.autoFillObjects3D  = _parameters.autoFillObjects3D\r\n\r\n    }\r\n\r\n    //// Getter/Setter\r\n\r\n    get geometriesProvider () {\r\n        return this._geometriesProvider\r\n    }\r\n\r\n    set geometriesProvider ( value ) {\r\n\r\n        if ( isNull( value ) ) { throw new TypeError( 'Geometries provider cannot be null ! Expect an instance of GeometriesManager.' ) }\r\n        if ( isUndefined( value ) ) { throw new TypeError( 'Geometries provider cannot be undefined ! Expect an instance of GeometriesManager.' ) }\r\n        if ( !( value instanceof GeometriesManager ) ) { throw new TypeError( `Geometries provider cannot be an instance of ${value.constructor.name} ! Expect an instance of TGeometriesManager.` ) }\r\n\r\n        this._geometriesProvider = value\r\n\r\n    }\r\n\r\n    get materialsProvider () {\r\n        return this._materialsProvider\r\n    }\r\n\r\n    set materialsProvider ( value ) {\r\n\r\n        if ( isNull( value ) ) { throw new TypeError( 'Materials provider cannot be null ! Expect an instance of MaterialsManager.' ) }\r\n        if ( isUndefined( value ) ) { throw new TypeError( 'Materials provider cannot be undefined ! Expect an instance of MaterialsManager.' ) }\r\n        if ( !( value instanceof MaterialsManager ) ) { throw new TypeError( `Materials provider cannot be an instance of ${value.constructor.name} ! Expect an instance of TMaterialsManager.` ) }\r\n\r\n        this._materialsProvider = value\r\n\r\n    }\r\n\r\n    get projectionSystem () {\r\n        return this._projectionSystem\r\n    }\r\n\r\n    set projectionSystem ( value ) {\r\n\r\n        if ( isNull( value ) ) { throw new TypeError( 'Projection system cannot be null ! Expect a positive number.' ) }\r\n        if ( isUndefined( value ) ) { throw new TypeError( 'Projection system cannot be undefined ! Expect a positive number.' ) }\r\n\r\n        this._projectionSystem = value\r\n\r\n    }\r\n\r\n    get globalScale () {\r\n        return this._globalScale\r\n    }\r\n\r\n    set globalScale ( value ) {\r\n\r\n        if ( isNull( value ) ) { throw new TypeError( 'Global scale cannot be null ! Expect a positive number.' ) }\r\n        if ( isUndefined( value ) ) { throw new TypeError( 'Global scale cannot be undefined ! Expect a positive number.' ) }\r\n\r\n        this._globalScale = value\r\n\r\n    }\r\n\r\n    get autoFillObjects3D () {\r\n        return this._autoFillObjects3D\r\n    }\r\n\r\n    set autoFillObjects3D ( value ) {\r\n\r\n        if ( isNull( value ) ) { throw new TypeError( 'Global scale cannot be null ! Expect a boolean.' ) }\r\n        if ( isUndefined( value ) ) { throw new TypeError( 'Global scale cannot be undefined ! Expect a positive number.' ) }\r\n        if ( isNotBoolean( value ) ) { throw new TypeError( 'Global scale cannot be null ! Expect a boolean.' ) }\r\n\r\n        this._autoFillObjects3D = value\r\n\r\n    }\r\n\r\n    setGeometriesProvider ( value ) {\r\n\r\n        this.geometriesProvider = value\r\n        return this\r\n\r\n    }\r\n\r\n    setMaterialsProvider ( value ) {\r\n\r\n        this.materialsProvider = value\r\n        return this\r\n\r\n    }\r\n\r\n    setProjectionSystem ( value ) {\r\n\r\n        this.projectionSystem = value\r\n        return this\r\n\r\n    }\r\n\r\n    setGlobalScale ( value ) {\r\n\r\n        this.globalScale = value\r\n        return this\r\n\r\n    }\r\n\r\n    setAutoFillObjects3D ( value ) {\r\n\r\n        this.autoFillObjects3D = value\r\n        return this\r\n\r\n    }\r\n\r\n    //// Methods\r\n\r\n    _onJson ( jsonData, onSuccess, onProgress, onError ) {\r\n\r\n        // Convert data from db to instanced object and add them into a map\r\n        const results = {}\r\n        for ( let dataIndex = 0, numberOfDatas = jsonData.length, data = undefined ; dataIndex < numberOfDatas ; dataIndex++ ) {\r\n\r\n            data = jsonData[ dataIndex ]\r\n\r\n            try {\r\n                results[ data._id ] = this.convert( data )\r\n            } catch ( err ) {\r\n                onError( err )\r\n            }\r\n\r\n            onProgress( new ProgressEvent( 'ObjectsManager', {\r\n                lengthComputable: true,\r\n                loaded:           dataIndex + 1,\r\n                total:            numberOfDatas\r\n            } ) )\r\n\r\n        }\r\n\r\n        // In case autoFill is true query materials and geometry\r\n        if ( this._autoFillObjects3D ) {\r\n            this.fillObjects3D( results, onSuccess, onProgress, onError )\r\n        } else {\r\n            onSuccess( results )\r\n        }\r\n\r\n    }\r\n\r\n    _onArrayBuffer ( data, onSuccess, onProgress, onError ) {}\r\n\r\n    _onBlob ( data, onSuccess, onProgress, onError ) {}\r\n\r\n    _onText ( data, onSuccess, onProgress, onError ) {}\r\n\r\n    /**\r\n     *\r\n     * @param data\r\n     * @return {*}\r\n     */\r\n    convert ( data ) {\r\n\r\n        if ( !data ) {\r\n            throw new Error( 'ObjectsManager: Unable to convert null or undefined data !' )\r\n        }\r\n\r\n        const objectType = data.type\r\n        let object       = null\r\n\r\n        // Todo: Use factory instead and allow user to register its own object type !!!\r\n        switch ( objectType ) {\r\n\r\n            case 'Object3D':\r\n                object = new Object3D()\r\n                this._fillBaseObjectsData( object, data )\r\n                break\r\n\r\n            case 'Scene':\r\n                object = new Scene()\r\n                this._fillBaseObjectsData( object, data )\r\n                if ( isDefined( data.background ) ) {\r\n\r\n                    if ( Number.isInteger( data.background ) ) {\r\n\r\n                        object.background = new Color( data.background )\r\n\r\n                    }\r\n\r\n                }\r\n                if ( isDefined( data.fog ) ) {\r\n\r\n                    if ( data.fog.type === 'Fog' ) {\r\n\r\n                        object.fog = new Fog( data.fog.color, data.fog.near, data.fog.far )\r\n\r\n                    } else if ( data.fog.type === 'FogExp2' ) {\r\n\r\n                        object.fog = new FogExp2( data.fog.color, data.fog.density )\r\n\r\n                    }\r\n\r\n                }\r\n                object.overrideMaterial = data.overrideMaterial\r\n                object.autoUpdate       = data.autoUpdate\r\n                break\r\n\r\n            case 'PerspectiveCamera':\r\n                object = new PerspectiveCamera()\r\n                this._fillBaseObjectsData( object, data )\r\n                object.fov    = data.fov\r\n                object.aspect = data.aspect\r\n                object.near   = data.near\r\n                object.far    = data.far\r\n                if ( isDefined( data.focus ) ) {\r\n                    object.focus = data.focus\r\n                }\r\n                if ( isDefined( data.zoom ) ) {\r\n                    object.zoom = data.zoom\r\n                }\r\n                if ( isDefined( data.filmGauge ) ) {\r\n                    object.filmGauge = data.filmGauge\r\n                }\r\n                if ( isDefined( data.filmOffset ) ) {\r\n                    object.filmOffset = data.filmOffset\r\n                }\r\n                if ( isDefined( data.view ) ) {\r\n                    object.view = Object.assign( {}, data.view )\r\n                }\r\n                break\r\n\r\n            case 'OrthographicCamera':\r\n                object = new OrthographicCamera( data.left, data.right, data.top, data.bottom, data.near, data.far )\r\n                this._fillBaseObjectsData( object, data )\r\n                break\r\n\r\n            case 'AmbientLight':\r\n                object = new AmbientLight( data.color, data.intensity )\r\n                this._fillBaseObjectsData( object, data )\r\n                break\r\n\r\n            case 'DirectionalLight':\r\n                object = new DirectionalLight( data.color, data.intensity )\r\n                this._fillBaseObjectsData( object, data )\r\n                break\r\n\r\n            case 'PointLight':\r\n                object = new PointLight( data.color, data.intensity, data.distance, data.decay )\r\n                this._fillBaseObjectsData( object, data )\r\n                break\r\n\r\n            case 'RectAreaLight':\r\n                object = new RectAreaLight( data.color, data.intensity, data.width, data.height )\r\n                this._fillBaseObjectsData( object, data )\r\n                break\r\n\r\n            case 'SpotLight':\r\n                object = new SpotLight( data.color, data.intensity, data.distance, data.angle, data.penumbra, data.decay )\r\n                this._fillBaseObjectsData( object, data )\r\n                break\r\n\r\n            case 'HemisphereLight':\r\n                object = new HemisphereLight( data.color, data.groundColor, data.intensity )\r\n                this._fillBaseObjectsData( object, data )\r\n                break\r\n\r\n            case 'SkinnedMesh':\r\n                object = new SkinnedMesh()\r\n                this._fillBaseObjectsData( object, data )\r\n                object.geometry          = data.geometry\r\n                object.material          = data.material\r\n                object.drawMode          = data.drawMode\r\n                object.bindMode          = data.bindMode\r\n                object.bindMatrix        = data.bindMatrix\r\n                object.bindMatrixInverse = data.bindMatrixInverse\r\n                break\r\n\r\n            case 'Mesh':\r\n                object = new Mesh()\r\n                this._fillBaseObjectsData( object, data )\r\n                object.geometry = data.geometry\r\n                object.material = data.material\r\n                object.drawMode = data.drawMode\r\n                break\r\n\r\n            case 'LOD':\r\n                object = new LOD()\r\n                this._fillBaseObjectsData( object, data )\r\n                object.levels = data.levels\r\n                break\r\n\r\n            case 'Line':\r\n                object = new Line()\r\n                this._fillBaseObjectsData( object, data )\r\n                object.geometry = data.geometry\r\n                object.material = data.material\r\n                object.drawMode = data.drawMode\r\n                break\r\n\r\n            case 'LineLoop':\r\n                object = new LineLoop()\r\n                this._fillBaseObjectsData( object, data )\r\n                object.geometry = data.geometry\r\n                object.material = data.material\r\n                object.drawMode = data.drawMode\r\n                break\r\n\r\n            case 'LineSegments':\r\n                object = new LineSegments()\r\n                this._fillBaseObjectsData( object, data )\r\n                object.geometry = data.geometry\r\n                object.material = data.material\r\n                object.drawMode = data.drawMode\r\n                break\r\n\r\n            case 'Points':\r\n                object = new Points()\r\n                this._fillBaseObjectsData( object, data )\r\n                object.geometry = data.geometry\r\n                object.material = data.material\r\n                object.drawMode = data.drawMode\r\n                break\r\n\r\n            case 'Sprite':\r\n                object = new Sprite()\r\n                this._fillBaseObjectsData( object, data )\r\n                object.material = data.material\r\n                break\r\n\r\n            case 'Group':\r\n                object = new Group()\r\n                this._fillBaseObjectsData( object, data )\r\n                break\r\n\r\n            default:\r\n                throw new Error( `TObjectsManager: Unknown object of type: ${objectType}` )\r\n                break\r\n\r\n        }\r\n\r\n        return object\r\n\r\n    }\r\n\r\n    _fillBaseObjectsData ( object, data ) {\r\n\r\n        // Common object properties\r\n        object._id = data._id\r\n\r\n        if ( isDefined( data.uuid ) ) {\r\n            object.uuid = data.uuid\r\n        }\r\n\r\n        if ( isDefined( data.name ) ) {\r\n            object.name = data.name\r\n        }\r\n\r\n        // IMPLICIT\r\n        //        if ( isDefined( data.type ) ) {\r\n        //            object.type = data.type\r\n        //        }\r\n\r\n        if ( isDefined( data.parent ) ) {\r\n            object.parent = data.parent\r\n        }\r\n\r\n        if ( isNotEmptyArray( data.children ) ) {\r\n            object.children = data.children\r\n        }\r\n\r\n        if ( isDefined( data.up ) ) {\r\n            object.up.x = data.up.x\r\n            object.up.y = data.up.y\r\n            object.up.z = data.up.z\r\n        }\r\n\r\n        if ( isDefined( data.position ) ) {\r\n\r\n            if ( this._projectionSystem === 'zBack' ) {\r\n\r\n                object.position.x = data.position.x / this._globalScale\r\n                object.position.y = data.position.z / this._globalScale\r\n                object.position.z = -data.position.y / this._globalScale\r\n\r\n            } else {\r\n\r\n                object.position.x = data.position.x / this._globalScale\r\n                object.position.y = data.position.y / this._globalScale\r\n                object.position.z = data.position.z / this._globalScale\r\n\r\n            }\r\n\r\n        }\r\n\r\n        if ( isDefined( data.rotation ) ) {\r\n\r\n            if ( this._projectionSystem === 'zBack' ) {\r\n\r\n                object.rotation.x     = data.rotation.x\r\n                object.rotation.y     = data.rotation.z\r\n                object.rotation.z     = -data.rotation.y\r\n                object.rotation.order = data.rotation.order\r\n\r\n            } else {\r\n\r\n                object.rotation.x     = data.rotation.x\r\n                object.rotation.y     = data.rotation.y\r\n                object.rotation.z     = data.rotation.z\r\n                object.rotation.order = data.rotation.order\r\n\r\n            }\r\n\r\n        }\r\n\r\n        if ( isDefined( data.quaternion ) ) {\r\n\r\n            if ( this._projectionSystem === 'zBack' ) {\r\n\r\n                object.quaternion.x = data.quaternion.x\r\n                object.quaternion.y = data.quaternion.z\r\n                object.quaternion.z = -data.quaternion.y\r\n                object.quaternion.w = data.quaternion.w\r\n\r\n            } else {\r\n\r\n                object.quaternion.x = data.quaternion.x\r\n                object.quaternion.y = data.quaternion.y\r\n                object.quaternion.z = data.quaternion.z\r\n                object.quaternion.w = data.quaternion.w\r\n\r\n            }\r\n\r\n        }\r\n\r\n        if ( isDefined( data.scale ) ) {\r\n\r\n            if ( data.scale.x !== 0 && data.scale.y !== 0 && data.scale.z !== 0 ) {\r\n                object.scale.x = data.scale.x\r\n                object.scale.y = data.scale.y\r\n                object.scale.z = data.scale.z\r\n            } else {\r\n                console.warn( 'Try to assign null scale !' )\r\n            }\r\n\r\n        }\r\n\r\n        if ( isDefined( data.modelViewMatrix ) && isNotEmptyArray( data.modelViewMatrix ) ) {\r\n            object.modelViewMatrix.fromArray( data.modelViewMatrix )\r\n        }\r\n\r\n        if ( isDefined( data.normalMatrix ) && isNotEmptyArray( data.normalMatrix ) ) {\r\n            object.normalMatrix.fromArray( data.normalMatrix )\r\n        }\r\n\r\n        if ( isDefined( data.matrix ) && isNotEmptyArray( data.matrix ) ) {\r\n            object.matrix.fromArray( data.matrix )\r\n        }\r\n\r\n        if ( isDefined( data.matrixWorld ) && isNotEmptyArray( data.matrixWorld ) ) {\r\n            object.matrixWorld.fromArray( data.matrixWorld )\r\n        }\r\n\r\n        if ( isDefined( data.matrixAutoUpdate ) ) {\r\n            object.matrixAutoUpdate = data.matrixAutoUpdate\r\n        }\r\n\r\n        if ( isDefined( data.matrixWorldNeedsUpdate ) ) {\r\n            object.matrixWorldNeedsUpdate = data.matrixWorldNeedsUpdate\r\n        }\r\n\r\n        if ( isDefined( data.layers ) ) {\r\n            object.layers.mask = data.layers\r\n        }\r\n\r\n        if ( isDefined( data.visible ) ) {\r\n            object.visible = data.visible\r\n        }\r\n\r\n        if ( isDefined( data.castShadow ) ) {\r\n            object.castShadow = data.castShadow\r\n        }\r\n\r\n        if ( isDefined( data.receiveShadow ) ) {\r\n            object.receiveShadow = data.receiveShadow\r\n        }\r\n\r\n        if ( isDefined( data.frustumCulled ) ) {\r\n            object.frustumCulled = data.frustumCulled\r\n        }\r\n\r\n        if ( isDefined( data.renderOrder ) ) {\r\n            object.renderOrder = data.renderOrder\r\n        }\r\n\r\n        if ( isDefined( data.userData ) ) {\r\n            object.userData = data.userData\r\n        }\r\n\r\n    }\r\n\r\n    //// Callback\r\n\r\n    fillObjects3D ( objects, onSuccess, onProgress, onError ) {\r\n\r\n        const self = this\r\n\r\n        // Get objects that need geometry or materials\r\n        const objectsArray = []\r\n        for ( let id in objects ) {\r\n\r\n            const object = objects[ id ]\r\n            if ( object.geometry || object.material ) {\r\n                objectsArray.push( objects[ id ] )\r\n            }\r\n\r\n        }\r\n\r\n        // In case no objects need to be filled return result\r\n        if ( objectsArray.length === 0 ) {\r\n            onSuccess( objects )\r\n            return\r\n        }\r\n\r\n        // Else fill geometries and materials for filtered objects\r\n        let geometriesMap = undefined\r\n        this._retrieveGeometriesOf( objectsArray, ( geometries ) => {\r\n            geometriesMap = geometries\r\n            onEndDataFetching()\r\n        }, onProgress, onError )\r\n\r\n        let materialsMap = undefined\r\n        this._retrieveMaterialsOf( objectsArray, ( materials ) => {\r\n            materialsMap = materials\r\n            onEndDataFetching()\r\n        }, onProgress, onError )\r\n\r\n        function onEndDataFetching () {\r\n\r\n            if ( !geometriesMap || !materialsMap ) { return }\r\n\r\n            for ( let key in objects ) {\r\n                const mesh = objects[ key ]\r\n                self.applyGeometry( mesh, geometriesMap )\r\n                self.applyMaterials( mesh, materialsMap )\r\n            }\r\n\r\n            // Don't forget to return all input object to callback,\r\n            // else some ids won't never be considered as processed !\r\n            onSuccess( objects )\r\n\r\n        }\r\n\r\n    }\r\n\r\n    _retrieveGeometriesOf ( meshes, onSuccess, onProgress, onError ) {\r\n\r\n        const geometriesIds = meshes.map( object => object.geometry )\r\n                                    .filter( ( value, index, self ) => {\r\n                                        return value && self.indexOf( value ) === index\r\n                                    } )\r\n\r\n        if ( geometriesIds.length === 0 ) {\r\n            onSuccess( {} )\r\n            return\r\n        }\r\n\r\n        this._geometriesProvider.read(\r\n            geometriesIds,\r\n            null,\r\n            onSuccess,\r\n            onProgress,\r\n            onError\r\n        )\r\n\r\n    }\r\n\r\n    _retrieveMaterialsOf ( meshes, onSuccess, onProgress, onError ) {\r\n\r\n        const materialsArray       = meshes.map( object => object.material )\r\n        const concatMaterialsArray = [].concat.apply( [], materialsArray )\r\n        const materialsIds         = concatMaterialsArray.filter( ( value, index, self ) => {\r\n            return value && self.indexOf( value ) === index\r\n        } )\r\n\r\n        if ( materialsIds.length === 0 ) {\r\n            onSuccess( {} )\r\n            return\r\n        }\r\n\r\n        this._materialsProvider.read(\r\n            materialsIds,\r\n            null,\r\n            onSuccess,\r\n            onProgress,\r\n            onError\r\n        )\r\n\r\n    }\r\n\r\n    /*\r\n     ///// PROMISE\r\n\r\n     async fillObjects3DByPromises ( objects, onSuccess, onProgress, onError ) {\r\n\r\n     const self         = this\r\n     const objectsArray = []\r\n     for ( let id in objects ) {\r\n     objectsArray.push( objects[ id ] )\r\n     }\r\n\r\n     const [ geometriesMap, materialsMap ] = await Promise.all( [\r\n     this._getGeometriesPromiseOf( objectsArray, onProgress, onError ),\r\n     this._getMaterialsPromiseOf( objectsArray, onProgress, onError )\r\n     ] )\r\n\r\n     for ( let key in objects ) {\r\n     const mesh = objects[ key ]\r\n     self.applyGeometry( mesh, geometriesMap )\r\n     self.applyMaterials( mesh, materialsMap )\r\n     }\r\n\r\n     // Don't forget to return all input object to callback,\r\n     // else some ids won't never be considered as processed !\r\n     onSuccess( objects )\r\n\r\n     }\r\n\r\n     _getGeometriesPromiseOf ( meshes, onProgress, onError ) {\r\n\r\n     const self = this\r\n\r\n     return new Promise( function ( resolve, reject ) {\r\n\r\n     const geometriesIds = meshes.map( object => object.geometry )\r\n     .filter( ( value, index, self ) => {\r\n     return value && self.indexOf( value ) === index\r\n     } )\r\n\r\n     if ( geometriesIds.length === 0 ) {\r\n     resolve( {} )\r\n     return\r\n     }\r\n\r\n     self._geometriesProvider.read(\r\n     geometriesIds,\r\n     null,\r\n     geometries => {\r\n     resolve( geometries )\r\n     },\r\n     onProgress,\r\n     onError\r\n     )\r\n\r\n     } )\r\n\r\n     }\r\n\r\n     _getMaterialsPromiseOf ( meshes, onProgress, onError ) {\r\n\r\n     const self = this\r\n\r\n     return new Promise( function ( resolve, reject ) {\r\n\r\n     const materialsArray       = meshes.map( object => object.material )\r\n     const concatMaterialsArray = [].concat.apply( [], materialsArray )\r\n     const materialsIds         = concatMaterialsArray.filter( ( value, index, self ) => {\r\n     return value && self.indexOf( value ) === index\r\n     } )\r\n\r\n     if ( materialsIds.length === 0 ) {\r\n     resolve( {} )\r\n     return\r\n     }\r\n\r\n     self._materialsProvider.read(\r\n     materialsIds,\r\n     null,\r\n     materials => {\r\n     resolve( materials )\r\n     },\r\n     onProgress,\r\n     onError\r\n     )\r\n\r\n     } )\r\n\r\n     }\r\n\r\n     ///// ASYNC\r\n\r\n     async fillObjects3D ( objects, onSuccess, onProgress, onError ) {\r\n\r\n     const self         = this\r\n     const objectsArray = []\r\n     for ( let id in objects ) {\r\n\r\n     const object = objects[ id ]\r\n     if ( object.geometry || object.material ) {\r\n     objectsArray.push( objects[ id ] )\r\n     }\r\n\r\n     }\r\n\r\n     if ( objectsArray.length === 0 ) {\r\n     onSuccess( objects )\r\n     return\r\n     }\r\n\r\n     let geometriesMap = undefined\r\n     this._retrieveGeometriesOf( objectsArray, ( geometries ) => {\r\n     geometriesMap = geometries\r\n     onEndDataFetching()\r\n     }, onProgress, onError )\r\n\r\n     let materialsMap = undefined\r\n     this._retrieveMaterialsOf( objectsArray, ( materials ) => {\r\n     materialsMap = materials\r\n     onEndDataFetching()\r\n     }, onProgress, onError )\r\n\r\n     function onEndDataFetching () {\r\n\r\n     if ( !geometriesMap || !materialsMap ) { return }\r\n\r\n     for ( let key in objects ) {\r\n     const mesh = objects[ key ]\r\n     self.applyGeometry( mesh, geometriesMap )\r\n     self.applyMaterials( mesh, materialsMap )\r\n     }\r\n\r\n     // Don't forget to return all input object to callback,\r\n     // else some ids won't never be considered as processed !\r\n     onSuccess( objects )\r\n\r\n     }\r\n\r\n     }\r\n\r\n     _retrieveGeometriesOf ( meshes, onSucess, onProgress, onError ) {\r\n\r\n     const geometriesIds = meshes.map( object => object.geometry )\r\n     .filter( ( value, index, self ) => {\r\n     return value && self.indexOf( value ) === index\r\n     } )\r\n\r\n     if ( geometriesIds.length === 0 ) {\r\n     onSucess( {} )\r\n     return\r\n     }\r\n\r\n     this._geometriesProvider.read(\r\n     geometriesIds,\r\n     null,\r\n     onSucess,\r\n     onProgress,\r\n     onError\r\n     )\r\n\r\n     }\r\n\r\n     _retrieveMaterialsOf ( meshes, onSucess, onProgress, onError ) {\r\n\r\n     const materialsArray       = meshes.map( object => object.material )\r\n     const concatMaterialsArray = [].concat.apply( [], materialsArray )\r\n     const materialsIds         = concatMaterialsArray.filter( ( value, index, self ) => {\r\n     return value && self.indexOf( value ) === index\r\n     } )\r\n\r\n     if ( materialsIds.length === 0 ) {\r\n     onSucess( {} )\r\n     return\r\n     }\r\n\r\n     this._materialsProvider.read(\r\n     materialsIds,\r\n     null,\r\n     onSucess,\r\n     onProgress,\r\n     onError\r\n     )\r\n\r\n     }\r\n\r\n     /////////////\r\n     */\r\n\r\n    applyGeometry ( object, geometries ) {\r\n\r\n        const geometryId = object.geometry\r\n        if ( !geometryId ) {\r\n            return\r\n        }\r\n\r\n        const geometry = geometries[ geometryId ]\r\n        if ( !geometry ) {\r\n            console.error( 'Unable to retrieve geometry !!!' )\r\n            return\r\n        }\r\n\r\n        object.geometry = geometry\r\n\r\n    }\r\n\r\n    applyMaterials ( object, materials ) {\r\n\r\n        const materialIds = object.material\r\n        if ( !materialIds ) {\r\n            return\r\n        }\r\n\r\n        if ( Array.isArray( materialIds ) ) {\r\n\r\n            if ( materialIds.length === 1 ) {\r\n\r\n                const materialId = materialIds[ 0 ]\r\n                const material   = materials[ materialId ]\r\n                if ( !material ) {\r\n                    console.error( 'Unable to retrieve material !!!' )\r\n                    return null\r\n                }\r\n\r\n                object.material = material.clone()\r\n\r\n            } else {\r\n\r\n                object.material = []\r\n                for ( let materialIndex = 0, numberOfMaterial = materialIds.length ; materialIndex < numberOfMaterial ; materialIndex++ ) {\r\n                    const materialId = materialIds[ materialIndex ]\r\n                    const material   = materials[ materialId ]\r\n                    if ( !material ) {\r\n                        console.error( 'Unable to retrieve material !!!' )\r\n                        return null\r\n                    }\r\n\r\n                    object.material.push( material.clone() )\r\n                }\r\n            }\r\n\r\n        } else if ( typeof materialIds === 'string' ) {\r\n\r\n            const material = materials[ materialIds ]\r\n            if ( !material ) {\r\n                console.error( 'Unable to retrieve material !!!' )\r\n                return\r\n            }\r\n\r\n            object.material = material.clone()\r\n\r\n        } else {\r\n\r\n            console.error( 'Invalid material ids, expected string or array of string' )\r\n\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\nexport { ObjectsManager }\r\n","/**\r\n * @author [Tristan Valcke]{@link https://github.com/Itee}\r\n * @license [BSD-3-Clause]{@link https://opensource.org/licenses/BSD-3-Clause}\r\n *\r\n * @class OrbitControlsHelper\r\n * @classdesc Todo...\r\n * @example Todo...\r\n *\r\n */\r\n\r\n/* eslint-env browser */\r\n\r\nimport {\r\n    BufferGeometry,\r\n    Color,\r\n    Float32BufferAttribute,\r\n    LineBasicMaterial,\r\n    LineSegments,\r\n    VertexColors\r\n} from 'three-full'\r\n\r\nclass OrbitControlsHelper extends LineSegments {\r\n\r\n    static _createInternalGeometry ( RADIUS, RADIALS, CIRCLES, DIVISIONS, color1, color2 ) {\r\n\r\n        const vertices = []\r\n        const colors   = []\r\n\r\n        let x, z, v, i, j, r, color\r\n\r\n        // create the radials\r\n        for ( i = 0 ; i <= RADIALS ; i++ ) {\r\n\r\n            v = ( i / RADIALS ) * ( Math.PI * 2 )\r\n\r\n            x = Math.sin( v ) * RADIUS\r\n            z = Math.cos( v ) * RADIUS\r\n\r\n            vertices.push( 0, 0, 0 )\r\n            vertices.push( x, 0, z )\r\n\r\n            color = ( i & 1 ) ? color1 : color2\r\n\r\n            colors.push( color.r, color.g, color.b )\r\n            colors.push( color.r, color.g, color.b )\r\n\r\n        }\r\n\r\n        // create the circles\r\n        for ( i = 0 ; i <= CIRCLES ; i++ ) {\r\n\r\n            color = ( i & 1 ) ? color1 : color2\r\n\r\n            r = RADIUS - ( RADIUS / CIRCLES * i )\r\n\r\n            for ( j = 0 ; j < DIVISIONS ; j++ ) {\r\n\r\n                // first vertex\r\n                v = ( j / DIVISIONS ) * ( Math.PI * 2 )\r\n\r\n                x = Math.sin( v ) * r\r\n                z = Math.cos( v ) * r\r\n\r\n                vertices.push( x, 0, z )\r\n                colors.push( color.r, color.g, color.b )\r\n\r\n                // second vertex\r\n                v = ( ( j + 1 ) / DIVISIONS ) * ( Math.PI * 2 )\r\n\r\n                x = Math.sin( v ) * r\r\n                z = Math.cos( v ) * r\r\n\r\n                vertices.push( x, 0, z )\r\n                colors.push( color.r, color.g, color.b )\r\n\r\n            }\r\n\r\n            // create axis\r\n            vertices.push(\r\n                -1, 0, 0, 1, 0, 0,\r\n                0, -1, 0, 0, 1, 0,\r\n                0, 0, -1, 0, 0, 1\r\n            )\r\n            colors.push(\r\n                1, 0, 0, 1, 0.6, 0,\r\n                0, 1, 0, 0.6, 1, 0,\r\n                0, 0, 1, 0, 0.6, 1\r\n            )\r\n\r\n        }\r\n\r\n        const positionBufferAttribute = new Float32BufferAttribute( vertices, 3 )\r\n        positionBufferAttribute.name  = 'TOrbitControlsHelperPositionBufferAttribute'\r\n\r\n        const colorBufferAttribute = new Float32BufferAttribute( colors, 3 )\r\n        colorBufferAttribute.name  = 'TOrbitControlsHelperColorBufferAttribute'\r\n\r\n        const geometry = new BufferGeometry()\r\n        geometry.addAttribute( 'position', positionBufferAttribute )\r\n        geometry.addAttribute( 'color', colorBufferAttribute )\r\n        geometry.name = 'TOrbitControlsHelperGeometry'\r\n\r\n        return geometry\r\n\r\n    }\r\n\r\n    static _createInternalMaterial () {\r\n\r\n        const material       = new LineBasicMaterial( { vertexColors: VertexColors } )\r\n        material.transparent = true\r\n        material.opacity     = 0.0\r\n        material.name        = 'TOrbitControlsHelperMaterial'\r\n\r\n        return material\r\n\r\n    }\r\n\r\n    constructor ( parameters = {} ) {\r\n\r\n        const _parameters = {\r\n            ...{\r\n                radius:     2,\r\n                radials:    16,\r\n                circles:    2,\r\n                divisions:  64,\r\n                innerColor: new Color( 0x444444 ),\r\n                outerColor: new Color( 0x888888 )\r\n            }, ...parameters\r\n        }\r\n\r\n        super( OrbitControlsHelper._createInternalGeometry( _parameters.radius, _parameters.radials, _parameters.circles, _parameters.divisions, _parameters.innerColor, _parameters.outerColor ), OrbitControlsHelper._createInternalMaterial() )\r\n\r\n        //        this.control     = control\r\n        this._intervalId = undefined\r\n\r\n        //        this.impose()\r\n\r\n    }\r\n\r\n    startOpacityAnimation () {\r\n\r\n        // In case fade off is running, kill it an restore opacity to 1\r\n        if ( this._intervalId !== undefined ) {\r\n\r\n            clearInterval( this._intervalId )\r\n            this._intervalId = undefined\r\n\r\n        }\r\n\r\n        this.material.opacity = 1.0\r\n\r\n    }\r\n\r\n    endOpacityAnimation () {\r\n\r\n        // Manage transparency interval\r\n        this._intervalId = setInterval( function () {\r\n\r\n            if ( this.material.opacity <= 0.0 ) {\r\n\r\n                this.material.opacity = 0.0\r\n                clearInterval( this._intervalId )\r\n                this._intervalId = undefined\r\n\r\n            } else {\r\n\r\n                this.material.opacity -= 0.1\r\n\r\n            }\r\n\r\n        }.bind( this ), 100 )\r\n\r\n    }\r\n\r\n}\r\n\r\nexport { OrbitControlsHelper }\r\n"],"names":["FRONT","Vector3","BACK","UP","DOWN","RIGHT","LEFT","State","toEnum","None","Rotating","Panning","Rolling","Zooming","Moving","CameraControlMode","FirstPerson","Orbit","Fly","Path","CameraControls","EventDispatcher","[object Object]","parameters","_parameters","logger","DefaultLogger","camera","target","Object3D","mode","domElement","window","super","this","_handlers","onMouseEnter","_onMouseEnter","bind","onMouseLeave","_onMouseLeave","onMouseDown","_onMouseDown","onMouseMove","_onMouseMove","onMouseWheel","_onMouseWheel","onMouseUp","_onMouseUp","onDblClick","_onDblClick","onTouchStart","_onTouchStart","onTouchEnd","_onTouchEnd","onTouchCancel","_onTouchCancel","onTouchLeave","_onTouchLeave","onTouchMove","_onTouchMove","onKeyDown","_onKeyDown","onKeyUp","_onKeyUp","enabled","_paths","_trackPath","_cameraJump","_currentPathPosition","_currentPathOffset","_currentPathIndex","_currentPath","_maxJump","_lockedTarget","previousTouches","canMove","moveSpeed","canFront","frontMinimum","Infinity","frontMaximum","frontMinSpeed","frontSpeed","frontMaxSpeed","frontAcceleration","canBack","backMinimum","backMaximum","backMinSpeed","backSpeed","backMaxSpeed","backAcceleration","canUp","upMinimum","upMaximum","upMinSpeed","upSpeed","upMaxSpeed","upAcceleration","canDown","downMinimum","downMaximum","downMinSpeed","downSpeed","downMaxSpeed","downAcceleration","canLeft","leftMinimum","leftMaximum","leftMinSpeed","leftSpeed","leftMaxSpeed","leftAcceleration","canRight","rightMinimum","rightMaximum","rightMinSpeed","rightSpeed","rightMaxSpeed","rightAcceleration","canRotate","minPolarAngle","maxPolarAngle","Math","PI","minAzimuthAngle","maxAzimuthAngle","rotateMinSpeed","rotateSpeed","rotateMaxSpeed","rotateAcceleration","canPan","panMinimum","panMaximum","panMinSpeed","panSpeed","panMaxSpeed","panAcceleration","canRoll","rollMinimum","rollMaximum","rollMinSpeed","rollSpeed","rollMaxSpeed","rollAcceleration","canZoom","zoomMinimum","zoomMaximum","zoomMinSpeed","zoomSpeed","zoomMaxSpeed","zoomAcceleration","canLookAt","actionsMap","front","Keys","Z","value","UP_ARROW","back","S","DOWN_ARROW","up","A","PAGE_UP","down","E","PAGE_DOWN","left","Q","LEFT_ARROW","right","D","RIGHT_ARROW","rotate","Mouse","pan","MIDDLE","roll","R","T","zoom","WHEEL","lookAtFront","NUMPAD_2","lookAtFrontLeft","NUMPAD_3","lookAtFrontRight","NUMPAD_1","lookAtBack","NUMPAD_8","lookAtBackLeft","NUMPAD_9","lookAtBackRight","NUMPAD_7","lookAtUp","NUMPAD_5","lookAtDown","NUMPAD_0","lookAtLeft","NUMPAD_6","lookAtRight","NUMPAD_4","_state","_camera","isNull","Error","isUndefined","Camera","constructor","name","_target","_mode","_initPathDisplacement","paths","trackPath","isNotBoolean","_domElement","Window","HTMLDocument","HTMLDivElement","HTMLCanvasElement","removeEventListener","dispose","addEventListener","impose","push","capture","once","passive","dispatchEvent","type","newCameraPosition","position","copy","lookAt","newTargetPosition","event","cancelable","stopImmediatePropagation","keyEvent","preventDefault","actionMap","key","keyCode","includes","_front","_consumeEvent","_back","_up","_down","_left","_right","_rotate","_pan","_roll","_zoom","_lookAt","normalize","touchEvent","touches","currentTouches","changedTouches","numberOfPreviousTouches","length","numberOfCurrentTouches","previousTouchA","Vector2","clientX","clientY","previousTouchB","previousGap","distanceTo","previousCenter","addVectors","divideScalar","previousDirection","subVectors","currentTouchA","currentTouchB","currentGap","currentCenter","currentDirection","deltaPan","deltaZoom","deltaRoll","dot","deltaRotate","warn","mouseEvent","focus","blur","button","state","delta","x","movementX","mozMovementX","webkitMovementX","y","movementY","mozMovementY","webkitMovementY","RangeError","wheelDelta","deltaY","cameraDirection","clone","applyQuaternion","quaternion","displacement","_getPathDisplacement","multiplyScalar","add","cameraPosition","targetPosition","targetToCamera","normalizedX","normalizedY","cameraToTargetDirection","dotProductUp","dotProductRight","max","lockedTargetPostion","setTargetPosition","spherical","Spherical","setFromVector3","newTheta","theta","degreesToRadians","newPhi","phi","min","newPosition","setFromSpherical","setCameraPosition","angle","applyAxisAngle","fov","updateProjectionMatrix","distanceBetweenCameraAndTarget","cameraNextPosition","currentCameraToNextCameraDirection","targetToCurrentCameraDirection","targetToNextCameraDirection","dotCurrentDirection","dotNextDirection","nextCameraToTargetSquaredDistance","distanceToSquared","direction","_direction","isEmptyArray","isNotDefined","getPointAt","currentPathPosition","nextPositiveOffset","positiveOffset","positivePathPosition","positiveDisplacement","positiveDirection","positiveDot","nextNegativeOffset","negativeOffset","negativePathPosition","negativeDisplacement","negativeDirection","negativeDot","pathExtremityMap","_getDirectionsMap","indexOfBestPath","undefined","bestDisplacement","bestDotProduct","isFromStart","forEach","pathExtremity","pathIndex","index","startDisplacement","startDirection","startDot","endDisplacement","endDirection","endDot","currentIndex","jump","maxDistance","reduce","array","path","start","end","PI_2","STATE","NONE","ROTATE","ZOOM","PAN","xVector","yVector","CameraPathController","self","currentState","cameraJump","pathsMap","Map","currentPath","currentPathIndex","document","forwardControl","children","backwardControl","timeoutId","enableZoom","enableRotate","enablePan","keyPanSpeed","verticalOffset","keysCodes","forwardKeys","backwardKeys","BOTTOM_ARROW","mouseQuat","Quaternion","moveForward","TLogger","log","indexOfNextPath","get","update","moveBackward","indexOfPreviousPath","pathCurrentPoint","pathDirection","sub","negate","dotProduct","getWorldDirection","mouseButtons","ORBIT","orientation","MOUSE","z","setFromAxisAngle","multiply","clearTimeout","setTimeout","Object","assign","prototype","getLength","nameOfFirstPathToFollow","pathToFollow","numberOfPaths","firstPath","startFirstPath","endFirstPath","secondPath","startSecondPath","endSecondPath","firstPathIndex","closestStartDistance","closestEndDistance","indexOfClosestStartPath","indexOfClosestEndPath","secondPathIndex","set","setPath","quat","asin","nextPosition","getNextPathPosition","setMouseQuat","numberOfPoints","currentPathPoints","closestPointIndex","closestPath","closestPathIndex","currentDistance","closestDistance","numberOfPath","floor","getSpacedPoints","pointIndex","lookAtPath","LineGeometry","BufferGeometry","pointA","pointB","addAttribute","Float32BufferAttribute","ClippingBox","LineSegments","geometry","EdgesGeometry","BoxBufferGeometry","material","LineBasicMaterial","color","normalPlanes","normalRightSide","normalLeftSide","normalFrontSide","normalBackSide","normalTopSide","normalBottomSide","planes","rightSidePlane","Plane","leftSidePlane","frontSidePlane","backSidePlane","topSidePlane","bottomSidePlane","_boundingBox","Box3","computeBoundingSphere","boundingSphere","applyMatrix4","matrixWorld","objects","i","traverse","object","materials","isArray","materialIndex","numberOfMaterial","clippingPlanes","size","scale","setFromObject","constant","HighlightableMaterial","MeshBasicMaterial","isHighlightableMaterial","depthTest","depthWrite","fog","side","DoubleSide","transparent","oldColor","highlighted","lum","_r","r","_g","g","_b","b","setRGB","HighlightableLineMaterial","linewidth","AbstractHitbox","Mesh","visible","isHitbox","CylindricaHitbox","cylinderGeometry","CylinderBufferGeometry","translate","isCylindricaHitbox","PlanarHitbox","planeBufferGeometry","setIndex","isPlanarHitbox","LozengeHitbox","positionBufferAttribute","lozengeBufferGeometry","OctahedricalHitbox","OctahedronBufferGeometry","isOctahedricalHitbox","TorusHitbox","TorusBufferGeometry","isTorusHitbox","AbstractHandle","hitbox","isHandle","baseQuaternion","line","child","setHex","_hitbox","childIndex","numberOfChildren","childMaterial","highlight","raycaster","intersects","intersections","intersectObject","distance","axis","TranslateHandle","isTranslateHandle","lineGeometry","lineMaterial","Line","coneGeometry","ConeBufferGeometry","coneMaterial","cone","radians","acos","flipDirection","ScaleHandle","isScaleHandle","boxGeometry","boxMaterial","box","PlaneHandle","isPlaneHandle","lineBufferGeometry","planeMaterial","opacity","plane","xAxis","yAxis","zAxis","xDirection","yDirection","zDirection","xDot","yDot","zDot","rotateOnAxis","setX","setY","setZ","LozengeHandle","lozengeMaterial","lozenge","tempDirection","OctahedricalHandle","isOmnidirectionalHandle","octahedronGeometry","octahedronMaterial","octahedron","edgesGeometry","edgesMaterial","edges","AbstractGizmo","isGizmo","handles","planeGeometry","PlaneBufferGeometry","intersectPlane","gizmoMap","parent","element","isNotArray","renderOrder","rotation","tag","updateMatrix","tempGeometry","applyMatrix","matrix","setupGizmos","handleGizmos","currentHandle","updateIntersectPlane","TranslateGizmo","isTranslateGizmo","X","Y","XY","setScale","YZ","setRotationFromAxisAndAngle","XZ","XYZ","init","RotateGizmo","isRotateGizmo","CircleGeometry","radius","facing","arc","vertices","cos","sin","pickerGizmos","tube","radialSegments","tubularSegments","ScaleGizmo","isScaleGizmo","ClippingModes","Translate","Rotate","Scale","ClippingControls","objectsToClip","_objectsToClipBoundingBox","_clippingBox","translationSnap","scaleSnap","rotationSnap","_dragging","_firstPoint","_secondPoint","_mouseDisplacement","_offset","_raycaster","Raycaster","_pointerVector","_directionToMouse","_cameraPosition","_cameraDirection","_worldPosition","_worldRotation","Euler","_gizmos","_currentGizmo","_currentHandle","_events","change","mouseEnter","mouseLeave","mouseDown","mouseUp","objectChange","setMode","widthPlus","widthMinus","heightPlus","heightMinus","depthPlus","depthMinus","_objectsToClip","makeEmpty","expandByObject","getSize","round","updateClipping","applyClippingTo","getWorldPosition","altActive","altKey","ctrlActive","ctrlKey","metaActive","metaKey","shiftActive","shiftKey","_translateZ","_translateX","_translateY","_scaleZ","_scaleX","_scaleY","defaultPrevented","planeIntersect","intersectObjects","point","intersect","handle","isDefined","currentHandleName","_translate","isRotateHandle","abs","_scale","pointer","clientRect","getBoundingClientRect","width","top","height","setFromCamera","deltaX","deltaZ","changeAmout","BufferGeometriesManager","TDataBaseManager","call","basePath","CurvesManager","create","data","onError","texture","Scene","defineProperties","_onJson","jsonData","onSuccess","onProgress","datas","isObject","results","result","dataIndex","numberOfDatas","convert","_id","curveType","curve","ArcCurve","CatmullRomCurve3","CubicBezierCurve","CubicBezierCurve3","Curve","CurvePath","EllipseCurve","LineCurve","LineCurve3","QuadraticBezierCurve","QuadraticBezierCurve3","SplineCurve","Shape","fromJSON","err","FilairesManager","responseType","ResponseType","Json","bunchSize","requestAggregationTime","requestsConcurrency","id","ProgressEvent","lengthComputable","loaded","total","objectType","_parseFilaire","_parsePoint","positions","JSON","parse","geojson","coordinates","acc","val","concat","bufferGeometry","numero_bloc","SphereBufferGeometry","parseFloat","attribut","computeVertexNormals","MeshPhongMaterial","ArrayType","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","GeometriesManager","projectionSystem","globalScale","computeNormals","computeBoundingBox","_computeBoundingBox","TypeError","_computeBoundingSphere","_computeNormals","_projectionSystem","_globalScale","geometryType","isBufferGeometry","_convertJsonToBufferGeometry","isGeometry","_convertJsonToGeometry","computeFaceNormals","boundingBox","types","BoxGeometry","CylinderGeometry","ConeGeometry","DodecahedronGeometry","ExtrudeGeometry","Geometry","IcosahedronGeometry","LatheGeometry","OctahedronGeometry","ParametricGeometry","PlaneGeometry","PolyhedronGeometry","RingGeometry","ShapeGeometry","TetrahedronGeometry","TextGeometry","TorusGeometry","TorusKnotGeometry","TubeGeometry","SphereGeometry","WireframeGeometry","uuid","vertex","numberOfVertices","faces","face","faceIndex","numberOfFaces","Face3","a","c","normal","morphTargets","morphNormals","skinWeights","skinIndices","lineDistances","elementsNeedUpdate","verticesNeedUpdate","uvsNeedUpdate","normalsNeedUpdate","colorsNeedUpdate","lineDistancesNeedUpdate","groupsNeedUpdate","bufferGeometryType","CircleBufferGeometry","DodecahedronBufferGeometry","ExtrudeBufferGeometry","IcosahedronBufferGeometry","LatheBufferGeometry","ParametricBufferGeometry","PolyhedronBufferGeometry","RingBufferGeometry","TetrahedronBufferGeometry","TextBufferGeometry","TorusKnotBufferGeometry","TubeBufferGeometry","InstancedBufferGeometry","dataIndexes","arrayBuffer","__convertBase64ToArrayBuffer","typedArray","__convertArrayBufferToTypedArray","BufferAttribute","itemSize","normalized","dataAttributes","attributes","positionAttributes","positionArray","pi","numPos","posIndex","normalAttributes","uvAttributes","uv","groups","shapes","map","jsonShape","curveSegments","dataView","DataView","dataByteLength","byteLength","getUint8","offset","getInt8","getInt16","getUint16","getInt32","getUint32","getFloat32","getFloat64","base64","chars","lookup","charCodeAt","base64Length","bufferLength","arraybuffer","ArrayBuffer","bytes","encoded1","encoded2","encoded3","encoded4","TexturesManager","textureType","DEFAULT_IMAGE","ImageLoader","load","MaterialsManager","texturesPath","texturesProvider","TextureLoader","generateMipmap","autoFillTextures","_texturesPath","isNotString","isEmptyString","isBlankString","_texturesProvider","_generateMipmap","_autoFillTextures","fillTextures","_fillBaseMaterialData","_setColor","specular","shininess","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalScale","_setVector2","displacementMap","displacementScale","displacementBias","specularMap","alphaMap","envMap","combine","reflectivity","refractionRatio","wireframe","wireframeLinewidth","wireframeLinecap","wireframeLinejoin","skinning","MeshLambertMaterial","PointsMaterial","sizeAttenuation","isString","lights","blending","flatShading","vertexColors","blendSrc","blendDst","blendEquation","blendSrcAlpha","blendDstAlpha","blendEquationAlpha","depthFunc","clipIntersection","clipShadows","colorWrite","precision","polygonOffset","polygonOffsetFactor","polygonOffsetUnits","dithering","alphaTest","premultipliedAlpha","overdraw","userData","needsUpdate","vec2","Color","texturesMap","_retrieveTexturesOf","textures","textureKey","availableTextures","localCache","numberOfAvailableTextures","mapType","isNotEmptyString","texturePath","cachedResult","image","generateMipmaps","magFilter","LinearFilter","minFilter","ObjectsManager","geometriesProvider","materialsProvider","autoFillObjects3D","_geometriesProvider","_materialsProvider","_autoFillObjects3D","fillObjects3D","_fillBaseObjectsData","background","Number","isInteger","Fog","near","far","FogExp2","density","overrideMaterial","autoUpdate","PerspectiveCamera","aspect","filmGauge","filmOffset","view","OrthographicCamera","bottom","AmbientLight","intensity","DirectionalLight","PointLight","decay","RectAreaLight","SpotLight","penumbra","HemisphereLight","groundColor","SkinnedMesh","drawMode","bindMode","bindMatrix","bindMatrixInverse","LOD","levels","LineLoop","Points","Sprite","Group","isNotEmptyArray","order","w","console","modelViewMatrix","fromArray","normalMatrix","matrixAutoUpdate","matrixWorldNeedsUpdate","layers","mask","castShadow","receiveShadow","frustumCulled","objectsArray","geometriesMap","_retrieveGeometriesOf","geometries","onEndDataFetching","materialsMap","mesh","applyGeometry","applyMaterials","_retrieveMaterialsOf","meshes","geometriesIds","filter","indexOf","read","materialsArray","materialsIds","apply","geometryId","error","materialIds","Array","OrbitControlsHelper","RADIUS","RADIALS","CIRCLES","DIVISIONS","color1","color2","colors","v","j","colorBufferAttribute","VertexColors","radials","circles","divisions","innerColor","outerColor","_createInternalGeometry","_createInternalMaterial","_intervalId","clearInterval","setInterval"],"mappings":"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"}